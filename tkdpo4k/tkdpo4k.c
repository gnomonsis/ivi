/***************************************************************************** 
 * (c) 2005 - 2016, National Instruments, Corporation.  All Rights Reserved. * 
 *****************************************************************************/

/****************************************ch*************************************
 *  TKDPO4K 2(4)-CH Digital Phosphor Oscilloscope Instrument Driver
 *  LabWindows/CVI 5.0 Instrument Driver
 *  Original Release: Tuesday, August 16, 2005
 *  By: Penar Zhu, National Instruments                              
 *      PH. 86-21-65557838   Fax 86-21-65556244
 *
 *  Modification History:
 *
 *       Tuesday, August 16, 2005 - Instrument Driver Created.
 *       07/14/2006 [PZ] - Modify the implementation of TKDPO7K_ATTR_PROBE_ATTENUATION
 *                         to support probe value.
 *
 *       07/24/2006 [PZ] - Modify the implementation of 
 *                         tkdpo4k_buildProbeAttenuationRangeTable.
 *
 *       06/19/2006 [PZ] - Add ID Query support for MSO 4000 series scope.
 *
 *       06/22/2007 [PZ] - Remove the tkdpo4k_buildProbeAttenuationRangeTable to
 *                         avoid overmuch IO operation in initialization and
 *                         give the TKDPO4K_ATTR_PROBE_ATTENUATION attribute a
 *                         loose range table.
 *
 *       11/16/2007 [PZ] - Add support for MSO 4000 series scope.
 *                         Add function tkdpo4k_ConfigureDigitalChannel,                                                                                                                          
 *                         tkdpo4k_ConfigureMagnivuEnabled,
 *                         tkdpo4k_ConfigureRS232, tkdpo4k_ConfigureParallel,
 *                         tkdpo4k_ConfigureTVTriggerFieldHoldoff,
 *                         tkdpo4k_ConfigureTVTriggerHDTV,
 *                         tkdpo4k_ConfigureTVTriggerCustom,
 *                         tkdpo4k_ConfigureRS232Trigger, and
 *                         tkdpo4k_ConfigureParallelTrigger.
 *                         Add support of digital channels for MSO 4000 models.
 *
 *       11/19/2007 [EZ] - Add support for DPO 3000 series scope.
 *
 *       04/11/2008 [EZ] - Add function
 *                         tkdpo4k_ReadPhaseMeasurement
 *                         tkdpo4k_ReadDelayMeasurement
 *                         tkdpo4k_FetchPhaseMeasurement
 *                         tkdpo4k_FetchDelayMeasurement
 *  
 *       04/29/2008 [EZ] - Change the hierarchy of Inherent IVI Properties.
 *
 *       07/04/2008 [EZ] - Change the error code to VI_ERROR_FAIL_ID_QUERY
 *                         when ID Query fails.
 *
 *       01/05/2010 [LL] - Change the external trigger level range.
 *                         Change the function: 
 *                         tkdpo4k_SetCachingOnProbeDependentAttributes
 *
 *       05/29/2010 [LL] - Add support for MSO3000 series scope.
 *                         Add ID Query support for MSO3000 series scope.
 *                         Porting driver to 64-bit.
 * 
 *       01/31/2011 [Liping] - Add support for MSO/DPO 4KB series scope.
 *                             
                               Added functions:
 *                             tkdpo4k_ConfigureBusThreshold
 *                             tkdpo4k_ConfigureEthernet
 *                             tkdpo4k_ConfigureUSBTrigger
 *                             tkdpo4k_ConfigureEthernetTriggerBasic
 *                             tkdpo4k_ConfigureEthernetTriggerData
 *                             tkdpo4k_ConfigureEthernetTriggerIPH
 *                             tkdpo4k_ConfigureEthernetTriggerMAC
 *                             tkdpo4k_ConfigureEthernetTriggerQTAG
 *                             tkdpo4k_ConfigureEthernetTriggerTCPH
 *                             tkdpo4k_ReadRFChannelPower
 *
 *                             Added Attributes:
 *                             TKDPO4K_ATTR_UPPER_THRESHOLD
 *                             TKDPO4K_ATTR_LOWER_THRESHOLD
 *                             TKDPO4K_ATTR_BUS_ETHERNET_TYPE
 *                             TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE
 *                             TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC
 *                             TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC
 *                             TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC
 *                             TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL
 *                             TKDPO4K_ATTR_ENET_BASIC_CONDITION
 *                             TKDPO4K_ATTR_ENET_BASIC_QUALIFIER
 *                             TKDPO4K_ATTR_ENET_DATA_SIZE
 *                             TKDPO4K_ATTR_ENET_DATA_OFFSET
 *                             TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT
 *                             TKDPO4K_ATTR_ENET_DATA
 *                             TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS
 *                             TKDPO4K_ATTR_ENET_IP_DST_ADDRESS
 *                             TKDPO4K_ATTR_ENET_IP_PROTOCOL
 *                             TKDPO4K_ATTR_ENET_MAC_DST_ADRESS
 *                             TKDPO4K_ATTR_ENET_MAC_SRC_ADRESS
 *                             TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH
 *                             TKDPO4K_ATTR_ENET_MAC_LENGTH
 *                             TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS
 *                             TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS
 *                             TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER
 *                             TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER
 *                             TKDPO4K_ATTR_ENET_QTAG
 *                             TKDPO4K_ATTR_USB_TRAN_END_POINT
 *                             TKDPO4K_ATTR_USB_TRAN_START_END
 *                             TKDPO4K_ATTR_USB_TRAN_FIELD
 *                             TKDPO4K_ATTR_USB_PORT_ADDRESS
 *                             TKDPO4K_ATTR_USB_HUB_ADDRESS
 *
 *      09/19/2011 [xTan] -    Add support for MDO 4K series Oscilloscope.
 *                             Added function:
 *                             tkdpo4k_ConfigureRFRBW
 *                             tkdpo4k_ConfigureRFRFSquelch
 *                             tkdpo4k_ConfigureRFSpectrum
 *                             tkdpo4k_ConfigureRFDetection
 *                             tkdpo4k_ConfigureRFNumAverages
 *                             tkdpo4k_ConfigureRFMeasurement
 *                             tkdpo4k_ConfigureTimeDomainWinFunc
 *                             tkdpo4k_EnableRFChannel
 *                             tkdpo4k_ConfigureMathChannelSpectrum
 *
 *                             Added Attributes:
 *                             TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ
 *                             TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ
 *                             TKDPO4K_ATTR_RF_MEASURE_OBW_PERCENT_DOWN
 *                             TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO
 *                             TKDPO4K_ATTR_RF_MEASURE_CHANNEL_POWER
 *                             TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH
 *                             TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING
 *                             TKDPO4K_ATTR_RF_MEASURE_ACPR_ADJACENTPAIRS
 *                             TKDPO4K_ATTR_RF_MEASURE_TYPE
 *                             TKDPO4K_ATTR_RF_FFT_WINDOW
 *                             TKDPO4K_ATTR_RF_UNITS
 *                             TKDPO4K_ATTR_RF_REF_LEVEL
 *                             TKDPO4K_ATTR_RF_FREQ_STOP
 *                             TKDPO4K_ATTR_RF_FREQ_START
 *                             TKDPO4K_ATTR_RF_FREQ_CENTER
 *                             TKDPO4K_ATTR_RF_FREQ_SPAN
 *                             TKDPO4K_ATTR_RF_SPECTRUM_MODE
 *                             TKDPO4K_ATTR_RF_SPAN_RBM_RATIO
 *                             TKDPO4K_ATTR_RF_RBW_MODE
 *                             TKDPO4K_ATTR_RF_RBW
 *                             TKDPO4K_ATTR_RF_SQUELCH_THRESHOLD
 *                             TKDPO4K_ATTR_RF_SQUELCH_STATE
 *                             TKDPO4K_ATTR_RF_DETECTION_MODE
 *                             TKDPO4K_ATTR_RF_DETECTION_METHOD
 *                             TKDPO4K_ATTR_RF_AVERAGE_TRACE_COUNT
 *                             TKDPO4K_ATTR_RF_NUM_AVERAGES
 *                             TKDPO4K_ATTR_MATH_RF_SOURCE_1ST
 *                             TKDPO4K_ATTR_MATH_RF_SOURCE_2ND
 *
 *      03/10/2012 [hfeng] -   Add support for DPO4102B, DPO4102B-L, DPO4104B, 
 *                                             MSO4102B, MSO4102B-L, MSO4104B 
 *                             Fix a bug in function :
 *                             tkdpo4kAttrInstrumentModel_ReadCallback
 *
 *      08/31/2013 [zsu] -     Add support for MDO4014-3, MDO4034-3,  
 *                                             DPO4014B, MSO4014B,  
 *                                             MDO4014B-3, MDO4034B-3, MDO4054B-3,
 *                                             MDO4054B-6, MDO4104B-3, MDO4104B-6
 *                             Added function: 
 *                             tkdpo4k_ConfigureAuxInTriggerLevel
 *                             tkdpo4k_ConfigureFastAcquisition
 *                             tkdpo4k_ConfigureMathExpDisplay
 *                             tkdpo4k_ReadSnapshotMeasurement
 *                             tkdpo4k_ConfigureRFPhaseTrace
 *                             tkdpo4k_ReadRFVersusBandwidth
 *                             tkdpo4k_ResetSpectrumTraces
 *                             tkdpo4k_ClearSpectrogram
 *                             tkdpo4k_ReadSpectrogramTime
 *                             tkdpo4k_SetRFIQDataFileFormat
 *
 *                             Added Attributes: 
 *                             TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE
 *                             TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN
 *                             TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING
 *                             TKDPO4K_ATTR_FASTACQ_STATE
 *                             TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY
 *                             TKDPO4K_ATTR_RF_PHASE_IN_DEGREES
 *                             TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM
 *                             TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE
 *                             TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH
 *                             TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP
 *                             TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM
 *                             TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT
 *
 *                             Add 5M and 20M to attrDPO4KTotalPointsRangeTableEntries.
 *                             Add new HD format to attrDPO4KTvTriggerSignalFormatRangeTableEntries.
 *                             Add 1-2000 range to attrNumEnvelopesRangeTableEntries.  
 *                             Fix a bug in function:tkdpo4kAttrNumEnvelopes_ReadCallback 
 *                                                   tkdpo4kAttrNumEnvelopes_WriteCallback. 
 *                             Add new type to tkdpo4k_buildRangeTable.
 *
 *      03/25/2014 [zsu] -     Add support for MDO3012, MDO3014, MDO3022, MDO3024,   
 *                                             MDO3032, MDO3034, MDO3052, MDO3054, 
 *                                             MDO3102, MDO3104
 *
 *                             Added function: 
 *                             tkdpo4k_ConfigureStandardWaveform
 *                             tkdpo4k_ConfigurePresetLevel
 *                             tkdpo4k_ConfigureNoise
 *                             tkdpo4k_ConfigureOutputEnabled
 *                             tkdpo4k_ConfigureOutputImpedance
 *                             tkdpo4k_ConfigurePeriod
 *                             tkdpo4k_ConfigureSquareDutyCycle
 *                             tkdpo4k_ConfigurePulseWidth
 *                             tkdpo4k_ConfigureRampSymmetry
 *                             tkdpo4k_QueryArbitraryWaveform
 *                             tkdpo4k_QueryEditedArbitraryWaveform
 *                             tkdpo4k_ConfigureWaveformLabel
 *                             tkdpo4k_GenerateArbWaveformFunction
 *                             tkdpo4k_CreateArbWaveform
 *                             tkdpo4k_ConfigureArbWaveform
 *                             tkdpo4k_ClearArbWaveform
 *                             tkdpo4k_SaveWaveform
 *                             tkdpo4k_RecallWaveform
 *                             tkdpo4k_ResetDigitalVoltmeter
 *                             tkdpo4k_ConfigureDigitalVoltmeter
 *                             tkdpo4k_ReadDigitalVoltmeter
 *                             tkdpo4k_ReadHistoryDVM
 *                             tkdpo4k_ReadStatisticsDVM
 *                             tkdpo4k_ConfigureEvent
 *                             tkdpo4k_ConfigureEventEnabled
 *
 *                             Added Attributes: 
 *                             TKDPO4K_ATTR_FUNC_WAVEFORM
 *                             TKDPO4K_ATTR_FUNC_AMPLITUDE
 *                             TKDPO4K_ATTR_FUNC_FREQUENCY
 *                             TKDPO4K_ATTR_FUNC_START_PHASE
 *                             TKDPO4K_ATTR_FUNC_HIGH_LEVEL
 *                             TKDPO4K_ATTR_FUNC_LOW_LEVEL
 *                             TKDPO4K_ATTR_FUNC_DC_OFFSET
 *                             TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH
 *                             TKDPO4K_ATTR_FUNC_PERIOD
 *                             TKDPO4K_ATTR_FUNC_PRESET_LEVEL
 *                             TKDPO4K_ATTR_FUNC_NOISE_LEVEL
 *                             TKDPO4K_ATTR_FUNC_NOISE_ENABLED
 *                             TKDPO4K_ATTR_FUNC_PULSE_WIDTH
 *                             TKDPO4K_ATTR_FUNC_RAMP_SYMMETRY
 *                             TKDPO4K_ATTR_OUTPUT_ENABLED
 *                             TKDPO4K_ATTR_OUTPUT_IMPEDANCE
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_DATE
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_TIME
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_LABEL
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_PREDEFINED_FUNCTION
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_POINT_NUMBER
 *                             TKDPO4K_ATTR_ARB_WAVEFORM_POINTS
 *                             TKDPO4K_ATTR_WAVEFORM_QUANTUM
 *                             TKDPO4K_ATTR_MIN_WAVEFORM_SIZE
 *                             TKDPO4K_ATTR_MAX_WAVEFORM_SIZE
 *                             TKDPO4K_ATTR_MAX_NUM_WAVEFORMS
 *                             TKDPO4K_ATTR_DVM_RANGE_AUTO_ENABLED
 *                             TKDPO4K_ATTR_DVM_TYPE
 *                             TKDPO4K_ATTR_DVM_SOURCE
 *                             TKDPO4K_ATTR_DVM_FREQUENCY
 *                             TKDPO4K_ATTR_DVM_HISTORY_AVERAGE
 *                             TKDPO4K_ATTR_DVM_HISTORY_MAXIMUM
 *                             TKDPO4K_ATTR_DVM_HISTORY_MINIMUM
 *                             TKDPO4K_ATTR_DVM_MAX_RESULE
 *                             TKDPO4K_ATTR_DVM_MIN_RESULT
 *                             TKDPO4K_ATTR_DVM_RESULT
 *                             TKDPO4K_ATTR_AUX_OUT_EVENT_ENABLED
 *                             TKDPO4K_ATTR_PRINT_EVENT_ENABLED
 *                             TKDPO4K_ATTR_SAVE_IMAGE_EVENT_ENABLED
 *                             TKDPO4K_ATTR_SAVE_WAVEFORM_EVENT_ENABLED
 *                             TKDPO4K_ATTR_SRQ_EVENT_ENABLED
 *                             TKDPO4K_ATTR_STOP_ACQUISITION_EVENT_ENABLED
 *                             TKDPO4K_ATTR_EVENT_REPEAT_COUNT
 *                             TKDPO4K_ATTR_EVENT_TRIGGER_TYPE
 *                             TKDPO4K_ATTR_ACQUISITION_NUMBER
 *                             TKDPO4K_ATTR_AFG_ENABLED
 *                             TKDPO4K_ATTR_ARB_ENABLED
 *                             TKDPO4K_ATTR_DVM_ENABLED
 *                             TKDPO4K_ATTR_CUSTOM_MASK_ENABLED
 *                             TKDPO4K_ATTR_STANDARD_MASK_ENABLED 
 *
 *      04/30/2015 [zsu] -     Updated driver to comply with IVI-2014 generation.
 *		
 *		01/10/2016 [kwang] -   Update driver to support MDO4024C, MDO4034C, MDO4054C, MDO4104C.
 *							   Add new rangetable for TKDPO4K_ATTR_I2C_DATA_SIZE
 *							   Add new rangetable for TKDPO4K_ATTR_BUS_SELECT
 *							   
 *****************************************************************************/

#ifdef _CVI
#include <formatio.h>
#include <utility.h>
#else
#ifdef _WIN64
extern int	Scan(void *, const char *, ...);
extern int	Fmt(void *, const char *, ...);
extern int	NumFmtdBytes(void);
#else
#define CVIFUNC         __stdcall
#define CVIFUNC_C       __cdecl
extern int	CVIFUNC_C	Scan(void *, const char *, ...);
extern int	CVIFUNC_C	Fmt(void *, const char *, ...);
extern int	CVIFUNC		NumFmtdBytes(void);
#endif
#endif

#include <string.h>
#include <stdio.h>  
#include <stdlib.h>
#include <math.h>
#include <ctype.h>


#include "tkdpo4k.h"

/*****************************************************************************
 *--------------------- Hidden Attribute Declarations -----------------------*
 *****************************************************************************/
#define TKDPO4K_ATTR_OPC_TIMEOUT            (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 1L)       /* ViInt32   */
#define TKDPO4K_ATTR_INPUT_DATA_SOURCE      (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 2L)       /* ViString  */

    /*- Trigger Type -*/
#define TKDPO4K_ATTR_MAIN_TRIGGER_TYPE      (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 4L)       /* ViInt32   */
#define TKDPO4K_ATTR_EDGE_TRIGGER_CLASS     (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 5L)       /* ViInt32   */
#define TKDPO4K_ATTR_PULSE_TRIGGER_CLASS    (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 6L)       /* ViInt32   */
#define TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS    (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 7L)       /* ViInt32   */
#define TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS   (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 8L)       /* ViInt32   */

#define TKDPO4K_ATTR_MEAS_VALUE             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 10L)      /* ViReal64  */
#define TKDPO4K_ATTR_PROBE_SENSE            (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 11L)      /* ViBoolean */
#define TKDPO4K_ATTR_PROBE_GAIN             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 24L)      /* ViReal64  */
#define TKDPO4K_ATTR_TOTAL_POINTS           (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 12L)      /* ViInt32   */

    /*- Logic Basic Attributes -*/
#define TKDPO4K_ATTR_LOGIC_FUNCTION         (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 13L)      /* ViInt32   */
#define TKDPO4K_ATTR_LOGIC_WHEN             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 14L)      /* ViInt32   */
#define TKDPO4K_ATTR_LOGIC_INPUT_BY_CH      (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 15L)      /* ViInt32   */

#define TKDPO4K_ATTR_DATA_WIDTH             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 16L)      /* ViInt32   */
#define TKDPO4K_ATTR_DATA_START_POS         (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 17L)      /* ViInt32   */ 
#define TKDPO4K_ATTR_DATA_STOP_POS          (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 18L)      /* ViInt32   */ 
#define TKDPO4K_ATTR_DATA_YZERO             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 19L)      /* ViReal64  */
#define TKDPO4K_ATTR_DATA_YOFF              (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 23L)      /* ViReal64  */
#define TKDPO4K_ATTR_DATA_YMULT             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 20L)      /* ViReal64  */
#define TKDPO4K_ATTR_DATA_XINCR             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 21L)      /* ViReal64  */
#define TKDPO4K_ATTR_DATA_XZERO             (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 22L)      /* ViReal64  */

#define TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE  (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 30L)  /* ViInt32   */
    
#define TKDPO4K_ATTR_WFM_STRUCTURE          (IVI_SPECIFIC_PRIVATE_ATTR_BASE + 124L)     /* ViAddr    */

#define TKDPO4K_RF_ATTR_START               TKDPO4K_ATTR_RF_NUM_AVERAGES
#define TKDPO4K_RF_ATTR_END                 TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ
/*****************************************************************************
 *---------------------------- Useful Macros --------------------------------*
 *****************************************************************************/

    /*- I/O buffer size -----------------------------------------------------*/
#define BUFFER_SIZE                             512L

#define TKDPO4K_IO_SESSION_TYPE                 IVI_VAL_VISA_SESSION_TYPE
    
#define MAX_TABLE_SIZE                          39
                                                                                                          
    /*- 488.2 Event Status Register (ESR) Bits ------------------------------*/
#define IEEE_488_2_QUERY_ERROR_BIT              0x04
#define IEEE_488_2_DEVICE_DEPENDENT_ERROR_BIT   0x08
#define IEEE_488_2_EXECUTION_ERROR_BIT          0x10
#define IEEE_488_2_COMMAND_ERROR_BIT            0x20

#define IEEE_488_2_ERROR_BITS     (IEEE_488_2_QUERY_ERROR_BIT | \
                                   IEEE_488_2_DEVICE_DEPENDENT_ERROR_BIT | \
                                   IEEE_488_2_EXECUTION_ERROR_BIT | \
                                   IEEE_488_2_COMMAND_ERROR_BIT)

    /*- List of channels ----------------------------------------------------*/ 
#define ANALOG_CHANNEL_LIST_2    "CH1,CH2"
#define ANALOG_CHANNEL_LIST_4    "CH1,CH2,CH3,CH4"
#define DIGITAL_CHANNEL_LIST     "D0,D1,D2,D3,D4,D5,D6,D7,D8,D9,D10,D11,D12,D13,D14,D15"
#define VIRTUAL_CHANNEL_LIST_2   "MATH,REF1,REF2"
#define VIRTUAL_CHANNEL_LIST_4   "MATH,REF1,REF2,REF3,REF4"
#define RF_CHANNEL_SOURCE_LIST   "RF"
#define RF_CHANNEL_LIST          "RF_AMP,RF_FREQ,RF_PHAS,RF_NORM,RF_AVE,RF_MAXH,RF_MINH"

    /*- Replicate capabilities ----------------------------------------------*/
#define BITSOURCE_REP_CAP_NAME   "BitSource" 
#define BITSOURCE_LIST           "BIT0,BIT1,BIT2,BIT3,BIT4,BIT5,BIT6,BIT7,BIT8,BIT9,BIT10,BIT11,BIT12,BIT13,BIT14,BIT15"
    
#define WAVEFORMSLOT_REP_CAP_NAME   "WaveformSlot"
#define WAVEFORMSLOT_LIST           "1,2,3,4"

#define RF_ACPR_RATIO_REP_CAP_NAME "AdjacentChannels" 
#define ADJACENT_CHANNELS          "LA1,LA2,LA3,UA1,UA2,UA3"

    /*- CAN Identifier Length -----------------------------------------------*/
#define TKDPO4K_VAL_CAN_ID_STANDARD_LEN         11
#define TKDPO4K_VAL_CAN_ID_EXTENDED_LEN         29

    /*- Instrument model macros ---------------------------------------------*/
#define IS_DPO4K(model) \
    ((model == TKDPO4K_VAL_DPO_4104) || (model == TKDPO4K_VAL_DPO_4054) || (model == TKDPO4K_VAL_DPO_4034) || (model == TKDPO4K_VAL_DPO_4032)||\
     (model == TKDPO4K_VAL_DPO_4104B) || (model == TKDPO4K_VAL_DPO_4054B) || (model == TKDPO4K_VAL_DPO_4034B) || (model == TKDPO4K_VAL_DPO_4102B) ||\
     (model == TKDPO4K_VAL_DPO_4102B_L) || (model == TKDPO4K_VAL_DPO_4104B_L) || (model == TKDPO4K_VAL_DPO_4014B))

#define IS_MSO4K(model) \
    ((model == TKDPO4K_VAL_MSO_4104) || (model == TKDPO4K_VAL_MSO_4054) || (model == TKDPO4K_VAL_MSO_4034) || (model == TKDPO4K_VAL_MSO_4032) ||\
     (model == TKDPO4K_VAL_MSO_4104B) || (model == TKDPO4K_VAL_MSO_4054B) || (model == TKDPO4K_VAL_MSO_4034B) || (model == TKDPO4K_VAL_MSO_4102B) ||\
     (model == TKDPO4K_VAL_MSO_4102B_L) || (model == TKDPO4K_VAL_MSO_4104B_L) || (model == TKDPO4K_VAL_MSO_4014B))

#define IS_DPO3K(model) \
    ((model == TKDPO4K_VAL_DPO_3012) || (model == TKDPO4K_VAL_DPO_3014) || (model == TKDPO4K_VAL_DPO_3032) || (model == TKDPO4K_VAL_DPO_3034) || (model == TKDPO4K_VAL_DPO_3052) || (model == TKDPO4K_VAL_DPO_3054))
    
#define IS_MSO3K(model) \
    ((model == TKDPO4K_VAL_MSO_3012) || (model == TKDPO4K_VAL_MSO_3014) || (model == TKDPO4K_VAL_MSO_3032) || (model == TKDPO4K_VAL_MSO_3034) || (model == TKDPO4K_VAL_MSO_3052) || (model == TKDPO4K_VAL_MSO_3054)) 

#define IS_MDO4K(model) \
    ((model == TKDPO4K_VAL_MDO_41046) || (model == TKDPO4K_VAL_MDO_41043) || (model == TKDPO4K_VAL_MDO_40546) || (model == TKDPO4K_VAL_MDO_40543)||\
     (model == TKDPO4K_VAL_MDO_4014_3) || (model == TKDPO4K_VAL_MDO_4034_3) || (model == TKDPO4K_VAL_MDO_4014B_3) || (model == TKDPO4K_VAL_MDO_4034B_3)||\
     (model == TKDPO4K_VAL_MDO_4054B_3) || (model == TKDPO4K_VAL_MDO_4054B_6) || (model == TKDPO4K_VAL_MDO_4104B_3) || (model == TKDPO4K_VAL_MDO_4104B_6) ||\
	 (model == TKDPO4K_VAL_MDO_4024C) || (model == TKDPO4K_VAL_MDO_4034C) || ( model == TKDPO4K_VAL_MDO_4054C) || ( model == TKDPO4K_VAL_MDO_4104C))

#define IS_MDO4KB(model)\
	((model == TKDPO4K_VAL_MDO_4014B_3) || (model == TKDPO4K_VAL_MDO_4034B_3)|| (model == TKDPO4K_VAL_MDO_4054B_3)\
	|| (model == TKDPO4K_VAL_MDO_4054B_6) || (model == TKDPO4K_VAL_MDO_4104B_3) || (model == TKDPO4K_VAL_MDO_4104B_6))

#define IS_MDO4KC(model) \
    ((model == TKDPO4K_VAL_MDO_4024C) || (model == TKDPO4K_VAL_MDO_4034C) || ( model == TKDPO4K_VAL_MDO_4054C) || ( model == TKDPO4K_VAL_MDO_4104C))

#define IS_MDO3K(model) \
    ((model == TKDPO4K_VAL_MDO_3012) || (model == TKDPO4K_VAL_MDO_3014) || (model == TKDPO4K_VAL_MDO_3022) || (model == TKDPO4K_VAL_MDO_3024)||\
     (model == TKDPO4K_VAL_MDO_3032) || (model == TKDPO4K_VAL_MDO_3034) || (model == TKDPO4K_VAL_MDO_3052) || (model == TKDPO4K_VAL_MDO_3054)||\
     (model == TKDPO4K_VAL_MDO_3102) || (model == TKDPO4K_VAL_MDO_3104))
    
    /*- Macros for access to enum range table -----------------------------------*/
#define tkdpo4k_GetCmdFromIntValue(value, table, cmd) \
        Ivi_GetViInt32EntryFromValue (value, table, VI_NULL, VI_NULL,\
                                      VI_NULL, VI_NULL, cmd, VI_NULL)

#define tkdpo4k_GetValueFromCmd(buffer, table, value) \
        Ivi_GetViInt32EntryFromString (buffer, table, value, VI_NULL,\
        VI_NULL, VI_NULL, VI_NULL)

    /*- Macros for the wrapper of empty channel name ---------------------------*/
#define VALID_CHANNELNAME(channelName) \
        (VI_NULL == channelName ? "" : channelName)

    
    /*- Waveform Quantum ----------------------------------------------------*/
#define TKDPO4K_VAL_WAVEFORMS_QUANTUM                     1  
    
    /*- Minimum Waveform Size -----------------------------------------------*/
#define TKDPO4K_VAL_MIN_WAVEFORM_SIZE                     2
    
    /*- Maximum Waveform Size -----------------------------------------------*/
#define TKDPO4K_VAL_MAX_WAVEFORM_SIZE                     131072
    
    /*- Defined values for attribute TKDPO4K_ATTR_ARB_WAVEFORM_HANDLE----*/
#define TKDPO4K_VAL_MAX_WAVEFORMS                   (1L)
#define TKDPO4K_VAL_LAST_WAVEFORM_HANDLE            (TKDPO4K_VAL_FIRST_WAVEFORM_HANDLE + TKDPO4K_VAL_MAX_WAVEFORMS - 1L)
#define TKDPO4K_WFM_HANDLE_FROM_INDEX(x)            (TKDPO4K_VAL_FIRST_WAVEFORM_HANDLE + x)
#define TKDPO4K_WFM_INDEX_FROM_HANDLE(x)            (x - TKDPO4K_VAL_FIRST_WAVEFORM_HANDLE)  
    
    /*- Defined value for length of arbitrary waveform and sequence names -*/

#define TKDPO4K_VAL_NAME_LENGTH                     (9L)

static IviRangeTableEntry attrRfDetectionModeNotAbbrRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_DETECT_MODE_AUTO, 0, 0, "AUTO", 0},
		{TKDPO4K_VAL_RF_DETECT_MODE_MANUAL, 0, 0, "MANUAL", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfDetectionModeNotAbbrRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        ":RF:DETECT:MOD",
        attrRfDetectionModeNotAbbrRangeTableEntries,
	};

static IviRangeTableEntry attrRfSpectrumModeNotAbbrRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_SPECTRUM_TRIGGERED, 0, 0, "TRIGGERED", 0},
		{TKDPO4K_VAL_RF_SPECTRUM_FREERUN, 0, 0, "FREERUN", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfSpectrumModeNotAbbrRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:SPECTRUMM",
        attrRfSpectrumModeNotAbbrRangeTableEntries,
	};

static IviRangeTableEntry attrRfRbwModeNotAbbrRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_RBW_MODE_MANUAL, 0, 0, "MANUAL", 0},
		{TKDPO4K_VAL_RF_RBW_MODE_AUTO, 0, 0, "AUTO", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfRbwModeNotAbbrRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:RBW:MOD",
        attrRfRbwModeNotAbbrRangeTableEntries,
	};

static IviRangeTableEntry attrRfDetectionMethodNotAbbrRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_DETECTION_POS_PEAK, 0, 0, "PLUSPEAK", 0},
		{TKDPO4K_VAL_RF_DETECTION_NEG_PEAK, 0, 0, "MINUSPEAK", 0},
		{TKDPO4K_VAL_RF_DETECTION_SAMPLE, 0, 0, "SAMPLE", 0},
		{TKDPO4K_VAL_RF_DETECTION_AVERAGE, 0, 0, "AVERAGE", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfDetectionMethodNotAbbrRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        ":RF:DETECT",
        attrRfDetectionMethodNotAbbrRangeTableEntries,
	};

static IviRangeTableEntry attrMDO4KCAdvVarRangeTableEntries[] =
	{
		{-1.0E15, 1.0E15, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrMDO4KCAdvVarRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "MATHVAR:VAR1",
        attrMDO4KCAdvVarRangeTableEntries,
	};

static IviRangeTableEntry attrMDO4kCI2cDataSizeRangeTableEntries[] =
	{
		{1, 5, 0, "", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrMDO4kCI2cDataSizeRangeTable =
	{
		IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrMDO4kCI2cDataSizeRangeTableEntries,
	};









static IviRangeTableEntry attrMDO4KCBusSelectRangeTableEntries[] =
	{
		{TKDPO4K_VAL_BUS1, 0, 0, "B1", 0},
		{TKDPO4K_VAL_BUS2, 0, 0, "B2", 0},
		{TKDPO4K_VAL_BUS3, 0, 0, "B3", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrMDO4KCBusSelectRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrMDO4KCBusSelectRangeTableEntries,
	};

static IviRangeTableEntry attrMDO4KCRfFftWindowRangeTableEntries[] =
	{
		{TKDPO4K_VAL_FFT_WINDOW_RECTANGULAR, 0, 0, "RECTANGULAR", 0},
		{TKDPO4K_VAL_FFT_WINDOW_HAMMING, 0, 0, "HAMMING", 0},
		{TKDPO4K_VAL_FFT_WINDOW_HANNING, 0, 0, "HANNING", 0},
		{TKDPO4K_VAL_FFT_WINDOW_BLACKMANHARRIS, 0, 0, "BLACKMANHARRIS", 0},
		{TKDPO4K_VAL_FFT_WINDOW_KAISER, 0, 0, "KAISER", 0},
		{TKDPO4K_VAL_FFT_WINDOW_FLATTOP, 0, 0, "FLATTOP", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrMDO4KCRfFftWindowRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:WIN",
        attrMDO4KCRfFftWindowRangeTableEntries,
	};

/*
    The driver uses this structure in its utility functions for creating and
    removing arbitray waveforms.
*/
typedef struct wfmNode
{
    ViInt32 wfmSize;
    ViChar  wfmName[TKDPO4K_VAL_NAME_LENGTH];
} wfmNode;
typedef wfmNode *wfmNodePtr;    
    
    
static IviRangeTableEntry attrRfFreqCenter3GRangeTableEntries[] =
    {
        {50000, 3000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqCenter3GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "RF:FREQ",
        attrRfFreqCenter3GRangeTableEntries,
    };

static IviRangeTableEntry attrRfFreqSpan3GRangeTableEntries[] =
    {
        {1000, 3000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqSpan3GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "RF:SPAN",
        attrRfFreqSpan3GRangeTableEntries,
    };

static IviRangeTableEntry attrRfFreqSpan6GRangeTableEntries[] =
    {
        {1000, 6000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqSpan6GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "RF:SPAN",
        attrRfFreqSpan6GRangeTableEntries,
    };

static IviRangeTableEntry attrRfFreqCenter6GRangeTableEntries[] =
    {
        {50000, 6000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqCenter6GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "RF:FREQ",
        attrRfFreqCenter6GRangeTableEntries,
    };

    /*-Macro for instrument commands -------------------------------------------*/
typedef struct { ViInt32       value;        /* Attribute ID */ 
                 ViConstString string;       /* Command */
                 ViConstString repCommand;   /* Extension for Reapted Command */
} tkdpo4kStringValueEntry;

typedef tkdpo4kStringValueEntry tkdpo4kStringValueTable[];

static tkdpo4kStringValueTable tkdpo4kEnum_commands = 
{   /* Attribute ID,        SCPI command          */
    {TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING,     ":ACQ:FASTA:PALE",             ""},
    {TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT,       ":SAV:WAVE:FILEF:RF_BB_IQ",    ""},
    {TKDPO4K_ATTR_FUNC_WAVEFORM,                ":AFG:FUNC",                   ""},
    {TKDPO4K_ATTR_FUNC_PRESET_LEVEL,            ":AFG:LEVELP",                 ""},
    {TKDPO4K_ATTR_OUTPUT_IMPEDANCE,             ":AFG:OUTP:LOA:IMPED",         ""},
    {TKDPO4K_ATTR_DVM_TYPE,                     ":DVM:MOD",                    ""},
    {TKDPO4K_ATTR_DVM_SOURCE,                   ":DVM:SOU",                    ""},
    {TKDPO4K_ATTR_EVENT_TRIGGER_TYPE,           ":ACTONEV:EVENTTYP",           ""},
    {VI_NULL,               VI_NULL,         VI_NULL}
};

static tkdpo4kStringValueTable tkdpo4kViString_commands = 
{   /* Attribute ID,        SCPI command          */
    {TKDPO4K_ATTR_ARB_WAVEFORM_DATE,                 "AFG:ARB:ARB",            ":DATE"},
    {TKDPO4K_ATTR_ARB_WAVEFORM_TIME,                 "AFG:ARB:ARB",            ":TIM"},
    {TKDPO4K_ATTR_ARB_WAVEFORM_LABEL,                "AFG:ARB:ARB",            ":LAB"},
    {TKDPO4K_ATTR_ARB_WAVEFORM_PREDEFINED_FUNCTION,  ":AFG:ARB:EMEM:FUNC",     ""},
    {TKDPO4K_ATTR_ARB_WAVEFORM_POINTS,               ":AFG:ARB:EMEM:POINTS",   ""},
    {VI_NULL,               VI_NULL,         VI_NULL}
};

static  tkdpo4kStringValueTable tkdpo4kViReal64_commands = 
{
    {TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ,    ":RF:MEASU:OBW:UPPERF",      ""},
    {TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ,     ":RF:MEASU:OBW:LOWERF",      ""},
    {TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO,       ":RF:MEASUre:ACPR:",         "DB"},
    {TKDPO4K_ATTR_RF_SPAN_RBW_RATIO,           ":RF:SPANR",                 ""},
    {TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN,      ":TRIG:A:LEV:AUX",           ""},
    {TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE,         ":MEASU:SNAPS:TOV",          ""},
    {TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH,    ":RF:RF_V_TIM:BANDW",        ""},
    {TKDPO4K_ATTR_FUNC_AMPLITUDE,              ":AFG:AMPL",                 ""},
    {TKDPO4K_ATTR_FUNC_FREQUENCY,              ":AFG:FREQ",                 ""},
    {TKDPO4K_ATTR_FUNC_START_PHASE,            ":AFG:PHAS",                 ""},
    {TKDPO4K_ATTR_FUNC_HIGH_LEVEL,             ":AFG:HIGHL",                ""},
    {TKDPO4K_ATTR_FUNC_LOW_LEVEL,              ":AFG:LOWL",                 ""},
    {TKDPO4K_ATTR_FUNC_DC_OFFSET,              ":AFG:OFFS",                 ""},
    {TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH,        ":AFG:SQU:DU",               ""},
    {TKDPO4K_ATTR_FUNC_PERIOD,                 ":AFG:PERI",                 ""},
    {TKDPO4K_ATTR_FUNC_PULSE_WIDTH,            ":AFG:PUL:WID",              ""},
    {TKDPO4K_ATTR_FUNC_RAMP_SYMMETRY,          ":AFG:RAMP:SYM",             ""},
    {TKDPO4K_ATTR_DVM_FREQUENCY,               ":DVM:MEASU:FREQ",           ""},
    {TKDPO4K_ATTR_DVM_HISTORY_AVERAGE,         ":DVM:MEASU:HIS:AVE",        ""},
    {TKDPO4K_ATTR_DVM_HISTORY_MAXIMUM,         ":DVM:MEASU:HIS:MAX",        ""},
    {TKDPO4K_ATTR_DVM_HISTORY_MINIMUM,         ":DVM:MEASU:HIS:MINI",       ""},
    {TKDPO4K_ATTR_DVM_MAX_RESULE,              ":DVM:MEASU:INFMAX",         ""},
    {TKDPO4K_ATTR_DVM_MIN_RESULT,              ":DVM:MEASU:INFMIN",         ""},
    {TKDPO4K_ATTR_DVM_RESULT,                  ":DVM:MEASU:VAL",            ""},
    {VI_NULL,               VI_NULL,         VI_NULL} 
};

static tkdpo4kStringValueTable tkdpo4kViBoolean_commands =
{
    {TKDPO4K_ATTR_RF_SQUELCH_STATE,                ":RF:SQUELCH:STATE",              ""},
    {TKDPO4K_ATTR_FASTACQ_STATE,                   ":ACQ:FASTA:STATE",               ""},
    {TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY,         ":MATH:AUTOSC",                   ""},
    {TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE,     ":RF:RF_PHAS:WRAP:STATE",         ""},
    {TKDPO4K_ATTR_FUNC_NOISE_ENABLED,              ":AFG:NOISEA:STATE",              ""},
    {TKDPO4K_ATTR_OUTPUT_ENABLED,                  ":AFG:OUTP:STATE",                ""},
    {TKDPO4K_ATTR_DVM_RANGE_AUTO_ENABLED,          ":DVM:AUTOR",                     ""},
    {TKDPO4K_ATTR_AUX_OUT_EVENT_ENABLED,           ":ACTONEV:ACTION:AUXOUT:STATE",   ""},
    {TKDPO4K_ATTR_PRINT_EVENT_ENABLED,             ":ACTONEV:ACTION:PRINT:STATE",    ""},
    {TKDPO4K_ATTR_SAVE_IMAGE_EVENT_ENABLED,        ":ACTONEV:ACTION:SAVEIMAGE:STATE",""},
    {TKDPO4K_ATTR_SAVE_WAVEFORM_EVENT_ENABLED,     ":ACTONEV:ACTION:SAVEWFM:STATE",  ""},
    {TKDPO4K_ATTR_SRQ_EVENT_ENABLED,               ":ACTONEV:ACTION:SRQ:STATE",      ""},
    {TKDPO4K_ATTR_STOP_ACQUISITION_EVENT_ENABLED,  ":ACTONEV:ACTION:STOPACQ:STATE",  ""},
    {TKDPO4K_ATTR_AFG_ENABLED,                     ":CONFIG:AFG",                    ""},
    {TKDPO4K_ATTR_ARB_ENABLED,                     ":CONFIG:ARB",                    ""},
    {TKDPO4K_ATTR_DVM_ENABLED,                     ":CONFIG:DVM",                    ""},
    {TKDPO4K_ATTR_CUSTOM_MASK_ENABLED,             ":CONFIG:APPL:CUSTOMM",           ""},
    {TKDPO4K_ATTR_STANDARD_MASK_ENABLED,           ":CONFIG:APPL:STANDARDM",         ""},
    {VI_NULL,               VI_NULL,         VI_NULL}
};

static tkdpo4kStringValueTable tkdpo4kViInt32_commands =
{
	{TKDPO4K_ATTR_RF_AVERAGE_TRACE_COUNT,            ":RF:RF_AVE:COUN",           ""},
    {TKDPO4K_ATTR_RF_NUM_AVERAGES,                   ":RF:RF_AVE:NUMAV",           ""},
    {TKDPO4K_ATTR_RF_PHASE_IN_DEGREES,               ":RF:RF_PHAS:REFER:DEG",      ""}, 
    {TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM,         ":RF:RF_PHAS:WRAP:DEG",       ""},
    {TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP,         ":RF:SPECTR:SLICETIM",        ""},
    {TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM,        ":RF:SPECTR:TIM",             ""},
    {TKDPO4K_ATTR_FUNC_NOISE_LEVEL,                  ":AFG:NOISEA:PERC",           ""},
    {TKDPO4K_ATTR_ARB_WAVEFORM_POINT_NUMBER,         ":AFG:ARB:EMEM:NUMP",         ""},
    {TKDPO4K_ATTR_EVENT_REPEAT_COUNT,                ":ACTONEV:REPEATC",           ""},
    {TKDPO4K_ATTR_ACQUISITION_NUMBER,                ":ACTONEV:NUMACQ",            ""},
    {VI_NULL,               VI_NULL,         VI_NULL}
};

/*- Range table for attribute TKDPO4K_ATTR_RF_MEASUTR_POWER_PERCENTAGE-*/       
static IviRangeTableEntry attrRfMeasurePowerPercentageRangeTableEntries[] =
    {
        {60, 99.9, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfMeasurePowerPercentageRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:MEASU:OBW:PERCENT",
        attrRfMeasurePowerPercentageRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_CHANNEL_SPACING-*/  
static IviRangeTableEntry attrRfACPRChannelSpacingRangeTableEntries[] =
    {
        {0, 6000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfACPRChannelSpacingRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:MEASU:ACPR:CHANSPAC",
        attrRfACPRChannelSpacingRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_CHANNEL_BANDWIDTH-*/  
static IviRangeTableEntry attrRfChannelBandwidth6GRangeTableEntries[] =
    {
        {0.91e3, 5.45e9, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfChannelBandwidth6GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRfChannelBandwidth6GRangeTableEntries,
    };

static IviRangeTableEntry attrRfChannelBandwidth3GRangeTableEntries[] =
    {
        {0.91e3, 2.72e9, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfChannelBandwidth3GRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRfChannelBandwidth3GRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_MEASURE_TYPE-*/ 
static IviRangeTableEntry attrRfMeasureTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_RF_MEASURE_TYPE_NONE, 0, 0, "NONE", 0},
        {TKDPO4K_VAL_RF_MEASURE_TYPE_CP, 0, 0, "CP", 0},
        {TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR, 0, 0, "ACPR", 0},
        {TKDPO4K_VAL_RF_MEASURE_TYPE_OBW, 0, 0, "OBW", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfMeasureTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:MEASU:TYP",
        attrRfMeasureTypeRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_MEASURE_ADJACENT_PAIRS-*/ 
static IviRangeTableEntry attrRfMeasureAcprAdjacentpairsRangeTableEntries[] =
    {
        {1, 3, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfMeasureAcprAdjacentpairsRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:MEASU:ACPR:ADJACENTPAIR",
        attrRfMeasureAcprAdjacentpairsRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_FFT_WINDOW-*/ 
static IviRangeTableEntry attrRfFftWindowRangeTableEntries[] =
    {
        {TKDPO4K_VAL_FFT_WINDOW_RECTANGULAR, 0, 0, "RECT", 0},
        {TKDPO4K_VAL_FFT_WINDOW_HAMMING, 0, 0, "HAM", 0},
        {TKDPO4K_VAL_FFT_WINDOW_HANNING, 0, 0, "HAN", 0},
        {TKDPO4K_VAL_FFT_WINDOW_BLACKMANHARRIS, 0, 0, "BLA", 0},
        {TKDPO4K_VAL_FFT_WINDOW_KAISER, 0, 0, "KAI", 0},
        {TKDPO4K_VAL_FFT_WINDOW_FLATTOP, 0, 0, "FLAT", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFftWindowRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:WIN",
        attrRfFftWindowRangeTableEntries,
    };



/*- Range table for attribute TKDPO4K_ATTR_RF_UNITS-*/ 
static IviRangeTableEntry attrRfUnitsRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_UNITS_DBM, 0, 0, "DBM", 0},
		{TKDPO4K_VAL_RF_UNITS_DBUW, 0, 0, "DBUW", 0},
		{TKDPO4K_VAL_RF_UNITS_DBMV, 0, 0, "DBMV", 0},
		{TKDPO4K_VAL_RF_UNITS_DMUV, 0, 0, "DMUV", 0},
		{TKDPO4K_VAL_RF_UNITS_DBMA, 0, 0, "DBMA", 0},
		{TKDPO4K_VAL_RF_UNITS_DBUA, 0, 0, "DBUA", 0},
		{TKDPO4K_VAL_RF_UNITS_DBUV, 0, 0, "DBUV", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfUnitsRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:UNI",
        attrRfUnitsRangeTableEntries,
	};

/*- Range table for attribute TKDPO4K_ATTR_RF_CHANNEL_BANDWIDTH-*/ 
static IviRangeTableEntry attrRfRefLevelRangeTableEntries[] =
    {
        {-140, 30, 0, "", 0},
        {TKDPO4K_VAL_RF_REF_LEVEL_AUTO, TKDPO4K_VAL_RF_REF_LEVEL_AUTO, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfRefLevelRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:REFL",
        attrRfRefLevelRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_FREQ_START-*/ 
static IviRangeTableEntry attrRfFreqStartRangeTableEntries[] =
    {
        {0, 6000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqStartRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:STAR",
        attrRfFreqStartRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_FREQ_STOP-*/ 
static IviRangeTableEntry attrRfFreqStopRangeTableEntries[] =
    {
        {0, 9000000000.0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfFreqStopRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        "RF:STOP",
        attrRfFreqStopRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_RBW*/
static IviRangeTableEntry attrRfRbwRangeTableEntries[] =
    {
        {20, 10000000, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };
static IviRangeTable attrRfRbwRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:RBW",
        attrRfRbwRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_RF_RBM_MODE-*/
static IviRangeTableEntry attrRfRbwModeRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_RBW_MODE_MANUAL, 0, 0, "MAN", 0},
		{TKDPO4K_VAL_RF_RBW_MODE_AUTO, 0, 0, "AUTO", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfRbwModeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:RBW:MOD",
        attrRfRbwModeRangeTableEntries,
	};

/*- Range table for attribute TKDPO4K_ATTR_RF_SPECTRUM_MODE-*/
static IviRangeTableEntry attrRfSpectrumModeRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_SPECTRUM_TRIGGERED, 0, 0, "TRIG", 0},
		{TKDPO4K_VAL_RF_SPECTRUM_FREERUN, 0, 0, "FREE", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfSpectrumModeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "RF:SPECTRUMM",
        attrRfSpectrumModeRangeTableEntries,
	};

/*-Range table for attribute TKDPO4K_ATTR_RF_DETECTION_MODE -*/
static IviRangeTableEntry attrRfDetectionModeRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_DETECT_MODE_AUTO, 0, 0, "AUTO", 0},
		{TKDPO4K_VAL_RF_DETECT_MODE_MANUAL, 0, 0, "MAN", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};
static IviRangeTable attrRfDetectionModeRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        ":RF:DETECT:MOD",
        attrRfDetectionModeRangeTableEntries,
	};

/*-Range table for attribute TKDPO4K_ATTR_RF_DETECTION_METHOD -*/
static IviRangeTableEntry attrRfDetectionMethodRangeTableEntries[] =
	{
		{TKDPO4K_VAL_RF_DETECTION_POS_PEAK, 0, 0, "PLUS", 0},
		{TKDPO4K_VAL_RF_DETECTION_NEG_PEAK, 0, 0, "MINUS", 0},
		{TKDPO4K_VAL_RF_DETECTION_SAMPLE, 0, 0, "SAMP", 0},
		{TKDPO4K_VAL_RF_DETECTION_AVERAGE, 0, 0, "AVE", 0},
		{IVI_RANGE_TABLE_LAST_ENTRY}
	};

static IviRangeTable attrRfDetectionMethodRangeTable =
	{
		IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        ":RF:DETECT",
        attrRfDetectionMethodRangeTableEntries,
	};



/*-Range table for attribute TKDPO4K_ATTR_RF_SQUELCH_THRESHOLD -*/
static IviRangeTableEntry attrRfSquelchThresholdRangeTableEntries[] =
    {
        {0.0022, 7.071, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRfSquelchThresholdRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        ":RF:SQUELCH:THR",
        attrRfSquelchThresholdRangeTableEntries,
    };
 
/*- Range table for attribute TKDPO4K_ATTR_MATH_RF_SOURCE_1ST -*/ 
/*- Range table for attribute TKDPO4K_ATTR_MATH_RF_SOURCE_2ND -*/
static IviRangeTableEntry attrMathRefSourceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_RFSOUR_NORMAL, 0, 0, "RF_NORM", 0},
        {TKDPO4K_VAL_RFSOUR_AVERAGE, 0, 0, "RF_AVE", 0},
        {TKDPO4K_VAL_RFSOUR_MAXHOLD, 0, 0, "RF_MAXH", 0},
        {TKDPO4K_VAL_RFSOUR_MINHOLD, 0, 0, "RF_MINH", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrMathRefSourceRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrMathRefSourceRangeTableEntries,
    };

/*-Range table for attribute TKDPO4K_ATTR_ENET_DATA_OFFSET -*/  
static IviRangeTableEntry attrEnetTriggerDataOffsetRangeTableEntries[] =
    {
        {-1, 1499, TKDPO4K_VAL_ENET_BASIC_CONDITION_SFD, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEnetTriggerDataOffsetRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnetTriggerDataOffsetRangeTableEntries,
    };

/*-Range table for attribute TKDPO4K_ATTR_ENET_DATA_SIZE -*/
static IviRangeTableEntry attrEnetTriggerDataSizeRangeTableEntries[] =
    {
        {1, 16, TKDPO4K_VAL_ENET_BASIC_CONDITION_SFD, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEnetTriggerDataSizeRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnetTriggerDataSizeRangeTableEntries,
    };

/*-Range table for attribute TKDPO4K_ATTR_ENET_BASIC_QUALIFIER -*/
static IviRangeTableEntry attrEnetTriggerBasicQualifierRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_LESST, 0, 0, "LESSTHAN", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_MORET, 0, 0, "MORETHAN", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_EQ, 0, 0, "EQUAL", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_UNEQ, 0, 0, "UNEQUAL", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_LESSEQ, 0, 0, "LESSEQUAL", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_MOREEQ, 0, 0, "MOREEQUAL", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_IN, 0, 0, "INRANGE", 0},
        {TKDPO4K_VAL_ENET_BASIC_QUALIFIER_OUT, 0, 0, "OUTRANGE", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEnetTriggerBasicQualifierRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnetTriggerBasicQualifierRangeTableEntries,
    };

/*-Range table for attribute TKDPO4K_ATTR_ENET_BASIC_CONDITION-*/
static IviRangeTableEntry attrEnetTriggerBasicConditionRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_SFD, 0, 0, "SFD", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_MACADDR, 0, 0, "MACADDRESS", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_MACLEN, 0, 0, "MACLENGTH", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_DAT, 0, 0, "DATA", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_EOP, 0, 0, "EOP", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_IDL, 0, 0, "IDLE", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_FCSE, 0, 0, "FCSERROR", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_IPH, 0, 0, "IPHEADER", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_TCPH, 0, 0, "TCPHEADER", 0},
        {TKDPO4K_VAL_ENET_BASIC_CONDITION_QTAG, 0, 0, "QTAG", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEnetTriggerBasicConditionRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnetTriggerBasicConditionRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE-*/   
static IviRangeTableEntry attrEnetTriggerBasicFrameTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_BASIC_FRAME_BAS, 0, 0, "BASIC", 0},
        {TKDPO4K_VAL_ENET_BASIC_FRAME_QTAG, 0, 0, "QTAG", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEnetTriggerBasicFrameTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEnetTriggerBasicFrameTypeRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_USB_TRAN_END_POINT -*/ 
static IviRangeTableEntry attrUSBSplitTranEndpointRangeTableEntries[] =
    {
        {TKDPO4K_VAL_USB_END_NOCARE, 0, 0, "NOCARE", 0},
        {TKDPO4K_VAL_USB_END_CONTR, 0, 0, "CONTROL", 0},
        {TKDPO4K_VAL_USB_END_ISO, 0, 0, "ISO", 0},
        {TKDPO4K_VAL_USB_END_BULK, 0, 0, "BULK", 0},
        {TKDPO4K_VAL_USB_END_INTERRUPT, 0, 0, "INTERRUPT", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrUSBSplitTranEndpointRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrUSBSplitTranEndpointRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_USB_TRAN_START_END -*/
static IviRangeTableEntry attrUSBSplitTranStartEndRangeTableEntries[] =
    {
        {TKDPO4K_VAL_USB_START_END_NOCARE, 0, 0, "NOCARE", 0},
        {TKDPO4K_VAL_USB_START_END_FULLSP, 0, 0, "FULLSPEED", 0},
        {TKDPO4K_VAL_USB_START_END_LOWSP, 0, 0, "LOWSPEED", 0},
        {TKDPO4K_VAL_USB_START_END_ISOSTART, 0, 0, "ISOSTART", 0},
        {TKDPO4K_VAL_USB_START_END_ISOMID, 0, 0, "ISOMID", 0},
        {TKDPO4K_VAL_USB_START_END_ISOEND, 0, 0, "ISOEND", 0},
        {TKDPO4K_VAL_USB_START_END_ISOALL, 0, 0, "ISOALL", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrUSBSplitTranStartEndRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrUSBSplitTranStartEndRangeTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_USB_TRAN_FIELD-*/  
static IviRangeTableEntry attrUSBSplitTranFieldRangeTableEntries[] =
    {
        {TKDPO4K_VAL_USB_NOCARE, 0, 0, "NOCARE", 0},
        {TKDPO4K_VAL_USB_SSPLIT, 0, 0, "SSPLIT", 0},
        {TKDPO4K_VAL_USB_CSPLIT, 0, 0, "CSPLIT", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };


static IviRangeTable attrUSBSplitTranFieldRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrUSBSplitTranFieldRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL-*/
static IviRangeTableEntry attrBusEthernetProtocolRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_PROT_IPV4, 0, 0, "IPV4", 0},
        {TKDPO4K_VAL_ENET_PROT_OTHER, 0, 0, "OTHER", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetProtocolRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetProtocolRangeTableEntries,
    };

/*- Range table for attribute TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC-*/
static IviRangeTableEntry attrBusEthernetMinusDataSourceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_MINUS_DATA_SRC_CH1, 0, 0, "CH1", 0},
        {TKDPO4K_VAL_ENET_MINUS_DATA_SRC_CH2, 0, 0, "CH2", 0},
        {TKDPO4K_VAL_ENET_MINUS_DATA_SRC_CH3, 0, 0, "CH3", 0},
        {TKDPO4K_VAL_ENET_MINUS_DATA_SRC_CH4, 0, 0, "CH4", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetMinusDataSourceRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetMinusDataSourceRangeTableEntries,
    };

/*- Range table for attribute BUS_ETHERNET_PLUS_DATA_SRC-*/
static IviRangeTableEntry attrBusEthernetPlusDataSourceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_PLUS_DATA_CH1, 0, 0, "CH1", 0},
        {TKDPO4K_VAL_ENET_PLUS_DATA_CH2, 0, 0, "CH2", 0},
        {TKDPO4K_VAL_ENET_PLUS_DATA_CH3, 0, 0, "CH3", 0},
        {TKDPO4K_VAL_ENET_PLUS_DATA_CH4, 0, 0, "CH4", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetPlusDataSourceRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetPlusDataSourceRangeTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC-*/ 
static IviRangeTableEntry attrBusEthernetDiffInputDataSourceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_CH1, 0, 0, "CH1", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_CH2, 0, 0, "CH2", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_CH3, 0, 0, "CH3", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_CH4, 0, 0, "CH4", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_MATH, 0, 0, "MATH", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_REF1, 0, 0, "REF1", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_REF2, 0, 0, "REF2", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_REF4, 0, 0, "REF4", 0},
        {TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_REF3, 0, 0, "REF3", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetDiffInputDataSourceRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetDiffInputDataSourceRangeTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE-*/ 
static IviRangeTableEntry attrBusEthernetProbeTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_PROBE_DIFFERENTIAL, 0, 0, "DIFFERENTIAL", 0},
        {TKDPO4K_VAL_ENET_PROBE_SINGLEENDED, 0, 0, "SINGLEENDED", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetProbeTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetProbeTypeRangeTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_BUS_ETHERNET_TYPE-*/
static IviRangeTableEntry attrBusEthernetTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_ENET_ENET10BASET, 0, 0, "ENET10BASET", 0},
        {TKDPO4K_VAL_ENET_ENET100BASETX, 0, 0, "ENET100BASETX", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusEthernetTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusEthernetTypeRangeTableEntries,
    };

static IviRangeTablePtr attrMeasFunctionRangeTable = VI_NULL;

 /*- Range table for attribute TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING-*/     
static IviRangeTableEntry attrWaveformGradingRangeTableEntries[] =
    {
        {TKDPO4K_VAL_WAVEFORM_GRADING_NORMAL, 0, 0, "NORMAL", 0},
        {TKDPO4K_VAL_WAVEFORM_GRADING_TEMPERATURE, 0, 0, "TEMPERATURE", 0},
        {TKDPO4K_VAL_WAVEFORM_GRADING_SPECTRAL, 0, 0, "SPECTRAL", 0},
        {TKDPO4K_VAL_WAVEFORM_GRADING_INVERTED, 0, 0, "INVERTED", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrWaveformGradingRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrWaveformGradingRangeTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_RF_PHASE_IN_DEGREES-*/ 
static IviRangeTableEntry attrRFPhaseDegreesRangTableEntries[] =
    {
        {-180, 180, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRFPhaseDegreesRangTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRFPhaseDegreesRangTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM-*/ 
static IviRangeTableEntry attrRFPhaseWrapDegreesNumRangTableEntries[] =
    {
        {180, 54000, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRFPhaseWrapDegreesNumRangTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRFPhaseWrapDegreesNumRangTableEntries,
    };

 /*- Range table for attribute TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT-*/ 
static IviRangeTableEntry attrRFIQDataFileFormatRangTableEntries[] =
    {
        {TKDPO4K_VAL_FILE_FORMAT_TIQ, 0, 0, "TIQ", 0},
        {TKDPO4K_VAL_FILE_FORMAT_MATLAB, 0, 0, "MATLAB", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRFIQDataFileFormatRangTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRFIQDataFileFormatRangTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeSineFiftyRangeTableEntries[] =
    {
        {0.01, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeSineFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeSineFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeSineHighzRangeTableEntries[] =
    {
        {0.02, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeSineHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeSineHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeSincFiftyRangeTableEntries[] =
    {
        {0.01, 1.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeSincFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeSincFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeSincHighzRangeTableEntries[] =
    {
        {0.02, 3, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeSincHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeSincHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeLorentzFiftyRangeTableEntries[] =
    {
        {0.01, 1.2, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeLorentzFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeLorentzFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeLorentzHighzRangeTableEntries[] =
    {
        {0.02, 2.4, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeLorentzHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeLorentzHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeGaussianFiftyRangeTableEntries[] =
    {
        {0.01, 1.25, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeGaussianFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeGaussianFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionAmplitudeGaussianHighzRangeTableEntries[] =
    {
        {0.02, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionAmplitudeGaussianHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionAmplitudeGaussianHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionFrequencySineRangeTableEntries[] =
    {
        {0.1, 5e7, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionFrequencySineRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionFrequencySineRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionFrequencySquareRangeTableEntries[] =
    {
        {0.1, 2.5e7, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionFrequencySquareRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionFrequencySquareRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionFrequencyLorentzRangeTableEntries[] =
    {
        {0.1, 5e6, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionFrequencyLorentzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionFrequencyLorentzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionFrequencySincRangeTableEntries[] =
    {
        {0.1, 2e6, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionFrequencySincRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionFrequencySincRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionFrequencyCardiacRangeTableEntries[] =
    {
        {0.1, 5e5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionFrequencyCardiacRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionFrequencyCardiacRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionWaveformRangeTableEntries[] =
    {
        {TKDPO4K_VAL_WFM_SINE, 0, 0, "SINE", 0},
        {TKDPO4K_VAL_WFM_SQUARE, 0, 0, "SQUARE", 0},
        {TKDPO4K_VAL_WFM_PULSE, 0, 0, "PULSE", 0},
        {TKDPO4K_VAL_WFM_RAMP, 0, 0, "RAMP", 0},
        {TKDPO4K_VAL_WFM_NOISE, 0, 0, "NOISE", 0},
        {TKDPO4K_VAL_WFM_DC, 0, 0, "DC", 0},
        {TKDPO4K_VAL_WFM_SINC, 0, 0, "SINC", 0},
        {TKDPO4K_VAL_WFM_GAUSSIAN, 0, 0, "GAUSSIAN", 0},
        {TKDPO4K_VAL_WFM_LORENTZ, 0, 0, "LORENTZ", 0},
        {TKDPO4K_VAL_WFM_ERISE, 0, 0, "ERISE", 0},
        {TKDPO4K_VAL_WFM_EDECAY, 0, 0, "EDECAY", 0},
        {TKDPO4K_VAL_WFM_HAVERSINE, 0, 0, "HAVERSINE", 0},
        {TKDPO4K_VAL_WFM_CARDIAC, 0, 0, "CARDIAC", 0},
        {TKDPO4K_VAL_WFM_ARBITRARY, 0, 0, "ARBITRARY", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionWaveformRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionWaveformRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelGaussianFiftyRangeTableEntries[] =
    {
        {-1.24, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelGaussianFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelGaussianFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelGaussianHighzRangeTableEntries[] =
    {
        {-2.48, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelGaussianHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelGaussianHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelSineFiftyRangeTableEntries[] =
    {
        {-1.245, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelSineFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelSineFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelSineHighzRangeTableEntries[] =
    {
        {-2.49, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelSineHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelSineHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelSincFiftyRangeTableEntries[] =
    {
        {-1.241, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelSincFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelSincFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelSincHighzRangeTableEntries[] =
    {
        {-2.482, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelSincHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelSincHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelLorentzFiftyRangeTableEntries[] =
    {
        {-1.239, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelLorentzFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelLorentzFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionHighLevelLorentzHighzRangeTableEntries[] =
    {
        {-2.478, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionHighLevelLorentzHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionHighLevelLorentzHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelSineFiftyRangeTableEntries[] =
    {
        {-2.5, 1.24, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelSineFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelSineFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelSineHighzRangeTableEntries[] =
    {
        {-5, 2.49, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelSineHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelSineHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelSincFiftyRangeTableEntries[] =
    {
        {-1.518, 1.248, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelSincFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelSincFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelSincHighzRangeTableEntries[] =
    {
        {-3.036, 2.496, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelSincHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelSincHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelLorentzFiftyRangeTableEntries[] =
    {
        {-1.233, 1.266, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelLorentzFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelLorentzFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelLorentzHighzRangeTableEntries[] =
    {
        {-2.466, 2.532, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelLorentzHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelLorentzHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelGaussianFiftyRangeTableEntries[] =
    {
        {-1.25, 1.24, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelGaussianFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelGaussianFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionLowLevelGaussianHighzRangeTableEntries[] =
    {
        {-2.5, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionLowLevelGaussianHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionLowLevelGaussianHighzRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionPresetLevelRangeTableEntries[] =
    {
        {TKDPO4K_VAL_FUNC_LEVEL_CMOS_5_0V, 0, 0, "CMOS_5_0V", 0},
        {TKDPO4K_VAL_FUNC_LEVEL_CMOS_3_3V, 0, 0, "CMOS_3_3V", 0},
        {TKDPO4K_VAL_FUNC_LEVEL_CMOS_2_5V, 0, 0, "CMOS_2_5V", 0},
        {TKDPO4K_VAL_FUNC_LEVEL_USER, 0, 0, "USER", 0},
        {TKDPO4K_VAL_FUNC_LEVEL_ECL, 0, 0, "ECL", 0},
        {TKDPO4K_VAL_FUNC_LEVEL_TTL, 0, 0, "TTL", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionPresetLevelRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionPresetLevelRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionNoiseLevelRangeTableEntries[] =
    {
        {0, 100, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionNoiseLevelRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionNoiseLevelRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionDCOffsetFiftyRangeTableEntries[] =
    {
        {-1.25, 1.25, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionDCOffsetFiftyRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionDCOffsetFiftyRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionDCOffsetHighzRangeTableEntries[] =
    {
        {-2.5, 2.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionDCOffsetHighzRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionDCOffsetHighzRangeTableEntries,
    };

static IviRangeTableEntry attrOutputImpedanceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_FIFTY, 0, 0, "FIFTY", 0},
        {TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ, 0, 0, "HIGHZ", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrOutputImpedanceRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrOutputImpedanceRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionStartPhaseRangeTableEntries[] =
    {
        {-180, 180, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionStartPhaseRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionStartPhaseRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionDutyCycleHighRangeTableEntries[] =
    {
        {10, 90, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionDutyCycleHighRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionDutyCycleHighRangeTableEntries,
    };

static IviRangeTableEntry attrFunctionRampSymmetryRangeTableEntries[] =
    {
        {0, 100, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrFunctionRampSymmetryRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrFunctionRampSymmetryRangeTableEntries,
    };

static IviRangeTableEntry attrDVMTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_DVM_TYPE_ACRMS, 0, 0, "ACRMS", 0},
        {TKDPO4K_VAL_DVM_TYPE_ACDCRMS, 0, 0, "ACDCRMS", 0},
        {TKDPO4K_VAL_DVM_TYPE_DC, 0, 0, "DC", 0},
        {TKDPO4K_VAL_DVM_TYPE_FREQUENCY, 0, 0, "FREQUENCY", 0},
        {TKDPO4K_VAL_DVM_TYPE_OFF, 0, 0, "OFF", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDVMTypeRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrDVMTypeRangeTableEntries,
    };

static IviRangeTableEntry attrDVMSourceRangeTableEntries[] =
    {
        {TKDPO4K_VAL_DVM_SOURCE_CH1, 0, 0, "CH1", 0},
        {TKDPO4K_VAL_DVM_SOURCE_CH2, 0, 0, "CH2", 0},
        {TKDPO4K_VAL_DVM_SOURCE_CH3, 0, 0, "CH3", 0},
        {TKDPO4K_VAL_DVM_SOURCE_CH4, 0, 0, "CH4", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDVMSourceRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrDVMSourceRangeTableEntries,
    };

static IviRangeTableEntry attrEventRepeatCountRangeTableEntries[] =
    {
        {1, 1000001, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEventRepeatCountRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEventRepeatCountRangeTableEntries,
    };

static IviRangeTableEntry attrEventTriggerTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_EVENT_TRIGGER_TYPE_NONE, 0, 0, "NONE", 0},
        {TKDPO4K_VAL_EVENT_TRIGGER_TYPE_TRIGGER, 0, 0, "TRIGGER", 0},
        {TKDPO4K_VAL_EVENT_TRIGGER_TYPE_ACQCOMPLETE, 0, 0, "ACQCOMPLETE", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrEventTriggerTypeRangeTable = 
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrEventTriggerTypeRangeTableEntries,
    };

static IviRangeTableEntry attrAcquisitionNumberRangeTableEntries[] =
    {
        {1, 1000000, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrAcquisitionNumberRangeTable = 
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrAcquisitionNumberRangeTableEntries,
    };

/*****************************************************************************
 *--- Typedefs for string/string tables used in trigger source callbacks ----*
 *****************************************************************************/

typedef struct
{
    ViString col1;
    ViString col2;
} tkdpo4kStringTableEntries;

typedef tkdpo4kStringTableEntries tkdpo4kStringTable[];

/*****************************************************************************
 *------------------------------- Global Data -------------------------------*
 *****************************************************************************/
    
    /*- TKDPO4K_ATTR_MODEL -*/
static IviRangeTableEntry attrModelRangeTableEntries[] =
    {
        {TKDPO4K_VAL_DPO_4104, 0, 0, "DPO4104", 1000},
        {TKDPO4K_VAL_DPO_4054, 0, 0, "DPO4054", 500},
        {TKDPO4K_VAL_DPO_4034, 0, 0, "DPO4034", 350},
        {TKDPO4K_VAL_DPO_4032, 0, 0, "DPO4032", 350},
        {TKDPO4K_VAL_MSO_4104, 0, 0, "MSO4104", 1000},
        {TKDPO4K_VAL_MSO_4054, 0, 0, "MSO4054", 500},
        {TKDPO4K_VAL_MSO_4034, 0, 0, "MSO4034", 350},
        {TKDPO4K_VAL_MSO_4032, 0, 0, "MSO4032", 350},
        {TKDPO4K_VAL_DPO_3012, 0, 0, "DPO3012", 100},
        {TKDPO4K_VAL_DPO_3014, 0, 0, "DPO3014", 100},
        {TKDPO4K_VAL_DPO_3032, 0, 0, "DPO3032", 300},
        {TKDPO4K_VAL_DPO_3034, 0, 0, "DPO3034", 300},
        {TKDPO4K_VAL_DPO_3052, 0, 0, "DPO3052", 500},
        {TKDPO4K_VAL_DPO_3054, 0, 0, "DPO3054", 500},
        {TKDPO4K_VAL_MSO_3012, 0, 0, "MSO3012", 0},
        {TKDPO4K_VAL_MSO_3014, 0, 0, "MSO3014", 0},
        {TKDPO4K_VAL_MSO_3032, 0, 0, "MSO3032", 0},
        {TKDPO4K_VAL_MSO_3034, 0, 0, "MSO3034", 0},
        {TKDPO4K_VAL_MSO_3052, 0, 0, "MSO3052", 0},
        {TKDPO4K_VAL_MSO_3054, 0, 0, "MSO3054", 0},
        {TKDPO4K_VAL_DPO_4034B, 0, 0, "DPO4034B", 0},
        {TKDPO4K_VAL_DPO_4054B, 0, 0, "DPO4054B", 0},
        {TKDPO4K_VAL_DPO_4104B, 0, 0, "DPO4104B", 0},
        {TKDPO4K_VAL_MSO_4034B, 0, 0, "MSO4034B", 0},
        {TKDPO4K_VAL_MSO_4054B, 0, 0, "MSO4054B", 0},
        {TKDPO4K_VAL_MSO_4104B, 0, 0, "MSO4104B", 0},
        {TKDPO4K_VAL_MDO_41046, 0, 0, "MDO41046", 0},
        {TKDPO4K_VAL_MDO_41043, 0, 0, "MDO41043", 0},
        {TKDPO4K_VAL_MDO_40546, 0, 0, "MDO40546", 0},
        {TKDPO4K_VAL_MDO_40543, 0, 0, "MDO40543", 0},
        {TKDPO4K_VAL_DPO_4102B,   0, 0, "DPO4102B",   1000},
        {TKDPO4K_VAL_DPO_4102B_L, 0, 0, "DPO4102B-L", 1000},
        {TKDPO4K_VAL_DPO_4104B_L, 0, 0, "DPO4104B-L", 1000},
        {TKDPO4K_VAL_MSO_4102B,   0, 0, "MSO4102B",   1000},
        {TKDPO4K_VAL_MSO_4102B_L, 0, 0, "MSO4102B-L", 1000},
        {TKDPO4K_VAL_MSO_4104B_L, 0, 0, "MSO4104B-L", 1000},
        {TKDPO4K_VAL_DPO_4014B, 0, 0, "DPO4014B", 0},
        {TKDPO4K_VAL_MSO_4014B, 0, 0, "MSO4014B", 0},
        {TKDPO4K_VAL_MDO_4014_3, 0, 0, "MDO4014-3", 0},
        {TKDPO4K_VAL_MDO_4034_3, 0, 0, "MDO4034-3", 0},
        {TKDPO4K_VAL_MDO_4014B_3, 0, 0, "MDO4014B-3", 0},
        {TKDPO4K_VAL_MDO_4034B_3, 0, 0, "MDO4034B-3", 0},
        {TKDPO4K_VAL_MDO_4054B_3, 0, 0, "MDO4054B-3", 0},
        {TKDPO4K_VAL_MDO_4054B_6, 0, 0, "MDO4054B-6", 0},
        {TKDPO4K_VAL_MDO_4104B_3, 0, 0, "MDO4104B-3", 0},
        {TKDPO4K_VAL_MDO_4104B_6, 0, 0, "MDO4104B-6", 0},
        {TKDPO4K_VAL_MDO_3012, 0, 0, "MDO3012", 0}, 
        {TKDPO4K_VAL_MDO_3014, 0, 0, "MDO3014", 0}, 
        {TKDPO4K_VAL_MDO_3022, 0, 0, "MDO3022", 0}, 
        {TKDPO4K_VAL_MDO_3024, 0, 0, "MDO3024", 0}, 
        {TKDPO4K_VAL_MDO_3032, 0, 0, "MDO3032", 0}, 
        {TKDPO4K_VAL_MDO_3034, 0, 0, "MDO3034", 0}, 
        {TKDPO4K_VAL_MDO_3052, 0, 0, "MDO3052", 0}, 
        {TKDPO4K_VAL_MDO_3054, 0, 0, "MDO3054", 0},
        {TKDPO4K_VAL_MDO_3102, 0, 0, "MDO3102", 0}, 
		{TKDPO4K_VAL_MDO_3104, 0, 0, "MDO3104", 0},
        {TKDPO4K_VAL_MDO_4024C, 0, 0, "MDO4024C", 0},
		{TKDPO4K_VAL_MDO_4034C, 0, 0, "MDO4034C", 0}, 
		{TKDPO4K_VAL_MDO_4054C, 0, 0, "MDO4054C", 0}, 
		{TKDPO4K_VAL_MDO_4104C, 0, 0, "MDO4104C", 0}, 
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };
   
static IviRangeTable attrModelRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        VI_NULL,
        attrModelRangeTableEntries,
    };
    /*- Identify instrument model from IDN return string -*/
static IviStringValueTable modelIdentificationTable =
{
    {TKDPO4K_VAL_DPO_4104,      "TEKTRONIX,DPO4104" },
    {TKDPO4K_VAL_DPO_4054,      "TEKTRONIX,DPO4054" },
    {TKDPO4K_VAL_DPO_4034,      "TEKTRONIX,DPO4034" },
    {TKDPO4K_VAL_DPO_4032,      "TEKTRONIX,DPO4032" },
    {TKDPO4K_VAL_MSO_4104,      "TEKTRONIX,MSO4104" },
    {TKDPO4K_VAL_MSO_4054,      "TEKTRONIX,MSO4054" },
    {TKDPO4K_VAL_MSO_4034,      "TEKTRONIX,MSO4034" },
    {TKDPO4K_VAL_MSO_4032,      "TEKTRONIX,MSO4032" },
    {TKDPO4K_VAL_DPO_3012,      "TEKTRONIX,DPO3012" },
    {TKDPO4K_VAL_DPO_3014,      "TEKTRONIX,DPO3014" },

    {TKDPO4K_VAL_DPO_3032,      "TEKTRONIX,DPO3032" },
    {TKDPO4K_VAL_DPO_3034,      "TEKTRONIX,DPO3034" },
    {TKDPO4K_VAL_DPO_3052,      "TEKTRONIX,DPO3052" },
    {TKDPO4K_VAL_DPO_3054,      "TEKTRONIX,DPO3054" },
    {TKDPO4K_VAL_MSO_3012,      "TEKTRONIX,MSO3012" },
    {TKDPO4K_VAL_MSO_3014,      "TEKTRONIX,MSO3014" },
    {TKDPO4K_VAL_MSO_3032,      "TEKTRONIX,MSO3032" },
    {TKDPO4K_VAL_MSO_3034,      "TEKTRONIX,MSO3034" },
    {TKDPO4K_VAL_MSO_3052,      "TEKTRONIX,MSO3052" },
    {TKDPO4K_VAL_MSO_3054,      "TEKTRONIX,MSO3054" },

    {TKDPO4K_VAL_DPO_4034B,     "TEKTRONIX,DPO4034B"},
    {TKDPO4K_VAL_DPO_4054B,     "TEKTRONIX,DPO4054B"},
    {TKDPO4K_VAL_DPO_4104B,     "TEKTRONIX,DPO4014B"},
    {TKDPO4K_VAL_MSO_4034B,     "TEKTRONIX,MSO4034B"},
    {TKDPO4K_VAL_MSO_4054B,     "TEKTRONIX,MSO4054B"},
    {TKDPO4K_VAL_MSO_4104B,     "TEKTRONIX,MSO4104B"},
    {TKDPO4K_VAL_MDO_41046,     "TEKTRONIX,MDO4104-6" },
    {TKDPO4K_VAL_MDO_41043,     "TEKTRONIX,MDO4104-3" }, 
    {TKDPO4K_VAL_MDO_40546,     "TEKTRONIX,MDO4054-6" }, 
    {TKDPO4K_VAL_MDO_40543,     "TEKTRONIX,MDO4054-3" }, 

    {TKDPO4K_VAL_DPO_4102B,     "TEKTRONIX,DPO4102B"  },
    {TKDPO4K_VAL_DPO_4102B_L,   "TEKTRONIX,DPO4102B-L"},
    {TKDPO4K_VAL_DPO_4104B_L,   "TEKTRONIX,DPO4104B-L"},
    {TKDPO4K_VAL_MSO_4102B,     "TEKTRONIX,MSO4102B"  },
    {TKDPO4K_VAL_MSO_4102B_L,   "TEKTRONIX,MSO4102B-L"},
    {TKDPO4K_VAL_MSO_4104B_L,   "TEKTRONIX,MSO4104B-L"},
    {TKDPO4K_VAL_DPO_4014B,     "TEKTRONIX,DPO4014B"},
    {TKDPO4K_VAL_MSO_4014B,     "TEKTRONIX,MSO4014B"},
    {TKDPO4K_VAL_MDO_4014_3,    "TEKTRONIX,MDO4014-3"}, 
    {TKDPO4K_VAL_MDO_4034_3,    "TEKTRONIX,MDO4034-3"}, 

    {TKDPO4K_VAL_MDO_4014B_3,   "TEKTRONIX,MDO4014B-3"}, 
    {TKDPO4K_VAL_MDO_4034B_3,   "TEKTRONIX,MDO4034B-3"}, 
    {TKDPO4K_VAL_MDO_4054B_3,   "TEKTRONIX,MDO4054B-3"}, 
    {TKDPO4K_VAL_MDO_4054B_6,   "TEKTRONIX,MDO4054B-6"}, 
    {TKDPO4K_VAL_MDO_4104B_3,   "TEKTRONIX,MDO4104B-3"}, 
    {TKDPO4K_VAL_MDO_4104B_6,   "TEKTRONIX,MDO4104B-6"}, 
    {TKDPO4K_VAL_MDO_3012,      "TEKTRONIX,MDO3012"}, 
    {TKDPO4K_VAL_MDO_3014,      "TEKTRONIX,MDO3014"}, 
    {TKDPO4K_VAL_MDO_3022,      "TEKTRONIX,MDO3022"}, 
    {TKDPO4K_VAL_MDO_3024,      "TEKTRONIX,MDO3024"}, 

    {TKDPO4K_VAL_MDO_3032,      "TEKTRONIX,MDO3032"}, 
    {TKDPO4K_VAL_MDO_3034,      "TEKTRONIX,MDO3034"}, 
    {TKDPO4K_VAL_MDO_3052,      "TEKTRONIX,MDO3052"}, 
    {TKDPO4K_VAL_MDO_3054,      "TEKTRONIX,MDO3054"},
    {TKDPO4K_VAL_MDO_3102,      "TEKTRONIX,MDO3102"}, 
    {TKDPO4K_VAL_MDO_3104,      "TEKTRONIX,MDO3104"},
	{TKDPO4K_VAL_MDO_4024C,      "TEKTRONIX,MDO4024C"},	
	{TKDPO4K_VAL_MDO_4034C,      "TEKTRONIX,MDO4034C"},	
	{TKDPO4K_VAL_MDO_4054C,      "TEKTRONIX,MDO4054C"},	
	{TKDPO4K_VAL_MDO_4104C,      "TEKTRONIX,MDO4104C"},	

    { VI_NULL,                  VI_NULL }   
};

    /*- TKDPO4K_ATTR_TRIGGER_SOURCE -*/
static tkdpo4kStringTable triggerSourceStringTable =
{
    { TKDPO4K_VAL_EXTERNAL,    "AUX"    },
    { TKDPO4K_VAL_AC_LINE,     "LINE"   },
    { VI_NULL,                  VI_NULL }
};                               

    /*- TKDPO4K_ATTR_MEAS_SOURCE*/
static tkdpo4kStringTable measurementSourceStringTable = 
{
    { TKDPO4K_VAL_HISTOGRAM,    "HIS"    },
    { VI_NULL,                  VI_NULL }
};
/*****************************************************************************
 *-------------- Utility Function Declarations (Non-Exported) ---------------*
 *****************************************************************************/
static ViStatus tkdpo4k_InitAttributes (ViSession vi, ViString idnString, ViInt32 instrModelNo);
static ViStatus tkdpo4k_DefaultInstrSetup (ViSession openInstrSession);
static ViStatus tkdpo4k_NonInvasiveInstrSetup (ViSession openInstrSession); 
static ViStatus tkdpo4k_CheckStatus (ViSession vi);
static ViStatus tkdpo4k_WaitForOPC (ViSession vi, ViInt32 maxTime);
static ViStatus tkdpo4k_GetStringFromTable( tkdpo4kStringValueTable table, ViInt32 value, ViConstString* string );
static ViStatus tkdpo4k_GetRepCommandFromTable( tkdpo4kStringValueTable table, ViInt32 value,ViConstString* repCommand );
static ViStatus tkdpo4k_TestifyRFMeasureType (ViSession vi, ViInt32 expectedValue);
static ViStatus tkdpo4k_TestifyMDOModel (ViSession vi);
static ViStatus tkdpo4k_TestifyMDO4KModel (ViSession vi); 
static ViStatus tkdpo4k_TestifyMDO3KModel (ViSession vi);
static ViStatus tkdpo4k_BuildChannelList (ViInt32 model, ViChar channelList[]);  
static ViStatus tkdpo4k_GetProbeAttenuation (ViSession vi, 
                                              ViConstString channelName, 
                                              ViReal64 *value);
static ViStatus tkdpo4k_ChangeOneAttributeFlag (ViSession vi, 
                                                 ViAttr attributeId, 
                                                 ViInt32 flagBit, 
                                                 ViBoolean flagState);
static ViStatus tkdpo4k_SetCachingOnProbeDependentAttributes (ViSession vi, 
                                                               ViBoolean state);
static ViStatus tkdpo4k_FetchRawWaveform (ViSession vi, ViSession io, 
                                           ViConstString dataSource,
                                           ViReal64 *yZero,
                                           ViReal64 *yOffset, 
                                           ViReal64 *yMultiplier,
                                           ViReal64 *xIncrement, 
                                           ViReal64 *initialX, 
                                           ViInt32 waveformSize, 
                                           ViReal64 waveform[],
                                           ViInt32 *actualPoints);
static ViStatus tkdpo4k_FetchRawMinMaxWaveform (ViSession vi, ViSession io,
                                                 ViConstString dataSource,
                                                 ViReal64 *yZero,
                                                 ViReal64 *yOffset, 
                                                 ViReal64 *yMultiplier,
                                                 ViReal64 *xIncrement, 
                                                 ViReal64 *initialX, 
                                                 ViInt32 waveformSize,
                                                 ViReal64 minWaveform[],
                                                 ViReal64 maxWaveform[],
                                                 ViInt32 *actualPoints);
static ViStatus tkdpo4k_FetchContinuousRawWaveform (ViSession vi, ViSession io, 
                                                       ViConstString dataSource,
                                                       ViReal64 *yZero,
                                                       ViReal64 *yOffset, 
                                                       ViReal64 *yMultiplier,
                                                       ViReal64 *xIncrement, 
                                                       ViReal64 *initialX, 
                                                       ViReal64 waveform[],
                                                       ViInt32 *actualPoints);
static ViStatus tkdpo4k_FetchContinuousRawMinMaxWaveform (ViSession vi, ViSession io,
                                                             ViConstString dataSource,
                                                             ViReal64 *yZero,
                                                             ViReal64 *yOffset, 
                                                             ViReal64 *yMultiplier,
                                                             ViReal64 *xIncrement, 
                                                             ViReal64 *initialX, 
                                                             ViReal64 minWaveform[],
                                                             ViReal64 maxWaveform[],
                                                             ViInt32 *actualPoints);                                                       
static void tkdpo4k_ScaleRawWaveform (ViInt32 waveformSize, ViReal64 waveform[],
                                       ViReal64 yZero, ViReal64 yOffset, ViReal64 yMultiplier);
static ViStatus tkdpo4k_CoerceStringSourceToCmd (ViSession vi, ViConstString source, 
                                                  ViConstString *sourceCmdString);
static ViStatus tkdpo4k_CoerceToResolution (ViSession vi, ViReal64 value, 
                                             ViReal64 resolution, ViInt32 comparePrecision, 
                                             ViReal64 *coercedValue);
static ViStatus tkdpo4k_GetStr1PtrFromStr2 (tkdpo4kStringTable strTable, 
                                             ViConstString *str1, ViConstString str2);
static ViStatus tkdpo4k_GetStr2BufFromStr1 (tkdpo4kStringTable strTable, 
                                             ViConstString str1, ViChar str2[]);
static ViStatus tkdpo4k_GetStr2PtrFromStr1 (tkdpo4kStringTable strTable, 
                                             ViConstString *str2, ViConstString str1);
static ViStatus tkdpo4k_CheckRangeWithPrecision (ViSession vi, ViAttr attributeId, 
                                                  ViReal64 value, ViReal64 min, 
                                                  ViReal64 max);
static ViStatus tkdpo4k_GetDriverSetupOption (ViSession vi,
                                               ViConstString optionTag,
                                               ViInt32 optionValueSize,
                                               ViChar optionValue[]);
                                               
static ViStatus tkdpo4k_GetSelectedBusName (ViSession vi, ViString* busName);

static ViStatus _VI_FUNC tkdpo4k_CheckStatusCallback (ViSession vi, ViSession io);
static ViStatus _VI_FUNC tkdpo4k_WaitForOPCCallback (ViSession vi, ViSession io);
static ViStatus _VI_FUNC tkdpo4kStdViInt32_WriteCallback (ViSession vi, ViSession io, 
                                                           ViConstString channelName, 
                                                           ViAttr attributeId, ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kStdViInt32_ReadCallback (ViSession vi, ViSession io, 
                                                          ViConstString channelName, 
                                                          ViAttr attributeId, ViInt32 *value);
static ViStatus tkdpo4k_CreateArbRecords (ViSession vi);
static ViStatus tkdpo4k_GetNumDefinedWaveforms (ViSession vi, 
                                                ViInt32 *numWfms);
static ViStatus tkdpo4k_VerifyWfmCreatable (ViSession vi, 
                                            ViInt32 wfmSize,
                                            ViReal64 wfmData[]);
static ViStatus tkdpo4k_GetNewWfmInfo (ViSession vi, 
                                       ViInt32 *wfmHandle);
static ViStatus tkdpo4k_UpdateDriverWfmRecord (ViSession vi, 
                                               ViInt32 wfmHandle, 
                                               ViInt32 wfmSize);
static ViStatus tkdpo4k_WfmExists (ViSession vi, 
                                   ViInt32 wfmHandle, 
                                   ViBoolean *wfmExists);
static ViStatus tkdpo4k_VerifyWfmHandle (ViSession vi, 
                                         ViInt32 wfmHandle);
static ViStatus tkdpo4k_ClearDriverWfmRecord (ViSession vi, 
                                              ViInt32 wfmHandle);

/*****************************************************************************
 *----------------- Callback Declarations (Non-Exported) --------------------*
 *****************************************************************************/ 
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_ReadCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_CheckCallback (ViSession vi, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_CoerceCallback (ViSession vi, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value, 
                                                                      ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrHorzMinNumPts_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);                                                                     
static ViStatus _VI_FUNC tkdpo4kAttrHorzRecordLength_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrHorzSampleRate_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_ReadCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_RangeTableCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           IviRangeTablePtr *rangeTablePtr); 
static ViStatus _VI_FUNC tkdpo4kAttrInitiateContinuous_ReadCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViBoolean *value);
static ViStatus _VI_FUNC tkdpo4kAttrInitiateContinuous_WriteCallback (ViSession vi, 
                                                                       ViSession io, 
                                                                       ViConstString channelName, 
                                                                       ViAttr attributeId, 
                                                                       ViBoolean value);    
static ViStatus _VI_FUNC tkdpo4kAttrMagnivuEnabled_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViBoolean *value);
static ViStatus _VI_FUNC tkdpo4kAttrMagnivuEnabled_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViBoolean value);

    /*- Channel Sub-system --------------------------------------------*/                                                                     
static ViStatus _VI_FUNC tkdpo4kAttrChannelEnabled_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViBoolean *value);
static ViStatus _VI_FUNC tkdpo4kAttrChannelEnabled_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViBoolean value);                                                                     

static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_ReadCallback (ViSession vi, 
                                                             ViSession io, 
                                                             ViConstString channelName, 
                                                             ViAttr attributeId, 
                                                             ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_WriteCallback (ViSession vi, 
                                                              ViSession io, 
                                                              ViConstString channelName, 
                                                              ViAttr attributeId, 
                                                              ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrChannelImpedance_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrChannelImpedance_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_CheckCallback (ViSession vi, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_ReadCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerMode_CheckCallback (ViSession vi, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViInt32 value);
                                                                     
static ViStatus _VI_FUNC tkdpo4kAttrIdQueryResponse_ReadCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrMeasureValue_ReadCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrNumEnvelopes_ReadCallback (ViSession vi, 
                                                                ViSession io,
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 *value); 
static ViStatus _VI_FUNC tkdpo4kAttrNumEnvelopes_WriteCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrPatternDeltatime_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViReal64 value,
                                                                      ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrProbeAttenuation_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrProbeSenseValue_ReadCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_CheckCallback (ViSession vi, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_ReadCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_CheckCallback (ViSession vi, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrRuntWidth_CoerceCallback (ViSession vi, 
                                                               ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViReal64 value, 
                                                               ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionDeltaTime_CoerceCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 value,
                                                                         ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_CheckCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_ReadCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_CheckCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_CoerceCallback (ViSession vi, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 value, 
                                                                    ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_CheckCallback (ViSession vi, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_ReadCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_WriteCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_CheckCallback (ViSession vi, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 const ViConstString cacheValue);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_CheckCallback (ViSession vi, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_ReadCallback (ViSession vi, 
                                                               ViSession io, 
                                                               ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_WriteCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerEvent_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerEvent_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_CheckCallback (ViSession vi, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_ReadCallback (ViSession vi, 
                                                                       ViSession io, 
                                                                       ViConstString channelName, 
                                                                       ViAttr attributeId, 
                                                                       ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_WriteCallback (ViSession vi, 
                                                                        ViSession io, 
                                                                        ViConstString channelName, 
                                                                        ViAttr attributeId, 
                                                                        ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerFieldHoldoff_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerFieldHoldoff_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomFormat_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomFormat_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomScanRate_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomScanRate_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalCoupling_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalCoupling_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViInt32 value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_CheckCallback (ViSession vi, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 value);
                                                                   
static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_CoerceCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value,
                                                                   ViReal64 *coercedValue);  
static ViStatus _VI_FUNC tkdpo4kAttrProbeGain_ReadCallback (ViSession vi, 
                                                            ViSession io, 
                                                            ViConstString channelName, 
                                                            ViAttr attributeId, 
                                                            ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrProbeGain_WriteCallback (ViSession vi, 
                                                             ViSession io, 
                                                             ViConstString channelName, 
                                                             ViAttr attributeId, 
                                                             ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 value);
                                                                  
static ViStatus _VI_FUNC tkdpo4kResolutionOne_CoerceCallback (ViSession vi, 
                                                               ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViReal64 value, 
                                                               ViReal64 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kStdViReal64_ReadCallback (ViSession vi, 
                                                           ViSession io, 
                                                           ViConstString channelName, 
                                                           ViAttr attributeId, 
                                                           ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kStdViReal64_WriteCallback (ViSession vi, 
                                                            ViSession io, 
                                                            ViConstString channelName, 
                                                            ViAttr attributeId, 
                                                            ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_CheckCallback (ViSession vi, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value);
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 const ViConstString cacheValue);
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value);
                                                                
static ViStatus _VI_FUNC tkdpo4kAttrProbeAttenuation_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_RangeTableCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   IviRangeTablePtr *rangeTablePtr);
static ViStatus _VI_FUNC tkdpo4kAttrGlitchWidth_CoerceCallback (ViSession vi,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 value,
                                                           ViReal64 *coercedValue);

static ViStatus _VI_FUNC tkdpo4kAttrStateWhen_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrStateWhen_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrAcLineTriggerSlope_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrAcLineTriggerSlope_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEdgeTriggerClass_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEdgeTriggerClass_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicTriggerClass_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicTriggerClass_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerClass_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerClass_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);
static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value);
                                                                     
static ViStatus _VI_FUNC tkdpo4kAttrTriggerUpperthresByCh_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerUpperthresByCh_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 value);
                                                                          
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLowerthresByCh_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLowerthresByCh_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrTriggerThresholdByCh_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicInputByCh_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicInputByCh_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternFunction_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternFunction_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternWhen_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternWhen_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternInput_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrPatternInput_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrStateFunction_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrStateFunction_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrStateInput_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrStateInput_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_RangeTableCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdHoldtime_CoerceCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 value,
                                                                    ViReal64 *coercedValue);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdSettime_CoerceCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value,
                                                                   ViReal64 *coercedValue);

static ViStatus _VI_FUNC tkdpo4kAttrRs232Condition_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232Condition_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataSize_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataSize_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataSize_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataSize_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrCanCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrCanCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdMode_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdMode_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_CheckCallback (ViSession vi,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_CoerceCallback (ViSession vi,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrCanDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrCanDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);


static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrCanFrametype_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrCanFrametype_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrMode_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrMode_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataDirection_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataDirection_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrMathFunction_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrMathFunction_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrAdvDefine_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrAdvDefine_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrBusType_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusType_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusType_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusState_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusState_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanBitrate_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanBitrate_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanProbe_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanProbe_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsPolarity_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsPolarity_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelBitsSource_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelBitsSource_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrInstrParallelBitSource_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrInstrParallelBitSource_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockEdge_ReadCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockEdge_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockLocked_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViBoolean *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockLocked_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViBoolean value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockSource_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockSource_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Bitrate_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Bitrate_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Databits_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Databits_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Delimiter_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Delimiter_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Parity_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Parity_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232RxSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232RxSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232TxSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232TxSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerTime_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value,
                                                                     ViReal64 *coercedValue);

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_CheckCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrDataStartPos_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDataStartPos_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrDataStopPos_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDataStopPos_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrDataWidth_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDataWidth_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrDataYZero_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViReal64 *value);
                                                              
static ViStatus _VI_FUNC tkdpo4kAttrDataYoff_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 *value);

                                                            
static ViStatus _VI_FUNC tkdpo4kAttrDataYmult_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDataXincr_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDataXzero_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDigitalThreshold_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrDigitalThreshold_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_CheckCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdHoldtime_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdSettime_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrHorzMinNumPts_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrInputImpedance_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrTriggerCoupling_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerCoupling_RangeTableCallback (ViSession vi,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_RangeTableCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_RangeTableCallback (ViSession vi,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomLinePeriod_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomLinePeriod_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomSyncInterval_ReadCallback (ViSession vi,
                                                                              ViSession io,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomSyncInterval_WriteCallback (ViSession vi,
                                                                               ViSession io,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_CheckCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerSource_RangeTableCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrBusSelect_RangeTableCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);
                                                                         
static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);
static ViStatus _VI_FUNC tkdpo4kBModelViInt32_CheckCallback (ViSession vi,
                                                      ViConstString channelName,
                                                      ViAttr attributeId,
                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetType_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetType_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProbeType_ReadCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProbeType_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetDiffInputDataSrc_ReadCallback (ViSession vi,
                                                                              ViSession io,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetDiffInputDataSrc_WriteCallback (ViSession vi,
                                                                               ViSession io,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetPlusDataSrc_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetPlusDataSrc_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetMinusDataSrc_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetMinusDataSrc_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProtocol_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProtocol_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value);


static ViStatus _VI_FUNC tkdpo4kAttrUsbTranField_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranField_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranEndPoint_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranEndPoint_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranStartEnd_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranStartEnd_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kBModelViString_CheckCallback (ViSession vi,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbHubAdd_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrUsbHubAdd_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrUsbPortAdd_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrUsbPortAdd_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicFrameType_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicFrameType_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicCondition_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicCondition_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicQualifier_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicQualifier_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataSize_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataSize_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataOffse_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataOffset_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataUppLimit_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataUppLimit_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetData_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetData_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPSrcAddr_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPSrcAddr_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPDstAddr_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPDstAddr_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACDstAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACDstAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACSrcAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACSrcAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACLength_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACLength_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACUppLength_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACUppLength_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetQtagValue_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetQtagValue_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpDstAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpDstAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSrcAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSrcAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpAcqNumber_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpAcqNumber_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSequenceNumber_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSequenceNumber_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViConstString value);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPProtocol_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue);

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPProtocol_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value);

/*- -------------------------------RF Channel Sub System-----------------------------*/

static ViStatus _VI_FUNC tkdpo4kAttrRfRbw_CheckCallback (ViSession vi,
                                                         ViConstString channelName,
                                                         ViAttr attributeId,
                                                         ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMethod_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfSpanRbwRatio_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfFreqStartStop_CheckCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_CoerceCallback (ViSession vi,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value,
                                                               ViInt32 *coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureAcprAdjacentpairs_CheckCallback (ViSession vi,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_RangeTableCallback (ViSession vi,
                                                                                  ViConstString channelName,
                                                                                  ViAttr attributeId,
                                                                                  IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelPower_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViReal64 *value);

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureAcprChannelSpacing_CheckCallback (ViSession vi,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViReal64 value);



static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureObwPercentDown_CheckCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfSpectrumMode_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value);



static ViStatus _VI_FUNC tkdpo4kAttrReal64HasEntry_ReadCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value);
static ViStatus _VI_FUNC tkdpo4kAttrReal64HasEntry_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value);

static ViStatus _VI_FUNC tkdpo4kAttrBooleanHasEntry_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViBoolean *value);

static ViStatus _VI_FUNC tkdpo4kAttrBooleanHasEntry_WriteCallback(ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViBoolean value);

static ViStatus _VI_FUNC tkdpo4kAttrInt32HasEntry_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32* value);

static ViStatus _VI_FUNC tkdpo4kAttrInt32HasEntry_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value);

static ViStatus _VI_FUNC tkdpo4kAttrRfFreqCenter_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr);
 
static ViStatus _VI_FUNC tkdpo4kAttrRfFreqSpan_RangeTableCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrFuncAmplitude_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value, ViReal64* coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrFuncAmplitude_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      IviRangeTablePtr *rangeTablePtr);               
        
static ViStatus _VI_FUNC tkdpo4kAttrFuncFrequency_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value, ViReal64* coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrFuncFrequency_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      IviRangeTablePtr *rangeTablePtr);               
        
static ViStatus _VI_FUNC tkdpo4kAttrFuncHighLevel_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value, ViReal64* coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrFuncHighLevel_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      IviRangeTablePtr *rangeTablePtr);               
        
static ViStatus _VI_FUNC tkdpo4kAttrFuncLowLevel_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 value, ViReal64* coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrFuncLowLevel_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr);               
        
static ViStatus _VI_FUNC tkdpo4kAttrFuncDcOffset_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 value, ViReal64* coercedValue);
static ViStatus _VI_FUNC tkdpo4kAttrFuncDcOffset_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr);               
        
static ViStatus _VI_FUNC tkdpo4kAttrFuncDutyCycleHigh_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViReal64 value, ViReal64* coercedValue);  
static ViStatus _VI_FUNC tkdpo4kAttrARBWaveformLabel_WriteCallback (ViSession vi,
                                                                    ViSession io, 
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId, 
                                                                    ViConstString value);
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionNumber_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value, ViInt32* coercedValue);
                                                                              
 /*-------------------- STD callbacks -------------------------------------------------*/

static ViStatus _VI_FUNC tkdpo4kEnum_ReadCallback (ViSession       vi,
                                                   ViSession       io,
                                                   ViConstString   channelName,
                                                   ViAttr          attributeId,
                                                   ViInt32*        value);

static ViStatus _VI_FUNC tkdpo4kEnum_WriteCallback (ViSession       vi,
                                                   ViSession        io,
                                                   ViConstString    channelName,
                                                   ViAttr           attributeId,
                                                   ViInt32      value);

static ViStatus _VI_FUNC tkdpo4kViBoolean_ReadCallback (ViSession       vi,
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViBoolean*      value);

static ViStatus _VI_FUNC tkdpo4kViBoolean_WriteCallback (ViSession      vi,
                                                         ViSession      io,
                                                         ViConstString  channelName,
                                                         ViAttr         attributeId,
                                                         ViBoolean      value);

static ViStatus _VI_FUNC tkdpo4kViString_WriteCallback (ViSession       vi,
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViConstString   value);

static ViStatus _VI_FUNC tkdpo4kViString_ReadCallback (ViSession            vi,
                                                       ViSession            io,
                                                       ViConstString        channelName,
                                                       ViAttr               attributeId,
                                                       const ViConstString  cacheValue);

static ViStatus _VI_FUNC tkdpo4kViReal64_WriteCallback (ViSession       vi,
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViReal64        value);

static ViStatus _VI_FUNC tkdpo4kViReal64_ReadCallback (ViSession        vi,
                                                       ViSession        io,
                                                       ViConstString    channelName,
                                                       ViAttr           attributeId,
                                                       ViReal64*        value);

static ViStatus _VI_FUNC tkdpo4kViInt32_WriteCallback (ViSession        vi,
                                                       ViSession        io,
                                                       ViConstString    channelName,
                                                       ViAttr           attributeId,
                                                       ViInt32          value);

static ViStatus _VI_FUNC tkdpo4kViInt32_ReadCallback (ViSession         vi,
                                                      ViSession         io,
                                                      ViConstString channelName,
                                                      ViAttr            attributeId,
                                                      ViInt32*          value);

static ViStatus _VI_FUNC tkdpo4kAttrRfPhaseTraceDegreesNum_CoerceCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViInt32 value, ViInt32* coercedValue);

static ViStatus _VI_FUNC tkdpo4kAttrRfFftWindow_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrAdvVar1_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrAdvVar2_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMethod_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrRfRbwMode_RangeTableCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrRfSpectrumMode_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr);

static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMode_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr);





/*****************************************************************************
 *------------ User-Callable Functions (Exportable Functions) ---------------*
 *****************************************************************************/

/*****************************************************************************
 * Function: tkdpo4k_init   
 * Purpose:  VXIplug&play required function.  Calls the   
 *           tkdpo4k_InitWithOptions function.   
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_init (ViRsrc resourceName, ViBoolean IDQuery, 
                                 ViBoolean resetDevice, ViSession *newVi)
{   
    ViStatus    error = VI_SUCCESS;

    if (newVi == VI_NULL)
    {
        Ivi_SetErrorInfo (VI_NULL, VI_FALSE, IVI_ERROR_INVALID_PARAMETER, 
                          VI_ERROR_PARAMETER4, "Null address for Instrument Handle");
        checkErr( IVI_ERROR_INVALID_PARAMETER);
    }
    checkErr( tkdpo4k_InitWithOptions (resourceName, IDQuery, resetDevice,   
                                        "", newVi));
Error:  
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_InitWithOptions                                       
 * Purpose:  This function creates a new IVI session and calls the 
 *           IviInit function.                                     
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_InitWithOptions (ViRsrc resourceName, ViBoolean IDQuery, 
                                            ViBoolean resetDevice, ViConstString optionString, 
                                            ViSession *newVi)
{   
    ViStatus    error = VI_SUCCESS;
    ViSession   vi = VI_NULL;
    ViChar      newResourceName[IVI_MAX_MESSAGE_BUF_SIZE];
    ViChar      newOptionString[IVI_MAX_MESSAGE_BUF_SIZE];
    ViBoolean   isLogicalName;
   
    if (newVi == VI_NULL)
    {
        Ivi_SetErrorInfo (VI_NULL, VI_FALSE, IVI_ERROR_INVALID_PARAMETER, 
                          VI_ERROR_PARAMETER5, "Null address for Instrument Handle");
        checkErr( IVI_ERROR_INVALID_PARAMETER);
    }

    *newVi = VI_NULL;
    
    checkErr( Ivi_GetInfoFromResourceName (resourceName, (ViString)optionString, newResourceName,
                                           newOptionString, &isLogicalName));
    
        /* create a new interchangeable driver */
    checkErr( Ivi_SpecificDriverNew ("tkdpo4k", newOptionString, &vi));  
    if (!isLogicalName)
    {
        ViInt32 oldFlag = 0;
        
        checkErr (Ivi_GetAttributeFlags (vi, IVI_ATTR_IO_RESOURCE_DESCRIPTOR, &oldFlag));
        checkErr (Ivi_SetAttributeFlags (vi, IVI_ATTR_IO_RESOURCE_DESCRIPTOR, oldFlag & 0xfffb | 0x0010));
        checkErr (Ivi_SetAttributeViString (vi, "", IVI_ATTR_IO_RESOURCE_DESCRIPTOR, 0, newResourceName));
    }
        /* init the driver */
    checkErr( tkdpo4k_IviInit (newResourceName, IDQuery, resetDevice, vi)); 
    
    if (isLogicalName)
    {
        checkErr( Ivi_ApplyDefaultSetup (vi));
    }
    *newVi = vi;
Error:
    if (error < VI_SUCCESS) 
    {
        Ivi_Dispose (vi);
    }
        
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_IviInit                                                       
 * Purpose:  This function is called by tkdpo4k_InitWithOptions  
 *           or by an IVI class driver.  This function initializes the I/O 
 *           interface, optionally resets the device, optionally performs an
 *           ID query, and sends a default setup to the instrument.                
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_IviInit (ViRsrc resourceName, ViBoolean IDQuery, 
                                    ViBoolean reset, ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    ViSession   io = VI_NULL;
    ViInt32     modelNumber = TKDPO4K_VAL_DPO_4054;
    ViChar      idnString[256] = "TEKTRONIX,DPO4054";
    ViChar      modelStr[BUFFER_SIZE] = "";
    ViChar      channelList[BUFFER_SIZE] = {0};
    ViChar      setup[BUFFER_SIZE] = ""; 
    ViInt32     modelStrLen = 1;
    ViChar      nonInvasiveInitStr[BUFFER_SIZE] = "";     
    ViBoolean   nonInvasiveInit = VI_FALSE;
    
    checkErr( tkdpo4k_GetDriverSetupOption (vi, "Model", 20, modelStr));
    if (!Ivi_Simulating(vi))
    {
        ViSession   rmSession = VI_NULL;

            /* Open instrument session */
        checkErr( Ivi_GetAttributeViSession (vi, VI_NULL, 
                                             IVI_ATTR_VISA_RM_SESSION, 
                                             0, &rmSession)); 
        viCheckErr (viOpen (rmSession, resourceName, VI_NULL, VI_NULL, &io));
            
            /* io session owned by driver now */
        checkErr( Ivi_SetAttributeViSession (vi, VI_NULL, 
                                             IVI_ATTR_IO_SESSION, 0, io));  

            /* Configure VISA Formatted I/O */
        viCheckErr (viSetAttribute (io, VI_ATTR_TMO_VALUE, 5000));
        viCheckErr (viSetBuf (io, VI_READ_BUF | VI_WRITE_BUF, 4000));
        viCheckErr (viSetAttribute (io, VI_ATTR_WR_BUF_OPER_MODE, 
                                    VI_FLUSH_ON_ACCESS));
        viCheckErr (viSetAttribute (io, VI_ATTR_RD_BUF_OPER_MODE, 
                                    VI_FLUSH_ON_ACCESS));
    }
    
    /* Identification Query */
    if (IDQuery)                               
    {
        ViBoolean idQueryResult = VI_FALSE;
        ViChar corp[BUFFER_SIZE] = {0};
        ViChar idnModelStr[BUFFER_SIZE] = {0};
        ViInt32 index;
        
        if (!Ivi_Simulating(vi))
            viCheckErr( viQueryf (io, "*IDN?", "%256[^\n]", idnString));
        
        sscanf (idnString, "%[^,]", corp);
        index = sprintf(idnModelStr, "%s,", corp);              
        sscanf (idnString, "%*[^,],%[^,]", idnModelStr+index);

        error = Ivi_GetValueFromTable(modelIdentificationTable, idnModelStr, &modelNumber);
        
        if (error < VI_SUCCESS)
        {
            error = VI_ERROR_FAIL_ID_QUERY;
            viCheckErrElab (error, "Failed to Recognize Model"); 
        }
        
        idQueryResult = VI_TRUE; 
    } 
    else
    {
        /* Parse ID query string for model number only if the */
        /* user did not specify the model via option string   */
        if (!*modelStr)
            sscanf (idnString, "%*[^,],%[^,]", modelStr);
        
        modelStrLen = (ViInt32)strlen(modelStr)-1;
    
        if (modelStr[modelStrLen] == 'B') {
            modelStr[modelStrLen]= '\0';
        }
        error = Ivi_GetViInt32EntryFromString (modelStr, &attrModelRangeTable, &modelNumber, 
                                           VI_NULL, VI_NULL, VI_NULL, VI_NULL);
        if (error < VI_SUCCESS)
            viCheckErrElab( VI_ERROR_FAIL_ID_QUERY, "Failed to Recognize Model");
    }
        /* Building channel table */
    checkErr( tkdpo4k_BuildChannelList (modelNumber, channelList) );   

    checkErr( Ivi_BuildRepCapTable (vi, BITSOURCE_REP_CAP_NAME, BITSOURCE_LIST));
    checkErr( Ivi_BuildRepCapTable (vi, RF_ACPR_RATIO_REP_CAP_NAME,ADJACENT_CHANNELS));
    checkErr( Ivi_BuildRepCapTable (vi, WAVEFORMSLOT_REP_CAP_NAME, WAVEFORMSLOT_LIST));
    
    checkErr( Ivi_BuildChannelTable (vi, channelList, VI_FALSE, VI_NULL));
    
    /* Check NonInvasiveInit */
    checkErr( Ivi_GetAttributeViString (vi, "", IVI_ATTR_DRIVER_SETUP, 0, BUFFER_SIZE, setup));
    if(strstr (setup, "NonInvasiveInit"))
    {
        checkErr( tkdpo4k_GetDriverSetupOption (vi, "NonInvasiveInit", 20, nonInvasiveInitStr));            
        if(strncmp (nonInvasiveInitStr, "TRUE", strlen("FALSE")) == 0)
        {
            nonInvasiveInit = VI_TRUE;      
        }
        else if(strncmp (nonInvasiveInitStr, "FALSE", strlen("FALSE")) == 0)
        {
            nonInvasiveInit = VI_FALSE;         
        }
        else
        {
            viCheckErr( IVI_ERROR_INVALID_CONFIGURATION );      
        }
    }
    
    /* Add attributes */
    checkErr (tkdpo4k_InitAttributes (vi, idnString, modelNumber));
    
    /* Reset instrument */
    if (reset) 
    {
        checkErr (tkdpo4k_reset (vi));
    }
    else  /* Send Default Instrument Setup */
    {   
        if(nonInvasiveInit == VI_FALSE)
        {
            checkErr (tkdpo4k_DefaultInstrSetup (vi));
        }
        else
        {
            checkErr (tkdpo4k_NonInvasiveInstrSetup (vi));
        }
    }

    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    if (error < VI_SUCCESS)
    {
        if (!Ivi_Simulating (vi) && io)
        {
            viClose (io);
        }
    }
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_close                                                           
 * Purpose:  This function closes the instrument.                            
 *
 *           Note:  This function must unlock the session before calling
 *           Ivi_Dispose.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_close (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    checkErr (tkdpo4k_IviClose (vi));

Error:    
    Ivi_UnlockSession (vi, VI_NULL);
    Ivi_Dispose (vi);  
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_IviClose                                                        
 * Purpose:  This function performs all of the drivers clean-up operations   
 *           except for closing the IVI session.  This function is called by 
 *           tkdpo4k_close or by an IVI class driver. 
 *
 *           Note:  This function must close the I/O session and set 
 *           IVI_ATTR_IO_SESSION to 0.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_IviClose (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    ViSession   io = VI_NULL;

        /* Do not lock here.  Either the class or specific driver will manage the lock. */
    checkErr( Ivi_GetAttributeViSession (vi, VI_NULL, IVI_ATTR_IO_SESSION, 0, &io));

Error:
    Ivi_SetAttributeViSession (vi, VI_NULL, IVI_ATTR_IO_SESSION, 0, VI_NULL);
    if(io)
    {
        viClose (io);
    }
    return error;   
}

/*****************************************************************************
 * Function: tkdpo4k_reset                                                         
 * Purpose:  This function resets the instrument.                          
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_reset (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
        viCheckErr (viPrintf (io, "*RST")); 
    }
    
    checkErr (tkdpo4k_DefaultInstrSetup (vi)); 
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_ResetWithDefaults
 * Purpose:  This function resets the instrument and applies default settings
 *           from the IVI Configuration Store based on the logical name
 *           from which the session was created.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ResetWithDefaults (ViSession vi)
{
    ViStatus error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    checkErr( tkdpo4k_reset(vi));
    checkErr( Ivi_ApplyDefaultSetup(vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/**************************************************************************** 
 *  Function: tkdpo4k_Disable
 *  Purpose:  This function places the instrument in a quiescent state as 
 *            quickly as possible.
 ****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_Disable (ViSession vi)
{
    return VI_SUCCESS;
}

/*****************************************************************************
 * Function: tkdpo4k_self_test                                                       
 * Purpose:  This function executes the instrument self-test and returns the 
 *           result.                                                         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_self_test (ViSession vi, ViInt16 *testResult, ViChar testMessage[])
{
    ViStatus    error = VI_SUCCESS;
    ViInt16     result = 0;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (testResult == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Test Result");
    if (testMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Test Message");

    if (!Ivi_Simulating(vi))                /* call only when locked */
        {
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */
    
        if (testResult && testMessage)
            {
                /* The *TST? command tests the GPIB interface, and always returns 0 */ 
            *testMessage = '\0';
            viCheckErr( viQueryf (io, "*TST?", "%hd", &result));

            if (result == 0)
                sprintf (testMessage, "Passed Self Test");
            else
                sprintf (testMessage, "Failed Self Test.");
            }
        }
    else
        {
            sprintf (testMessage, "Passed Self Test.");
        }
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    *testResult = result;
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_error_query                                                     
 * Purpose:  This function queries the instrument error queue and returns   
 *           the result.                                                     
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_error_query (ViSession vi, ViInt32 *errCode, ViChar errMessage[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (errCode == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Error Code");
    if (errMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Error Message");

    if (!Ivi_Simulating(vi))                /* call only when locked */
        {
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */
    
        if (errCode && errMessage)
            {
            ViInt32 tmpErr = 0;
            
            /*check to see if there is an error waiting*/
            viCheckErr( viQueryf(io, ":EVM?", "%ld, \"%[^\"]", errCode, errMessage)); 
            if (*errCode == 1)   /*if an error waiting, then must do a *ESR? to get to the queue*/
                {
                    /*allows to get the next error message from queue*/
                    viCheckErr( viQueryf(io, "*ESR?", "%ld", &tmpErr));  
                    viCheckErr( viQueryf(io, ":EVM?", "%ld, \"%[^\"]", errCode, errMessage));
                }
            }
        }
    else
        {
                /* Simulate Error Query */
            if (errCode)
                *errCode = 0;
            if (errMessage)
                sprintf (errMessage, "%s", "No Error");
        }
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_error_message                                                  
 * Purpose:  This function translates the error codes returned by this       
 *           instrument driver into user-readable strings.  
 *
 *           Note:  The caller can pass VI_NULL for the vi parameter.  This 
 *           is useful if one of the init functions fail.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_error_message (ViSession vi, ViStatus errorCode, 
                                          ViChar errorMessage[256])
{
    ViStatus    error = VI_SUCCESS;
    
    static      IviStringValueTable errorTable = 
        {
            {TKDPO4K_ERROR_NOT_VALID_FOR_MODEL,  "The operation or attribute is not valid for this model."}, 
            {TKDPO4K_ERROR_OPTION_NOT_INSTALLED, "The option required is not installed."}, 
            IVISCOPE_ERROR_CODES_AND_MSGS, 
            {TKDPO4K_ERROR_NO_WFMS_AVAILABLE,    "No free waveform structure to create new waveform." }, 
            {VI_NULL,                               VI_NULL}
        };
        
    if (vi)
        Ivi_LockSession(vi, VI_NULL);

        /* all VISA and IVI error codes are handled as well as codes in the table */
    if (errorMessage == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Error Message");

    checkErr( Ivi_GetSpecificDriverStatusDesc(vi, errorCode, errorMessage, errorTable));

Error:
    if (vi)
        Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_revision_query                                                  
 * Purpose:  This function returns the driver and instrument revisions.      
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_revision_query (ViSession vi, ViChar driverRev[], 
                                           ViChar instrRev[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (driverRev == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Driver Revision");
    if (instrRev == VI_NULL)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Instrument Revision");

    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_SPECIFIC_DRIVER_REVISION, 
                                        0, 256, driverRev));
    checkErr( Ivi_GetAttributeViString (vi, "", TKDPO4K_ATTR_INSTRUMENT_FIRMWARE_REVISION, 
                                        0, 256, instrRev));
    checkErr( tkdpo4k_CheckStatus (vi));

Error:    
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_InvalidateAllAttributes
 * Purpose:  This function invalidates the cached value of all attributes.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_InvalidateAllAttributes (ViSession vi)
{
    return Ivi_InvalidateAllAttributes(vi);
}

/**************************************************************************** 
 *  Function: tkdpo4k_GetChannelName
 *  Purpose:  This function returns the highest-level channel name that
 *            corresponds to the specific driver channel string that is in
 *            the channel table at an index you specify.
 ****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetChannelName (ViSession vi, ViInt32 index,
                                           ViInt32 bufferSize,
                                           ViChar name[])
{
   ViStatus         error = VI_SUCCESS;
   ViConstString    channelName;
   ViInt32          actualSize = 0;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (bufferSize != 0)
    {
        if (name == VI_NULL)
        {
            viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Channel Name");
        }
    }
    
    /* Get channel name */
    viCheckParm( Ivi_GetNthChannelString (vi, index, &channelName), 2, "Index");
    
    actualSize = (ViInt32)strlen(channelName) + 1;
    
    /* Prepare return values */
    if (bufferSize == 0)
    {
        error = actualSize;
    }
    else 
    {
        if (bufferSize > 0)
        {
            if (actualSize > bufferSize)
            {
                error = actualSize;
                actualSize = bufferSize;
            }
        }
        memcpy(name, channelName, actualSize-1);
        name[actualSize-1] = '\0';
    }

Error:    
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureChannel
 *  Purpose:  This function configures the most common attributes of 
 *            the oscilloscope vertical subsystem.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureChannel (ViSession vi, 
                                              ViConstString channel, 
                                              ViReal64 range, 
                                              ViReal64 offset, 
                                              ViInt32 coupling, 
                                              ViReal64 probeAttenuation, 
                                              ViBoolean enabled)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 0, 
                                            enabled), 7, "Enabled");  
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_PROBE_ATTENUATION, 0, 
                                           probeAttenuation), 6, "Probe Attenuation");                                           
    viCheckParm( Ivi_SetAttributeViInt32 (vi, channel, TKDPO4K_ATTR_VERTICAL_COUPLING, 0, 
                                          coupling), 5, "Coupling");
        /* Set this after Probe Attenuation */
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 0, 
                                           range), 3, "Range");
        /* Set this after Probe Attenuation and Vertical Range */
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_OFFSET, 0, 
                                           offset), 4, "Offset");
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureDigitalChannel
 *  Purpose:  This function configures the status and threshold of digital
 *            channels.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureDigitalChannel (ViSession vi,
                                                    ViConstString channel,
                                                    ViReal64 threshold,
                                                    ViBoolean enabled)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 0,
                                            enabled), 4, "Enabled");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_DIGITAL_THRESHOLD, 0,
                                            threshold), 3, "Threshold");
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureChanCharacteristics
 *  Purpose:  This function configures the less common attributes of 
 *            the oscilloscope channel subsystem.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureChanCharacteristics (ViSession vi, 
                                                         ViConstString channel, 
                                                         ViReal64 inputImpedance, 
                                                         ViReal64 maxInputFrequency)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_INPUT_IMPEDANCE, 
                                           0, inputImpedance), 3, "Input Impedance");

    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY, 
                                           0, maxInputFrequency), 4, "Maximum Input Frequency");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_AutoProbeSenseValue
 *  Purpose:  This function returns the actual probe attenuation when you
 *            configure the oscilloscope to sense the probe attenuation.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_AutoProbeSenseValue (ViSession vi, 
                                                ViConstString channel, 
                                                ViReal64 *autoProbeSenseValue)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (autoProbeSenseValue == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, 
                     "Null address for Auto Probe Sense Value");
    }
    
    checkErr( Ivi_GetAttributeViReal64 (vi, channel, 
                                        TKDPO4K_ATTR_PROBE_SENSE_VALUE, 
                                        0, autoProbeSenseValue));
    
    checkErr (tkdpo4k_CheckStatus (vi));
                                        
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureBusThreshold 
 *  Purpose:  This function configures the bus thresholds settings. 
 *            This function only applies to DPO/MSO 4kB models.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureBusThreshold (ViSession vi,
                                                    ViConstString channel,
                                                    ViReal64 upperThreshold,
                                                    ViReal64 lowerThreshold)

{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_UPPER_THRESHOLD, 0,
                                            upperThreshold), 3, "Upper Threshold");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_LOWER_THRESHOLD, 0,
                                            lowerThreshold), 4, "Lower Threshold");
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}



/*****************************************************************************
 *  Function: tkdpo4k_ConfigureAcquisitionRecord
 *  Purpose:  This function configures the most common attributes of
 *            the oscilloscope acquisition subsystem.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureAcquisitionRecord (ViSession vi, 
                                                ViReal64 timePerRecord, 
                                                ViInt32 minNumPts, 
                                                ViReal64 acquisitionStartTime)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                          0, minNumPts), 3, "Minimum Record Length");

        /* Set this after Horz Min Num Pts */
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                           0, timePerRecord), 2, "Time Per Record");
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_START_TIME, 
                                           0, acquisitionStartTime), 4, "Acquisition Start Time");

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ActualRecordLength
 *  Purpose:  This function returns the actual waveform record length the 
 *            oscilloscope acquires.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ActualRecordLength (ViSession vi, 
                                               ViInt32 *actualRecordLength)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (actualRecordLength == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, 
                     "Null address for Actual Record Length");
    }
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                       0, actualRecordLength));
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTrigger
 *  Purpose:  This function configures common triggering attributes such
 *            as trigger type and holdoff.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTrigger (ViSession vi, 
                                ViInt32 triggerType, 
                                ViReal64 holdoff)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 
                                          0, triggerType), 2, "Trigger Type");

        /* Invalidated by Trigger Type */
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_HOLDOFF, 
                                           0, holdoff), 3, "Holdoff");

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTriggerCoupling
 *  Purpose:  This function configures trigger coupling.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTriggerCoupling (ViSession vi,
                                    ViInt32 coupling)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, 
                                TKDPO4K_ATTR_TRIGGER_COUPLING, 
                                0, coupling), 
                                2, "Trigger Coupling");
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTriggerLevel
 *  Purpose:  This function configures trigger level of a specified channel
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTriggerLevel (ViSession vi,
                                                    ViConstString channel,
                                                    ViReal64 level)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));     

    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel,
                                            TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH,
                                            0, level), 3, "Level");
    checkErr( tkdpo4k_CheckStatus(vi) );                                            

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTriggerThreshold
 *  Purpose:  This function configures trigger threshold of a specified channel
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTriggerThreshold(ViSession vi,
                                                        ViConstString channel,
                                                        ViReal64 upperThreshold,
                                                        ViReal64 lowerThreshold)                                                    
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL) );
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                            0, upperThreshold), 3, "Upper Threshold");
                                            
    viCheckParm( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                            0, lowerThreshold), 4, "Lower Threshold");
                                            
    checkErr( tkdpo4k_CheckStatus(vi) );
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureEdgeTriggerSource
 *  Purpose:  This function configures the edge triggering attributes.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEdgeTriggerSource (ViSession vi, 
                                                      ViConstString source,
                                                      ViReal64 level,   
                                                      ViInt32 slope)
{
    ViStatus  error = VI_SUCCESS;
    ViReal64  triggerLevel = level;
    ViInt32   modelNo;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    checkErr(Ivi_GetAttributeViInt32(vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &modelNo));
    
    /* The TKDPO4K_VAL_EITHER is available for MDO3000 series models only. */
    if((slope == TKDPO4K_VAL_EITHER) && (!IS_MDO3K (modelNo)))
    {
        viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);    
    }
    
    /* 
        If the trigger source is AC Line, set the trigger level to 
        the zero crossing. /* This is to keep the behavior of this 
        function compliant with ivi.
    */
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                0, source), 2, "Trigger Source");

    if (strcmp (source, TKDPO4K_VAL_AC_LINE) == 0)
        triggerLevel = 0.0;
        
        /* Invalidated by Trigger Source */
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_LEVEL, 0, 
                                           triggerLevel), 3, "Level");
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SLOPE, 0, 
                                          slope), 4, "Slope");
    
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureDelayTriggerSource
 *  Purpose:  This function configures the scope for delay triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureDelayTriggerSource ( ViSession vi,
                                                        ViConstString source,
                                                        ViInt32 coupling,
                                                        ViReal64 level,
                                                        ViInt32 slope)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE,
                                            0, source), 2, "B Trigger Source" );

    if (strcmp (source, TKDPO4K_VAL_AC_LINE) == 0)
        level = 0.0;
        
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING,
                                            0, coupling), 3, "B Trigger Coupling");
                                            
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL,
                                            0, level), 4, "B Trigger Level");
                                            
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_SLOPE,
                                            0, slope), 5, "B Trigger Slope");
                                            
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;                                           
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureDelayTriggerMode
 *  Purpose:  This function configures the delay trigger mode for delay 
 *            triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureDelayTriggerMode (ViSession vi,
                                                     ViInt32 mode)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_MODE,
                                            0, mode), 2, "B Trigger Mode");
    
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}

/******************************************************************************
 *  Function: tkdpo4k_ConfigureDelayTriggerEvents
 *  Purpose:  This function configures the trigger events for delay triggering.
 ******************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureDelayTriggerEvents (ViSession vi,
                                                       ViInt32 events)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_EVENTS,
                                            0, events), 2, "B Trigger Events");

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureDelayTriggerTime
 *  Purpose:  This function configures the trigger time for delay triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureDelayTriggerTime (ViSession vi,
                                                     ViReal64 time)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViReal64( vi, VI_NULL, TKDPO4K_ATTR_DELAY_TRIGGER_TIME,
                                            0, time), 2, "B Trigger Time");

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureGlitchTriggerSource
 *  Purpose:  This function configures the scope for glitch triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureGlitchTriggerSource (ViSession vi,
                                                        ViConstString source,
                                                        ViReal64 level,  
                                                        ViReal64 glitchWidth, 
                                                        ViInt32 glitchPolarity,
                                                        ViInt32 glitchCondition)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

        /* ATTR_TRIGGER_SOURCE invalidates ATTR_TRIGGER_LEVEL and must be set first */
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                   0, source), 2, "Trigger Source");

    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                           0, level), 
                                           3, "Trigger Level");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_GLITCH_WIDTH, 
                                           0, glitchWidth), 
                                           4, "Glitch Width");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_GLITCH_POLARITY, 
                                            0, glitchPolarity), 
                                            5, "Glitch Trigger Polarity");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_GLITCH_CONDITION,
                                            0, glitchCondition), 
                                            6, "Glitch Condition");

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTVTriggerSource
 *  Purpose:  This function configures the scope for TV triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTVTriggerSource (ViSession vi,
                                    ViConstString source,
                                    ViInt32 TVSignalFormat, 
                                    ViInt32 TVEvent, 
                                    ViInt32 TVPolarity)
{
    ViStatus   error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                   0, source), 2, "Trigger Source");
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT, 
                                          0, TVSignalFormat), 3, "TV Signal Format");
        /* Set this after Signal Type */
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_EVENT, 
                                          0, TVEvent), 4, "TV Trigger Event");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_POLARITY, 
                                          0, TVPolarity), 5, "TV Trigger Polarity");

    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTVTriggerLineNumber
 *  Purpose:  This function configures the line number for TV triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTVTriggerLineNumber (ViSession vi, 
                                                        ViInt32 lineNumber)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, 
                                TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER, 
                                0, lineNumber), 
                                2, "TV Trigger Line Number");
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
                      
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTVTriggerFieldHoldoff
 *  Purpose:  This function configures the video trigger holdoff for TV triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTVTriggerFieldHoldoff (ViSession vi,
                                                          ViReal64 holdoff)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_FIELD_HOLDOFF,
                                            0, holdoff), 2, "Trigger Holdoff");
            
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTVTriggerHDTV
 *  Purpose:  This function configures the HDTV format for TV triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTVTriggerHDTV (ViSession vi,
                                                  ViInt32 format)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT,
                                            0, format), 2, "HDTV Format");
    
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;       
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTVTriggerHDTV
 *  Purpose:  This function configures custom format and scan rate for TV triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTVTriggerCustom (ViSession vi,
                                                    ViInt32 format,
                                                    ViInt32 scanRate,
                                                    ViReal64 linePeriod,
                                                    ViReal64 syncInterval)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_FORMAT,
                                            0, format), 2, "Custom Format");
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SCAN_RATE,
                                            0, scanRate), 3, "Custom Scan Rate");
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_LINE_PERIOD,
                                            0, linePeriod), 4, "Custom Line Period");
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SYNC_INTERVAL,
                                            0, syncInterval), 5, "Custom Sync Interval");
    
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRuntTriggerSource
 *  Purpose:  This function configures the scope for runt triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRuntTriggerSource (ViSession vi,
                                    ViConstString source,
                                    ViReal64 runtLowThreshold, 
                                    ViReal64 runtHighThreshold, 
                                    ViInt32 runtPolarity)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, 
                                            TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                            0, source), 2, "Trigger Source");

    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_RUNT_LOW_THRESHOLD, 
                                           0, runtLowThreshold), 3, "Runt Low Threshold");

    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD, 
                                           0, runtHighThreshold), 4, "Runt High Threshold");
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RUNT_POLARITY, 
                                          0, runtPolarity), 5, "Runt Trigger Polarity");

    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRuntTriggerCondition
 *  Purpose:  This function configures the condition for runt triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRuntTriggerCondition (ViSession vi,
                                                            ViReal64 runtWidth,
                                                            ViInt32 runtCondition)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_RUNT_WIDTH,
                                            0, runtWidth), 2, "Runt Width" );
                                            
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RUNT_WHEN,
                                            0, runtCondition), 3, "Runt Condition" );

    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: ConfigureAcLineTriggerSlope
 *  Purpose:  This function configures the oscilloscope for AC Line triggering
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureAcLineTriggerSlope ( ViSession vi, 
                                        ViInt32 acLineSlope)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE,
                                            0, acLineSlope), 
                                            2, "AC Line Slope");
    checkErr(tkdpo4k_CheckStatus (vi));
                                            
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTransitionTriggerSource
 *  Purpose:  This function configures the scope for transition triggering.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTransitTriggerSource (ViSession vi,
                                                    ViConstString source,
                                                    ViInt32 polarity, 
                                                    ViInt32 when, 
                                                    ViReal64 deltaTime, 
                                                    ViReal64 lowThreshold, 
                                                    ViReal64 highThreshold)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                            0, source), 2, "Trigger Source");
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD, 
                                            0, lowThreshold), 6, "Transition Low Threshold");
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD, 
                                            0, highThreshold), 7, "Transition High Threshold"); 
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRANSITION_DELTA_TIME, 
                                            0, deltaTime), 5, "Transition Delta Time");                                             
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRANSITION_WHEN, 
                                            0, when), 4, "Transition Trigger When");                                            
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRANSITION_POLARITY, 
                                            0, polarity), 3, "Transition Trigger Polarity");
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureLogicTriggerThreshold
 *  Purpose:  This function configures logic trigger threshold for the 
 *            specified channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureLogicTriggerThreshold (ViSession vi,
                                                            ViConstString channel,
                                                            ViReal64 threshold)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    
    viCheckParm (Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_LOGIC_THRES_BY_CH,
                                            0, threshold), 3, "Logic Threshold");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigurePatternTrigger
 *  Purpose:  This function configures the scope for logic pattern trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigurePatternTrigger (ViSession vi,
                                                            ViInt32 function,
                                                            ViReal64 deltaTime,
                                                            ViInt32 condition)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_PATTERN_FUNCTION,
                                            0, function), 2, "Loggic Pattern Function");
                                            
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_PATTERN_DELTATIME,
                                            0, deltaTime), 3, "Logic Pattern Delta Time");
                                            
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_PATTERN_WHEN,
                                            0, condition), 4, "Logic Pattern Condition");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error; 
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigurePatternTriggerInput
 *  Purpose:  This function configures the trigger input for logic pattern 
 *            trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigurePatternTriggerInput (ViSession vi,
                                                                ViConstString channel,
                                                                ViInt32 logicInput)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    
    viCheckParm (Ivi_SetAttributeViInt32(vi, channel, TKDPO4K_ATTR_PATTERN_INPUT,
                                            0, logicInput), 2, "Logic Pattern Trigger Input");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureStateTrigger
 *  Purpose:  This function configures the scope for logic state trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureStateTrigger (ViSession vi,
                                                        ViInt32 function)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_FUNCTION,
                                            0, function), 2, "Loggic State Function");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureStateTriggerDataInput
 *  Purpose:  This function configures the data source input for logic
 *            state trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureStateTriggerDataInput (ViSession vi,
                                                                ViConstString channel,
                                                                ViInt32 logicInput)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, channel, TKDPO4K_ATTR_STATE_INPUT,
                                            0, logicInput), 3, "Logic State Data Input");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureStateTriggerClockInput
 *  Purpose:  This function configures the clock source for logic state
 *            trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureStateTriggerClockInput (ViSession vi,
                                                                    ViInt32 source,
                                                                    ViInt32 edge)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_CLOCK_SOURCE,
                                            0, source), 2, "Logic State Clock Source");
                                            
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_CLOCK_EDGE,
                                            0, edge), 3, "Logic State Clock Edge");                                         
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;     
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureSetholdTriggerSource
 *  Purpose:  This fucntion configures the scope for logic sethold trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureSetholdTriggerSource( ViSession vi,
                                                            ViInt32 dataSource,
                                                            ViInt32 clockSource,
                                                            ViInt32 clockEdge,
                                                            ViReal64 setTime,
                                                            ViReal64 holdTime)
{
    ViStatus    error = VI_SUCCESS;
    
    ViInt32     originalClockSource;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));   
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                            0, &originalClockSource));
    
    if (originalClockSource == dataSource)
    {
        viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                            0, clockSource), 3, "Logic Sethold Clock Source");
        
        viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                            0, dataSource), 2, "Logic Sethold Data Source");
    }
    else
    {
        viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                            0, dataSource), 2, "Logic Sethold Data Source");

        viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                            0, clockSource), 3, "Logic Sethold Clock Source");
    }
                                        
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_CLOCK_EDGE,
                                            0, clockEdge), 4, "Logic Sethold Clock Edge");
                                            
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_SETTIME,
                                            0, setTime), 5, "Logic Sethold Set Time");
                                            
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_HOLDTIME,
                                            0, holdTime), 6, "Logic Sethold Hold Time");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error; 
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureSerialTriggerSource
 *  Purpose:  This function configures serial trigger source for the scope.
 *  Notes: MDO4000C series only have 3 buses(BUS1,BUS2,BUS3), whereas older 4000 series have up to 4.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureSerialTriggerSource (ViSession vi, ViInt32 busSource)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE,
                                            0, busSource), 2, "Bus Source");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureParallelTrigger
 *  Purpose:  This function configures scope for parallel trigger
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureParallelTrigger( ViSession vi,
                                                    ViInt32 busNumber,
                                                    ViString value)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Parallel Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_PARALLEL_VALUE,
                                            0, value), 3, "Parallel Data Value");   
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureUSBTrigger
 *  Purpose:  This function configures scope for USB trigger
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureUSBTrigger( ViSession vi,
                                                    ViInt32 busNumber,
                                                    ViString hubAddress,
                                                    ViString portAddress,
                                                    ViInt32 splitTranStartEnd,
                                                    ViInt32 splitTranField,
                                                    ViInt32 splitTranEnd)   
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "USB Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_USB_HUB_ADDRESS,
                                            0, hubAddress), 3, "Hub Address");  
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_USB_PORT_ADDRESS,
                                            0, portAddress), 4, "Port Address");    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_USB_TRAN_START_END,
                                            0, splitTranStartEnd), 5, "Split Transaction Start/End");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_USB_TRAN_FIELD,
                                            0, splitTranField), 6, "Split Transaction Field");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_USB_TRAN_END_POINT,
                                            0, splitTranEnd), 7, "Split Transaction Endpoint");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}



/*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTrigger
 *  Purpose:  This function configures Data trigger settings for ethernet trigger. 
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerBasic( ViSession vi,
                                                            ViInt32 busNumber,
                                                            ViInt32 frameType,
                                                            ViInt32 condition,
                                                            ViInt32 qualifier)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE,
                                            0, frameType), 3, "Frame Type");    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ENET_BASIC_CONDITION,
                                            0, condition), 4, "Condition"); 
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ENET_BASIC_QUALIFIER,
                                            0, qualifier), 5, "Qualifier");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTriggerData
 *  Purpose:  This function configures scope for ethernet trigger
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerData( ViSession vi,
                                                            ViInt32 busNumber,
                                                            ViInt32 size,
                                                            ViInt32 offset,
                                                            ViString upperLimit,
                                                            ViString data)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ENET_DATA_SIZE,
                                            0, size), 3, "Data Size");  
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ENET_DATA_OFFSET,
                                            0, offset), 4, "Offset");   
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT,
                                            0, upperLimit), 5, "Upper Limit");
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_DATA,
                                            0, data), 5, "Data");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

 /*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTriggerIPHeader
 *  Purpose:  This function configures IP header trigger settings for Ethernet trigger. 
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerIPH( ViSession vi,
                                                                ViInt32 busNumber,
                                                                ViString srcAddress,
                                                                ViString dstAddress,
                                                                ViString protocol)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS,
                                            0, srcAddress), 3, "Source Address");   
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_IP_DST_ADDRESS,
                                            0, dstAddress), 4, "Destination Address");  
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_IP_PROTOCOL,
                                            0, protocol), 5, "Protocol");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
    
}

 /*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTriggerMAC
 *  Purpose:  This function configures MAC trigger settings for Ethernet trigger. 
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerMAC( ViSession vi,
                                                            ViInt32 busNumber,
                                                            ViString srcAddress,
                                                            ViString dstAddress,
                                                            ViString upperLength,
                                                            ViString length)
 {
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_MAC_SRC_ADDRESS,
                                            0, srcAddress), 3, "Source Address");   
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_MAC_DST_ADDRESS,
                                            0, dstAddress), 4, "Destination Address");  
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH,
                                            0, upperLength), 5, "Upper Length");
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_MAC_LENGTH,
                                            0, length), 5, "Length");   
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
    
}

 /*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTriggerQTAG
 *  Purpose:  This function configures QTAG trigger settings for Ethernet trigger. 
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerQTAG( ViSession vi,
                                                            ViInt32 busNumber,
                                                            ViString QTAG)
 {
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_QTAG,
                                            0, QTAG), 3, "QTAG Value"); 
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
 }


 /*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernetTriggerTCPHeader
 *  Purpose:  This function configures TCP Header trigger settings for Ethernet trigger. 
 *  This function only applies to DPO4034B, DPO4054B, DPO4104B, MSO4034B, 
 *  MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureEthernetTriggerTCPH( ViSession vi,
                                                            ViInt32 busNumber,
                                                            ViString srcAddress,
                                                            ViString dstAddress,
                                                            ViString seqNumber,
                                                            ViString ackNumber) 
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Ethernet Trigger Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS,
                                            0, srcAddress), 3, "Source Address");   
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS,
                                            0, dstAddress), 4, "Destination Address");  
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER,
                                            0, seqNumber), 5, "Sequence Number");
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER,
                                            0, ackNumber), 6, "TCP Acknowledgement Number");    
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}   


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRS232Trigger
 *  Purpose:  This function configures scope for serial RS232 trigger
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRS232Trigger(ViSession vi,
                                                ViInt32 busNumber,
                                                ViInt32 condition,
                                                ViInt32 RxSize,
                                                ViString RxValue,
                                                ViInt32 TxSize,
                                                ViString TxValue)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "RS232 Trigger Bus Number");  
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_CONDITION,
                                            0, condition), 3, "RS232 Condition");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_RX_DATA_SIZE,
                                            0, RxSize), 4, "RS232 RX Data Size");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_RS232_RX_DATA_VALUE,
                                            0, RxValue), 5, "RS232 RX Data Value");
    
    viCheckParm ( Ivi_SetAttributeViInt32 ( vi, VI_NULL, TKDPO4K_ATTR_RS232_TX_DATA_SIZE,
                                            0, TxSize), 6, "RS232 TX Data Size");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_RS232_TX_DATA_VALUE,
                                            0, RxValue), 7, "RS232 TX Data Value"); 
    
    checkErr (tkdpo4k_CheckStatus (vi));
        
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureCANTrigger
 *  Purpose:  This function configures scope for serial CAN trigger
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureCANTrigger( ViSession vi,
                                                ViInt32 busNumber,
                                                ViInt32 condition)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "CAN Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_CONDITION,
                                            0, condition), 3, "CAN Trigger Condition");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureCANTriggerID
 *  Purpose:  This function configures ID mode and ID value for CAN trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureCANTriggerID( ViSession vi,
                                                    ViInt32 busNumber,
                                                    ViInt32 mode,
                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "CAN Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_ID_MODE,
                                            0, mode), 3, "CAN Trigger ID Mode");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_CAN_ID_VALUE,
                                            0, value), 4, "CAN Trigger ID Value");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureCANTriggerData
 *  Purpose:  This function configures CAN data size and data value for
 *            CAN trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureCANTriggerData( ViSession vi,
                                                    ViInt32 busNumber,
                                                    ViInt32 size,
                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "CAN Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_DATA_SIZE,
                                            0, size), 3, "CAN Trigger Data Size");
                                            
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_CAN_DATA_VALUE,
                                            0, value), 4, "CAN Trigger Data Value");

    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureCANTriggerFrameType
 *  Purpose:  This function configures CAN frame type for CAN trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureCANTriggerFrameType( ViSession vi,
                                                        ViInt32 busNumber,
                                                        ViInt32 frameType)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "CAN Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_FRAMETYPE,
                                            0, frameType), 3, "CAN Trigger Frame Type");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureI2CTrigger
 *  Purpose:  This function configures scope for Serial I2C Trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureI2CTrigger( ViSession vi,
                                                ViInt32 busNumber,
                                                ViInt32 condition,
                                                ViInt32 direction)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "I2C Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_CONDITION,
                                            0, condition), 3, "I2C Trigger Condition");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_DATA_DIRECTION,
                                            0, direction), 4, "I2C Trigger Direction");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureI2CTriggerAddress
 *  Purpose:  This function configures I2C address mode and address value
 *            for I2C trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureI2CTriggerAddress( ViSession vi,
                                                        ViInt32 busNumber,
                                                        ViInt32 mode,
                                                        ViConstString value)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "I2C Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_ADDR_MODE,
                                            0, mode), 3, "I2C Trigger Address Mode");
                                            
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_I2C_ADDR_VALUE,
                                            0, value), 4, "I2C Trigger Address Value");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                            
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureI2CTriggerData
 *  Purpose:  This function configures I2C data size and data value for I2C
 *            trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureI2CTriggerData( ViSession vi,
                                                    ViInt32 busNumber,
                                                    ViInt32 size,
                                                    ViConstString value)
{                                                   
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "I2C Trigger Bus Number");    

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_DATA_SIZE,
                                            0, size), 3, "I2C Trigger Data Size");
                                            
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_I2C_DATA_VALUE,
                                            0, value), 4, "I2C Trigger Data Value");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error; 
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureSPITrigger
 *  Purpose:  This function configures scope for Serial SPI Trigger.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureSPITrigger( ViSession vi,
                                                ViInt32 busNumber,
                                                ViInt32 condition,
                                                ViInt32 dataSize,
                                                ViConstString MISOValue,
                                                ViConstString MOSIValue)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "SPI Trigger Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_CONDITION,
                                            0, condition), 3, "SPI Trigger Condition");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            0, dataSize), 4, "SPI Trigger Data Size");
                                            
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_SPI_MISO_VALUE,
                                            0, MISOValue), 5, "SPI Trigger MISO Value");
                                            
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_SPI_MOSI_VALUE,
                                            0, MOSIValue), 6, "SPI Trigger MOSI Value");

    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error; 
}
                                                                
/*****************************************************************************
 *  Function: tkdpo4k_ConfigureBUSType
 *  Purpose:  This function configures bus type for the selected bus.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureBUSType (ViSession vi,
                                            ViInt32 busNumber,
                                            ViInt32 type)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_TYPE,
                                            0, type), 3, "Bus Type");
                                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;                                           
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureBUSState
 *  Purpose:  This function configures bus state for the selected bus.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureBUSState (ViSession vi,
                                                ViInt32 busNumber,
                                                ViBoolean state)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_BUS_STATE,
                                                0, state), 3, "Bus State");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;                                           
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureCAN
 *  Purpose:  This function configures CAN bit rate, probe type and signal
 *            source.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureCAN (ViSession vi,
                                        ViInt32 busNumber,
                                        ViInt32 bitRate,
                                        ViInt32 probeType,
                                        ViInt32 source)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_CAN_BITRATE,
                                            0, bitRate), 3, "CAN Bit Rate");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_CAN_PROBE,
                                            0, probeType), 4, "CAN Probe Type");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_CAN_SOURCE,
                                            0, source), 5, "CAN Source");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureI2C
 *  Purpose:  This function configures I2C clock source, clock polarity
 *            and data source.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureI2C (ViSession vi,
                                        ViInt32 busNumber,
                                        ViInt32 clockSource,
                                        ViInt32 dataSource)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE,
                                            0, clockSource), 3, "Clock Source");
                                        
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE,
                                            0, dataSource), 4, "Data Source");

    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/***************************************************************************** 
 *  Function: tkdpo4k_ConfigureSPI
 *  Purpose:  This function configures SPI MISO, MOSI, SCLK, SS features.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureSPI (ViSession vi,
                                        ViInt32 busNumber,
                                        ViInt32 SCLKSource,
                                        ViInt32 SCLKPolarity,   
                                        ViInt32 SSSource,
                                        ViInt32 SSPolarity, 
                                        ViInt32 MOSISource,
                                        ViInt32 MOSIPolarity,                                       
                                        ViInt32 MISOSource,
                                        ViInt32 MISOPolarity)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");

    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE,
                                            0, SCLKSource), 3, "SCLK Source");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_SCLK_POLARITY,
                                            0, SCLKPolarity), 4, "SCLK Polarity");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_SS_SOURCE,
                                            0, SSSource), 5, "SS Source");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_SS_POLARITY,
                                            0, SSPolarity), 6, "SS Polarity");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE,
                                            0, MOSISource), 7, "MOSI Source");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_MOSI_POLARITY,
                                            0, MOSIPolarity), 8, "MOSI Polarity");                                          
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE,
                                            0, MISOSource), 9, "MISO Source");
                                            
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SPI_MISO_POLARITY,
                                            0, MISOPolarity), 10, "MISO Polarity");
                            
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureParallel
 *  Purpose:  This function configures scope for Parallel Trigger.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureParallel (ViSession     vi,
                                              ViInt32       busNumber,
                                              ViConstString bitsSource,
                                              ViInt32       clockSource,
                                              ViInt32       clockEdge,
                                              ViBoolean     clockLocked,
                                              ViInt32       width)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_BITS_SOURCE,
                                                0, bitsSource), 3, "Bits Source" );
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_SOURCE,
                                                0, clockSource), 4, "Clovk Source" );
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_EDGE,
                                                0, clockEdge), 5, "Clock Edge" );
    viCheckParm ( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_LOCKED,
                                                0, clockLocked), 6, "Clock Locked" );
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_WIDTH,
                                                0, width), 7, "Width" );
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRS232
 *  Purpose:  This function configures scope for RS232 Trigger.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureRS232 (ViSession    vi,
                                           ViInt32      busNumber,
                                           ViInt32      bitRate,
                                           ViInt32      dataBits,
                                           ViInt32      delimiter,
                                           ViInt32      parity,
                                           ViInt32      RxSource,
                                           ViInt32      TxSource)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_BITRATE,
                                            0, bitRate), 3, "Bit Rate");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_DATABITS,
                                            0, dataBits), 4, "Data Bits");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_DELIMITER,
                                            0, delimiter), 5, "Delimiter");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_PARITY,
                                            0, parity), 6, "Parity");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_RX_SOURCE,
                                            0, RxSource), 7, "RX Source");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_RS232_TX_SOURCE,
                                            0, TxSource), 8, "TX Source");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureEthernet
 *  Purpose:  This function configures scope for Ethernet settings.
 *            This function only applies to DPO4034B, DPO4054B, DPO4104B, 
 *            MSO4034B, MSO4054B, MSO4104B.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureEthernet (ViSession vi,
                                           ViInt32      busNumber, 
                                           ViInt32      ethernetType,
                                           ViInt32      probeType,
                                           ViInt32      diffInputDataSrc,
                                           ViInt32      plusDataSrc,
                                           ViInt32      minusDataSrc,
                                           ViInt32      protocol)
{
    ViStatus    error = VI_SUCCESS; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                            0, busNumber), 2, "Bus Number");
    
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_TYPE,
                                            0, ethernetType), 3, "Ethernet Type");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE,
                                            0, probeType), 4, "");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC,
                                            0, diffInputDataSrc), 5, "Differential Input Data Source");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC,
                                            0, plusDataSrc), 6, "Ethernet D+ Data Source");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC,
                                            0, minusDataSrc), 7, "Ethernet D- Data Source ");
    viCheckParm ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL,
                                            0, protocol), 8, "Ethernet Protocol");
    
    checkErr (tkdpo4k_CheckStatus (vi));                                                

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureAcquisitionType
 *  Purpose:  This function sets the waveform acquisition type.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureAcquisitionType (ViSession vi, 
                                                     ViInt32 acquisitionType)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                          0, acquisitionType), 2, "Acquisition Type");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureFastAcquisition
 * Purpose:   This function configures the fast acquisition mode. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureFastAcquisition (ViSession vi, 
                                                    ViInt32 WaveformGrading, 
                                                    ViBoolean FastAcqusitionEnable)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING,
                 0, WaveformGrading), 2, "Waveform Grading");
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_FASTACQ_STATE,
                 0, FastAcqusitionEnable), 3, "Fast Acqusition Enable");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureNumAverages
 *  Purpose:  This function sets the number of averages for the averaging
 *            acquisition type.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureNumAverages (ViSession vi, 
                                                  ViInt32 numberOfAverages)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_NUM_AVERAGES, 
                                          0, numberOfAverages), 2, "Number Of Averages");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureNumEnvelopes
 *  Purpose:  This function sets the number of envelopes for the envelope
 *            acquisition type.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureNumEnvelopes (ViSession vi, 
                                                   ViInt32 numberOfEnvelopes)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_NUM_ENVELOPES, 
                                          0, numberOfEnvelopes), 2, "Number Of Envelopes");
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMagnivuEnabled
 *  Purpose:  This function enables or disables the MagniVu feature.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureMagnivuEnabled (ViSession vi,
                                                    ViBoolean magnivuEnabled)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_MAGNIVU_ENABLED, 
                                          0, magnivuEnabled), 2, "Magnivu Enabled");
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 * Function: tkdpo4k_ConfigureMidRef                                     
 * Purpose:  Configure an immediate delay measurement.                                                    
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureMidRef (ViSession vi, ViReal64 mid)
{
    ViStatus  error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    checkErr( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_MID2_REF, 0, 
                                        mid));
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
       
}


/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRefLevels
 *  Purpose:  This function configures the reference levels for
 *            waveform measurements.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureRefLevels (ViSession vi, 
                                                ViReal64 low, 
                                                ViReal64 mid, 
                                                ViReal64 high)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_HIGH_REF, 
                                           0, high), 4, "High");

    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_LOW_REF, 
                                           0, low), 2, "Low");
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_MID_REF, 
                                           0, mid), 3, "Mid");
                                           
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMeasurement
 *  Purpose:  This function configures the method the oscilloscope uses to
 *            calculate the measurement reference levels and whether to use
 *            gating for measurements.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureMeasurement (ViSession vi, 
                                                  ViInt32 referenceLevelCalcMethod, 
                                                  ViInt32 gating)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_REF_CALC_METH, 
                 0, referenceLevelCalcMethod), 2, "Reference Level Calc Method");

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_GATING, 
                                            0, gating), 3, "Gating");
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
    
}

/*****************************************************************************
 *  Function: tkdpo4k_AutoSetup                                     
 *  Purpose:  This function performs and autosetup on the instrument.        
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_AutoSetup (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_INITIATE_CONTINUOUS, 
                                           0, VI_TRUE)); 

    if (!Ivi_Simulating (vi)) /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
        viCheckErr( viPrintf (io, ":AUTOS EXEC;"));
    }
    checkErr( tkdpo4k_WaitForOPC (vi, 5000)); 
    checkErr( Ivi_InvalidateAllAttributes (vi));  
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureWfmBufferSize
 *  Purpose:  This function initiates the waveform buffer size.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_ConfigureWfmBufferSize(ViSession vi, 
                                                ViInt32 bufferSize)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));  
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FETCH_BUFFER_SIZE,
                                            0, bufferSize));
  
Error:
    Ivi_UnlockSession (vi, VI_NULL); 
    return error;    
}

/*****************************************************************************
 *  Function: tkdpo4k_ReadWaveform
 *  Purpose:  This function initiates a new waveform acquisition and
 *            returns a waveform from a specific channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ReadWaveform (ViSession vi, 
                                         ViConstString channel, 
                                         ViInt32 waveformSize, 
                                         ViInt32 maxTime, 
                                         ViReal64 waveform[], 
                                         ViInt32 *actualPoints, 
                                         ViReal64 *initialX, 
                                         ViReal64 *xIncrement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channelEnabled;
    ViInt32     acquisitionType;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (waveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for Waveform");
    }       
    if (actualPoints == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 6, "Null address for Actual Points");
    }       
    if (initialX == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 7, "Null address for Initial X");
    }       
    if (xIncrement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 8, "Null address for X Increment");
    }       

    checkErr( Ivi_GetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 0, 
                                        &channelEnabled));
    if (!channelEnabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read waveform from disabled channel.");
    }

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_TYPE, 0, 
                                        &acquisitionType));

    if ((acquisitionType == TKDPO4K_VAL_PEAK_DETECT)
            || (acquisitionType == TKDPO4K_VAL_ENVELOPE))
    {
        viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION, 
                        "Use ReadMinMaxWaveform for acquisition types "
                        "Peak Detect or Envelope.");
    }
        

        /* Read Waveform */
    checkErr( tkdpo4k_InitiateAcquisition (vi)); 
    
    checkErr( tkdpo4k_WaitForOPC (vi, maxTime)); 
    
    checkErr( tkdpo4k_FetchWaveform (vi, channel, waveformSize, waveform, 
                                      actualPoints, initialX, xIncrement));
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ReadMinMaxWaveform                            
 *  Purpose:  This function initiates new waveform acquisition and           
 *            returns min and max waveforms from a specific channel.         
 *            Call this function only when TKDPO4K_ATTR_ACQUISITION_TYPE       
 *            is TKDPO4K_VAL_PEAK_DETECT or TKDPO4K_VAL_ENVELOPE.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ReadMinMaxWaveform (ViSession vi, 
                                               ViConstString channel, 
                                               ViInt32 waveformSize, 
                                               ViInt32 maxTime, 
                                               ViReal64 minWaveform[], 
                                               ViReal64 maxWaveform[], 
                                               ViInt32 *actualPoints, 
                                               ViReal64 *initialX, 
                                               ViReal64 *xIncrement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channelEnabled;
    ViInt32     acquisitionType;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (minWaveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for minWaveform");
    }
    if (maxWaveform == VI_NULL)
    {        
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 6, "Null address for maxWaveform");
    }       
    if (actualPoints == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 7, "Null address for Actual Points");
    }       
    if (initialX == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 8, "Null address for Initial X");
    }       
    if (xIncrement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 9, "Null address for X Increment");
    }       
    
    checkErr( Ivi_GetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channelEnabled));
    if (!channelEnabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read waveform from disabled channel.");
    }
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                       0, &acquisitionType));

    if ( (acquisitionType != TKDPO4K_VAL_PEAK_DETECT)
            && (acquisitionType != TKDPO4K_VAL_ENVELOPE) )
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Use ReadMinMaxWaveform only for acquisition types "
                        "Peak Detect or Envelope.");
    }
    /* Read Min and Max Waveforms */
    checkErr( tkdpo4k_InitiateAcquisition(vi));
    
    checkErr( tkdpo4k_WaitForOPC(vi, maxTime));
    
    checkErr( tkdpo4k_FetchMinMaxWaveform (vi, channel, waveformSize, 
                                            minWaveform, maxWaveform, 
                                            actualPoints, initialX, 
                                            xIncrement));
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ReadWaveformMeasurement                       
 *  Purpose:  This function initiates a new waveform acquisition and         
 *            returns a specified waveform measurement from a specific       
 *            channel.                                                       
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ReadWaveformMeasurement (ViSession vi, 
                                                    ViConstString channel, 
                                                    ViInt32 measFunction, 
                                                    ViInt32 maxTime, 
                                                    ViReal64 *measurement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channelEnabled;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    IviScope_InterchangeCheck (vi, "tkdpo4k_ReadWaveformMeasurement");
    
        /* Not checking the following parameters: channel, maxTime */
    checkErr( Ivi_GetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channelEnabled));
    if (!channelEnabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for Measurement");
    }
    
        /* Read Waveform Measurement */
    checkErr( tkdpo4k_InitiateAcquisition (vi));
    
    checkErr( tkdpo4k_WaitForOPC (vi, maxTime));

    checkErr( tkdpo4k_FetchWaveformMeasurement (vi, channel, measFunction, 
                                                 measurement));

    checkErr( tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ReadPhaseMeasurement                       
 *  Purpose:  This function initiates a new waveform acquisition and         
 *            returns a phase measurement.                        
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ReadPhaseMeasurement (ViSession vi,
                                                ViConstString measureSource1,
                                                ViConstString measureSource2,
                                                ViInt32 maxTime,
                                                ViReal64 *measurement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channel1Enabled;
    ViBoolean   channel2Enabled;
    ViConstString channel1 = VI_NULL, channel2 = VI_NULL;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm (Ivi_CoerceChannelName (vi, measureSource1, &channel1),
                                         2, "Measurement Source1");
    
    viCheckParm (Ivi_CoerceChannelName (vi, measureSource2, &channel2),
                                         3, "Measurement Source2");
    
        /* Not checking the following parameters: maxTime */
    checkErr( Ivi_GetAttributeViBoolean (vi, channel1, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channel1Enabled));
    
    checkErr( Ivi_GetAttributeViBoolean (vi, channel2, TKDPO4K_ATTR_CHANNEL_ENABLED,
                                         0, &channel2Enabled));
    
    if (!channel1Enabled || !channel2Enabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for Measurement");
    }
    
        /* Read Waveform Measurement */
    checkErr( tkdpo4k_InitiateAcquisition (vi));
    
    checkErr( tkdpo4k_WaitForOPC (vi, maxTime));

    checkErr( tkdpo4k_FetchPhaseMeasurement (vi, channel1, channel2, 
                                                 measurement));
    checkErr( tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}
/*****************************************************************************
 *  Function: tkdpo4k_ReadFreqDomainMeasurement                       
 *  Purpose:  This function returns the total channel power according to 
 *            specified RF measure type.  Use tkdpo4k_ConfigureRFMeasurement to 
 *            change the RF measure type.
 *****************************************************************************/

ViStatus _VI_FUNC tkdpo4k_ReadFreqDomainMeasurement (ViSession vi,
                                                     ViReal64 *RFChannelPower,
                                                     ViInt32 *RFIntUnit,
                                                     ViReal64 *ACPR,
                                                     ViConstString ACPRAdjacentChannel)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     measureType;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    checkErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_TYPE,0,&measureType));
    if(measureType == TKDPO4K_VAL_RF_MEASURE_TYPE_NONE)
    {
        viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);
    }
    else
    {
        checkErr( tkdpo4k_InitiateAcquisition (vi));
        checkErr( Ivi_GetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_CHANNEL_POWER,0,RFChannelPower));
        checkErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_UNITS,0,RFIntUnit));
    }
    if(measureType == TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR)
    {
        checkErr(Ivi_GetAttributeViReal64(vi,ACPRAdjacentChannel,TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO,0,ACPR));
    }
    checkErr( tkdpo4k_CheckStatus (vi));
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ReadDelayMeasurement                       
 *  Purpose:  This function initiates a new waveform acquisition and         
 *            returns a delay measurement.                        
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ReadDelayMeasurement (ViSession vi,
                                                ViConstString measureSource1,
                                                ViConstString measureSource2,
                                                ViInt32 delayEdge1,
                                                ViInt32 delayEdge2,
                                                ViInt32 delayDirection,
                                                ViInt32 maxTime,
                                                ViReal64 *measurement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channel1Enabled;
    ViBoolean   channel2Enabled;
    ViConstString channel1 = VI_NULL, channel2 = VI_NULL;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    viCheckParm (Ivi_CoerceChannelName (vi, measureSource1, &channel1),
                                         2, "Measurement Source1");
    
    viCheckParm (Ivi_CoerceChannelName (vi, measureSource2, &channel2),
                                         3, "Measurement Source2");
    
        /* Not checking the following parameters: maxTime */
    checkErr( Ivi_GetAttributeViBoolean (vi, channel1, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channel1Enabled));
    
    checkErr( Ivi_GetAttributeViBoolean (vi, channel2, TKDPO4K_ATTR_CHANNEL_ENABLED,
                                         0, &channel2Enabled));
    
    if (!channel1Enabled || !channel2Enabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 8, "Null address for Measurement");
    }
    
        /* Read Waveform Measurement */
    checkErr( tkdpo4k_InitiateAcquisition (vi));
    
    checkErr( tkdpo4k_WaitForOPC (vi, maxTime));

    checkErr( tkdpo4k_FetchDelayMeasurement (vi, channel1, channel2, delayEdge1,
                                                 delayEdge2, delayDirection, measurement));
    checkErr( tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ReadSnapshotMeasurement
 * Purpose:   This function reads the requested snapshot measurement value from the last snapshot. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadSnapshotMeasurement (ViSession vi, 
                                                   ViReal64 *SnapshotMeasValue)
{
    ViStatus     error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE,
                 0, SnapshotMeasValue), 2, "Snapshot Meas Value");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}   

/*******************************************************************************
 * Function:  tkdpo4k_ReadRFVersusBandwidth
 * Purpose:   This function reads the RF versus time bandwidth. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadRFVersusBandwidth (
                  ViSession vi, ViReal64 *VersusTimeBandwidth)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH,
                 0, VersusTimeBandwidth), 2, "Versus Time Bandwidth");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ReadSpectrogramTime
 * Purpose:   This function reads the time in the spectrogram. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadSpectrogramTime (ViSession vi, 
                                               ViInt32 *SecondsNum, 
                                               ViInt32 *TimeStamp)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM,
                 0, SecondsNum), 2, "Seconds Num");
    viCheckParm( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP,
                 0, TimeStamp), 3, "Time Stamp");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_InitiateAcquisition
 *  Purpose:  This function initiates waveform acquisition in single 
 *            acquisition mode.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_InitiateAcquisition (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model; 
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    IviScope_InterchangeCheck (vi, "tkdpo4k_InitiateAcquisition");
    /*
       If the minimum number of points is greater than the 
       record length, then another attribute must have changed the
       record length of the oscilloscope and invalidated the 
       TKDPO4K_ATTR_HORZ_RECORD_LENGTH attribute.

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                       0, &recordLen));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                       0, &minNumPts));
    if (minNumPts > recordLen)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Current record length is less than the minimum number of points.");
    }
    */
    
        /* Initiate the acquisition */
    if (!Ivi_Simulating (vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */
        /* Do not find additional needs for math channel setup, remove it from source 
           code to enhance speed.
        */
        /*
        checkErr( Ivi_GetAttributeViBoolean (vi, "MATH", TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                             0, &mathEnabled));
                                             
        if (mathEnabled)
        {
            Delay (1.0); */ /* delay to ensure MATH setup. Allow for 1 sec  */
        /*}
        */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
        
        /* Set Continuous Acquisition to FALSE */
        /*  Remove it to support continuous acquisition mode */
        /*
        checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_INITIATE_CONTINUOUS,
                                            0, VI_FALSE) );
        */
        
            /* Set Acquisition State to RUN */
        viCheckErr( viPrintf (io, ":ACQ:STATE RUN"));
        
        /* Invalidate Preamble attributes */
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
        if((model == TKDPO4K_VAL_DPO_4032)
                || (model == TKDPO4K_VAL_MSO_4032)
                    || (model == TKDPO4K_VAL_DPO_3012)
                        || (model == TKDPO4K_VAL_DPO_3032)
                            || (model == TKDPO4K_VAL_DPO_3052) 
                              || (model == TKDPO4K_VAL_MSO_3012) 
                                  || (model == TKDPO4K_VAL_MSO_3032)
                                      || (model == TKDPO4K_VAL_MSO_3052)
                                        || (model == TKDPO4K_VAL_DPO_4102B) 
                                            || (model == TKDPO4K_VAL_DPO_4102B_L)
                                                || (model == TKDPO4K_VAL_MSO_4102B) 
                                                    || (model == TKDPO4K_VAL_MSO_4102B_L))
        {
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YZERO) );
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YOFF) );           

            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YMULT) );       
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YMULT) );  
               
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YZERO) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YOFF) );  
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YMULT) );      
        }
        else
        {
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YZERO) );      
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YOFF) );        
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YOFF) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YMULT) );       
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YMULT) );  
               
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YZERO) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YOFF) );  
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YOFF) );
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YMULT) );      
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YMULT) );      
        }
        
        checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR) );
        checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO) );
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_InitiateContinuousAcquisition
 *  Purpose:  This function initiates waveform acquisition in continuous
 *            acquisition mode. Set the waveform size element to the desired 
 *            amount.
 *  Note:     All channels 
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_InitiateContinuousAcquisition (ViSession vi, 
                                                            ViInt32 waveformSize)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     horzRecordLength, stopIndex;  
    ViInt32     acquisitionType, dataWidth=1;
    ViInt32     wfmFormat=1;
    ViInt32     model;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    IviScope_InterchangeCheck (vi, "tkdpo4k_InitiateAcquisition");
    /*
       If the minimum number of points is greater than the 
       record length, then another attribute must have changed the
       record length of the oscilloscope and invalidated the 
       TKDPO4K_ATTR_HORZ_RECORD_LENGTH attribute.

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                       0, &recordLen));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                       0, &minNumPts));
    if (minNumPts > recordLen)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Current record length is less than the minimum number of points.");
    }
    */ 
    
        /* Initiate the acquisition */
    if (!Ivi_Simulating (vi))                /* call only when locked */
    {
        ViBoolean   mathEnabled;
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */
        
        checkErr( Ivi_GetAttributeViBoolean (vi, "MATH", TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                             0, &mathEnabled));
                                             
        /* delay to ensure MATH setup. Allow for 1 sec */
        /* Do not find neccessary use for math channel setup, remove it from source code
        if (mathEnabled)
        {
            Delay (1.0);  
        }
        */
        
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
         
            /* Set Continuous Acquisition to TRUE */
        checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_INITIATE_CONTINUOUS,
                                                0, VI_TRUE) );
            
            /* Set Acquisition State to RUN */
        viCheckErr( viPrintf (io, ":ACQ:STATE RUN"));
        
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_WAVEFORM_SIZE,
                                            0, waveformSize));
        
        checkErr( Ivi_GetAttributeViInt32  (vi, VI_NULL, 
                                            TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                            0, &acquisitionType));              
        switch (acquisitionType) 
        {
            case TKDPO4K_VAL_NORMAL:
            {
                dataWidth = 1;
                wfmFormat = 1;
                break;
            }            
            case TKDPO4K_VAL_AVERAGE:
            case TKDPO4K_VAL_HI_RES:
            {
                dataWidth = 2;
                wfmFormat = 1;
                break;
            }
            case TKDPO4K_VAL_PEAK_DETECT:
            case TKDPO4K_VAL_ENVELOPE:
            {
                dataWidth = 1;
                wfmFormat = 2;
                break;
            }
            default:
            {
                viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                                "Use InitiateContinuousAcquisition for acquisition types "
                                "Peak Detect or Envelope.");
            }
        }
       
        /* Get record length, not support Ref1 ~ Ref4 */
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                           0, &horzRecordLength));
        if(wfmFormat == 2)
        {
            horzRecordLength *= 2; 
            waveformSize     *= 2;  
        }
        
        if (horzRecordLength > waveformSize)
        {
            stopIndex = waveformSize;
        }        
        else
        {
            stopIndex = horzRecordLength;
        }       
        
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, dataWidth) );
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_START_POS, 0, 1) );
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_STOP_POS, 0, stopIndex) );    

        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
        if((model == TKDPO4K_VAL_DPO_4032)
                || (model == TKDPO4K_VAL_MSO_4032)
                    || (model == TKDPO4K_VAL_MSO_3052)
                        || (model == TKDPO4K_VAL_MSO_3012)
                            || (model == TKDPO4K_VAL_MSO_3032)
                                ||(model == TKDPO4K_VAL_DPO_3012)
                                    ||(model == TKDPO4K_VAL_DPO_3032)
                                        || (model == TKDPO4K_VAL_DPO_4102B) 
                                            || (model == TKDPO4K_VAL_DPO_4102B_L)
                                                || (model == TKDPO4K_VAL_MSO_4102B) 
                                                    || (model == TKDPO4K_VAL_MSO_4102B_L))
        {
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YZERO) );
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YOFF) );           

            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YMULT) );       
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YMULT) );  
            
            /* Intend not to support Reference channel in 
               InitiateContinuousAcquisition && FetchContinuousAcquisition 
               for simplification.
               
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YZERO) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YOFF) );  
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YOFF) );       
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YMULT) );      
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YMULT) );      
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YMULT) );          
            */
        }
        else
        {
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YZERO) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YZERO) );      
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YOFF) );        
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YOFF) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YOFF) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "CH1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH2", TKDPO4K_ATTR_DATA_YMULT) );       
            checkErr( Ivi_InvalidateAttribute (vi, "CH3", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "CH4", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "MATH", TKDPO4K_ATTR_DATA_YMULT) );  
            
            /* Intend not to support Reference channel in 
               InitiateContinuousAcquisition && FetchContinuousAcquisition 
               for simplification.
               
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YZERO) ); 
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YZERO) ); 
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YOFF) );  
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YOFF) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YOFF) );
            
            checkErr( Ivi_InvalidateAttribute (vi, "REF1", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF2", TKDPO4K_ATTR_DATA_YMULT) );      
            checkErr( Ivi_InvalidateAttribute (vi, "REF3", TKDPO4K_ATTR_DATA_YMULT) );
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YMULT) );      
            checkErr( Ivi_InvalidateAttribute (vi, "REF4", TKDPO4K_ATTR_DATA_YMULT) );          
            */
        }
        
        checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR) );
        checkErr( Ivi_InvalidateAttribute (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO) );
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_StopContinuousAcquisition
 *  Purpose:  This function stops waveform acquisition in continuous
 *            acquisition mode.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_StopContinuousAcquisition (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    IviScope_InterchangeCheck (vi, "tkdpo4k_InitiateAcquisition");

        /* Initiate the acquisition */
    if (!Ivi_Simulating (vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */ 

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE)); 
        
            /* Set Acquisition State to STOP */
        viCheckErr( viPrintf (io, ":ACQ:STATE STOP"));
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ForceTrigger
 *  Purpose:  This function forces a trigger with a software command.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ForceTrigger (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (!Ivi_Simulating (vi))                   /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

        viCheckErr( viPrintf (io, "%s", "*TRG"));
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_AcquisitionStatus
 *  Purpose:  This function determines if an acquisition is in
 *            progress or has completed. If it cannot determine the acquisition
 *            status, it returns TKDPO4K_VAL_ACQ_STATUS_UNKNOWN.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_AcquisitionStatus (ViSession vi, ViInt32 *statusRef)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     status = TKDPO4K_VAL_ACQ_COMPLETE;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (statusRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Status");
    }
    
    if (!Ivi_Simulating (vi))                   /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */
        ViInt32     acqStatus;
    
        viCheckErr( viQueryf (io, ":ACQ:STATE?", "%ld", &acqStatus));
        if (acqStatus != 0)
        {
            status = TKDPO4K_VAL_ACQ_IN_PROGRESS;
        }
    }
        
Error:
    *statusRef = status;
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchWaveform
 *  Purpose:  This function fetches a waveform from a specified
 *            channel from previously initiated acquisition.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_FetchWaveform (ViSession vi, 
                                           ViConstString channel, 
                                           ViInt32 waveformSize, 
                                           ViReal64 waveform[], 
                                           ViInt32 *actualPointsRef, 
                                           ViReal64 *initialXRef, 
                                           ViReal64 *xIncrementRef)
{
    ViStatus      error = VI_SUCCESS;
    ViInt32       actualPoints;
    ViReal64      xIncrement, initialX;
    ViConstString dataSource;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName (vi, channel, &dataSource), 2, "Invalid Channel");
    if (waveform == VI_NULL)
    {    
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Waveform");
    }  
    if (actualPointsRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for Actual Points");
    }
    if (initialXRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 6, "Null address for Initial X");
    }
    if (xIncrementRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 7, "Null address for X Increment");
    }
    
        /* Fetch Waveform */
    if (!Ivi_Simulating (vi))                   /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */
        ViReal64    yZero, yOffset, yMultiplier;
        
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

        checkErr( tkdpo4k_FetchRawWaveform (vi, io, dataSource,
                                             &yZero, &yOffset, &yMultiplier, 
                                             &xIncrement, &initialX, 
                                             waveformSize, waveform,
                                             &actualPoints));
                                             
        tkdpo4k_ScaleRawWaveform (actualPoints, waveform, yZero, yOffset, yMultiplier);
    }
    else
    {
        ViInt32     x;
        ViReal64    yRange, simOffset = 0.0;
        ViInt32     triggerSlope, vCoup;
        ViReal64    k, level, theta, offset;

        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                           0, &actualPoints));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, 
                                            TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &yRange)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, channel, 
                                           TKDPO4K_ATTR_VERTICAL_COUPLING, 
                                           0, &vCoup));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, 
                                            TKDPO4K_ATTR_VERTICAL_OFFSET, 
                                            0, &offset)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_TRIGGER_SLOPE, 
                                           0, &triggerSlope));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                            0, &level));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            0, &xIncrement));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_ACQUISITION_START_TIME, 
                                            0, &initialX));
        theta = asin (2*level/yRange);
        if (triggerSlope == TKDPO4K_VAL_POSITIVE)
        {
            k = 1.0;
        }           
        else 
        {
            k = -1.0;
        }           
        
        if( actualPoints>waveformSize ) 
        {
            actualPoints = waveformSize;  /* Checking number of points to write */
        }           
        xIncrement /= actualPoints;

        if (vCoup == TKDPO4K_VAL_DC)
            simOffset = 0.5;
        if (vCoup == TKDPO4K_VAL_GND)
            simOffset = 0.0;     /*i changed this variable from K to simOffset */
            
        for (x = 0; x < actualPoints; x++)
        {
            ViReal64 y = simOffset + k * 2.5 * sin (xIncrement * 12560 * x + k * theta) + /* ~2 periods of 1kHz sinewave */
                            (!(x%20)) * (16384 - rand())/150000.0;
            waveform[x] = (offset + yRange/2) > y ? ((offset - yRange/2) < y ? y : (offset - yRange/2)) : (offset + yRange/2);
        }            
    }
    *actualPointsRef = actualPoints;
    *initialXRef = initialX;
    *xIncrementRef = xIncrement;
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchMinMaxWaveform                           
 *  Purpose:  This function fetches a min and max waveform from a waveform 
 *            acquisition that the user or driver previously initiated on a 
 *            specific channel.                     
 *            Call this function only when TKDPO4K_ATTR_ACQUISITION_TYPE
 *            is TKDPO4K_VAL_PEAK_DETECT or TKDPO4K_VAL_ENVELOPE.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchMinMaxWaveform (ViSession vi, 
                                                ViConstString channel, 
                                                ViInt32 waveformSize, 
                                                ViReal64 minWaveform[], 
                                                ViReal64 maxWaveform[], 
                                                ViInt32 *actualPointsRef, 
                                                ViReal64 *initialXRef, 
                                                ViReal64 *xIncrementRef)
{
    ViStatus        error = VI_SUCCESS;
    ViInt32         acquisitionType, actualPoints;
    ViReal64        initialX, xIncrement;
    ViConstString   dataSource;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName(vi, channel, &dataSource), 2, "Channel");
    
    if (minWaveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for minWaveform");
    }
    
    if (maxWaveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 5, "Null address for maxWaveform");
    }
    
    if (actualPointsRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 6, "Null address for Actual Points");
    }
    
    if (initialXRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 7 , "Null address for Initial X");
    }
    
    if (xIncrementRef == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 8 , "Null address for X Increment");
    }
    
        /* Fetch Min and Max Waveforms */
    checkErr( Ivi_GetAttributeViInt32  (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_TYPE, 0, 
                                        &acquisitionType));
    
    if ((acquisitionType != TKDPO4K_VAL_PEAK_DETECT) 
            && (acquisitionType != TKDPO4K_VAL_ENVELOPE))
    {           
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Use FetchMinMaxWaveform only for acquisition types "
                        "Peak Detect or Envelope.");
    }
    
    if (!Ivi_Simulating (vi))               /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */
        ViReal64    yZero, yOffset, yMultiplier;
        
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

        checkErr( tkdpo4k_FetchRawMinMaxWaveform (vi, io, dataSource,
                                                   &yZero, &yOffset, &yMultiplier,
                                                   &xIncrement, &initialX, 
                                                   waveformSize, minWaveform, 
                                                   maxWaveform, &actualPoints));
        
        
        tkdpo4k_ScaleRawWaveform (actualPoints, minWaveform, yZero, yOffset, yMultiplier);
        tkdpo4k_ScaleRawWaveform (actualPoints, maxWaveform, yZero, yOffset, yMultiplier);
    }
    else
    {
        ViInt32     x;
        ViReal64    yRange, k, theta, level;
        ViInt32     triggerSlope;
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                           0, &actualPoints));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &yRange)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SLOPE, 
                                           0, &triggerSlope));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                            0, &level));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            0, &xIncrement));
        theta = asin (2*level/yRange);
        if (triggerSlope == TKDPO4K_VAL_POSITIVE)
            k = 1.0;
        else 
            k = -1.0;

        initialX = 0.0;
        actualPoints /= 4;
        if( actualPoints>waveformSize ) 
            actualPoints = waveformSize;  /* Checking number of points to write */
        xIncrement *= 4;
        for (x = 0; x < actualPoints; x++) 
        {
                /* add glitch to the every 20th element in the waveform array */
            maxWaveform[x] = k * yRange * .49 * sin (xIncrement * x + k * theta)
                            + (!(x%20)) * rand()/150000.0;
            minWaveform[x] = k * yRange * .51 * sin (xIncrement * x + k * theta)
                            - (!(x%20)) * rand()/160000.0;
        }
    }
    *actualPointsRef = actualPoints;
    *xIncrementRef = xIncrement;
    *initialXRef = initialX;
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchWaveformMeasurement                      
 *  Purpose:  This function fetches a specified waveform measurement         
 *            from a specific channel from a previously initiated            
 *            waveform acquisition.                                          
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchWaveformMeasurement (ViSession vi, 
                                                     ViConstString channel, 
                                                     ViInt32 measFunction, 
                                                     ViReal64 *measurement)
                                                     
{ 
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channelEnabled;
    ViBoolean   nonHistSource;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    nonHistSource = (ViBoolean) strcmp(channel,TKDPO4K_VAL_HISTOGRAM);
    if(nonHistSource)
    {
        checkErr( Ivi_GetAttributeViBoolean (vi, channel, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channelEnabled));
        if (!channelEnabled)
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                            "Cannot read a waveform measurement from disabled channel.");
        }
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Measurement");
    }
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE, 
                                           0, channel), 2, "Measure Source");

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_FUNCTION, 
                                          0, measFunction), 3, "Measurement Function");

    if(nonHistSource)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_MEAS_VALUE, 
                                        0, measurement)); 
    }
    else
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, TKDPO4K_VAL_CH_1, TKDPO4K_ATTR_MEAS_VALUE, 
                                        0, measurement));   
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchPhaseMeasurement                      
 *  Purpose:  This function fetches the phase measurement.         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchPhaseMeasurement (ViSession vi,
                                                    ViConstString measureSource1,
                                                    ViConstString measureSource2,
                                                    ViReal64 *measurement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channel1Enabled;
    ViBoolean   channel2Enabled;
    ViConstString channel1 = VI_NULL, channel2 = VI_NULL;
    ViBoolean   nonHistSource;
    nonHistSource = (ViBoolean) strcmp(measureSource1,TKDPO4K_VAL_HISTOGRAM);
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if(nonHistSource)
    {
        checkErr (Ivi_CoerceChannelName (vi, measureSource1, &channel1));
        checkErr( Ivi_GetAttributeViBoolean (vi, channel1, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channel1Enabled));
        if (!channel1Enabled)
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
        }
    }
    else
    {
        channel1 = measureSource1;
    }
    checkErr (Ivi_CoerceChannelName (vi, measureSource2, &channel2));
    checkErr( Ivi_GetAttributeViBoolean (vi, channel2, TKDPO4K_ATTR_CHANNEL_ENABLED,
                                         0, &channel2Enabled));
    if (!channel2Enabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Measurement");
    }
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE, 
                                           0, channel1), 2, "Measure Source");
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE2,
                                           0, channel2), 3, "Measure Source2");

    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_FUNCTION, 
                                           0, TKDPO4K_VAL_PHASE));

    if(nonHistSource)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, channel1, TKDPO4K_ATTR_MEAS_VALUE, 
                                        0, measurement));
    }
    else
    {
          checkErr( Ivi_GetAttributeViReal64 (vi, TKDPO4K_VAL_CH_1, TKDPO4K_ATTR_MEAS_VALUE, 
                                        0, measurement));
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchDelayMeasurement                      
 *  Purpose:  This function fetches the delay measurement.         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchDelayMeasurement (ViSession vi,
                                                    ViConstString measureSource1,
                                                    ViConstString measureSource2,
                                                    ViInt32 delayEdge1,
                                                    ViInt32 delayEdge2,
                                                    ViInt32 delayDirection,
                                                    ViReal64 *measurement)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   channel1Enabled;
    ViBoolean   channel2Enabled;
    ViConstString channel1 = VI_NULL, channel2 = VI_NULL;
    ViBoolean   nonHistSource = VI_TRUE;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    nonHistSource = (ViBoolean) strcmp(measureSource1,TKDPO4K_VAL_HISTOGRAM);
    if(nonHistSource)
    {
        checkErr (Ivi_CoerceChannelName (vi, measureSource1, &channel1));  
        checkErr( Ivi_GetAttributeViBoolean (vi, channel1, TKDPO4K_ATTR_CHANNEL_ENABLED, 
                                         0, &channel1Enabled));
        if (!channel1Enabled)
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");
        }
    }
    checkErr (Ivi_CoerceChannelName (vi, measureSource2, &channel2)); 
    checkErr( Ivi_GetAttributeViBoolean (vi, channel2, TKDPO4K_ATTR_CHANNEL_ENABLED,
                                         0, &channel2Enabled));
    
    if (!channel2Enabled)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Cannot read a waveform measurement from disabled channel.");   
    }
    
    if (measurement == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 7, "Null address for Measurement");
    }
    
    if(nonHistSource)
    {
        viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE, 
                                           0, channel1), 2, "Measurement Source1");
    }
    else
    {
        viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE, 
                                           0, measureSource1), 2, "Measurement Source1");   
    }
    
    viCheckParm( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_MEAS_SOURCE2,
                                           0, channel2), 3, "Measurement Source2");
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_DEL_EDGE,
                                           0, delayEdge1), 4, "Measure Source1 Delay Edge");
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_DEL_EDGE2,
                                           0, delayEdge2), 5, "Measure Source2 Delay Edge");

    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_DEL_DIRECTION,
                                           0, delayDirection), 6, "Measure Delay Direction");

    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_FUNCTION, 
                                           0, TKDPO4K_VAL_DELAY));

    if(nonHistSource)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, channel1, TKDPO4K_ATTR_MEAS_VALUE, 
                                           0, measurement)); 
    }
    else
    {
        /* channelName only for simulation model.
          Hist model do not support                 */
        checkErr( Ivi_GetAttributeViReal64 (vi, TKDPO4K_VAL_CH_1, TKDPO4K_ATTR_MEAS_VALUE, 
                                           0, measurement)); 
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_Abort
 *  Purpose:  This function aborts a previously initiated acquisition.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_Abort (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (!Ivi_Simulating (vi))                   /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

            /* Set Acquisition State to STOP */
        viCheckErr( viPrintf (io, "%s", ":ACQ:STATE 0"));
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMathChannel                                
 *  Purpose:  This function configures a math channel to for single or dual
 *            waveform math. 
 *            NOTE: FFTs, use tkdpo4k_ConfigureMathChannelFFT.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureMathChannel (ViSession vi,
                                                ViInt32 mathSource1,
                                                ViInt32 mathFunction,
                                                ViInt32 mathSource2)
{
    ViStatus error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    checkErr (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, TKDPO4K_VAL_MATH_TYPE_DUAL));
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_SOURCE_1ST,
                                           0, mathSource1), 2, "Math Source 1");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_SOURCE_2ND,
                                           0, mathSource2), 4, "Math Source 2");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_FUNCTION, 
                                          0, mathFunction), 3, "Math Function");
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}
             
/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMathChannelFFT                               
 *  Purpose:  This function configures a math channel for FFTs. A math channel
 *            must be configured before it can be enabled.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureMathChannelFFT (ViSession vi, 
                                                    ViInt32 mathSource1,
                                                    ViInt32 fftWindow, 
                                                    ViInt32 fftVertScale)
{
    ViStatus error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    checkErr (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, TKDPO4K_VAL_MATH_TYPE_FFT));

    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_SOURCE_1ST,
                                           0, mathSource1), 2, "Math Source 1");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FFT_WINDOW, 
                                          0, fftWindow), 3, "FFT Window");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FFT_VERT_SCALE, 
                                          0, fftVertScale), 4, "FFT Vert Scale");
    checkErr (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_FUNCTION, 0,
                                       TKDPO4K_VAL_MATH_FFT));
    
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMathChannelAdvanced                               
 *  Purpose:  Configures a math channel using a mathematical expression.  
 *            Only invalid for DPO2K, MSO2K and MDO4K series.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureMathChannelAdvanced (ViSession vi,
                                                        ViReal64 var1,
                                                        ViReal64 var2,
                                                        ViConstString funcDefinition)
{
    ViStatus error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    checkErr (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, TKDPO4K_VAL_MATH_TYPE_ADVANCED));
    
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_ADV_VAR1, 
                                            0, var1), 2, "Math VAR1");
                                            
    viCheckParm (Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_ADV_VAR2,
                                            0, var2), 3, "Math VAR2");
                                            
    viCheckParm (Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ADV_DEFINE,
                                            0, funcDefinition), 4, 
                                            "Math Advanced Function Definition");
    
    checkErr (tkdpo4k_CheckStatus (vi));
                                            
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}
/*****************************************************************************
 *  Function: tkdpo4k_ConfigureMathChannelSpectrum                               
 *  Purpose:  Configures a math channel to perform math operations on RF Channels..  
 *            Only invalid for MDO4K series.
 *****************************************************************************/  
ViStatus _VI_FUNC tkdpo4k_ConfigureMathChannelSpectrum (ViSession vi,
                                                        ViInt32 mathRFSource1,
                                                        ViInt32 mathRFSource2,
                                                        ViInt32 mathFunction)
{
    ViStatus    error = VI_SUCCESS;
     
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );   
    checkErr (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, TKDPO4K_VAL_MATH_TYPE_SPECTRUM));
    
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_RF_SOURCE_1ST,
                                           0, mathRFSource1), 2, "Math Source 1");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_RF_SOURCE_2ND,
                                           0, mathRFSource2), 4, "Math Source 2");
    viCheckParm (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_FUNCTION, 
                                          0, mathFunction), 3, "Math Function");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL); 
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_EnableMathChannel
 *  Purpose:  This enables/disables the MATH channel.
 *****************************************************************************/
ViStatus _VI_FUNC  tkdpo4k_EnableMathChannel (ViSession vi, 
                                                ViBoolean enableMathChannel)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckParm( Ivi_SetAttributeViBoolean (vi, "MATH", 
                                            TKDPO4K_ATTR_CHANNEL_ENABLED, 0, 
                                            enableMathChannel), 2, "Reference Channel");      
    checkErr (tkdpo4k_CheckStatus (vi)); 

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}                                               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureMathExpDisplay
 * Purpose:   This function configures the display of the math expression.
 *            
 *            Note:
 *            
 *            Depending upon the platform's UI, this command may or may not have any effect. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureMathExpDisplay (ViSession vi, 
                                                   ViBoolean AutoScale)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY,
                 0, AutoScale), 2, "Auto Scale");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}       

/*****************************************************************************
 *  Function: tkdpo4k_EnableReferenceChannel
 *  Purpose:  This enables/disables a reference channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_EnableReferenceChannel (ViSession vi, 
                                                    ViConstString refChannel, 
                                                    ViBoolean enableRefChannel)
{
    ViStatus    error = VI_SUCCESS;
    ViString    coercedRefChannel;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName (vi, refChannel, &coercedRefChannel), 
                                        2, "Ref Channel");
    if (strncmp (coercedRefChannel, "REF", 3) != 0)
        viCheckParm( IVI_ERROR_INVALID_VALUE, 2, "Reference Channel");
    viCheckParm( Ivi_SetAttributeViBoolean (vi, coercedRefChannel, 
                                            TKDPO4K_ATTR_CHANNEL_ENABLED, 0, 
                                            enableRefChannel), 3, "Enable Reference Channel");  
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_StoreWfmToRefChannel
 *  Purpose:  This function stores a waveform to a reference channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_StoreWfmToRefChannel (ViSession vi, 
                                                 ViConstString sourceChannel, 
                                                 ViConstString refChannel)
{
    ViStatus        error = VI_SUCCESS;
    ViConstString   sourceChanStr, refChanStr;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName (vi, sourceChannel, &sourceChanStr), 
                2, "Source Channel");
    viCheckParm( Ivi_CoerceChannelName (vi, refChannel, &refChanStr), 
                3, "Reference Channel");
    if (strncmp (refChanStr, "REF", 3) != 0)
        viCheckParm( IVI_ERROR_INVALID_VALUE, 3, "Reference Channel");
        
    /* Save channnel to instrument's reference channel */
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        viCheckErr( viPrintf (io, "SAV:WAVE %s,%s", sourceChanStr, refChanStr));
    }
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFRbw
 *  Purpose:  This function configures the Span:Bandwidth Ratio,
 *            Reference Level and Resolution Bandwidth for MDO Series 
 *            Oscilloscopes.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFRbw (ViSession vi,
                                          ViReal64 spanBandwidth,
                                          ViBoolean autoResolution,
                                          ViReal64 manualResolution,
                                          ViReal64 manualReference,
                                          ViBoolean autoReference)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    if(autoResolution)
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_RBW_MODE,0, TKDPO4K_VAL_RF_RBW_MODE_AUTO),4,"Auto Resolution");
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_SPAN_RBW_RATIO,0,spanBandwidth),3,"Span:Bandwidth");  
    }
    else
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_RBW_MODE,0, TKDPO4K_VAL_RF_RBW_MODE_MANUAL),4,"Auto Resolution");
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_RBW,0, manualResolution),5,"Manual Resolution");   
    }
    if(autoReference)
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_REF_LEVEL,0, TKDPO4K_VAL_RF_REF_LEVEL_AUTO),6,"Auto Reference");  
    }
    else
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_REF_LEVEL,0,manualReference),7,"Manual Reference");
    }
    checkErr (tkdpo4k_CheckStatus (vi)); 
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFSquelch
 *  Purpose:  This function enables or disables the RF Squelch function and
 *            configures the RF Squelch threshold.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFSquelch (ViSession vi,
                                              ViBoolean enableSquelch,
                                              ViReal64 squelchThreshold)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckParm(Ivi_SetAttributeViBoolean(vi,VI_NULL,TKDPO4K_ATTR_RF_SQUELCH_STATE,0,enableSquelch),2,"Enable Squelch ");
    if(enableSquelch)
    {
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_SQUELCH_THRESHOLD,0,squelchThreshold),3,"Squelch Threshold");
    }
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFSpectrum
 *  Purpose:  This function configures the RF Spectrum Mode and the start/stop 
 *            frequency.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFSpectrum (ViSession vi,
                                               ViInt32 spectrumMode,
                                               ViInt32 frequencySettingMode,
                                               ViReal64 centerFrequency,
                                               ViReal64 spanFrequency,
                                               ViReal64 startFrequency,
                                               ViReal64 stopFrequency)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi)); 
    viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_SPECTRUM_MODE,0,spectrumMode),2,"Spectrum Mode");
    if(frequencySettingMode == 1)  /* Start/Stop Mode */
    {  
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_FREQ_START,0,startFrequency),6,"Start Frequency");
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_FREQ_STOP,0,stopFrequency),7,"Stop Frequency");
    }
    else    /* Center/Span Mode */ 
    {
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_FREQ_CENTER,0,centerFrequency),4,"Center Frequency");
        viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_FREQ_SPAN,0,spanFrequency),5,"Span Frequency");
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFDetection
 *  Purpose:  This function configures RF detection attributes.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFDetection (ViSession vi,
                                                ViBoolean enableAutoDetectionMode,
                                                ViConstString RFChannel,
                                                ViInt32 detectionMethod)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL));  
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    if(enableAutoDetectionMode)
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_DETECTION_MODE,0,TKDPO4K_VAL_RF_DETECT_MODE_AUTO),2,"Enable Auto Detection Mode");
    }
    else
    {
        viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_DETECTION_MODE,0,TKDPO4K_VAL_RF_DETECT_MODE_MANUAL),2,"Enable Auto Detection Mode");
        viCheckParm(Ivi_SetAttributeViInt32(vi,RFChannel,TKDPO4K_ATTR_RF_DETECTION_METHOD,0,detectionMethod),4,"Detection Method");
    }
    checkErr (tkdpo4k_CheckStatus (vi));  
Error:
     Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFNumAverages
 *  Purpose:  This function configures number of acquisitions to be used when 
 *  creating the RF Average frequency domain trace for RF_Average Channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFNumAverages (ViSession vi,
                                                  ViInt32 numberOfAverages)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_NUM_AVERAGES, 
                                          0, numberOfAverages), 2, "RF Number Of Averages");
    
    checkErr (tkdpo4k_CheckStatus (vi));
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureRFMeasurement
 *  Purpose:  This function configures the RF Measurement function.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureRFMeasurement (ViSession vi,
                                                  ViInt32 measureType,
                                                  ViReal64 channelBandwidth,
                                                  ViInt32 ACPRAdjacentPairCount,
                                                  ViReal64 ACPRChannelSpacing,
                                                  ViReal64 OBWPowerPercentage)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_TYPE,0,measureType),2,"Measure Type");
    switch (measureType)
    {
        case TKDPO4K_VAL_RF_MEASURE_TYPE_NONE:
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR:
            viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,0,channelBandwidth),3,"Channel Bandwidth");
            viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_ACPR_ADJACENTPAIRS,0,ACPRAdjacentPairCount),4,"ACPR Adjacent Pair Count");
            viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING,0,ACPRChannelSpacing),5,"ACPR Channel Spacing");
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_OBW:
            viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_OBW_PERCENT_DOWN,0,OBWPowerPercentage),6,"OBW Power Percentage");
        case TKDPO4K_VAL_RF_MEASURE_TYPE_CP:
            viCheckParm(Ivi_SetAttributeViReal64(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,0,channelBandwidth),3,"Channel Bandwidth");
            break;
        default:
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                            "Use InitiateContinuousAcquisition for acquisition types "
                            "Peak Detect or Envelope.");
        }
        
    }
Error:
    checkErr (tkdpo4k_CheckStatus (vi));  
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureRFPhaseTrace
 * Purpose:   This function configures  the RF Phase vs. Time trace.
 *
 * Note:
 * This function only available for MDO4000 models.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureRFPhaseTrace (ViSession vi, 
                                                 ViInt32 PhaseInDegrees, 
                                                 ViInt32 DegreesNumber,
                                                 ViBoolean EnablePhaseWrap)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO4KModel(vi) );     
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_PHASE_IN_DEGREES,
                 0, PhaseInDegrees), 2, "Phase In Degrees");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM,
                 0, DegreesNumber), 3, "Degrees Number");
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE,
                 0, EnablePhaseWrap), 4, "Enable Phase Wrap");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ConfigureTimeDomainWinFunc
 *  Purpose:  This function configures windows function for time domain traces.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTimeDomainWinFunc (ViSession vi,
                                                      ViInt32 RFWindowFunction)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_LockSession (vi, VI_NULL)); 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckParm(Ivi_SetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_FFT_WINDOW,0,RFWindowFunction),2,"RF Window Function");
    checkErr (tkdpo4k_CheckStatus (vi)); 
Error:
    Ivi_UnlockSession (vi, VI_NULL);  
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_EnableRFChannel
 *  Purpose:  This function enables specified RF channel.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_EnableRFChannel (ViSession vi,
                                           ViConstString rfChannel,
                                           ViBoolean enableRFChannel)
{
    ViStatus    error = VI_SUCCESS;
    ViString    coercedRFChannel;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckParm( Ivi_CoerceChannelName (vi, rfChannel, &coercedRFChannel), 
                                        2, "Ref Channel");
    if (strncmp (coercedRFChannel, "RF", 2) != 0)
        viCheckParm( IVI_ERROR_INVALID_VALUE, 2, "RF Channel");
    viCheckParm( Ivi_SetAttributeViBoolean (vi, coercedRFChannel, 
                                            TKDPO4K_ATTR_CHANNEL_ENABLED, 0, 
                                            enableRFChannel), 3, "Reference Channel");  
    checkErr (tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_SetRFIQDataFileFormat
 * Purpose:   This function specifies the file format for saving the RF baseband I & Q data. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_SetRFIQDataFileFormat (ViSession vi, 
                                                 ViInt32 FileFormat)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT,
                 0, FileFormat), 2, "File Format");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ResetSpectrumTraces
 * Purpose:   This function resets the spectrum traces, RF_MINHold, RF_MAXHold and RF_AVErage. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ResetSpectrumTraces (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (!Ivi_Simulating (vi))               /* call only when locked */
    {   
        ViSession   io = Ivi_IOSession (vi); 

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
    
        viCheckErr ( viPrintf (io, ":RF:SPECTRUMT RESET") );                                   
                 
        checkErr( tkdpo4k_CheckStatus (vi));
    }

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
/*******************************************************************************
 * Function:  tkdpo4k_ClearSpectrogram
 * Purpose:   This function clears the spectrogram. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ClearSpectrogram (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));

    if (!Ivi_Simulating (vi))               /* call only when locked */
    {   
        ViSession   io = Ivi_IOSession (vi); 

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
    
        viCheckErr ( viPrintf (io, ":RF:SPECTR CLEAR") );                                    
                 
        checkErr( tkdpo4k_CheckStatus (vi));
    }

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}   

/*===========================================================================*
 *= Arbitrary Function Generator Group Functions ============================*
 *===========================================================================*/ 

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureStandardWaveform
 * Purpose:   This function configures the attributes of the function generator 
 *            that affect standard waveform generation.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
 *            3. The tkdpo4k_ConfigureOutputImpedance function must be used
 *            before this function, so that saved setups are recalled with the
 *            proper load factor applied.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureStandardWaveform (ViSession vi, 
                                                     ViInt32 Waveform, 
                                                     ViReal64 Amplitude, 
                                                     ViReal64 DCOffset, 
                                                     ViReal64 Frequency, 
                                                     ViReal64 StartPhase)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM,
                 0, Waveform), 2, "Waveform");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_AMPLITUDE,
                 0, Amplitude), 3, "Amplitude");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_DC_OFFSET,
                 0, DCOffset), 4, "D COffset");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_FREQUENCY,
                 0, Frequency), 5, "Frequency");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_START_PHASE,
                 0, StartPhase), 6, "Start Phase");
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigurePresetLevel
 * Purpose:   This function configures the AFG preset levels to values that 
 *            correspond to the logic standard specified by the argument.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigurePresetLevel (ViSession vi, 
                                                ViInt32 PresetLevel)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_PRESET_LEVEL,
                 0, PresetLevel), 2, "Preset Level");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureNoise
 * Purpose:   This function configures the arbitrary function generator additive noise.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureNoise (ViSession vi, 
                                          ViBoolean EnableNoise, 
                                          ViInt32 NoiseLevel)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_FUNC_NOISE_ENABLED,
                 0, EnableNoise), 2, "Enable Noise");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_NOISE_LEVEL,
                 0, NoiseLevel), 3, "Noise Level");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureOutputEnabled
 * Purpose:   This function configures the arbitrary function generator output state.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureOutputEnabled (ViSession vi, 
                                                  ViBoolean Enabled)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_ENABLED,
                 0, Enabled), 2, "Enabled");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureOutputImpedance
 * Purpose:   This function configures the arbitrary function generator output
 *            load impedance.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureOutputImpedance (ViSession vi, 
                                                    ViInt32 Impedance)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE,
                 0, Impedance), 2, "Impedance");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_ConfigurePeriod
 * Purpose:   This function configures the period of the AFG waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigurePeriod (ViSession vi, 
                                           ViReal64 Period)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_PERIOD,
                 0, Period), 2, "Period");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureSquareDutyCycle
 * Purpose:   This function configures the duty cycle of the AFG square waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureSquareDutyCycle (ViSession vi, 
                                                    ViReal64 DutyCycle)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH,
                 0, DutyCycle), 2, "Duty Cycle");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigurePulseWidth
 * Purpose:   This function configures the pulse width of the AFG pulse waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigurePulseWidth (ViSession vi, 
                                               ViReal64 PulseWidth)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_PULSE_WIDTH,
                 0, PulseWidth), 2, "Pulse Width");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureRampSymmetry
 * Purpose:   This function configures the ramp symmetry of the AFG ramp waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureRampSymmetry (ViSession vi, 
                                                 ViReal64 RampSymmetry)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_RAMP_SYMMETRY,
                 0, RampSymmetry), 2, "Ramp Symmetry");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_SaveWaveform
 * Purpose:   This function saves the specified waveform to the specified 
 *            destination reference memory slot, or saves the specified waveform(s)
 *            to the specified destination file.
 *            
 *            SCPI Command:
 *            SAVe:WAVEform 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_SaveWaveform (ViSession vi, 
                                        ViChar Source[], 
                                        ViChar Destination[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        viCheckErr( viPrintf (io, "SAV:WAVE %s,%s", Source, Destination));
    }                                  
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_RecallWaveform
 * Purpose:   This function recalls a stored waveform to a reference memory location.
 *            
 *            Notes:
 *            1. Only the first waveform in a .CSV file is recalled for multiple 
 *            waveform .CSV files. 
 *            2. Recall of digital waveforms (D0 through D15) is not supported.
 *            3. For MDO3000 series models, a saved ARB waveform cannot be
 *            recalled to a reference location. It can only be recalled to an
 *            EMEM location. However, an AFG waveform can be recalled into
 *            either a reference or EMEM location.
 *            
 *            SCPI Command:
 *            RECAll:WAVEform 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_RecallWaveform (ViSession vi, 
                                          ViChar Source[], 
                                          ViChar Destination[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        viCheckErr( viPrintf (io, "RECA:WAVE %s,%s", Source, Destination));
    }
    checkErr (tkdpo4k_CheckStatus (vi));                                  

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}


/*===========================================================================*
 *= IviScope Arbitrary Waveform Generator Group Functions ===================*
 *===========================================================================*/         
            
/*******************************************************************************
 * Function:  tkdpo4k_QueryArbitraryWaveform
 * Purpose:   This function queries the date and time of the specified arbitrary 
 *            waveform slot.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_QueryArbitraryWaveform (ViSession vi, 
                                                  ViChar WaveformSlot[], 
                                                  ViChar WaveformDate[],
                                                  ViChar WaveformTime[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));    
    
    viCheckParm( Ivi_GetAttributeViString (vi, WaveformSlot, TKDPO4K_ATTR_ARB_WAVEFORM_DATE,
                 0, BUFFER_SIZE, WaveformDate), 3, "Waveform Date");
    viCheckParm( Ivi_GetAttributeViString (vi, WaveformSlot, TKDPO4K_ATTR_ARB_WAVEFORM_TIME,
                 0, BUFFER_SIZE, WaveformTime), 4, "Waveform Time");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_QueryEditedArbitraryWaveform
 * Purpose:   This function queries the currently selected arbitrary waveform 
 *            pre-defined function and the point number in the AFB arbitrary 
 *            waveform edit memory.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_QueryEditedArbitraryWaveform (ViSession vi, 
                                                        ViChar Function[], 
                                                        ViInt32 *PointNumber)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));    
    
    viCheckParm( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ARB_WAVEFORM_PREDEFINED_FUNCTION,
                 0, BUFFER_SIZE, Function), 2, "Function");
    viCheckParm( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ARB_WAVEFORM_POINT_NUMBER,
                 0, PointNumber), 3, "Point Number");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_ConfigureWaveformLabel
 * Purpose:   This function configures the waveform label for arbitrary waveform 
 *            slots 1- 4.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureWaveformLabel (ViSession vi, 
                                                  ViChar WaveformSlot[], 
                                                  ViChar Label[])
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));    
    
    viCheckParm( Ivi_SetAttributeViString (vi, WaveformSlot, TKDPO4K_ATTR_ARB_WAVEFORM_LABEL,
                 0, Label), 3, "Label");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}


/*******************************************************************************
 * Function:  tkdpo4k_GenerateArbWaveformFunction
 * Purpose:   This function generates the arbitrary waveform function.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
 *            
 *            SCPI Command:
 *            AFG:ARBitrary:EMEM:GENerate 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_GenerateArbWaveformFunction (ViSession vi, 
                                                       ViInt32 Function, 
                                                       ViInt32 PointNumber)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi)); 
    
    if((PointNumber>131072)||(PointNumber<2))
    {
        viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);
    }
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        switch(Function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            {
                viCheckErr( viPrintf (io, "AFG:ARB:EMEM:GEN SINE,%d", PointNumber));
                break;
            }
            case TKDPO4K_VAL_WFM_SQUARE:
            {
                viCheckErr( viPrintf (io, "AFG:ARB:EMEM:GEN SQUARE,%d", PointNumber));
                break;
            }
            case TKDPO4K_VAL_WFM_PULSE:
            {
                viCheckErr( viPrintf (io, "AFG:ARB:EMEM:GEN PULSE,%d", PointNumber));
                break;
            }
            case TKDPO4K_VAL_WFM_RAMP:
            {
                viCheckErr( viPrintf (io, "AFG:ARB:EMEM:GEN RAMP,%d", PointNumber));
                break;
            }
            case TKDPO4K_VAL_WFM_NOISE:
            {
                viCheckErr( viPrintf (io, "AFG:ARB:EMEM:GEN NOISE,%d", PointNumber));
                break;
            }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);
        }
    }
    checkErr (tkdpo4k_CheckStatus (vi));                                  

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_CreateArbWaveform
 * Purpose:   This function creates an arbitrary waveform and returns a handle 
 *            that identifies that waveform.  You pass this handle to the 
 *            tkdpo4k_ConfigureArbWaveform function to configure that waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_CreateArbWaveform (ViSession vi, 
                                             ViInt32 wfmSize, 
                                             ViReal64 wfmData[], 
                                             ViInt32* wfmHandle)
{
    ViStatus error = VI_SUCCESS;
    ViInt32  newWfmHandle = VI_NULL;
    ViChar   *fmtData = VI_NULL; 
    ViInt32  i;
    ViInt32  pos = 0; 
   
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi)); 

    if (!wfmData)
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "NULL address for wfmData");

    if (!wfmHandle)
        viCheckParm ( IVI_ERROR_INVALID_PARAMETER, 4, "NULL address for wfmHandle");

    checkErr( tkdpo4k_VerifyWfmCreatable(vi, wfmSize, wfmData));
    checkErr( tkdpo4k_GetNewWfmInfo (vi, &newWfmHandle));
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

        checkErr( Ivi_Alloc (vi, 9 * wfmSize, (ViAddr *)(&fmtData))); 
        
        pos = sprintf(fmtData, "%08.6f", wfmData[0]);
        
        for (i = 1; i < wfmSize; i++)
        {
             pos += sprintf(fmtData + pos, ",%08.6f", wfmData[i]); 
        }
        
        viCheckErr ( viPrintf (io, "AFG:ARB:EMEM:POINTS %s", fmtData) ); 
    }

    checkErr( tkdpo4k_UpdateDriverWfmRecord (vi, newWfmHandle, wfmSize) );

    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    if (fmtData)
        Ivi_Free (vi, fmtData);

    /* if there is an error, do not return a handle. */
    if (error < VI_SUCCESS)
        newWfmHandle = VI_NULL;
    *wfmHandle = newWfmHandle;

    Ivi_UnlockSession (vi, VI_NULL);
    return error;    
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_ConfigureArbWaveform
 * Purpose:   This function configures the arbitrary waveform.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureArbWaveform (ViSession vi, 
                                                ViInt32 Handle, 
                                                ViReal64 Amplitude,
                                                ViReal64 Offset, 
                                                ViReal64 Frequency)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi)); 
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM,
              0, TKDPO4K_VAL_WFM_ARBITRARY));
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ARB_WAVEFORM_HANDLE,
                 0, Handle), 2, "Handle");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_AMPLITUDE,
                 0, Amplitude), 3, "Amplitude");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_DC_OFFSET,
                 0, Offset), 4, "Offset");
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_FREQUENCY,
                 0, Frequency), 5, "Frequency");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
                
/*******************************************************************************
 * Function:  tkdpo4k_ClearArbWaveform
 * Purpose:   This function removes a previously created arbitrary waveform from
 *            the function generator's memory and invalidates the waveform's handle.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series.
 *            2. Requires the MDO3AFG option to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ClearArbWaveform (ViSession vi, 
                                            ViInt32 wfmHandle)
{
    ViStatus  error = VI_SUCCESS;
    ViBoolean wfmExists;
    ViChar    wfmName[BUFFER_SIZE];
    ViInt32   maxWfms, i, currentHandle;

    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi)); 

    memset(wfmName, 0, sizeof(ViChar)*BUFFER_SIZE);

    if (wfmHandle != TKDPO4K_VAL_ALL_WAVEFORMS)
    {
        checkErr( tkdpo4k_VerifyWfmHandle (vi, wfmHandle) );
        checkErr( tkdpo4k_WfmExists (vi, wfmHandle, &wfmExists));
        if (!wfmExists)
           viCheckErrElab( IVI_ERROR_INVALID_VALUE,
                           "The waveform does not exist.");
        
        checkErr (tkdpo4k_ClearDriverWfmRecord(vi, wfmHandle));

    }
    else
    {
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS, 0, &maxWfms));

        for(i=0; i<maxWfms; i++)
        {
            currentHandle = TKDPO4K_WFM_HANDLE_FROM_INDEX(i);
            checkErr ( tkdpo4k_WfmExists (vi, currentHandle, &wfmExists) );
            if(wfmExists == VI_TRUE)
            {
                checkErr (tkdpo4k_ClearDriverWfmRecord(vi, wfmHandle)); 
            }
        }
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}               


/*===========================================================================*
 *= IviScope Digital Voltmeter Group Functions =============================*
 *===========================================================================*/         
            
/*******************************************************************************
 * Function:  tkdpo4k_ResetDigitalVoltmeter
 * Purpose:   This function resets the Digital Voltmeter measurements and history.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series. 
 *            2. Requires option MDO3DVM to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ResetDigitalVoltmeter (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    if (!Ivi_Simulating(vi))                /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi); /* call only when locked */

        viCheckErr( viPrintf (io, "DVM"));
    }                                  
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureDigitalVoltmeter
 * Purpose:   This function configures the Digital Voltmeter.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series. 
 *            2. Requires option MDO3DVM to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureDigitalVoltmeter (ViSession vi, 
                                                     ViInt32 Type, 
                                                     ViInt32 Source, 
                                                     ViBoolean AutoRange)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );     
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DVM_TYPE,
                 0, Type), 2, "Type");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DVM_SOURCE,
                 0, Source), 3, "Source");
    viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_DVM_RANGE_AUTO_ENABLED,
                 0, AutoRange), 4, "Auto Range");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ReadDigitalVoltmeter
 * Purpose:   This function reads the current value and frequency for the Digital 
 *            Voltmeter.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series. 
 *            2. Requires option MDO3DVM to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadDigitalVoltmeter (ViSession vi, 
                                                ViReal64 *Value, 
                                                ViReal64 *Frequency)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));    
    
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_RESULT,
                 0, Value), 2, "Value");
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_FREQUENCY,
                 0, Frequency), 3, "Frequency");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*******************************************************************************
 * Function:  tkdpo4k_ReadHistoryDVM
 * Purpose:   This function reads the readout value for the Digital Voltmeter 
 *            function over the history period.
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series. 
 *            2. Requires option MDO3DVM to be installed.
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadHistoryDVM (ViSession vi, 
                                          ViReal64 *Average, 
                                          ViReal64 *Maximum, 
                                          ViReal64 *Minimum)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));       
    
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_HISTORY_AVERAGE,
                 0, Average), 2, "Average");
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_HISTORY_MAXIMUM,
                 0, Maximum), 3, "Maximum");
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_HISTORY_MINIMUM,
                 0, Minimum), 4, "Minimum");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
/*******************************************************************************
 * Function:  tkdpo4k_ReadStatisticsDVM
 * Purpose:   This function reads the maximum and minimum DVM readout value over 
 *            the entire time that the DVM has been on since the last change using 
 *            ConfigureDigitalVoltmeter or ResetDigitalVoltmeter.   
 *            
 *            Notes:
 *            1. This function is only available for MDO3000 Series. 
 *            2. Requires option MDO3DVM to be installed. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ReadStatisticsDVM (ViSession vi, 
                                             ViReal64 *Maximum, 
                                             ViReal64 *Minimum)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi));       
    
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_MAX_RESULE,
                 0, Maximum), 2, "Maximum");
    viCheckParm( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DVM_MIN_RESULT,
                 0, Minimum), 3, "Minimum");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*===========================================================================*
 *= IviScope Action Event Group Functions =============================*
 *===========================================================================*/         
            
/*******************************************************************************
 * Function:  tkdpo4k_ConfigureEvent
 * Purpose:   This function configures the event.
 *            
 *            Note:
 *            This function is only available for MDO3000 Series. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureEvent (ViSession vi, 
                                          ViInt32 EventType, 
                                          ViInt32 AcquisitionNumber,
                                          ViInt32 RepeatCount)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_EVENT_TRIGGER_TYPE,
                 0, EventType), 2, "Event Type");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_NUMBER,
                 0, AcquisitionNumber), 3, "Acquisition Number");
    viCheckParm( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_EVENT_REPEAT_COUNT,
                 0, RepeatCount), 4, "Repeat Count");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}               
            
/*******************************************************************************
 * Function:  tkdpo4k_ConfigureEventEnabled
 * Purpose:   This function configures the event action state.
 *            
 *            Note:
 *            This function is only available for MDO3000 Series.
 *            
 *            SCPI Command:
 *            ACTONEVent:ACTION:AUXOUT:STATE
 *            ACTONEVent:ACTION:PRINT:STATE
 *            ACTONEVent:ACTION:SAVEIMAGE:STATE
 *            ACTONEVent:ACTION:SAVEWFM:STATE
 *            ACTONEVent:ACTION:SRQ:STATE
 *            ACTONEVent:ACTION:STOPACQ:STATE 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureEventEnabled (ViSession vi, 
                                                 ViInt32 EventAction, 
                                                 ViBoolean EventEnabled)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    viCheckErr(tkdpo4k_TestifyMDO3KModel(vi) );
    
    switch (EventAction)
    {
        case TKDPO4K_VAL_EVENT_ACTION_AUXOUT:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_AUX_OUT_EVENT_ENABLED,
                         0, EventEnabled), 2, "Auxiliary Out Enabled");
            break;
        }    
        case TKDPO4K_VAL_EVENT_ACTION_PRINT:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_PRINT_EVENT_ENABLED,
                         0, EventEnabled), 2, "Print Enabled");
            break;
        }        
        case TKDPO4K_VAL_EVENT_ACTION_SAVE_IMAGE:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_SAVE_IMAGE_EVENT_ENABLED,
                         0, EventEnabled), 2, "Save Image Enabled");
            break;
        }        
        case TKDPO4K_VAL_EVENT_ACTION_SAVE_WAVEFORM:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_SAVE_WAVEFORM_EVENT_ENABLED,
                         0, EventEnabled), 2, "Save Waveform Enabled");
            break;
        }        
        case TKDPO4K_VAL_EVENT_ACTION_SRQ:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_SRQ_EVENT_ENABLED,
                         0, EventEnabled), 2, "SRQ Enabled");
            break;
        }    
        case TKDPO4K_VAL_EVENT_ACTION_STOP_ACQ:
        {
            viCheckParm( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_STOP_ACQUISITION_EVENT_ENABLED,
                         0, EventEnabled), 2, "Stop Acquisition Enabled");
            break;
        }
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);
    }
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}
             
/*****************************************************************************
 *  Function: tkdpo4k_IsInvalidWfmElement
 *  Purpose:  This function takes one of the Waveform Array's element value
 *            that you obtain from the ReadWaveform or FetchWaveform function
 *            and determines if the value is a valid measurement value or a
 *            value indicating that the oscilloscope could not sample a
 *            voltage.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_IsInvalidWfmElement (ViSession vi,
                                                ViReal64 elementValue,
                                                ViBoolean *isInvalid)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     type;
    
    checkErr( Ivi_LockSession(vi, VI_NULL));
    
    if (isInvalid == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Is Invalid.");
    }
    
    viCheckErr( Ivi_GetViReal64Type (elementValue, &type));
    
    if (type == IVI_VAL_TYPE_NAN)
    {
        *isInvalid = VI_TRUE;
    }       
    else
    {
        *isInvalid = VI_FALSE;
    }       

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_SampleRate                                    
 * Purpose:  Returns the sample rate of the instrument. 
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_SampleRate (ViSession vi, ViReal64 *sampleRate)
{
    return ( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_SAMPLE_RATE,
                                       IVI_VAL_DIRECT_USER_CALL, sampleRate));
}

/*****************************************************************************
 * Function: tkdpo4k_SampleMode
 * Purpose:  Returns the sample mode of the instrument. 
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_SampleMode (ViSession vi, ViInt32 *mode)
{
    return ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SAMPLE_MODE,
                                      IVI_VAL_DIRECT_USER_CALL, mode));
}

/*****************************************************************************
 * Function: tkdpo4k_ConfigureInitiateContinuous                                     
 * Purpose:  This function configures the oscilloscope to perform a continuous 
 *           acquisition. 
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureInitiateContinuous (ViSession vi,
                                                        ViBoolean continuousAcquisition)
{
    return Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_INITIATE_CONTINUOUS,
                                      IVI_VAL_DIRECT_USER_CALL, continuousAcquisition); 
}

/*****************************************************************************
 * Function: tkdpo4k_ConfigureTriggerModifier                                     
 * Purpose:  This function configures the oscilloscope trigger modifier. 
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_ConfigureTriggerModifier (ViSession vi,
                                                    ViInt32 triggerModifier)
{
    return (Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_MODIFIER,
                                     IVI_VAL_DIRECT_USER_CALL, triggerModifier)); 
}

/*******************************************************************************
 * Function:  tkdpo4k_ConfigureAuxInTriggerLevel
 * Purpose:   This function configures the threshold voltage level when triggering on the auxiliary input waveform.
 *            
 *            Note:
 *            
 *            This function is not available for MDO Series oscilloscope models. 
*******************************************************************************/            
ViStatus _VI_FUNC tkdpo4k_ConfigureAuxInTriggerLevel (ViSession vi,
                                                      ViReal64 TriggerLevel)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_LockSession (vi, VI_NULL));
    
    
    viCheckParm( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN,
                 0, TriggerLevel), 2, "Trigger Level");                              
                 
    checkErr( tkdpo4k_CheckStatus (vi));

Error:
    Ivi_UnlockSession(vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_GetAttribute<type> Functions                                    
 * Purpose:  These functions enable the instrument driver user to get 
 *           attribute values directly.  There are typesafe versions for 
 *           ViInt32, ViReal64, ViString, ViBoolean, and ViSession attributes.                                         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetAttributeViInt32 (ViSession vi, ViConstString channelName, 
                                                ViAttr attributeId, ViInt32 *value)
{                                                                                                           
    return Ivi_GetAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                    value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_GetAttributeViReal64 (ViSession vi, ViConstString channelName, 
                                                 ViAttr attributeId, ViReal64 *value)
{                                                                                                           
    return Ivi_GetAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                     value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_GetAttributeViString (ViSession vi, ViConstString channelName, 
                                                 ViAttr attributeId, ViInt32 bufSize, 
                                                 ViChar value[]) 
{   
    return Ivi_GetAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                     bufSize, value);
}   
ViStatus _VI_FUNC tkdpo4k_GetAttributeViBoolean (ViSession vi, ViConstString channelName, 
                                                  ViAttr attributeId, ViBoolean *value)
{                                                                                                           
    return Ivi_GetAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                      value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_GetAttributeViSession (ViSession vi, ViConstString channelName, 
                                                  ViAttr attributeId, ViSession *value)
{                                                                                                           
    return Ivi_GetAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                      value);
}                                                                                                           

/*****************************************************************************
 * Function: tkdpo4k_SetAttribute<type> Functions                                    
 * Purpose:  These functions enable the instrument driver user to set 
 *           attribute values directly.  There are typesafe versions for 
 *           ViInt32, ViReal64, ViString, ViBoolean, and ViSession datatypes.                                         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_SetAttributeViInt32 (ViSession vi, ViConstString channelName, 
                                                ViAttr attributeId, ViInt32 value)
{                                                                                                           
    return Ivi_SetAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                    value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_SetAttributeViReal64 (ViSession vi, ViConstString channelName, 
                                                 ViAttr attributeId, ViReal64 value)
{                                                                                                           
    return Ivi_SetAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                     value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_SetAttributeViString (ViSession vi, ViConstString channelName, 
                                                 ViAttr attributeId, ViConstString value) 
{   
    return Ivi_SetAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                     value);
}   
ViStatus _VI_FUNC tkdpo4k_SetAttributeViBoolean (ViSession vi, ViConstString channelName, 
                                                  ViAttr attributeId, ViBoolean value)
{                                                                                                           
    return Ivi_SetAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                      value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_SetAttributeViSession (ViSession vi, ViConstString channelName, 
                                                  ViAttr attributeId, ViSession value)
{                                                                                                           
    return Ivi_SetAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, 
                                      value);
}                                                                                                           

/*****************************************************************************
 * Function: tkdpo4k_CheckAttribute<type> Functions                                  
 * Purpose:  These functions enable the instrument driver user to check  
 *           attribute values directly.  These functions check the value you
 *           specify even if you set the TKDPO4K_ATTR_RANGE_CHECK 
 *           attribute to VI_FALSE.  There are typesafe versions for ViInt32, 
 *           ViReal64, ViString, ViBoolean, and ViSession datatypes.                         
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_CheckAttributeViInt32 (ViSession vi, ViConstString channelName, 
                                                  ViAttr attributeId, ViInt32 value)
{                                                                                                           
    return Ivi_CheckAttributeViInt32 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, value);
}
ViStatus _VI_FUNC tkdpo4k_CheckAttributeViReal64 (ViSession vi, ViConstString channelName, 
                                                   ViAttr attributeId, ViReal64 value)
{                                                                                                           
    return Ivi_CheckAttributeViReal64 (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_CheckAttributeViString (ViSession vi, ViConstString channelName, 
                                                   ViAttr attributeId, ViConstString value)  
{   
    return Ivi_CheckAttributeViString (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, value);
}   
ViStatus _VI_FUNC tkdpo4k_CheckAttributeViBoolean (ViSession vi, ViConstString channelName, 
                                                    ViAttr attributeId, ViBoolean value)
{                                                                                                           
    return Ivi_CheckAttributeViBoolean (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, value);
}                                                                                                           
ViStatus _VI_FUNC tkdpo4k_CheckAttributeViSession (ViSession vi, ViConstString channelName, 
                                                    ViAttr attributeId, ViSession value)
{                                                                                                           
    return Ivi_CheckAttributeViSession (vi, channelName, attributeId, IVI_VAL_DIRECT_USER_CALL, value);
}                                                                                                           

/**************************************************************************** 
 *  Function: tkdpo4k_GetNextCoercionRecord                            
 *  Purpose:  Get the next coercion record from the queue.           
 ****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetNextCoercionRecord (ViSession vi, ViInt32 bufferSize, ViChar record[])
{
    return Ivi_GetNextCoercionString (vi, bufferSize, record);
}

/*****************************************************************************
 * Function: tkdpo4k_LockSession and tkdpo4k_UnlockSession Functions                        
 * Purpose:  These functions enable the instrument driver user to lock the 
 *           session around a sequence of driver calls during which other
 *           execution threads must not disturb the instrument state.
 *                                                                          
 *           NOTE:  The callerHasLock parameter must be a local variable 
 *           initialized to VI_FALSE and passed by reference, or you can pass 
 *           VI_NULL.                     
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_LockSession (ViSession vi, ViBoolean *callerHasLock)  
{                                              
    return Ivi_LockSession(vi, callerHasLock);      
}                                              
ViStatus _VI_FUNC tkdpo4k_UnlockSession (ViSession vi, ViBoolean *callerHasLock) 
{                                              
    return Ivi_UnlockSession(vi, callerHasLock);    
}   

/**************************************************************************** 
 *  Function: tkdpo4k_GetNextInterchangeWarning,
 *            tkdpo4k_ResetInterchangeCheck, and
 *            tkdpo4k_ClearInterchangeWarnings
 *  Purpose:  These functions allow the user to retrieve interchangeability
 *            warnings, reset the driver's interchangeability checking 
 *            state, and clear all previously logged interchangeability warnings.
 ****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetNextInterchangeWarning (ViSession vi, 
                                                      ViInt32 bufferSize, 
                                                      ViChar warnString[])
{
    return Ivi_GetNextInterchangeCheckString (vi, bufferSize, warnString);
}

ViStatus _VI_FUNC tkdpo4k_ResetInterchangeCheck (ViSession vi)
{
    return Ivi_ResetInterchangeCheck (vi);
}

ViStatus _VI_FUNC tkdpo4k_ClearInterchangeWarnings (ViSession vi)
{
    return Ivi_ClearInterchangeWarnings (vi);
}

/*****************************************************************************
 * Function: tkdpo4k_GetError and tkdpo4k_ClearError Functions                       
 * Purpose:  These functions enable the instrument driver user to  
 *           get or clear the error information the driver associates with the
 *           IVI session.                                                        
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetError (ViSession vi, 
                                     ViStatus *errorCode, 
                                     ViInt32 bufferSize,
                                     ViChar description[])  
{
    ViStatus error = VI_SUCCESS;
    ViStatus primary = VI_SUCCESS,
             secondary = VI_SUCCESS;
    ViChar   elaboration[256] = "";
    ViChar   errorMessage[1024] = "";
    ViChar  *appendPoint = errorMessage;
    ViInt32  actualSize = 0;
    ViBoolean locked = VI_FALSE;

    /* Lock Session */
    if (vi != 0)
        {
        checkErr( Ivi_LockSession(vi, &locked));
        }

    /* Test for nulls and acquire error data */
    if (bufferSize != 0)
        {
        if (errorCode == VI_NULL)
            {
            viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for Error");
            }
        if (description == VI_NULL)
            {
            viCheckParm( IVI_ERROR_INVALID_PARAMETER, 4, "Null address for Description");
            }
        checkErr( Ivi_GetErrorInfo (vi, &primary, &secondary, elaboration));
        }

    else
        {
        checkErr( Ivi_GetAttributeViString(vi, VI_NULL, IVI_ATTR_ERROR_ELABORATION, 0, 256, elaboration));
        checkErr( Ivi_GetAttributeViInt32(vi, VI_NULL, IVI_ATTR_SECONDARY_ERROR, 0, &secondary));
        checkErr( Ivi_GetAttributeViInt32(vi, VI_NULL, IVI_ATTR_PRIMARY_ERROR, 0, &primary));
        }
        
    /* Format data */
    if (primary != VI_SUCCESS)
        {
        ViChar msg[256] = "";
        checkErr( tkdpo4k_error_message (vi, primary, msg));
        appendPoint += sprintf(appendPoint, "Primary Error: (Hex 0x%08X) %s", primary, msg);
        }
    
    if (secondary != VI_SUCCESS)
        {
        ViChar msg[256] = "";
        checkErr( tkdpo4k_error_message (vi, secondary, msg));
        appendPoint += sprintf(appendPoint, "\nSecondary Error: (Hex 0x%08X) %s", secondary, msg);
        }
    
    if (elaboration[0])
        {
        sprintf(appendPoint, "\nElaboration: %s", elaboration);
        }
    
    actualSize = (ViInt32)strlen(errorMessage) + 1;
    
    /* Prepare return values */
    if (bufferSize == 0)
        {
        error = actualSize;
        }
    else 
        {
        if (bufferSize > 0)
            {
            if (actualSize > bufferSize)
                {
                error = actualSize;
                actualSize = bufferSize;
                }
            }
        memcpy(description, errorMessage, actualSize-1);
        description[actualSize-1] = '\0';
        }
    
    if (errorCode) 
        {
        *errorCode = primary;
        }
    
Error:
    /* Unlock Session */
    Ivi_UnlockSession (vi, &locked);
    return error;
}   

ViStatus _VI_FUNC tkdpo4k_ClearError (ViSession vi)                                                        
{                                                                                                           
    return Ivi_ClearErrorInfo (vi);                                                                             
}

/*****************************************************************************
 * Function: viWrite and viRead Functions
 * Purpose:  These functions enable the instrument driver user to
 *           write and read commands directly to and from the instrument.
 * 
 *           Notes: 1) These functions bypass the IVI attribute state caching.  
 *                  viWrite invalidates the cached values for all
 *                  attributes.
 *                  2) These functions are supported with the IVI Compliance
 *                  Package (ICP) 4.6.1 and later. If you are using an
 *                  earlier version of ICP, you can still use the tkdpo4k_WriteInstrData
 *                  and tkdpo4k_ReadInstrData functions under the Obsolete folder.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_viWrite (ViSession vi, ViByte buffer[], ViInt64 count, ViInt64 *returnCount)
{
    return Ivi_viWrite (vi, buffer, count, returnCount);
}
ViStatus _VI_FUNC tkdpo4k_viRead (ViSession vi, ViInt64 bufferSize, ViByte buffer[], ViInt64 *returnCount)
{
    return Ivi_viRead (vi, bufferSize, buffer, returnCount);
}

/*****************************************************************************
 * Function: WriteInstrData and ReadInstrData Functions                      
 * Purpose:  These functions enable the instrument driver user to  
 *           write and read commands directly to and from the instrument.            
 *                                                                           
 *           Notes: 1) These functions bypass the IVI attribute state caching.
 *                  WriteInstrData invalidates the cached values for all
 *                  attributes.
 *                  2) These functions are obsolete since IVI Compliance
 *                  Package (ICP) 4.6.1. You can use tkdpo4k_viWrite
 *                  and tkdpo4k_viRead instead.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_WriteInstrData (ViSession vi, ViConstString writeBuffer)   
{   
    return Ivi_WriteInstrData (vi, writeBuffer);    
}   
ViStatus _VI_FUNC tkdpo4k_ReadInstrData (ViSession vi, ViInt32 numBytes, 
                                          ViChar rdBuf[], ViInt32 *bytesRead)  
{   
    return Ivi_ReadInstrData (vi, numBytes, rdBuf, bytesRead);   
} 

/*****************************************************************************
 * Function: tkdpo4k_CreateArbRecords
 * Purpose:  This utility function creates new array of waveform structures 
 *           and assigns pointers to the arrays to the hidden attributes 
 *           TKDPO4K_ATTR_WFM_STRUCTURE.  This function is called from 
 *           the tkdpo4k_InitAttributes function as part of the initialization 
 *           of the driver.
 *****************************************************************************/
static ViStatus tkdpo4k_CreateArbRecords (ViSession vi)
{
    ViStatus   error = VI_SUCCESS;
    ViInt32    maxNumWfms;
    wfmNodePtr newWfmStruct = VI_NULL;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS,
                                       0, &maxNumWfms));

    checkErr( Ivi_Alloc (vi, ((ViInt32)sizeof(wfmNode))*maxNumWfms,  (ViAddr *)(&newWfmStruct)));

    checkErr( Ivi_SetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      0, (ViAddr)newWfmStruct));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_GetNumDefinedWaveforms
 * Purpose:  This utility function returns the number of arbitrary waveforms
 *           the user has created.
 *****************************************************************************/
static ViStatus tkdpo4k_GetNumDefinedWaveforms (ViSession vi, 
                                                ViInt32 *numWfms)
{
    ViStatus error = VI_SUCCESS;
    ViInt32  maxNumWfms, tmpNumWfms = 0;
    ViInt16  i;

    wfmNodePtr wfmStruct = VI_NULL;

    checkErr( Ivi_GetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      0, (ViAddr *)(&wfmStruct)));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS,
                                       0, &maxNumWfms));

    /* Determine the current number of defined waveforms */
    for (i = 0; i < maxNumWfms; i++)
    {
        if (wfmStruct[i].wfmSize)
            tmpNumWfms++;
    }

Error:
    if (error < VI_SUCCESS)
        *numWfms = 0;
    else
        *numWfms = tmpNumWfms;
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_VerifyWfmCreatable
 * Purpose:  This utility function verifies that a user-specified waveform is
 *           of valid size, that the data in the waveform is valid, and that
 *           there is memory available for the new waveform.
 *****************************************************************************/
static ViStatus tkdpo4k_VerifyWfmCreatable (ViSession vi, 
                                            ViInt32 wfmSize,
                                            ViReal64 wfmData[])
{
    ViStatus error = VI_SUCCESS;
    ViInt32 maxWfms, currentWfms, wfmQuantum, minWfmSize, maxWfmSize, i, compare = 0;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS, 0, &maxWfms));

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_WAVEFORM_QUANTUM, 0, &wfmQuantum));

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MIN_WAVEFORM_SIZE, 0, &minWfmSize));

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_WAVEFORM_SIZE, 0, &maxWfmSize));

    checkErr( tkdpo4k_GetNumDefinedWaveforms (vi, &currentWfms));

    if (currentWfms >= maxWfms)
        viCheckErrElab( TKDPO4K_ERROR_NO_WFMS_AVAILABLE,
                                    "There is no free waveform structure to create new waveform.");

    if ((wfmSize < minWfmSize) || (wfmSize > maxWfmSize) || (wfmSize % wfmQuantum))
        viCheckErrElab( IVI_ERROR_INVALID_VALUE, "Invalid Waveform Length");

    for (i = 0; i < wfmSize; i++)
    {
        viCheckErr( Ivi_CompareWithPrecision(4, fabs(wfmData[i]), 1.0, &compare));
        if (compare > 0)
            break;
    }

    if (compare > 0)
    {
        ViChar errElab[BUFFER_SIZE];
        sprintf (errElab, "Element number %d = %.3lf of the waveform is not valid.", i, wfmData[i]);
        viCheckErrElab( IVI_ERROR_INVALID_VALUE, errElab);
    }

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_GetNewWfmInfo
 * Purpose:  This utility function determines the handle for a new waveform
 *           from the number of current user-defined waveforms.
 *****************************************************************************/
static ViStatus tkdpo4k_GetNewWfmInfo (ViSession vi, 
                                       ViInt32 *wfmHandle)
{
    ViStatus   error = VI_SUCCESS;
    ViInt32    tmpHandle = 0, maxWfms, i;
    wfmNodePtr wfmRecord = VI_NULL;

    checkErr( Ivi_GetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE, 0, (ViAddr *)&wfmRecord));

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS, 0, &maxWfms));

    for (i = 0; i < maxWfms; i++)
    {
        if (!(wfmRecord[i].wfmSize))
        {
            tmpHandle = i;
            break;
        }
    }

    tmpHandle = TKDPO4K_WFM_HANDLE_FROM_INDEX(tmpHandle);

Error:
    *wfmHandle = tmpHandle;
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_UpdateDriverWfmRecord
 * Purpose:  This utility function updates an element of an existing waveform
 *           data structure to reflect a newly created waveform.
 *****************************************************************************/
static ViStatus tkdpo4k_UpdateDriverWfmRecord (ViSession vi, 
                                               ViInt32 wfmHandle, 
                                               ViInt32 wfmSize)
{
    ViStatus   error = VI_SUCCESS;
    ViInt32    index;
    wfmNodePtr wfmRecord = VI_NULL;

    checkErr( Ivi_GetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      0, (ViAddr *)&wfmRecord));
    index = TKDPO4K_WFM_INDEX_FROM_HANDLE(wfmHandle);
    wfmRecord[index].wfmSize = wfmSize;

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_WfmExists
 * Purpose:  This utilitiy function checks whether a waveform exists.
 *****************************************************************************/
static ViStatus tkdpo4k_WfmExists (ViSession vi, 
                                   ViInt32 wfmHandle, 
                                   ViBoolean *wfmExists)
{
    ViStatus   error = VI_SUCCESS;
    ViInt32    index, maxWfms;
    wfmNodePtr wfmRecord = VI_NULL;

    checkErr( Ivi_GetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      0, (ViAddr *)&wfmRecord));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS,
                                       0, &maxWfms));

    if ((wfmHandle > (TKDPO4K_VAL_LAST_WAVEFORM_HANDLE)) ||
                                (wfmHandle < (TKDPO4K_VAL_FIRST_WAVEFORM_HANDLE)))
    {
        *wfmExists = VI_FALSE;
    }
    else
    {
        index =  TKDPO4K_WFM_INDEX_FROM_HANDLE(wfmHandle);
        *wfmExists = wfmRecord[index].wfmSize != 0;
    }

Error:
    if (error < VI_SUCCESS)
    {
        *wfmExists = VI_FALSE;
    }
    return error;
}

/*****************************************************************************
 * Function: tkafg3k_VerifyWfmHandle
 * Purpose:  This utility function determines if passed waveform handle is
 *           valid.
 *****************************************************************************/
static ViStatus tkdpo4k_VerifyWfmHandle (ViSession vi, 
                                         ViInt32 wfmHandle)
{
    ViStatus   error = VI_SUCCESS;
    if(wfmHandle!=TKDPO4K_VAL_FIRST_WAVEFORM_HANDLE)
    {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
    }

Error:
    return error;
}

/*****************************************************************************
 * Function: tkafg3k_ClearDriverWfmRecord
 * Purpose:  This utility function clears the data in an existing waveform
 *           data structure.  If the waveform's handle parameter is
 *           TKAFG3K_VAL_ALL_WAVEFORMS, the function clears the
 *           data in all waveform data structures for the session.
 *****************************************************************************/
static ViStatus tkdpo4k_ClearDriverWfmRecord (ViSession vi, 
                                              ViInt32 wfmHandle)
{
    ViStatus   error = VI_SUCCESS;
    ViInt32    index, maxWfms;
    wfmNodePtr wfmRecord = VI_NULL;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS,
                                       0, &maxWfms));
    checkErr( Ivi_GetAttributeViAddr (vi, VI_NULL, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      0, (ViAddr *)&wfmRecord));

    if (wfmHandle == TKDPO4K_VAL_ALL_WAVEFORMS)
    {
        memset (wfmRecord, 0, (sizeof(wfmNode)*maxWfms));
    }
    else
    {
        index = TKDPO4K_WFM_INDEX_FROM_HANDLE(wfmHandle);
        wfmRecord[index].wfmSize = 0;
        wfmRecord[index].wfmName[0] = '\0';
    }

Error:
    return error;
}

/****************************************************************************
 *--------- Obsolete Inherent functions ------------------------------------*
 ****************************************************************************/
/*****************************************************************************
 * Function: tkdpo4k_GetErrorInfo and tkdpo4k_ClearErrorInfo Functions                       
 * Purpose:  These functions enable the instrument driver user to  
 *           get or clear the error information the driver associates with the
 *           IVI session.                                                        
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_GetErrorInfo (ViSession vi, ViStatus *primaryError, 
                                         ViStatus *secondaryError, ViChar errorElaboration[256])  
{                                                                                                           
    return Ivi_GetErrorInfo(vi, primaryError, secondaryError, errorElaboration);                                
}                                                                                                           

ViStatus _VI_FUNC tkdpo4k_ClearErrorInfo (ViSession vi)                                                        
{                                                                                                           
    return Ivi_ClearErrorInfo (vi);                                                                             
}

/*****************************************************************************
 *-------------------- Utility Functions (Not Exported) ---------------------*
 *****************************************************************************/

/*****************************************************************************
 *  Function: tkdpo4k_BuildChannelList
 *  Purpose:  This function build channel list for special instrument model.
 *****************************************************************************/
static ViStatus tkdpo4k_BuildChannelList (ViInt32 model, ViChar channelList[])
{
    ViStatus error = VI_SUCCESS;
    int pos = 0;
    
    if( (model == TKDPO4K_VAL_DPO_4104)
        || (model == TKDPO4K_VAL_DPO_4054)
            || (model == TKDPO4K_VAL_DPO_4034)
                || (model == TKDPO4K_VAL_DPO_4104B)
                    || (model == TKDPO4K_VAL_DPO_4054B)
                        || (model == TKDPO4K_VAL_DPO_4034B)
                            || (model == TKDPO4K_VAL_DPO_4104B_L)
                                || (model == TKDPO4K_VAL_DPO_4014B))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_4);
    }           
    else if((model == TKDPO4K_VAL_DPO_4032)
            || (model == TKDPO4K_VAL_DPO_4102B)
               || (model == TKDPO4K_VAL_DPO_4102B_L))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_2);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_2);
    }
    else if( (model == TKDPO4K_VAL_MSO_4104)
                || (model == TKDPO4K_VAL_MSO_4054)
                    || (model == TKDPO4K_VAL_MSO_4034) 
                        || (model == TKDPO4K_VAL_MSO_3014)
                            || (model == TKDPO4K_VAL_MSO_3034)
                                || (model == TKDPO4K_VAL_MSO_3054)
                                    || (model == TKDPO4K_VAL_MSO_4104B)
                                        || (model == TKDPO4K_VAL_MSO_4054B)
                                            || (model == TKDPO4K_VAL_MSO_4034B)  
                                                || (model == TKDPO4K_VAL_MSO_4104B_L)
                                                    || (model == TKDPO4K_VAL_MSO_4014B))  
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s,", DIGITAL_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_4);
    }
    else if(model == TKDPO4K_VAL_MSO_4032
               || (model == TKDPO4K_VAL_MSO_3012)
                   || (model == TKDPO4K_VAL_MSO_3032)
                       || (model == TKDPO4K_VAL_MSO_3052)
                           || (model == TKDPO4K_VAL_MSO_4102B)
                               || (model == TKDPO4K_VAL_MSO_4102B_L))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_2);
        pos += sprintf(channelList+pos, "%s,", DIGITAL_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_2);
    }
    else if( (model == TKDPO4K_VAL_DPO_3012)
                || (model == TKDPO4K_VAL_DPO_3032)
                    || (model == TKDPO4K_VAL_DPO_3052) )
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_2);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_2);
    }
    else if( (model == TKDPO4K_VAL_DPO_3014)
                || (model == TKDPO4K_VAL_DPO_3034)
                    || (model == TKDPO4K_VAL_DPO_3054) )
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s", VIRTUAL_CHANNEL_LIST_4);
    }
    else if( (model == TKDPO4K_VAL_MDO_41046)
          || (model == TKDPO4K_VAL_MDO_41043)
          || (model == TKDPO4K_VAL_MDO_40546)
		  || (model == TKDPO4K_VAL_MDO_40543)
          || (model == TKDPO4K_VAL_MDO_4014_3)
          || (model == TKDPO4K_VAL_MDO_4034_3)
          || (model == TKDPO4K_VAL_MDO_4014B_3)
          || (model == TKDPO4K_VAL_MDO_4034B_3)
          || (model == TKDPO4K_VAL_MDO_4054B_3)
          || (model == TKDPO4K_VAL_MDO_4054B_6)
          || (model == TKDPO4K_VAL_MDO_4104B_3)
          || (model == TKDPO4K_VAL_MDO_4104B_6)
		  || (model == TKDPO4K_VAL_MDO_4024C)
		  || (model == TKDPO4K_VAL_MDO_4034C)
		  || (model == TKDPO4K_VAL_MDO_4054C)
		  || (model == TKDPO4K_VAL_MDO_4104C))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s,", DIGITAL_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s,", VIRTUAL_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s,", RF_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s",  RF_CHANNEL_SOURCE_LIST);
    }
    else if( (model == TKDPO4K_VAL_MDO_3012)
                || (model == TKDPO4K_VAL_MDO_3022)
                    || (model == TKDPO4K_VAL_MDO_3032)
                        || (model == TKDPO4K_VAL_MDO_3052)
                            || (model == TKDPO4K_VAL_MDO_3102))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_2);
        pos += sprintf(channelList+pos, "%s,", DIGITAL_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s,", VIRTUAL_CHANNEL_LIST_2);
        pos += sprintf(channelList+pos, "%s,", RF_CHANNEL_LIST);  
        pos += sprintf(channelList+pos, "%s",  RF_CHANNEL_SOURCE_LIST);          
    }
    else if( (model == TKDPO4K_VAL_MDO_3014)
                || (model == TKDPO4K_VAL_MDO_3024)
                    || (model == TKDPO4K_VAL_MDO_3034)
                        || (model == TKDPO4K_VAL_MDO_3054)
                            || (model == TKDPO4K_VAL_MDO_3104))
    {
        pos += sprintf(channelList+pos, "%s,", ANALOG_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s,", DIGITAL_CHANNEL_LIST);
        pos += sprintf(channelList+pos, "%s,", VIRTUAL_CHANNEL_LIST_4);
        pos += sprintf(channelList+pos, "%s,", RF_CHANNEL_LIST);  
        pos += sprintf(channelList+pos, "%s",  RF_CHANNEL_SOURCE_LIST);  
    }
    else
    {
        checkErr(IVI_ERROR_INVALID_PARAMETER);  
    }
 
Error:
    return error;   
}

/*****************************************************************************
 *  Function: tkdpo4k_GetProbeAttenuation
 *  Purpose:  This function always returns the actual probe attenuation.
 *****************************************************************************/
static ViStatus tkdpo4k_GetProbeAttenuation (ViSession vi, 
                                              ViConstString channelName, 
                                              ViReal64 *value)
{
    ViStatus   error = VI_SUCCESS;
    ViReal64   probeAttenuation;
    ViInt32    notProbeSensing;

    checkErr( Ivi_GetAttributeViReal64 (vi, channelName, 
                                        TKDPO4K_ATTR_PROBE_ATTENUATION,
                                        0, &probeAttenuation));
    viCheckErr( Ivi_CompareWithPrecision (0, probeAttenuation, 
                                          TKDPO4K_VAL_PROBE_SENSE_ON, 
                                          &notProbeSensing));
    if (notProbeSensing == 0)   /* probe auto sense is turned on */
    checkErr( Ivi_GetAttributeViReal64 (vi, channelName, 
                                        TKDPO4K_ATTR_PROBE_SENSE_VALUE,
                                        0, &probeAttenuation));
    *value = probeAttenuation;
     
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_SetCachingOnProbeDependentAttributes
 *  Purpose:  This function alters the state of the IVI_VAL_NEVER_CACHE
 *            flag of the probe dependent attributes based on the state
 *            parameter.
 *****************************************************************************/
static ViStatus tkdpo4k_SetCachingOnProbeDependentAttributes (ViSession vi, 
                                                               ViBoolean cache)
{
    ViStatus    error = VI_SUCCESS;

    checkErr (tkdpo4k_ChangeOneAttributeFlag (vi, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                               IVI_VAL_NEVER_CACHE, (ViBoolean)!cache));
    checkErr (tkdpo4k_ChangeOneAttributeFlag (vi, TKDPO4K_ATTR_VERTICAL_OFFSET, 
                                               IVI_VAL_NEVER_CACHE, (ViBoolean)!cache));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_changeRangeWithPrecision                                  
 * Purpose:  This function verifies that the value is not less than the min
 *           and not greater than the max.  The function uses the comparison precision
 *           for the attribute identified by attributeId for the comparison.
 *           If the value is less than min or greater than max, the function
 *           return if the value returns IVI_ERROR_INVALID_VALUE.
 *****************************************************************************/
static ViStatus tkdpo4k_CheckRangeWithPrecision (ViSession vi, ViAttr attributeId, 
                                                  ViReal64 value, ViReal64 min, 
                                                  ViReal64 max)
{
    ViStatus error = VI_SUCCESS;
    ViInt32  comparePrecision;
    ViInt32  compareResult;
    
    checkErr( Ivi_GetAttrComparePrecision (vi, attributeId, &comparePrecision));

    viCheckErr( Ivi_CompareWithPrecision (comparePrecision, value, min, &compareResult));
    if (compareResult == -1)
        viCheckErr( IVI_ERROR_INVALID_VALUE);

    viCheckErr( Ivi_CompareWithPrecision (comparePrecision, value, max, &compareResult));
    if (compareResult == 1)
        viCheckErr( IVI_ERROR_INVALID_VALUE);

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_CoerceToResolution                                     
 * Purpose:  Coerce a given value to the next highest step using a given step 
 *           value.                                                                                                    
 *****************************************************************************/
static ViStatus tkdpo4k_CoerceToResolution (ViSession vi, ViReal64 value, 
                                             ViReal64 resolution, 
                                             ViInt32 comparePrecision, 
                                             ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 absValue;
    ViReal64 newValue = value;
    ViReal64 resMultiplier;
    ViInt32  compareResult;
    
    if (resolution <= 0.0)
        viCheckErr( IVI_ERROR_INVALID_VALUE);    

    absValue = fabs (value);

    modf (absValue/resolution, &resMultiplier);
    Ivi_CompareWithPrecision (comparePrecision, resMultiplier, absValue/resolution, &compareResult);
    if (compareResult)
        resMultiplier = ceil (absValue/resolution);

    newValue = resolution * resMultiplier;

    if (value < 0.0)
        newValue *= -1.0;

Error:
    *coercedValue = newValue;
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchContinuousWaveform
 *  Purpose:  This function fetches a waveform from a specified channel and 
 *            optinally return ActualPoints(Number of points actually acquired
 *            in waveform), InitialX(The time in relation to the Trigger Event
 *            of the first point in the waveform in seconds), XIncrement(The 
 *            time between points in the acquired waveform in seconds). The 
 *            function is used only when the instrument runs in continuous 
 *            mode and is in running state.
 *
 *  Note:     There is no guarantee that the waveform fetched by this function
 *            is the latest one acquired by instrument. While using in loops 
 *            to repeatedly acquiring waveform, it is possible that several
 *            fetched waveform is from the same acquisition.
 *            
 *            Call this function only when TKDPO4K_ATTR_ACQUISITION_TYPE is
 *            TKDPO4K_VAL_NORMAL, TKDPO4K_VAL_HI_RES or TKDPO4K_VAL_AVERAGE.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchContinuousWaveform (ViSession vi, 
                                                    ViConstString channel, 
                                                    ViReal64 waveform[],
                                                    ViInt32 *actualPointsRef,
                                                    ViReal64 *initialXRef, 
                                                    ViReal64 *xIncrementRef)
{
    ViStatus      error = VI_SUCCESS;
    ViInt32       actualPoints;
    ViReal64      xIncrement, initialX;
    ViConstString dataSource;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName (vi, channel, &dataSource), 2, "Invalid Channel");

    if (waveform == VI_NULL)
    {    
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for Waveform");
    }  
    
        /* Fetch Waveform */
    if (!Ivi_Simulating (vi))                   /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */
        ViReal64    yZero, yOffset, yMultiplier;
        
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));

        checkErr( tkdpo4k_FetchContinuousRawWaveform (vi, io, dataSource, &yZero, &yOffset, &yMultiplier, 
                                                        xIncrementRef, initialXRef, waveform, 
                                                        &actualPoints));
        
        tkdpo4k_ScaleRawWaveform (actualPoints, waveform, yZero, yOffset, yMultiplier);
        if(actualPointsRef)
        {
            *actualPointsRef = actualPoints;
        }
    }
    else
    {
        ViInt32     x;
        ViReal64    yRange, simOffset = 0.0;
        ViInt32     triggerSlope, vCoup;
        ViReal64    k, level, theta, offset;
        ViChar      channel[BUFFER_SIZE] = {0};
        ViInt32     waveformSize;

        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                           0, &actualPoints));
        checkErr( Ivi_GetAttributeViString (vi, VI_NULL, 
                                            TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                            0, BUFFER_SIZE, channel) );
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, 
                                            TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &yRange)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, channel, 
                                           TKDPO4K_ATTR_VERTICAL_COUPLING, 
                                           0, &vCoup));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, 
                                            TKDPO4K_ATTR_VERTICAL_OFFSET, 
                                            0, &offset)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_TRIGGER_SLOPE, 
                                           0, &triggerSlope));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                            0, &level));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            0, &xIncrement));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, 
                                            TKDPO4K_ATTR_ACQUISITION_START_TIME, 
                                            0, &initialX));
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL,
                                            TKDPO4K_ATTR_WAVEFORM_SIZE, 
                                            0, &waveformSize));
                                            
        theta = asin (2*level/yRange);
        if (triggerSlope == TKDPO4K_VAL_POSITIVE)
        {
            k = 1.0;
        }           
        else 
        {
            k = -1.0;
        }           
        if( actualPoints>waveformSize ) 
            actualPoints = waveformSize;  /* Checking number of points to write */
        xIncrement /= actualPoints;

        if (vCoup == TKDPO4K_VAL_DC)
            simOffset = 0.5;
        if (vCoup == TKDPO4K_VAL_GND)
            simOffset = 0.0;     /* i changed this variable from K to simOffset */
            
        for (x = 0; x < actualPoints; x++)
        {
            ViReal64 y = simOffset + k * 2.5 * sin (xIncrement * 12560 * x + k * theta) + /* ~2 periods of 1kHz sinewave */
                            (!(x%20)) * (16384 - rand())/150000.0;
            waveform[x] = (offset + yRange/2) > y ? ((offset - yRange/2) < y ? y : (offset - yRange/2)) : (offset + yRange/2);
        }  
        
        if(actualPointsRef)
        {
            *actualPointsRef = actualPoints;        
        }
        if(initialXRef)
        {
            *initialXRef = initialX;        
        }
        if(xIncrementRef)
        {
            *xIncrementRef = xIncrement;        
        }
    }
    
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;   
}

/*****************************************************************************
 * Function: tkdpo4k_FetchContinuousRawWaveform 
 * Purpose:  This function fetches and returns an unscaled waveform in 
 *           condition that the instrument runs in continuous mode. The 
 *           waveform can be fetched from an input channel(CH1-CH4), a 
 *           reference channel (REF1-REF4), or a math channel MATH. To transfer 
 *           less data than the horizontal record length,  This 
 *           may be desired if Extended Acqusition mode is enabled, but you do 
 *           not want to transfer that much data.
 * NOTE:     Call this only when NOT Simulating.   
 *****************************************************************************/
static ViStatus tkdpo4k_FetchContinuousRawWaveform (ViSession vi, ViSession io, 
                                                       ViConstString dataSource,
                                                       ViReal64 *yZero,
                                                       ViReal64 *yOffset, 
                                                       ViReal64 *yMultiplier,
                                                       ViReal64 *xIncrement, 
                                                       ViReal64 *initialX, 
                                                       ViReal64 waveform[],
                                                       ViInt32 *actualPoints)
{
    ViStatus  error = VI_SUCCESS;
    ViInt32   dataWidth = 1;
    ViInt32   bytesRead, numDigits, numDataBytes;
    ViInt32   numReadings, totalBytesRead;
    ViInt32   bufferSize;
    ViChar*   rdBuffer = VI_NULL;
    ViReal64  *data = waveform;
    ViBoolean doneWithRead;
    ViInt32   waveformSize;
    ViInt32   lastReadBytes=0; 
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FETCH_BUFFER_SIZE, 0, &bufferSize) );
    checkErr( Ivi_Alloc(vi, bufferSize, (ViAddr*)&rdBuffer) );
    
    checkErr( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_INPUT_DATA_SOURCE, 0, dataSource)); 
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, &dataWidth) ); 

    /* Replace ":WFMPRE:YZE?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;" */
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YZERO, 0, yZero) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YOFF, 0, yOffset) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YMULT, 0, yMultiplier) );
    if(xIncrement)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR, 0, xIncrement) );     
    }
    if(initialX)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO, 0, initialX) );           
    }
        
        /* Waveform Query */
    viCheckErr( viPrintf (io, "%s", ":CURV?"));
    
         /* Read how many digits make up the entry for number of bytes */
    viCheckErr( viRead (io, rdBuffer, 2, &bytesRead));
    rdBuffer[bytesRead] = 0;
    //if (Scan (rdBuffer, "%s>#%i", &numDigits) != 1) 
	if (sscanf(rdBuffer, "%s>#%i", &numDigits) != 1)
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }
    
        /* Read how many bytes make up the data */
    viCheckErr( viRead (io, rdBuffer, numDigits, &bytesRead));
    rdBuffer[bytesRead] = 0;
    //if (Scan (rdBuffer, "%s>%i", &numDataBytes) != 1) 
	if (sscanf(rdBuffer, "%s>%i", &numDataBytes) != 1)
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }
    
        /* Calculate the Number of Readings */
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_WAVEFORM_SIZE, 0, &waveformSize) );
    numReadings = numDataBytes/dataWidth;
    if (numReadings > waveformSize)
    {
        numReadings = waveformSize;
        numDataBytes = numReadings * dataWidth;
    }
    *actualPoints = numReadings;
    
        /* Read the Data into the Array */
    totalBytesRead = 0;
    doneWithRead = VI_FALSE;
    while (!doneWithRead)
    {
        viCheckErr( viRead (io, rdBuffer, bufferSize, &bytesRead));
        
        if (totalBytesRead + bytesRead >= numDataBytes)
        {
            lastReadBytes = bytesRead;
            bytesRead = numDataBytes - totalBytesRead;
            doneWithRead = VI_TRUE;
        }
        
        totalBytesRead += bytesRead;
        if (dataWidth == 1)
        {
            if (Scan (rdBuffer, "%*i[zb1]>%*f",bytesRead, bytesRead, data)!= 1)
            {                       
                viCheckErr( VI_ERROR_INV_RESPONSE);
            }
        }
        else
        {
            bytesRead /= 2;
        
            if ((Scan (rdBuffer, "%*i[zb2o10]>%*f[b8]", 
                           bytesRead, bytesRead, data)) != 1)
            {
                viCheckErr( VI_ERROR_INV_RESPONSE);
            }                
        }
        data += bytesRead;
    }
    
    /* Read the extra data and empty the waveform buffer in the oscilloscope */
    if(rdBuffer[lastReadBytes-1] != '\n')
    {       
        viScanf (io, "%*[^\n]");
    }

Error:
    Ivi_Free(vi, rdBuffer);
    return error;   
}
 
/*****************************************************************************
 * Function: tkdpo4k_FetchRawWaveform                                       
 * Purpose:  This function fetches and returns an unscaled waveform from the  
 *           instrument. The waveform can be fetched from an input channel   
 *           (CH1-CH4), a reference channel (REF1-REF4), or a math channel   
 *           MATH. To transfer less data than the horizontal record 
 *           length, set the arraySize element in the waveformData parameter 
 *           to the desired amount. This may be desired if Extended          
 *           Acqusition mode is enabled, but you do not want to transfer     
 *           that much data.NOTE: Call this only when NOT Simulating.        
 *****************************************************************************/
static ViStatus tkdpo4k_FetchRawWaveform (ViSession vi, ViSession io, 
                                           ViConstString dataSource,
                                           ViReal64 *yZero,
                                           ViReal64 *yOffset, 
                                           ViReal64 *yMultiplier,
                                           ViReal64 *xIncrement, 
                                           ViReal64 *initialX, 
                                           ViInt32 waveformSize, 
                                           ViReal64 waveform[],
                                           ViInt32 *actualPoints)
{
    ViStatus  error = VI_SUCCESS;
    ViInt32   acquisitionType, dataWidth = 1;
    ViInt32   bytesRead, numDigits, numDataBytes;
    ViInt32   numReadings, totalBytesRead;
    ViInt32   horzRecordLength, stopIndex;
    ViInt32   bufferSize;
    ViChar*   rdBuffer = VI_NULL;
    ViReal64  *data = waveform;
    ViBoolean doneWithRead;
    ViInt32   lastReadBytes=0;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FETCH_BUFFER_SIZE, 0, &bufferSize) );
    checkErr( Ivi_Alloc(vi, bufferSize, (ViAddr*)&rdBuffer) );
    
    checkErr( Ivi_SetAttributeViString (vi, VI_NULL, 
                                        TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                        0, dataSource));

    checkErr( Ivi_GetAttributeViInt32  (vi, VI_NULL, 
                                        TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                        0, &acquisitionType));
                                        
    switch (acquisitionType) 
    {
        case TKDPO4K_VAL_NORMAL:
        {
            dataWidth = 1;
            break;
        }            
        case TKDPO4K_VAL_AVERAGE:
        case TKDPO4K_VAL_HI_RES:
        {
            dataWidth = 2;
            break;
        }
        default:
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                                "Use FetchMinMaxWaveform for acquisition types "
                                "Peak Detect or Envelope.");
        }        
    }

    if( strncmp (dataSource, TKDPO4K_VAL_CH_1, (strlen(dataSource)+1)) == 0 
        || strncmp (dataSource, TKDPO4K_VAL_CH_2, (strlen(dataSource)+1)) == 0 
            || strncmp (dataSource, TKDPO4K_VAL_CH_3, (strlen(dataSource)+1)) == 0
                || strncmp (dataSource, TKDPO4K_VAL_CH_4, (strlen(dataSource)+1)) == 0 
                    || strncmp (dataSource, TKDPO4K_VAL_MATH, (strlen(dataSource)+1)) == 0 )
    {
        /* If CH1 ~ CH4 is specified, get record length from the TKDPO4K_ATTR_HORZ_RECORD_LENGTH attribute */
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                                                    0, &horzRecordLength));
    }
    else
    {
        /* If REF1 ~ REF4 is specified, get record length from the "WFMPRE:NR_PT?" command */
        viCheckErr( viQueryf(io, "WFMPRE:NR_PT?", "%ld", &horzRecordLength) );
    }

    if (horzRecordLength > waveformSize)
    {
        stopIndex = waveformSize;
    }        
    else
    {
        stopIndex = horzRecordLength;
    }   
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, dataWidth));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_START_POS, 0, 1));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_STOP_POS, 0, stopIndex));
    
    /* Replace with cache attributes
    viCheckErr( viQueryf (io, ":WFMPRE:YZE?;:WFMPRE:YOFF?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;",
                          "%le;%le;%le;%le", yZero, yOffset, yMultiplier, xIncrement, initialX));
    */
        /* Replace ":WFMPRE:YZE?;:WFMPRE:YOFF?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;" */
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YZERO, 0, yZero) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YOFF, 0, yOffset) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YMULT, 0, yMultiplier) );
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR, 0, xIncrement) );     
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO, 0, initialX) );           
                          
        /* Waveform Query */
    viCheckErr( viPrintf (io, "%s", ":CURV?"));
    
        /* Read how many digits make up the entry for number of bytes */
    viCheckErr( viRead (io, rdBuffer, 2, &bytesRead));
    rdBuffer[bytesRead] = 0 ;
    //if (Scan (rdBuffer, "%s>#%i", &numDigits) != 1) 
	if (sscanf(rdBuffer, "%s>#%i", &numDigits) != 1)
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }
    
        /* Read how many bytes make up the data */
    viCheckErr( viRead (io, rdBuffer, numDigits, &bytesRead));
    rdBuffer[bytesRead] = 0;
    //if (Scan (rdBuffer, "%s>%i", &numDataBytes) != 1) 
	if (sscanf(rdBuffer, "%s>%i", &numDataBytes) != 1)
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }
    
        /* Calculate the Number of Readings */
    numReadings = numDataBytes/dataWidth;
    if (numReadings > waveformSize)
    {
        numReadings = waveformSize;
        numDataBytes = numReadings * dataWidth;
    }
    *actualPoints = numReadings;  
    
        /* Read the Data into the Array */
    totalBytesRead = 0;
    doneWithRead = VI_FALSE;
    while (!doneWithRead)
    {
        viCheckErr( viRead (io, rdBuffer, bufferSize, &bytesRead));
        
        if (totalBytesRead + bytesRead >= numDataBytes)
        {
            lastReadBytes = bytesRead;
            bytesRead = numDataBytes - totalBytesRead;
            doneWithRead = VI_TRUE;
        }
        
        totalBytesRead += bytesRead;
        if (dataWidth == 1)
        {
            if ((Scan (rdBuffer, "%*i[zb1]>%*f", 
                       bytesRead, bytesRead, data)) != 1)
            {                       
                viCheckErr( VI_ERROR_INV_RESPONSE);
            }
        }
        else
        {
            bytesRead /= 2;
        
            if ((Scan (rdBuffer, "%*i[zb2o10]>%*f[b8]", 
                       bytesRead, bytesRead, data)) != 1)
            {
                viCheckErr( VI_ERROR_INV_RESPONSE);
            }                
        }
        data += bytesRead;
    }

    /* Read the extra data and empty the waveform buffer in the oscilloscope */
    if(rdBuffer[lastReadBytes-1] != '\n')
    {       
        viScanf (io, "%*[^\n]");
    }
    
Error:
    Ivi_Free(vi, rdBuffer);
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_FetchContinuousMinMaxWaveform                           
 *  Purpose:  This function fetches a min and max waveform from a waveform 
 *            acquisition that the user or driver previously initiated on a 
 *            specific channel.                     
 *  Note:     Call this function only when TKDPO4K_ATTR_ACQUISITION_TYPE
 *            is TKDPO4K_VAL_PEAK_DETECT or TKDPO4K_VAL_ENVELOPE.
 *****************************************************************************/
ViStatus _VI_FUNC tkdpo4k_FetchContinuousMinMaxWaveform (ViSession vi,
                                                    ViConstString channel, 
                                                    ViReal64 minWaveform[], 
                                                    ViReal64 maxWaveform[], 
                                                    ViInt32 *actualPointsRef, 
                                                    ViReal64 *initialXRef, 
                                                    ViReal64 *xIncrementRef)
{
    ViStatus        error = VI_SUCCESS;
    ViInt32         actualPoints;
    ViReal64        xIncrement, initialX;
    ViConstString   dataSource;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    viCheckParm( Ivi_CoerceChannelName (vi, channel, &dataSource), 2, "Invalid Channel");

    if (minWaveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 2, "Null address for minWaveform");
    }
    
    if (maxWaveform == VI_NULL)
    {
        viCheckParm( IVI_ERROR_INVALID_PARAMETER, 3, "Null address for maxWaveform");
    }
    
        /* Fetch Min and Max Waveforms */
    if (!Ivi_Simulating (vi))               /* call only when locked */
    {
        ViSession   io = Ivi_IOSession (vi);    /* call only when locked */
        ViReal64    yZero, yOffset, yMultiplier;
        
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
                                                   
        checkErr( tkdpo4k_FetchContinuousRawMinMaxWaveform (vi, io, dataSource, &yZero, &yOffset, &yMultiplier,
                                                                xIncrementRef, initialXRef, 
                                                                minWaveform, maxWaveform,
                                                                &actualPoints));
        
        tkdpo4k_ScaleRawWaveform (actualPoints, minWaveform, yZero, yOffset, yMultiplier);
        tkdpo4k_ScaleRawWaveform (actualPoints, maxWaveform, yZero, yOffset, yMultiplier);
        if(actualPointsRef)   
        {
            *actualPointsRef = actualPoints;     
        }
    }
    else
    {
        ViInt32     x;
        ViReal64    yRange, k, theta, level;
        ViInt32     triggerSlope;
        ViChar      channel[BUFFER_SIZE] = {0};
        ViInt32     waveformSize;
        
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                           0, &actualPoints));
        checkErr( Ivi_GetAttributeViString (vi, VI_NULL, 
                                            TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                            0, BUFFER_SIZE, channel) );
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &yRange)); 
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SLOPE, 
                                           0, &triggerSlope));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                            0, &level));
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            0, &xIncrement));
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_WAVEFORM_SIZE,
                                            0, &waveformSize));
                                            
        theta = asin (2*level/yRange);
        if (triggerSlope == TKDPO4K_VAL_POSITIVE)
            k = 1.0;
        else 
            k = -1.0;

        initialX = 0.0;
        actualPoints /= 4;
        if( actualPoints>waveformSize ) 
            actualPoints = waveformSize;  /* Checking number of points to write */
        xIncrement *= 4;
        for (x = 0; x < actualPoints; x++) 
        {
                /* add glitch to the every 20th element in the waveform array */
            maxWaveform[x] = k * yRange * .49 * sin (xIncrement * x + k * theta)
                            + (!(x%20)) * rand()/150000.0;
            minWaveform[x] = k * yRange * .51 * sin (xIncrement * x + k * theta)
                            - (!(x%20)) * rand()/160000.0;
        }
        
        if(actualPointsRef)
        {
            *actualPointsRef = actualPoints;         
        }
        if(xIncrementRef)
        {
            *xIncrementRef = xIncrement;         
        }
        if(initialXRef)
        {
            *initialXRef = initialX;        
        }
    }

Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_FetchContinuousRawMinMaxWaveform 
 * Purpose:  
 *****************************************************************************/
static ViStatus tkdpo4k_FetchContinuousRawMinMaxWaveform (ViSession vi, ViSession io,
                                                             ViConstString dataSource,
                                                             ViReal64 *yZero,
                                                             ViReal64 *yOffset, 
                                                             ViReal64 *yMultiplier,
                                                             ViReal64 *xIncrement, 
                                                             ViReal64 *initialX, 
                                                             ViReal64 minWaveform[],
                                                             ViReal64 maxWaveform[],
                                                             ViInt32 *actualPoints)
{
    ViStatus  error = VI_SUCCESS;
    ViInt32   dataWidth = 1;
    ViInt32   bytesRead, numDigits, numDataBytes;
    ViInt32   totalBytesRead;
    ViInt32   bufferSize;
    ViChar*   rdBuffer = VI_NULL;
    ViBoolean doneWithRead;
    ViInt32   waveformSize;
    ViReal64  *minData, *maxData; 
    ViInt32   counter = 0;   
    ViInt32   lastReadBytes=0;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FETCH_BUFFER_SIZE, 0, &bufferSize) );
    checkErr( Ivi_Alloc(vi, bufferSize, (ViAddr*)&rdBuffer) );

    checkErr( Ivi_SetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_INPUT_DATA_SOURCE, 0, dataSource));   
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, &dataWidth) ); 

    /* Replace ":WFMPRE:YZE?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;" */
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YZERO, 0, yZero) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YOFF, 0, yOffset) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YMULT, 0, yMultiplier) );
    if(xIncrement)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR, 0, xIncrement) );     
    }
    if(initialX)
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO, 0, initialX) );           
    }
        
        /* Waveform Query */
    viCheckErr( viWrite (io, ":CURV?", 6, VI_NULL));
    
        /* Read how many digits make up the entry for number of bytes */
    viCheckErr( viRead (io, rdBuffer, 2, &bytesRead));
    rdBuffer[bytesRead]=0;
    if (Scan (rdBuffer, "%s>#%i", &numDigits) != 1) 
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }       
        
        /* Read how many bytes make up the data */
    viCheckErr( viRead (io, rdBuffer, numDigits, &bytesRead));
    rdBuffer[bytesRead]=0;
    if (Scan (rdBuffer, "%s>%i", &numDataBytes) != 1) 
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }       
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_WAVEFORM_SIZE, 0, &waveformSize) );
    waveformSize *= 2;
    if (numDataBytes > waveformSize)
    {
        numDataBytes = waveformSize;
    }
    *actualPoints = numDataBytes / 2; /*return the fact that we are giving half */
                                          /*as many points as databytes read        */
    
        /* Read Data into Arrays */
    totalBytesRead = 0;
    doneWithRead = VI_FALSE;
    minData = minWaveform;
    maxData = maxWaveform;
    while (!doneWithRead)
    {
        ViInt32 i;

        viCheckErr( viRead (io, rdBuffer, bufferSize, &bytesRead));
        
        if (totalBytesRead + bytesRead >= numDataBytes)
        {
            lastReadBytes = bytesRead;
            bytesRead = numDataBytes - totalBytesRead;
            doneWithRead = VI_TRUE;
        }
        
        totalBytesRead += bytesRead;

        for (i=0; i < bytesRead; i += 2)
        {
            minData[counter + (i/2)] = (ViReal64) rdBuffer[i];
            maxData[counter + (i/2)] = (ViReal64) rdBuffer[i+1];
        }
        counter += i/2;
    }

    /* Read the extra data and empty the waveform buffer in the oscilloscope */
    if(rdBuffer[lastReadBytes-1] != '\n')
    {       
        viScanf (io, "%*[^\n]");
    }   
    
Error:
    Ivi_Free(vi, rdBuffer);
    return error;   
}    
    
/*****************************************************************************
 * Function: tkdpo4k_FetchRawMinMaxWaveform                                 
 * Purpose:  This function fetches and returns an unscaled waveform from the 
 *           instrument. The waveform can be fetched from an input channel   
 *           (CH1-CH4), a reference channel (REF1-REF4), or a math channel   
 *           MATH. To transfer less data than the horizontal record 
 *           length, set the arraySize element in the waveformData parameter 
 *           to the desired amount. This may be desired if Extended          
 *           Acqusition mode is enabled, but you do not want to transfer     
 *           that much data.                                                 
 *           NOTE: Call thisonly when TKDPO4K_ATTR_ACQUISITION_TYPE is      
 *           TKDPO4K_VAL_PEAK_DETECT or TKDPO4K_VAL_ENVELOPE.              
 *           NOTE: Call this only when NOT Simulating.                       
 *****************************************************************************/
static ViStatus tkdpo4k_FetchRawMinMaxWaveform (ViSession vi, ViSession io,
                                                 ViConstString dataSource,
                                                 ViReal64 *yZero,
                                                 ViReal64 *yOffset, 
                                                 ViReal64 *yMultiplier,
                                                 ViReal64 *xIncrement, 
                                                 ViReal64 *initialX, 
                                                 ViInt32 waveformSize,
                                                 ViReal64 minWaveform[],
                                                 ViReal64 maxWaveform[],
                                                 ViInt32 *actualPoints)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     horzRecordLength, stopIndex;
    ViInt32     numDigits, numDataBytes, totalBytesRead, bytesRead;
    ViInt32     counter = 0;
    ViInt32     bufferSize;
    ViChar*     rdBuffer = VI_NULL;
    ViReal64    *minData, *maxData;
    ViBoolean   doneWithRead;
    ViInt32     lastReadBytes=0;

    /* Assign Buffer */
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FETCH_BUFFER_SIZE, 0, &bufferSize) );
    checkErr( Ivi_Alloc(vi, bufferSize, (ViAddr*)&rdBuffer) );    
    
    checkErr( Ivi_SetAttributeViString (vi, VI_NULL, 
                                        TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                        0, dataSource));
                                        
    if( strncmp (dataSource, TKDPO4K_VAL_CH_1, (strlen(dataSource)+1)) == 0 
        || strncmp (dataSource, TKDPO4K_VAL_CH_2, (strlen(dataSource)+1)) == 0 
            || strncmp (dataSource, TKDPO4K_VAL_CH_3, (strlen(dataSource)+1)) == 0
                || strncmp (dataSource, TKDPO4K_VAL_CH_4, (strlen(dataSource)+1)) == 0 
                    || strncmp (dataSource, TKDPO4K_VAL_MATH, (strlen(dataSource)+1)) == 0 )
    {
        /* If CH1 ~ CH4 is specified, get record length from the TKDPO4K_ATTR_HORZ_RECORD_LENGTH attribute */  
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                           TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                           0, &horzRecordLength));
    }
    else
    {
        /* If REF1 ~ REF4 is specified, get record length from the "WFMPRE:NR_PT?" command */
        viCheckErr( viQueryf(io, "WFMPRE:NR_PT?", "%ld", &horzRecordLength) );
    }                                        

    horzRecordLength *= 2; /*this is necessary as the record length is half of the instrument value*/
    waveformSize     *= 2;
    if (horzRecordLength > waveformSize)
    {
        stopIndex = waveformSize;
    }       
    else
    {
        stopIndex = horzRecordLength;
    }       

    /* There is stopIndex points in both min and max waveforms. */
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, 1));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_START_POS, 0, 1));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_STOP_POS, 0, stopIndex));    
 
    /* Replace with cache attributes
    viCheckErr( viQueryf (io, ":WFMPRE:YZE?;:WFMPRE:YOFF?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;",
                          "%le;%le;%le;%le", yZero, yOffset, yMultiplier, xIncrement, initialX));
    */
    
    /* Replace ":WFMPRE:YZE?;:WFMPRE:YOFF?;:WFMPRE:YMULT?;:WFMPRE:XINCR?;:WFMPRE:XZERO?;" */
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YZERO, 0, yZero) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YOFF, 0, yOffset) );
    checkErr( Ivi_GetAttributeViReal64 (vi, dataSource, TKDPO4K_ATTR_DATA_YMULT, 0, yMultiplier) );
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XINCR, 0, xIncrement) );     
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_DATA_XZERO, 0, initialX) );                          
                          
        /* Waveform Query */
    viCheckErr( viWrite (io, ":CURV?", 6, VI_NULL));
    
        /* Read how many digits make up the entry for number of bytes */
    viCheckErr( viRead (io, rdBuffer, 2, &bytesRead));
    rdBuffer[bytesRead]=0;
    if (Scan (rdBuffer, "%s>#%i", &numDigits) != 1) 
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }       
        
        /* Read how many bytes make up the data */
    viCheckErr( viRead (io, rdBuffer, numDigits, &bytesRead));
    rdBuffer[bytesRead]=0;
    if (Scan (rdBuffer, "%s>%i", &numDataBytes) != 1) 
    {
        viCheckErr( VI_ERROR_INV_RESPONSE);
    }       
    
    if (numDataBytes > waveformSize)
    {
        numDataBytes = waveformSize;
    }
    *actualPoints = numDataBytes / 2; /*return the fact that we are giving half */
                                      /*as many points as databytes read        */
        
        /* Read Data into Arrays */
    totalBytesRead = 0;
    doneWithRead = VI_FALSE;
    minData = minWaveform;
    maxData = maxWaveform;
    while (!doneWithRead)
    {
        ViInt32 i;

        viCheckErr( viRead (io, rdBuffer, bufferSize, &bytesRead));
        
        if (totalBytesRead + bytesRead >= numDataBytes)
        {
            lastReadBytes = bytesRead;
            bytesRead = numDataBytes - totalBytesRead;
            doneWithRead = VI_TRUE;
        }
        
        totalBytesRead += bytesRead;

        for (i=0; i < bytesRead; i += 2)
        {
            minData[counter + (i/2)] = (ViReal64) rdBuffer[i];
            maxData[counter + (i/2)] = (ViReal64) rdBuffer[i+1];
        }
        counter += i/2;
    }

    /* Read the extra data and empty the waveform buffer in the oscilloscope */
    if(rdBuffer[lastReadBytes-1] != '\n')
    {       
        viScanf (io, "%*[^\n]");
    }
    
Error:
    Ivi_Free(vi, rdBuffer);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_ScaleRawWaveform                                       
 * Purpose:  This function scales a waveform retrieved from the oscilloscope 
 *           with one of the functions tkdpo4k_FetchRawWaveform or          
 *           tkdpo4k_FetchRawMinMaxWaveform.                                   
 *           NOTE: Call this only when NOT simulating.                          
 *****************************************************************************/
static void tkdpo4k_ScaleRawWaveform (ViInt32 waveformSize, ViReal64 waveform[],
                                       ViReal64 yZero, ViReal64 yOffset, ViReal64 yMultiplier)
                                
{
    ViInt32   i;
    ViReal64  *rawData = waveform;

    for (i=0; i< waveformSize; i++) 
    /*  waveform[i] = rawData[i] * yMultiplier + yOffset;        */
        waveform[i] = (rawData[i]-yOffset)*yMultiplier+yZero;      
}

/*****************************************************************************
 * Function: tkdpo4kResolutionOne_CoerceCallback                                       
 * Purpose:  This coerce callback is used by attributes whose resoluton is 1.0 
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kResolutionOne_CoerceCallback (ViSession vi, 
                                                               ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViReal64 value, 
                                                               ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;

    checkErr (tkdpo4k_CoerceToResolution (vi, value, 1.0, 14, &newValue));

Error:
    *coercedValue = newValue;
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kStdViInt32_WriteCallback                                       
 * Purpose:  This write callback is used by attributes with a range table that
 *           contains the base GPIB string in the customInfo parameter. This 
 *           function supports mulit-channel attributes whose GPIB command
 *           follows the pattern: :FUNCTION:CH<X> ARG 
  *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViInt32_WriteCallback (ViSession vi, 
                                                           ViSession io, 
                                                           ViConstString channelName, 
                                                           ViAttr attributeId, 
                                                           ViInt32 value)
{
    ViStatus         error = VI_SUCCESS;
    ViString         cmdStr;
    IviRangeTablePtr rangeTable;
    ViConstString    commandSeparator;
    ViConstString    channelStr;
    
    if (channelName == VI_NULL || *channelName == '\0')
    {
        commandSeparator = "";
        channelStr = "";
    }
    else
    {
        commandSeparator = ":";
        channelStr = channelName;
    }

    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    if (rangeTable->type == IVI_VAL_DISCRETE)
    {
        viCheckErr( Ivi_GetViInt32EntryFromValue (value, rangeTable, 
              VI_NULL, VI_NULL, VI_NULL, VI_NULL, &cmdStr, VI_NULL));
             
        viCheckErr( viPrintf (io, "%s%s%s %s;", rangeTable->customInfo, 
                              commandSeparator, channelStr, cmdStr));
    }
    else 
        viCheckErr( viPrintf (io, "%s%s%s %ld;", rangeTable->customInfo, 
                              commandSeparator, channelStr, value));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kStdViInt32_ReadCallback                                       
 * Purpose:  This write callback is used by attributes with a range table that
 *           contains the base command string in the userData parameter. This 
 *           function supports mulit-channel attributes whose command
 *           follows the pattern: :FUNCTION:CH<X>? 
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViInt32_ReadCallback (ViSession vi, 
                                                          ViSession io, 
                                                          ViConstString channelName, 
                                                          ViAttr attributeId, 
                                                          ViInt32 *value)
{
    ViStatus         error = VI_SUCCESS;
    ViChar           buf[BUFFER_SIZE]="";
    IviRangeTablePtr rangeTable;
    if(attributeId>TKDPO4K_RF_ATTR_START && attributeId<TKDPO4K_RF_ATTR_END)
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) );   
    }
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    if (channelName == VI_NULL || *channelName == '\0')
    {
        viCheckErr( viPrintf (io, "%s?", rangeTable->customInfo));
    }
    else 
    {
        viCheckErr( viPrintf (io, "%s:%s?", rangeTable->customInfo, channelName));
    }
  
    viCheckErr( viRead (io, buf, BUFFER_SIZE, VI_NULL));  
    
    if (rangeTable->type == IVI_VAL_DISCRETE)
    {
		if (Ivi_GetViInt32EntryFromString (buf, rangeTable, value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) < VI_SUCCESS)
	    {
	        viCheckErr( VI_ERROR_INV_RESPONSE);
	    }
    }
	
    else 
    {
        if (Scan (buf, "%s>%i", value) != 1)
        {
            viCheckErr( VI_ERROR_INV_RESPONSE);
        }
    }
    
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kStdViReal64_ReadCallback                                       
 * Purpose:  This write callback is used by attributes with a range table    
 *           that contains the base GPIB string in the userData parameter.   
 *           This function supports multi-channel attributes whose GPIB      
 *           command follows the pattern: :FUNCTION:CH<X> ARG                
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViReal64_ReadCallback (ViSession vi, 
                                                           ViSession io, 
                                                           ViConstString channelName, 
                                                           ViAttr attributeId, 
                                                           ViReal64 *value)
{
    ViStatus            error = VI_SUCCESS;
    ViChar              rdBuffer[BUFFER_SIZE];
    IviRangeTablePtr    rangeTable;
    if(attributeId>TKDPO4K_RF_ATTR_START && attributeId<TKDPO4K_RF_ATTR_END)
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) );   
    }
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    if (channelName == VI_NULL || *channelName == '\0')
    {
        viCheckErr( viPrintf (io, "%s?", rangeTable->customInfo));
    }
    else 
    {
        viCheckErr( viPrintf (io, "%s:%s?", rangeTable->customInfo, channelName));
    }
    
    viCheckErr( viRead (io, rdBuffer, BUFFER_SIZE, VI_NULL));  
    
    if (Scan (rdBuffer, "%s>%f[e]", value) != 1)
        viCheckErr( VI_ERROR_INV_RESPONSE);

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kStdViReal64_WriteCallback                                       
 * Purpose:  This write callback is used by attributes with a range table    
 *           that contains the base GPIB string in the userData parameter.   
 *           This function supports multi-channel attributes whose GPIB      
 *           command follows the pattern: :FUNCTION:CH<X> ARG?               
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViReal64_WriteCallback (ViSession vi, 
                                                            ViSession io, 
                                                            ViConstString channelName, 
                                                            ViAttr attributeId, 
                                                            ViReal64 value)
{
    ViStatus         error = VI_SUCCESS;
    ViChar           wrBuffer[BUFFER_SIZE];
    IviRangeTablePtr rangeTable;
    ViInt32          numBytes;

    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    Fmt (wrBuffer, "%s<%s", rangeTable->customInfo);
    numBytes = NumFmtdBytes();

    if (channelName != VI_NULL && *channelName != '\0')
    {
        Fmt (wrBuffer, "%s[a]<:%s", channelName);
        numBytes += NumFmtdBytes();
    }
    Fmt (wrBuffer, "%s[a]< %f[e]", value);
    numBytes += NumFmtdBytes();
    
    viCheckErr (viBufWrite (io, wrBuffer, numBytes, VI_NULL));
    
Error:
    return error;
}

/****************************************************************************** 
 * Function: tkdpo4kStdViStringSource_CheckCallback
 * Purpose:  This callback function checks that a given value is included in the
 *           range table associated with a string attribute.
 ******************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_CheckCallback (ViSession vi, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value)
{
    ViStatus         error = VI_SUCCESS;
    ViConstString    coercedValue;
    IviRangeTablePtr rangeTable;
        if(attributeId>TKDPO4K_RF_ATTR_START && attributeId<TKDPO4K_RF_ATTR_END)
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) );   
    }
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    error = Ivi_CoerceChannelName (vi, value, &coercedValue);
    if (error < VI_SUCCESS) 
    {
        coercedValue = value;
    }
    
    viCheckErr( Ivi_GetViInt32EntryFromString (coercedValue, rangeTable, 
                                               VI_NULL, VI_NULL, VI_NULL, 
                                               VI_NULL, VI_NULL));

Error:
    return error;
}
                                           
/****************************************************************************** 
 * Function: tkdpo4kStdViStringSource_WriteCallback
 * Purpose:  This write callback is used by string attributes that contain the 
 *           base GPIB command in the userData element of the associated range 
 *           table.
 ******************************************************************************/    
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value)
{
    ViStatus         error = VI_SUCCESS;
    ViString         sourceCmdString;
    IviRangeTablePtr rangeTable;

    error = tkdpo4k_CoerceStringSourceToCmd (vi, value, &sourceCmdString);
    if(error < VI_SUCCESS && attributeId ==TKDPO4K_ATTR_MEAS_SOURCE)
    {
        if(strcmp(value,TKDPO4K_VAL_HISTOGRAM) == 0)
        {
            error = VI_SUCCESS;
        }
    }
    checkErr( error);
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));
    viCheckErr( viPrintf (io, "%s %s", rangeTable->customInfo, sourceCmdString));
    
Error:
    return error;
}
    
/****************************************************************************** 
 * Function: tkdpo4kStdViStringSource_ReadCallback
 * Purpose:  This function coerces a given source name to a string that can be  
 *           used by the driver.
 ******************************************************************************/
static ViStatus _VI_FUNC tkdpo4kStdViStringSource_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue)
{
    ViStatus         error = VI_SUCCESS;
    ViChar           rdBuffer[BUFFER_SIZE];
    size_t           bufSize = sizeof(rdBuffer);
    ViConstString    userChannelName;
    IviRangeTablePtr rangeTable;
        if(attributeId>TKDPO4K_RF_ATTR_START && attributeId<TKDPO4K_RF_ATTR_END)
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) );   
    }
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    viCheckErr( viQueryf (io, "%s?", "%#s", rangeTable->customInfo, &bufSize, rdBuffer));
    error = tkdpo4k_GetStr1PtrFromStr2 (triggerSourceStringTable, &userChannelName, 
                                         rdBuffer);
    
    if (error < VI_SUCCESS)
        error = Ivi_GetUserChannelName(vi, rdBuffer, &userChannelName);
    
    if (error < VI_SUCCESS)
        error = VI_ERROR_INV_RESPONSE;
                
    viCheckErr (error);

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, userChannelName));

Error:
    return error;
}

/****************************************************************************** 
 * Function: tkdpo4k_CoerceStringSourceToCmd
 * Purpose:  This function coerces a given source name to a string that can be  
 *           used by the driver.
 ******************************************************************************/ 
static ViStatus tkdpo4k_CoerceStringSourceToCmd (ViSession vi, ViConstString source, 
                                                  ViConstString *sourceCmdString)
{
    ViStatus error = VI_SUCCESS;

    error = tkdpo4k_GetStr2PtrFromStr1 (triggerSourceStringTable, 
                                         sourceCmdString, source);
    if (error < VI_SUCCESS)
    {
        error =  tkdpo4k_GetStr2PtrFromStr1(measurementSourceStringTable, 
                                         sourceCmdString, source);
        if(error < VI_SUCCESS)
        {
            checkErr( Ivi_CoerceChannelName (vi, source, sourceCmdString));
        }
    }
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_ChangeOneAttributeFlag
 *  Purpose:  This function alters a single attribute flag.
 *            Pass the flag in the flagBit parameter.
 *            Pass the new state of the flag in the flagState parameter, the
 *            value VI_TRUE sets a flag bit, the value of VI_FALSE resets it.
 *****************************************************************************/
static ViStatus tkdpo4k_ChangeOneAttributeFlag (ViSession vi, ViAttr attributeId, 
                                                 ViInt32 flagBit, ViBoolean flagState)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     flags;
    
    checkErr( Ivi_GetAttributeFlags (vi, attributeId, &flags));
    
    /* 
        Changed this so that VI_FALSE resets the flag bit and 
        VI_TRUE sets it. Using inverse logic seemed misleading 
    */
    
    flags = flagState ? (flags|flagBit) : (flags&~flagBit);
    checkErr( Ivi_SetAttributeFlags (vi, attributeId, flags));
    
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetStr1PtrFromStr2
 *  Purpose:  This function searches the string/string table the driver
 *            defines with the tkdpo4kStringTable type. 
 *            Use this function when you know the string in the second table 
 *            column. Function returns the pointer to the corresponding string
 *            in the first column.
 *****************************************************************************/
static ViStatus tkdpo4k_GetStr1PtrFromStr2 (tkdpo4kStringTable strTable, 
                                             ViConstString *str1, ViConstString str2)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     i = 0;
    ViBoolean   found = VI_FALSE;
    
    *str1 = VI_NULL;
    while (!found && strTable[i].col1)
    {
        if (strcmp (strTable[i].col2, str2) == 0)
        {
            *str1 = strTable[i].col1;
            found = VI_TRUE;
        }
        i++;
    }
    if (!found)
        checkErr( IVI_ERROR_INVALID_VALUE);
Error:  
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetStr2PtrFromStr1
 *  Purpose:  This function searches the string/string table the driver
 *            defines with the tkdpo4kStringTable type. 
 *            Use this function when you know the string in the first table 
 *            column. Function returns the pointer to the corresponding string
 *            in the second column.
 *****************************************************************************/
static ViStatus tkdpo4k_GetStr2PtrFromStr1 (tkdpo4kStringTable strTable, 
                                             ViConstString *str2, ViConstString str1)
{
    ViStatus error = VI_SUCCESS;
    ViInt32  i=0;
    ViBoolean found = VI_FALSE;
    
    *str2 = VI_NULL;
    while (!found && strTable[i].col2)
    {
        if (strcmp (strTable[i].col1, str1) == 0)
        {
            *str2 = strTable[i].col2;
            found = VI_TRUE;
        }
        i++;
    }
    if (!found)
        checkErr( IVI_ERROR_INVALID_VALUE);
        
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetStr2BufFromStr1
 *  Purpose:  This function searches the string/string table the driver
 *            defines with the tkdpo4kStringTable type. 
 *            Use this function when you know the string in the first table 
 *            column. Function fills the buffer you pass as the str2 parameter
 *            with the contents of the respective second column.
 *****************************************************************************/
static ViStatus tkdpo4k_GetStr2BufFromStr1 (tkdpo4kStringTable strTable, 
                                             ViConstString str1, ViChar str2[])
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     i = 0;
    ViBoolean   found = VI_FALSE;
    
    if (str2)
        str2[0] = 0;
    
    while (!found && strTable[i].col1)
    {
        if (strcmp (strTable[i].col1, str1) == 0)
        {
            if (str2)
                strcpy (str2, strTable[i].col2);
            found = VI_TRUE;
        }
        i++;
    }
    
    if (!found)
        checkErr( IVI_ERROR_INVALID_VALUE);
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_GetSelectedBusName 
 * Purpose:  This function returns name of currently selected bus.
 *****************************************************************************/
static ViStatus tkdpo4k_GetSelectedBusName (ViSession vi, ViString* busName)
{
    ViStatus    error = VI_SUCCESS; 
    ViInt32     busSelect;
    IviRangeTablePtr RngTblPtr;    
    
    checkErr (Ivi_GetAttrRangeTable (vi, "", TKDPO4K_ATTR_BUS_SELECT,
                                        &RngTblPtr));
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT,
                                        0, &busSelect) );
                                            
    viCheckErr ( Ivi_GetViInt32EntryFromValue (busSelect, RngTblPtr,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                busName, VI_NULL ) );
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_CheckStatus                                                 
 * Purpose:  This function checks the status of the instrument to detect 
 *           whether the instrument has encountered an error.  This function  
 *           is called at the end of most exported driver functions.  If the    
 *           instrument reports an error, this function returns      
 *           IVI_ERROR_INSTR_SPECIFIC.  The user can set the 
 *           IVI_ATTR_QUERY_INSTR_STATUS attribute to VI_FALSE to disable this 
 *           check and increase execution speed.                                   
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus tkdpo4k_CheckStatus (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;

    if (Ivi_QueryInstrStatus (vi) && Ivi_NeedToCheckStatus (vi) && !Ivi_Simulating (vi))
    {
        checkErr( tkdpo4k_CheckStatusCallback (vi, Ivi_IOSession(vi)));
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_FALSE));
    }
        
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_WaitForOPC                                                  
 * Purpose:  This function waits for the instrument to complete the      
 *           execution of all pending operations.  This function is a        
 *           wrapper for the WaitForOPCCallback.  It can be called from 
 *           other instrument driver functions. 
 *
 *           The maxTime parameter specifies the maximum time to wait for
 *           operation complete in milliseconds.
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus tkdpo4k_WaitForOPC (ViSession vi, ViInt32 maxTime) 
{
    ViStatus    error = VI_SUCCESS;
    ViSession   io = Ivi_IOSession(vi);

    if (!Ivi_Simulating(vi))
        {
        ViUInt16    _interface = VI_INTF_USB;
        
        viCheckErr( viGetAttribute (Ivi_IOSession(vi), VI_ATTR_INTF_TYPE, &_interface));
        if (_interface != VI_INTF_ASRL)
        {
            ViInt32  oldOPCTimeout; 
            
            checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OPC_TIMEOUT, 
                                               0, &oldOPCTimeout));
            Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OPC_TIMEOUT,        
                                     0, maxTime);
            
            error = tkdpo4k_WaitForOPCCallback (vi, Ivi_IOSession(vi));
            
            Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OPC_TIMEOUT, 
                                     0, oldOPCTimeout);
            viCheckErr( error);
        }
        else{
            ViBoolean opcDone = VI_FALSE;
            viCheckErr( viQueryf (io, "*OPC?", "%hd", &opcDone));
            }
        }

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_NonInvasiveInstrSetup
 * Purpose:  This function sends a invasive setup to the instrument. The
 *           tkdpo4k_IviInit function calls this function when the user
 *           passes VI_FALSE for the reset parameter and specify TRUE to 
 *           NonInvasiveInit in option string. This function is used to configure
 *           the instrument with neccessary settings without modifying 
 *           its state.
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus tkdpo4k_NonInvasiveInstrSetup (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;  
    
        /* Invalidate all attributes */
    checkErr( Ivi_InvalidateAllAttributes (vi));
    if (!Ivi_Simulating(vi))    
    {
        ViInt32   model;
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */    
        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model));

        viCheckErr( viPrintf (io, "*CLS;"));
        viCheckErr( viPrintf (io, "*ESE 1;"));            
        viCheckErr( viPrintf (io, "*SRE 32;"));
  
        viCheckErr( viPrintf (io, "VERBOSE ON;"));  /* sets the instrument to verbose mode */
        
        viCheckErr( viPrintf (io, ":HEAD OFF;")); 
        
            /* 
                The reference levels can be set using percentages or absolute values 
                The IviScope class uses percentages.  There is currently not support
                for setting the reference levels as absolute values in this driver.    
                If this is added, the ConfigureRefLevels function will need to first 
                set the mode to use percentages.
            */
        viCheckErr( viPrintf (io, ":MEASU:REFL:METH PERC;"));
        
            /* 
                The *DDT command sets up a list of commands that occur when 
                the instrument recieves a GIPB GET or the *TRG command.  
                The *TRG command is what is used in tkdpo4k_ForceTrigger  
            */
        viCheckErr( viPrintf (io, "*DDT \":TRIG FORC;\""));
            /* 
                Only allow vertical cursors to be set in units of seconds.  
            */
        viCheckErr( viPrintf (io, ":CURS:VBA:UNITS SECONDS;"));   
            /* 
                Set the delay mode to off in order to allow setting of the ref. pos.  
            */
        viCheckErr( viPrintf (io, ":HOR:DEL:STATE ON"));
            /*
                Initialize waveform data parameter
            */
        viCheckErr( viPrintf (io, ":DAT:ENC RIB;"));
    }
  
    /*
        Initiaze waveform data parameter
    */
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, 1));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_START_POS, 0, 1));
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_STOP_POS, 0, 10000));
    
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_DefaultInstrSetup                                               
 * Purpose:  This function sends a default setup to the instrument.  The    
 *           tkdpo4k_reset function calls this function.  The 
 *           tkdpo4k_IviInit function calls this function when the
 *           user passes VI_FALSE for the reset parameter.  This function is 
 *           useful for configuring settings that other instrument driver 
 *           functions require.    
 *
 *           Note:  Call this function only when the session is locked.
 *****************************************************************************/
static ViStatus tkdpo4k_DefaultInstrSetup (ViSession vi)
{
    ViStatus    error = VI_SUCCESS;
   
        /* Invalidate all attributes */
    checkErr( Ivi_InvalidateAllAttributes (vi));
    
    if (!Ivi_Simulating(vi))
    {
        ViInt32   model;
        ViSession   io = Ivi_IOSession(vi); /* call only when locked */

        checkErr( Ivi_SetNeedToCheckStatus (vi, VI_TRUE));
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model));

        viCheckErr( viPrintf (io, "*CLS;"));
        viCheckErr( viPrintf (io, "*ESE 1;"));            
        viCheckErr( viPrintf (io, "*SRE 32;"));
        
        viCheckErr( viPrintf (io, "VERBOSE ON;"));  /* sets the instrument to verbose mode */
        
        viCheckErr( viPrintf (io, ":HEAD OFF;ACQ:STATE 0;")); 
        
            /* 
                The reference levels can be set using percentages or absolute values 
                The IviScope class uses percentages.  There is currently not support
                for setting the reference levels as absolute values in this driver.    
                If this is added, the ConfigureRefLevels function will need to first 
                set the mode to use percentages.
            */
        viCheckErr( viPrintf (io, ":MEASU:REFL:METH PERC;"));
        
            /* 
                The *DDT command sets up a list of commands that occur when 
                the instrument recieves a GIPB GET or the *TRG command.  
                The *TRG command is what is used in tkdpo4k_ForceTrigger  
            */
        viCheckErr( viPrintf (io, "*DDT \":TRIG FORC;\""));       
        
            /* 
                Only allow vertical cursors to be set in units of seconds.  
            */
        viCheckErr( viPrintf (io, ":CURS:VBA:UNITS SECONDS;"));
        
            /* 
                Set the delay mode to off in order to allow setting of the ref. pos.  
            */
        viCheckErr( viPrintf (io, ":HOR:DEL:STATE ON"));
        
        viCheckErr( viPrintf (io, "ACQ:STATE ON;")); 
            /*
                Initialize waveform data parameter
            */
        viCheckErr( viPrintf (io, ":DAT:ENC RIB;"));
    }
  
    /*
        Initiaze waveform data parameter
    */
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_WIDTH, 0, 1));
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_START_POS, 0, 1));
        checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_DATA_STOP_POS, 0, 10000));
    
    checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, TKDPO4K_ATTR_INITIATE_CONTINUOUS, 
                                           0, VI_FALSE));     

    checkErr( Ivi_SetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_ACQUISITION_START_TIME,
                                        0, 0.0));
                                        
Error:
    return error;
}

/*****************************************************************************
 *------------------------ Global Session Callbacks -------------------------*
 *****************************************************************************/

/*****************************************************************************
 * Function: tkdpo4k_CheckStatusCallback                                               
 * Purpose:  This function queries the instrument to determine if it has 
 *           encountered an error.  If the instrument has encountered an 
 *           error, this function returns the IVI_ERROR_INSTRUMENT_SPECIFIC 
 *           error code.  This function is called by the 
 *           tkdpo4k_CheckStatus utility function.  The 
 *           Ivi_SetAttribute and Ivi_GetAttribute functions invoke this 
 *           function when the optionFlags parameter includes the
 *           IVI_VAL_DIRECT_USER_CALL flag.
 *           
 *           The user can disable calls to this function by setting the 
 *           IVI_ATTR_QUERY_INSTR_STATUS attribute to VI_FALSE.  The driver can 
 *           disable the check status callback for a particular attribute by 
 *           setting the IVI_VAL_DONT_CHECK_STATUS flag.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4k_CheckStatusCallback (ViSession vi, ViSession io)
{
    ViStatus    error = VI_SUCCESS;
    ViInt16     esr = 0;
    
    /* Query instrument status */
    viCheckErr( viQueryf (io, "*ESR?", "%hd", &esr));
    
    /* Convert status information into a message */
    if (esr & IEEE_488_2_ERROR_BITS)
    {     
        viCheckErr( IVI_ERROR_INSTR_SPECIFIC);
    }
    
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4k_WaitForOPCCallback                                               
 * Purpose:  This function waits until the instrument has finished processing 
 *           all pending operations.  This function is called by the 
 *           tkdpo4k_WaitForOPC utility function.  The IVI engine invokes
 *           this function in the following two cases:
 *           - Before invoking the read callback for attributes for which the 
 *             IVI_VAL_WAIT_FOR_OPC_BEFORE_READS flag is set.
 *           - After invoking the write callback for attributes for which the 
 *             IVI_VAL_WAIT_FOR_OPC_AFTER_WRITES flag is set.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4k_WaitForOPCCallback (ViSession vi, ViSession io)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     opcTimeout;
    ViUInt16    statusByte;
    ViUInt16    _interface = VI_INTF_USB;
    
    
    viCheckErr( viGetAttribute (io, VI_ATTR_INTF_TYPE, &_interface));
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OPC_TIMEOUT, 0, 
                                       &opcTimeout));
    if (_interface == VI_INTF_TCPIP)
    {
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OPC_TIMEOUT, 0, 
                                            &opcTimeout));
        viCheckErr( viEnableEvent (io, VI_EVENT_SERVICE_REQ, VI_QUEUE, VI_NULL));
        viCheckErr( viDiscardEvents (io, VI_EVENT_SERVICE_REQ, VI_QUEUE) );
    
        viCheckErr( viPrintf (io, "*OPC"));

            /* wait for SRQ */
        viCheckErr( viWaitOnEvent (io, VI_EVENT_SERVICE_REQ, opcTimeout, VI_NULL, VI_NULL));
        viCheckErr( viDisableEvent (io, VI_EVENT_SERVICE_REQ, VI_QUEUE));
        
            /* clean up after SRQ */
        viCheckErr( viBufWrite (io, "*CLS", 4, VI_NULL));
        viCheckErr( viReadSTB (io, &statusByte));

    }
    else 
    {
        ViBoolean   opcDone = VI_FALSE;
		
        viCheckErr( viQueryf (io, "*OPC?", "%hd", &opcDone));
    }

Error:
    if (_interface == VI_INTF_USB)
    {
        viBufWrite (io, "*CLS", 4, VI_NULL);  
        viDisableEvent (io, VI_EVENT_SERVICE_REQ, VI_QUEUE);           
        if (error == VI_ERROR_TMO)
        {
            Ivi_SetErrorInfo(vi, VI_TRUE, TKDPO4K_ERROR_MAX_TIME_EXCEEDED, 0, VI_NULL);
        }            
    }
    return error;
}

/*****************************************************************************
 *----------------- Attribute Range Tables and Callbacks --------------------*
 *****************************************************************************/

    /*- TKDPO4K_ATTR_ID_QUERY_RESPONSE -*/
static ViStatus _VI_FUNC tkdpo4kAttrIdQueryResponse_ReadCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE];

    viCheckErr( viQueryf (io, "*IDN?", "%256[^\n]", rdBuffer));
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_DRIVER_REVISION -*/
static ViStatus _VI_FUNC tkdpo4kAttrDriverRevision_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      driverRevision[256];
    
    
    sprintf (driverRevision, 
             "Driver: TKDPO4K %d.%d, Compiler: %s %3.2f, "
             "Components: IVIEngine %.2f, VISA-Spec %.2f", 
             TKDPO4K_MAJOR_VERSION, TKDPO4K_MINOR_VERSION,
             IVI_COMPILER_NAME, IVI_COMPILER_VER_NUM, IVI_ENGINE_MAJOR_VERSION+ 
             IVI_ENGINE_MINOR_VERSION/1000.0, Ivi_ConvertVISAVer(VI_SPEC_VERSION));

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, driverRevision));
Error:
    return error;
}

    /*- TKDPO4K_ATTR_CHANNEL_ENABLED -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrChannelEnabled_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViBoolean value)
{
    ViStatus         error = VI_SUCCESS;
        
    viCheckErr( viPrintf (io, ":SEL:%s %s;", channelName, value ? "ON" : "OFF"));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrChannelEnabled_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     state;
    
    viCheckErr( viQueryf (io, ":SEL:%s?", "%ld", channelName, &state));

    *value = (state == 0) ? VI_FALSE : VI_TRUE;

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PROBE_ATTENUATION -*/

static IviRangeTableEntry attrProbeAttenuationRangeTableEntries[] =
{
    {TKDPO4K_VAL_PROBE_SENSE_ON,    0.0,    0.0,    "AUTO",     0}, 
    {0.001,                         0.0,    0.0,    "0.001",    0},
    {0.002,                         0.0,    0.0,    "0.002",    0},
    {0.005,                         0.0,    0.0,    "0.005",    0},
    {0.01,                          0.0,    0.0,    "0.01",     0},
    {0.02,                          0.0,    0.0,    "0.02",     0},
    {0.05,                          0.0,    0.0,    "0.05",     0},
    {0.1,                           0.0,    0.0,    "0.1",      0},
    {0.2,                           0.0,    0.0,    "0.2",      0},
    {0.5,                           0.0,    0.0,    "0.5",      0},
    {1.0,                           0.0,    0.0,    "1.0",      0},
    {2.0,                           0.0,    0.0,    "2.0",      0},
    {5.0,                           0.0,    0.0,    "5.0",      0}, 
    {10.0,                          0.0,    0.0,    "10.0",     0},
    {20.0,                          0.0,    0.0,    "20.0",     0},
    {50.0,                          0.0,    0.0,    "50.0",     0},
    {100.0,                         0.0,    0.0,    "100.0",    0},
    {200.0,                         0.0,    0.0,    "200.0",    0},
    {500.0,                         0.0,    0.0,    "500.0",    0},
    {1000.0,                        0.0,    0.0,    "1000.0",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrProbeAttenuationRangeTable =
{
    IVI_VAL_DISCRETE,                    
    VI_FALSE, 
    VI_FALSE, 
    VI_NULL,
    attrProbeAttenuationRangeTableEntries,
};

/* 
 * The probe attenuation range table before changing probe gain representation.   
 * 
static IviRangeTableEntry attrProbeAttenuationRangeTableEntries[] =
{
    {TKDPO4K_VAL_PROBE_SENSE_ON,    0.0,    0.0,    "AUTO",     0}, 
    {1.0,                           0.0,    0.0,    "1.0",      0},
    {10.0,                          0.0,    0.0,    "10.0",     0},
    {100.0,                         0.0,    0.0,    "100.0",    0},
    {1000.0,                        0.0,    0.0,    "1000.0",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
*/

static ViStatus _VI_FUNC tkdpo4kAttrProbeAttenuation_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   probeSense = VI_FALSE;
    ViReal64    probeGain;
    
    checkErr( Ivi_GetAttributeViBoolean (vi, channelName, TKDPO4K_ATTR_PROBE_SENSE, 
                                         0, &probeSense));
    if (probeSense)
    {
        *value = TKDPO4K_VAL_PROBE_SENSE_ON;
    }
    else
    {
        checkErr( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_PROBE_GAIN, 0, &probeGain));
        
        *value = 1.0/probeGain;
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrProbeAttenuation_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     notProbeSensing = 0;
    
   
    viCheckErr( Ivi_CompareWithPrecision (0, value, TKDPO4K_VAL_PROBE_SENSE_ON, 
                                          &notProbeSensing));
    if (notProbeSensing)
    {
        checkErr( tkdpo4k_SetCachingOnProbeDependentAttributes (vi, VI_TRUE));
 
        checkErr( Ivi_SetAttributeViBoolean (vi, channelName, TKDPO4K_ATTR_PROBE_SENSE, 
                                             0, VI_FALSE));
        
        checkErr( Ivi_SetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_PROBE_GAIN, 0, (1.0 / value)) );
    }
    else
    {
        checkErr( tkdpo4k_SetCachingOnProbeDependentAttributes (vi, VI_FALSE));
        checkErr( Ivi_SetAttributeViBoolean (vi, channelName, TKDPO4K_ATTR_PROBE_SENSE, 
                                             0, VI_TRUE));
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PROBE_SENSE_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrProbeSenseValue_ReadCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    probeGain; 
    
    checkErr( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_PROBE_GAIN, 0, &probeGain));
    
    *value = 1.0/probeGain; 

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PROBE_GAIN -*/
static ViStatus _VI_FUNC tkdpo4kAttrProbeGain_ReadCallback (ViSession vi, 
                                                            ViSession io, 
                                                            ViConstString channelName, 
                                                            ViAttr attributeId, 
                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, ":%s:PRO:GAIN?", "%le", channelName, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrProbeGain_WriteCallback (ViSession vi, 
                                                             ViSession io, 
                                                             ViConstString channelName, 
                                                             ViAttr attributeId, 
                                                             ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viPrintf (io, ":%s:PRO:GAIN %le", channelName, value));

Error:
    return error;
}

    /*- TKDPO4K_ATTR_VERTICAL_RANGE -*/
static IviRangeTableEntry attrVerticalRangeRangeTableEntries[] =
{
    {0,         1.5E-2,     1.0E-2,     "",     0},
    {1.5E-2,    3.5E-2,     2.0E-2,     "",     0},
    {3.5E-2,    7.5E-2,     5.0E-2,     "",     0},
    {7.5E-2,    15.0E-2,    10.0E-2,    "",     0},
    {15.0E-2,   35.0E-2,    20.0E-2,    "",     0},
    {35.0E-2,   75.0E-2,    50.0E-2,    "",     0},
    {75.0E-2,   1.5,        1.0,        "",     0},
    {1.5,       3.5,        2.0,        "",     0},
    {3.5,       7.5,        5.0,        "",     0},
    {7.5,       15,         10,         "",     0},
    {15,        35,         20,         "",     0},
    {35,        75,         50,         "",     0},
    {75,        100,        100,        "",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrVerticalRangeRangeTable =
{
    IVI_VAL_COERCED,
    VI_FALSE,
    VI_TRUE,
    VI_NULL,
    attrVerticalRangeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 probeAttenuation, scaleValue = (value / 10.0);

    checkErr( tkdpo4k_GetProbeAttenuation (vi, channelName, &probeAttenuation));
    
    /* Adjust for Probe Attenuation */
    checkErr( Ivi_DefaultCheckCallbackViReal64 (vi, channelName, attributeId, scaleValue/probeAttenuation));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_CoerceCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value,
                                                                   ViReal64 *coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    probeAttenuation, probeDivideValue = value; 
    
    checkErr( tkdpo4k_GetProbeAttenuation (vi, channelName, &probeAttenuation)); 
    
    /* Adjust for Probe Attenuation */
    checkErr( Ivi_DefaultCoerceCallbackViReal64 (vi, channelName, attributeId, value/probeAttenuation, &probeDivideValue) );
    
Error:
    *coercedValue = probeDivideValue*probeAttenuation;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    scaleValue;
    ViString    channelString;
    /*the SCAle command is used to set the division size and the oscilloscope has 10 divisions 
    therefore to set the range, we divide the input by 10. */
    scaleValue = value/10.0;
    Ivi_CoerceChannelName(vi,channelName,&channelString);
    if(strncmp(channelString,"CH",2)==0)
    {
        viCheckErr( viPrintf (io, ":%s:SCA %le;", channelString, scaleValue));
    }
    else
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Invalid channel name.");   
    }
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalRange_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 *value)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 verticalScale;

    viCheckErr( viQueryf (io, ":%s:SCA?", "%le", channelName, &verticalScale));
    *value = verticalScale * 10.0;
    
Error:
    return error;
}


    /*- TKDPO4K_ATTR_VERTICAL_OFFSET -*/
static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_CheckCallback (ViSession vi, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 value)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 offsetLimit = 1.0, vertRange, vertScale, probeAttenuation;

    checkErr( tkdpo4k_GetProbeAttenuation (vi, channelName, &probeAttenuation));
    
    checkErr( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                        0, &vertRange)); 

        /* Adjust values for total attenuation */
    value /= probeAttenuation;
    vertScale = (vertRange / 10.0) / probeAttenuation;
    
        /* Set limit based on the value of the vertScale */
    if  ( 1e-3 <= vertScale && vertScale <= 9.95e-3)
    {
        offsetLimit = 0.1; 
    }
    else if (9.95e-3 < vertScale && vertScale <= 99.5e-3)
    {
        offsetLimit = 1.0; 
    }
    else if (99.5e-3 < vertScale && vertScale <= 995.0e-3) 
    {
        offsetLimit = 10.0;
    }
    else if (995.0e-3 < vertScale && vertScale <= 10.0)
    {
        offsetLimit = 100.0;
    }
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                -offsetLimit, offsetLimit));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViReal64 value)

{
    ViStatus error = VI_SUCCESS;

    viCheckErr( viPrintf (io, ":%s:OFFS %le;", channelName, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalOffset_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 *value)
{
    ViStatus error = VI_SUCCESS;
    
    viCheckErr( viQueryf (io, ":%s:OFFS?", "%le", channelName, value));

Error:
    return error;
}

    /*- TKDPO4K_ATTR_VERTICAL_COUPLING -*/ 
static IviRangeTableEntry attrVerticalCouplingRangeTableEntries[] =
{
    {TKDPO4K_VAL_AC,    0,  0,  "AC",   0}, 
    {TKDPO4K_VAL_DC,    0,  0,  "DC",   0}, 
    {TKDPO4K_VAL_GND,   0,  0,  "GND",  0},
	{TKDPO4K_VAL_DCREJ,   0,  0,  "DCREJ",  0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable  attrVerticalCouplingRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    VI_NULL, 
    attrVerticalCouplingRangeTableEntries, 
};

static ViStatus _VI_FUNC tkdpo4kAttrVerticalCoupling_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViInt32 value)

{
    ViStatus  error = VI_SUCCESS;
    ViString  couplingStr;
    
    
    viCheckErr( Ivi_GetViInt32EntryFromValue (value, &attrVerticalCouplingRangeTable, 
                        VI_NULL, VI_NULL, VI_NULL, VI_NULL, &couplingStr, VI_NULL));
    
    viCheckErr( viPrintf (io, ":%s:COUP %s;", channelName, couplingStr));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrVerticalCoupling_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViInt32 *value)
 
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuffer[BUFFER_SIZE];

    viCheckErr( viQueryf (io, ":%s:COUP?", "%s", channelName, rdBuffer));
    viCheckErr( Ivi_GetViInt32EntryFromString (rdBuffer, &attrVerticalCouplingRangeTable, 
                                               value, VI_NULL, VI_NULL, 
                                               VI_NULL, VI_NULL));
Error:
    return error;
    
}

    /*- TKDPO4K_ATTR_MAX_INPUT_FREQUENCY -*/
static IviRangeTableEntry attrMaxInputFrequency_1000_RangeTableEntries[] = 
{
    {0.0,       20.0e6,     20.0e6,     "TWENTY",   0},
    {20.0e6,    250.0e6,    250.0e6,    "TWOFIFTY", 0},
    {250.0e6,   IVI_VIREAL64_MAX,   1000.0e6,   "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}    
};

static IviRangeTable attrMaxInputFrequency_1000_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_1000_RangeTableEntries,
};
    
static IviRangeTableEntry attrMaxInputFrequency_500_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "TWENTY",   0},
    {20.0e6,    250.0e6,    250.0e6,    "TWOFIFTY", 0},
    {250.0e6,   IVI_VIREAL64_MAX,   500.0e6,    "FULL",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_500_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_500_RangeTableEntries,
};
    
static IviRangeTableEntry attrMaxInputFrequency_350_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "TWENTY",   0},
    {20.0e6,    250.0e6,    250.0e6,    "TWOFIFTY", 0},
    {250.0e6,   IVI_VIREAL64_MAX,   350.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_350_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_350_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_100_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "TWENTY",   0},
    {20.0e6,    IVI_VIREAL64_MAX,   100.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_100_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_100_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_200_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "TWENTY",   0},
    {20.0e6,    IVI_VIREAL64_MAX,   200.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_200_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_200_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_DPO3K_100_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "20E6",     0},
    {20.0e6,    IVI_VIREAL64_MAX,   100.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_DPO3K_100_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_DPO3K_100_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_DPO3K_200_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "20E6",     0},
    {20.0e6,   IVI_VIREAL64_MAX,   200.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_DPO3K_200_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_DPO3K_200_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_DPO3K_300_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "20E6",     0},
    {20.0e6,    150.0e6,    150.0e6,    "150E6",    0},
    {150.0e6,   IVI_VIREAL64_MAX,   300.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_DPO3K_300_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_DPO3K_300_RangeTableEntries,
};

static IviRangeTableEntry attrMaxInputFrequency_DPO3K_500_RangeTableEntries[] =
{
    {0.0,       20.0e6,     20.0e6,     "20E6",     0},
    {20.0e6,    150.0e6,    150.0e6,    "150E6",    0},
    {150.0e6,   IVI_VIREAL64_MAX,   500.0e6,    "FULL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMaxInputFrequency_DPO3K_500_RangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMaxInputFrequency_DPO3K_500_RangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_RangeTableCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    IviRangeTablePtr    tblPtr = VI_NULL;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model));
    
    switch (model) 
    {
        case TKDPO4K_VAL_DPO_4104:
        case TKDPO4K_VAL_MSO_4104:
        case TKDPO4K_VAL_DPO_4104B:
        case TKDPO4K_VAL_MSO_4104B:
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_41043: 
        case TKDPO4K_VAL_DPO_4102B:    
        case TKDPO4K_VAL_DPO_4102B_L:  
        case TKDPO4K_VAL_DPO_4104B_L:  
        case TKDPO4K_VAL_MSO_4102B:    
        case TKDPO4K_VAL_MSO_4102B_L:  
        case TKDPO4K_VAL_MSO_4104B_L:
        case TKDPO4K_VAL_MDO_4104B_3:
        case TKDPO4K_VAL_MDO_4104B_6:
        case TKDPO4K_VAL_MDO_3102:
        case TKDPO4K_VAL_MDO_3104:
		case TKDPO4K_VAL_MDO_4104C:	
        {
            tblPtr = &attrMaxInputFrequency_1000_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_4054:
        case TKDPO4K_VAL_MSO_4054:
        case TKDPO4K_VAL_DPO_4054B:
        case TKDPO4K_VAL_MSO_4054B:
        case TKDPO4K_VAL_MDO_40546: 
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_MDO_4054B_3:
        case TKDPO4K_VAL_MDO_4054B_6:
		case TKDPO4K_VAL_MDO_4054C:			
        {
            tblPtr = &attrMaxInputFrequency_500_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_4034:
        case TKDPO4K_VAL_DPO_4032:
        case TKDPO4K_VAL_MSO_4034:
        case TKDPO4K_VAL_MSO_4032:
        case TKDPO4K_VAL_DPO_4034B:
        case TKDPO4K_VAL_MSO_4034B:
        case TKDPO4K_VAL_MDO_4034_3:
        case TKDPO4K_VAL_MDO_4034B_3:
		case TKDPO4K_VAL_MDO_4034C:			
        {
            tblPtr = &attrMaxInputFrequency_350_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_4014B:
        case TKDPO4K_VAL_MSO_4014B:
        {
            tblPtr = &attrMaxInputFrequency_100_RangeTable;
            break;
        }
		case TKDPO4K_VAL_MDO_4024C:
        {
            tblPtr = &attrMaxInputFrequency_200_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_3012:
        case TKDPO4K_VAL_DPO_3014:
        case TKDPO4K_VAL_MSO_3012:
        case TKDPO4K_VAL_MSO_3014:
        case TKDPO4K_VAL_MDO_3012:
        case TKDPO4K_VAL_MDO_3014:
        {
            tblPtr = &attrMaxInputFrequency_DPO3K_100_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_3032:
        case TKDPO4K_VAL_DPO_3034:
        case TKDPO4K_VAL_MSO_3032:
        case TKDPO4K_VAL_MSO_3034:
        case TKDPO4K_VAL_MDO_3032: 
        case TKDPO4K_VAL_MDO_3034:
        {
            tblPtr = &attrMaxInputFrequency_DPO3K_300_RangeTable;
            break;
        }
        case TKDPO4K_VAL_MDO_3022: 
        case TKDPO4K_VAL_MDO_3024:
        {
            tblPtr = &attrMaxInputFrequency_DPO3K_200_RangeTable;
            break;
        }
        case TKDPO4K_VAL_DPO_3052:
        case TKDPO4K_VAL_DPO_3054:
        case TKDPO4K_VAL_MSO_3052:
        case TKDPO4K_VAL_MSO_3054:
        case TKDPO4K_VAL_MDO_3052: 
        case TKDPO4K_VAL_MDO_3054:
        {
            tblPtr = &attrMaxInputFrequency_DPO3K_500_RangeTable;
            break;
        }
    }
    
Error:
    *rangeTablePtr = tblPtr;
    return error;   
}

static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_ReadCallback (ViSession vi, 
                                                             ViSession io, 
                                                             ViConstString channelName, 
                                                             ViAttr attributeId, 
                                                             ViReal64 *value)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViReal64            readValue = 0.0;

    checkErr(Ivi_GetAttrRangeTable (vi, channelName, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY, &tblPtr));
    
    viCheckErr( viQueryf (io, ":%s:BAN?", "%le", channelName, &readValue));
    
    viCheckErr( Ivi_GetViReal64EntryFromValue(readValue, tblPtr, VI_NULL, VI_NULL, value, VI_NULL, VI_NULL, VI_NULL) );                                
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrMaxInputFrequency_WriteCallback (ViSession vi, 
                                                              ViSession io, 
                                                              ViConstString channelName, 
                                                              ViAttr attributeId, 
                                                              ViReal64 value)
{
    ViStatus        error = VI_SUCCESS;
    ViString        commandStr = "";
    IviRangeTablePtr    tblPtr = VI_NULL;

    checkErr(Ivi_GetAttrRangeTable (vi, channelName, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY, &tblPtr));

    viCheckErr( Ivi_GetViReal64EntryFromValue (value, tblPtr, VI_NULL, VI_NULL,
                                               VI_NULL, VI_NULL, &commandStr,
                                               VI_NULL));

    viCheckErr( viPrintf (io, ":%s:BAN %s;", channelName, commandStr));

Error:
    return error;
}

    /*- TKDPO4K_ATTR_INPUT_IMPEDANCE -*/
static IviRangeTableEntry attrDPO4KChannelImpedanceRangeTableEntries[] =
{
    {50.0,      0, 0, "FIFTY", 0},
    {1.0e+06,   0, 0, "MEG", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrDPO4KChannelImpedanceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    VI_NULL,
    attrDPO4KChannelImpedanceRangeTableEntries,
};

static IviRangeTableEntry attrDPO3KChannelImpedanceRangeTableEntries[] =
{
    {50.0,      0, 0, "FIFTY", 0},
    {75.0,      0, 0, "SEVENTYFIVE", 0},
    {1.0e+06,   0, 0, "MEG", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrDPO3KChannelImpedanceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    VI_NULL,
    attrDPO3KChannelImpedanceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrChannelImpedance_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 *value)
{
    ViStatus error = VI_SUCCESS;
    ViChar   rdBuffer[BUFFER_SIZE];
    IviRangeTablePtr rangeTable;

    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));
     
    viCheckErr( viQueryf (io, ":%s:IMP?", "%s", channelName, rdBuffer));
    viCheckErr( Ivi_GetViReal64EntryFromString (rdBuffer, rangeTable, 
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL));
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrChannelImpedance_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value)
{
    ViStatus  error = VI_SUCCESS;
    ViString  channelImpedanceStr;
    IviRangeTablePtr rangeTable; 
    
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));

    viCheckErr( Ivi_GetViReal64EntryFromValue (value, rangeTable, 
                        VI_NULL, VI_NULL, VI_NULL, VI_NULL, &channelImpedanceStr, VI_NULL));
    viCheckErr( viPrintf (io, ":%s:IMP %s;", channelName, channelImpedanceStr));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrInputImpedance_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KChannelImpedanceRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KChannelImpedanceRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_DIGITAL_THRESHOLD -*/
static IviRangeTableEntry attrDigitalThresholdRangeTableEntries[] =
    {
        {-2, 5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDigitalThresholdRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrDigitalThresholdRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrDigitalThreshold_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, "BUS:THR:%s?", "%Lf", channelName, value));       
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDigitalThreshold_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viPrintf (io, "BUS:THR:%s %Lf", channelName, value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_HORZ_TIME_PER_RECORD -*/
static IviRangeTableEntry attrDPO4054HorzTimePerRecordRangeTableEntries[] =
{
    {IVI_VIREAL64_MAX_NEG,  1.5E-8,             1.0E-8,     "",     0},
    {1.5E-8,                3.0E-8,             2.0E-8,     "",     0},
    {3.0E-8,                7.0E-8,             4.0E-8,     "",     0},
    {7.0E-8,                15.0E-8,            10.0E-8,    "",     0},
    {15.0E-8,               30.0E-8,            20.0E-8,    "",     0},
    {30.0E-8,               70.0E-8,            40.0E-8,    "",     0},
    {70.0E-8,               150.0E-8,           100.0E-8,   "",     0},
    {150.0E-8,              300.0E-8,           200.0E-8,   "",     0},
    {300.0E-8,              700.0E-8,           400.0E-8,   "",     0},
    {700.0E-8,              1.5E-5,             1.0E-5,     "",     0},
    {1.5E-5,                3.0E-5,             2.0E-5,     "",     0},
    {3.0E-5,                6.0E-5,             4.0E-5,     "",     0},
    {6.0E-5,                15.0E-5,            10.0E-5,    "",     0},
    {15.0E-5,               30.0E-5,            20.0E-5,    "",     0},
    {30.0E-5,               60.0E-5,            40.0E-5,    "",     0},
    {60.0E-5,               150.0E-5,           100.0E-5,   "",     0},
    {150.0E-5,              300.0E-5,           200.0E-5,   "",     0},
    {300.0E-5,              700.0E-5,           400.0E-5,   "",     0},
    {700.0E-5,              1.5E-2,             1.0E-2,     "",     0},
    {1.5E-2,                3.0E-2,             2.0E-2,     "",     0},
    {3.0E-2,                7.0E-2,             4.0E-2,     "",     0},
    {7.0E-2,                15.0E-2,            10.0E-2,    "",     0},
    {15.0E-2,               30.0E-2,            20.0E-2,    "",     0},
    {30.0E-2,               70.0E-2,            40.0E-2,    "",     0},
    {70.0E-2,               150.0E-2,           100.0E-2,   "",     0},
    {150.0E-2,              300.0E-2,           200.0E-2,   "",     0},
    {300.0E-2,              700.0E-2,           400.0E-2,   "",     0},
    {700.0E-2,              15,                 10,         "",     0},
    {15,                    30,                 20,         "",     0},
    {30,                    70,                 40,         "",     0},
    {70,                    150,                100,        "",     0},
    {150,                   300,                200,        "",     0},
    {300,                   700,                400,        "",     0},
    {700,                   1500,               1000,       "",     0},
    {1500,                  3000,               2000,       "",     0},
    {3000,                  7000,               4000,       "",     0},
    {7000,                  IVI_VIREAL64_MAX,   10000,      "",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable attrDPO4054HorzTimePerRecordRangeTable =
{
    IVI_VAL_COERCED,
    VI_FALSE,
    VI_TRUE,
    VI_NULL,
    attrDPO4054HorzTimePerRecordRangeTableEntries,
};

static IviRangeTableEntry attrDPO4104HorzTimePerRecordRangeTableEntries[] =
{
    {IVI_VIREAL64_MAX_NEG,  700E-11,            400E-11,    "",     0},
    {700E-11,               1.5E-8,             1.0E-8,     "",     0},
    {1.5E-8,                3.0E-8,             2.0E-8,     "",     0},
    {2.0E-8,                7.0E-8,             4.0E-8,     "",     0},
    {7.0E-8,                15.0E-8,            10.0E-8,    "",     0},
    {15.0E-8,               30.0E-8,            20.0E-8,    "",     0},
    {30.0E-8,               70.0E-8,            40.0E-8,    "",     0},
    {70.0E-8,               150.0E-8,           100.0E-8,   "",     0},
    {150.0E-8,              300.0E-8,           200.0E-8,   "",     0},
    {300.0E-8,              700.0E-8,           400.0E-8,   "",     0},
    {700.0E-8,              1.5E-5,             1.0E-5,     "",     0},
    {1.5E-5,                3.0E-5,             2.0E-5,     "",     0},
    {3.0E-5,                7.0E-5,             4.0E-5,     "",     0},
    {7.0E-5,                15.0E-5,            10.0E-5,    "",     0},
    {15.0E-5,               30.0E-5,            20.0E-5,    "",     0},
    {30.0E-5,               70.0E-5,            40.0E-5,    "",     0},
    {70.0E-5,               150.0E-5,           100.0E-5,   "",     0},
    {150.0E-5,              300.0E-5,           200.0E-5,   "",     0},
    {300.0E-5,              700.0E-5,           400.0E-5,   "",     0},
    {700.0E-5,              1.5E-2,             1.0E-2,     "",     0},
    {1.5E-2,                3.0E-2,             2.0E-2,     "",     0},
    {3.0E-2,                7.0E-2,             4.0E-2,     "",     0},
    {7.0E-2,                15.0E-2,            10.0E-2,    "",     0},
    {15.0E-2,               30.0E-2,            20.0E-2,    "",     0},
    {30.0E-2,               70.0E-2,            40.0E-2,    "",     0},
    {70.0E-2,               150.0E-2,           100.0E-2,   "",     0},
    {150.0E-2,              300.0E-2,           200.0E-2,   "",     0},
    {300.0E-2,              700.0E-2,           400.0E-2,   "",     0},
    {700.0E-2,              15,                 10,         "",     0},
    {15,                    30,                 20,         "",     0},
    {30,                    70,                 40,         "",     0},
    {70,                    150,                100,        "",     0},
    {150,                   300,                200,        "",     0},
    {300,                   700,                400,        "",     0},
    {700,                   1500,               1000,       "",     0},
    {1500,                  3000,               2000,       "",     0},
    {3000,                  7000,               4000,       "",     0},
    {7000,                  IVI_VIREAL64_MAX,   1.0E4,      "",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}                        
};
static IviRangeTable attrDPO4104HorzTimePerRecordRangeTable =
{
    IVI_VAL_COERCED,
    VI_FALSE,
    VI_TRUE,
    VI_NULL,
    attrDPO4104HorzTimePerRecordRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_ReadCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 *value)
{
    ViStatus error = VI_SUCCESS;
    /* ":HOR:SEC" is the same with ":HOR:SCA" */ 
    viCheckErr( viQueryf (io, ":HOR:SEC?", "%le", value));
    *value *= 10.0;

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value)
{
    ViStatus error = VI_SUCCESS;
    /* ":HOR:SEC" is the same with ":HOR:SCA" */
    viCheckErr( viPrintf (io, ":HOR:SEC %le;", value/10.0));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrHorzTimePerRecord_RangeTableCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    if( (instrModelNo == TKDPO4K_VAL_DPO_4104)
            || (instrModelNo == TKDPO4K_VAL_MSO_4104)
                || (instrModelNo == TKDPO4K_VAL_DPO_4104B)
                    || (instrModelNo == TKDPO4K_VAL_MSO_4104B))
    {
        tblPtr = &attrDPO4104HorzTimePerRecordRangeTable; 
    }
    else if( (instrModelNo == TKDPO4K_VAL_DPO_4054)
                || (instrModelNo == TKDPO4K_VAL_MSO_4054) 
                    || (instrModelNo == TKDPO4K_VAL_DPO_4054B)
                        || (instrModelNo == TKDPO4K_VAL_MSO_4054B))
    {
        tblPtr = &attrDPO4054HorzTimePerRecordRangeTable;
    }
    else if( (instrModelNo == TKDPO4K_VAL_DPO_4034)
                || (instrModelNo == TKDPO4K_VAL_MSO_4034) 
                    || (instrModelNo == TKDPO4K_VAL_DPO_4034B)
                        || (instrModelNo == TKDPO4K_VAL_MSO_4034B) )
    {
        /* Use 4054 currently */    
        tblPtr = &attrDPO4054HorzTimePerRecordRangeTable; 
    }
    else if( (instrModelNo == TKDPO4K_VAL_DPO_4032)
                || (instrModelNo == TKDPO4K_VAL_MSO_4032) )
    {
        /* Use 4054 currently.*/    
        tblPtr = &attrDPO4054HorzTimePerRecordRangeTable; 
    }
    else if(IS_DPO3K (instrModelNo) || IS_MSO3K(instrModelNo) || IS_MDO3K(instrModelNo))
    {
        /* Use 4054 currently. */
        tblPtr = &attrDPO4054HorzTimePerRecordRangeTable;
    }
    else if(instrModelNo == TKDPO4K_VAL_MDO_40543 || instrModelNo == TKDPO4K_VAL_MDO_40546)
    {
        /* Use 4054 currently. */
        tblPtr = &attrDPO4054HorzTimePerRecordRangeTable;
    }
    else if(instrModelNo == TKDPO4K_VAL_MDO_41043 || instrModelNo == TKDPO4K_VAL_MDO_41046)
    {
        tblPtr = &attrDPO4104HorzTimePerRecordRangeTable;          
    }
    else if((instrModelNo == TKDPO4K_VAL_DPO_4102B)
            || (instrModelNo == TKDPO4K_VAL_DPO_4102B_L)
            || (instrModelNo == TKDPO4K_VAL_DPO_4104B_L)
            || (instrModelNo == TKDPO4K_VAL_MSO_4102B)
            || (instrModelNo == TKDPO4K_VAL_MSO_4102B_L)
            || (instrModelNo == TKDPO4K_VAL_MSO_4104B_L))
    {
        tblPtr = &attrDPO4104HorzTimePerRecordRangeTable;          
    }
    else if((instrModelNo == TKDPO4K_VAL_DPO_4014B)
            || (instrModelNo == TKDPO4K_VAL_MSO_4014B)
            || (instrModelNo == TKDPO4K_VAL_MDO_4014_3)
            || (instrModelNo == TKDPO4K_VAL_MDO_4024C) 
			|| (instrModelNo == TKDPO4K_VAL_MDO_4034_3)
            || (instrModelNo == TKDPO4K_VAL_MDO_4014B_3)
            || (instrModelNo == TKDPO4K_VAL_MDO_4034B_3)
			|| (instrModelNo == TKDPO4K_VAL_MDO_4034C)
            || (instrModelNo == TKDPO4K_VAL_MDO_4054B_3)
            || (instrModelNo == TKDPO4K_VAL_MDO_4054B_6)
			|| (instrModelNo == TKDPO4K_VAL_MDO_4054C)
            || (instrModelNo == TKDPO4K_VAL_MDO_4104B_3)
            || (instrModelNo == TKDPO4K_VAL_MDO_4104B_6)
			|| (instrModelNo == TKDPO4K_VAL_MDO_4104C))
    {
        tblPtr = &attrDPO4104HorzTimePerRecordRangeTable;          
    }
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_HORZ_MIN_NUM_PTS -*/
static IviRangeTableEntry attrDPO4KHorzMinNumPtsRangeTableEntries[] =
{
    {0, 10000000, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KHorzMinNumPtsRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KHorzMinNumPtsRangeTableEntries,
};

static IviRangeTableEntry attrDPO3KHorzMinNumPtsRangeTableEntries[] =
{
    {0, 5000000, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO3KHorzMinNumPtsRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO3KHorzMinNumPtsRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrHorzMinNumPts_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    return Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TOTAL_POINTS,
                                    0, value);
}

static ViStatus _VI_FUNC tkdpo4kAttrHorzMinNumPts_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KHorzMinNumPtsRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KHorzMinNumPtsRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TOTAL_POINTS -*/
static IviRangeTableEntry attrDPO4KTotalPointsRangeTableEntries[] =
{
    {0,         5500,       1000,       "", 0},
    {5501,      55000,      10000,      "", 0},
    {55001,     550000,     100000,     "", 0},   
    {550001,    3000000,    1000000,    "", 0},
    {3000001,   7500000,    5000000,    "", 0}, 
    {7500001,   15000000,   10000000,   "", 0},
    {1500001,   55000000,   20000000,   "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KTotalPointsRangeTable =
{
    IVI_VAL_COERCED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KTotalPointsRangeTableEntries,
};

static IviRangeTableEntry attrDPO3KTotalPointsRangeTableEntries[] =
    {
        {0, 5000000, 1000, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDPO3KTotalPointsRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrDPO3KTotalPointsRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":HOR:RECORDL %ld;", value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf(io, ":HOR:RECORDL?", "%ld", value));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTotalPoints_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KTotalPointsRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KTotalPointsRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}
    
    /*- TKDPO4K_ATTR_HORZ_RECORD_LENGTH -*/
static ViStatus _VI_FUNC tkdpo4kAttrHorzRecordLength_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     temp = 0, acqType;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_TOTAL_POINTS, 
                                       0, &temp));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, 
                                       TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                       0, &acqType));
    
    if (acqType == TKDPO4K_VAL_PEAK_DETECT || acqType == TKDPO4K_VAL_ENVELOPE)  
    {
        temp /= 2;
    }
        
    *value = temp;

Error:
    return error;
}

    /*- TKDPO4K_ATTR_HORZ_SAMPLE_RATE -*/
static ViStatus _VI_FUNC tkdpo4kAttrHorzSampleRate_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViReal64 *value)
{
    ViStatus error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":HOR:MAI:SAMPLER?", "%lf", value)); 
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_MAGNIVU_ENABLED -*/
static ViStatus _VI_FUNC tkdpo4kAttrMagnivuEnabled_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":ACQ:MAG?", "%d", value));    
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrMagnivuEnabled_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViBoolean value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viPrintf(io, ":ACQ:MAG %s", value ? "ON" : "OFF") );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_MAIN_TRIGGER_TYPE -*/
static IviRangeTableEntry attrMainTriggerTypeRangeTableEntries[] =
{
    {TKDPO4K_VAL_EDGE_TRIGGER,      0, 0, "EDGE",   0},
    {TKDPO4K_VAL_LOGIC_TRIGGER,     0, 0, "LOGIC",  0},
    {TKDPO4K_VAL_PULSE_TRIGGER,     0, 0, "PULSE",  0},
    {TKDPO4K_VAL_SERIAL_TRIGGER,    0, 0, "BUS",    0},
    {TKDPO4K_VAL_TV_TRIGGER,        0, 0, "VIDEO",  0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMainTriggerTypeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:TYP",
    attrMainTriggerTypeRangeTableEntries,
};

    /*- TKDPO4K_ATTR_EDGE_TRIGGER_CLASS -*/
static IviRangeTableEntry attrEdgeTriggerClassRangeTableEntries[] =
{
    {TKDPO4K_VAL_EDGE_TRIGGER,  0,  0,  "CH1",  0},
    {TKDPO4K_VAL_AC_LINE_TRIGGER,   0,  0,  "LINE", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrEdgeTriggerClassRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrEdgeTriggerClassRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrEdgeTriggerClass_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    strACLine;  
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_AC_LINE_TRIGGER, &attrEdgeTriggerClassRangeTable,
                                              VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strACLine, VI_NULL ));
    
    viCheckErr ( viQueryf (io, "TRIG:A:EDGE:SOU?", "%s", buf) );
    
    if( strncmp( buf, strACLine, strlen(strACLine)) == 0 )
    {
        *value = TKDPO4K_VAL_AC_LINE_TRIGGER;   
    }
    else
    {
        *value = TKDPO4K_VAL_EDGE_TRIGGER;
    }
        
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEdgeTriggerClass_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     currentValue;
    ViChar      buf[BUFFER_SIZE];
    ViString    strACLine;
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_AC_LINE_TRIGGER, &attrEdgeTriggerClassRangeTable,
                                              VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strACLine, VI_NULL ));
    
    viCheckErr ( viQueryf (io, "TRIG:A:EDGE:SOU?", "%s", buf) );
    
    if( strncmp( buf, strACLine, strlen(strACLine) ) == 0 )
    {
        currentValue = TKDPO4K_VAL_AC_LINE_TRIGGER; 
    }
    else
    {
        currentValue = TKDPO4K_VAL_EDGE_TRIGGER;
    }
    
    if(value != currentValue)
    {
        if(value == TKDPO4K_VAL_EDGE_TRIGGER)
        {
            viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_EDGE_TRIGGER, &attrEdgeTriggerClassRangeTable,
                                                      VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strACLine, VI_NULL ));           
            viCheckErr ( viPrintf (io, "TRIG:A:EDGE:SOU %s;", strACLine) );
        }
        else
        {
            viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_AC_LINE_TRIGGER, &attrEdgeTriggerClassRangeTable,
                                                      VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strACLine, VI_NULL ));   
            viCheckErr ( viPrintf (io, "TRIG:A:EDGE:SOU %s;", strACLine) );                                                   
        }
        
        /* Invalidate attribute TKDPO4K_ATTR_TRIGGER_SOURCE */
        checkErr ( Ivi_InvalidateAttribute (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE) );
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS -*/
static IviRangeTableEntry attrLogicTriggerClassRangeTableEntries[] =
{
    {TKDPO4K_VAL_PATTERN_TRIGGER,   0,  0,  "LOGIC",    0}, 
    {TKDPO4K_VAL_STATE_TRIGGER,     0,  0,  "LOGIC",    0},
    {TKDPO4K_VAL_SETHOLD_TRIGGER,   0,  0,  "SETHOLD",  0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrLogicTriggerClassRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    "",
    attrLogicTriggerClassRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrLogicTriggerClass_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViInt32     triggerType, clockSource;
    
    viCheckErr ( viQueryf (io, "TRIG:A:LOGI:CLA?", "%s", buf) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (buf, &attrLogicTriggerClassRangeTable, &triggerType, 
                                              VI_NULL, VI_NULL, VI_NULL, VI_NULL ));
    
    if(triggerType == TKDPO4K_VAL_SETHOLD_TRIGGER)                                              
    {
        *value = TKDPO4K_VAL_SETHOLD_TRIGGER;   
    }
    else
    {
        checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_CLOCK_SOURCE, 0, &clockSource) );
        if(clockSource == TKDPO4K_VAL_SOUR_NONE)
        {
            *value = TKDPO4K_VAL_PATTERN_TRIGGER;
        }
        else
        {
            *value = TKDPO4K_VAL_STATE_TRIGGER;
        }
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLogicTriggerClass_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    strTriggerType;
    
    switch(value)
    {
        case TKDPO4K_VAL_PATTERN_TRIGGER:
        {
            viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_PATTERN_TRIGGER, &attrLogicTriggerClassRangeTable, 
                                                      VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strTriggerType, VI_NULL) );
            
            viCheckErr ( viPrintf (io, "TRIG:A:LOGI:CLA %s;", strTriggerType) ); 
            checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_CLOCK_SOURCE, 0, TKDPO4K_VAL_SOUR_NONE));
            break;
        }
        case TKDPO4K_VAL_STATE_TRIGGER:
        {
            viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_STATE_TRIGGER, &attrLogicTriggerClassRangeTable, 
                                                      VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strTriggerType, VI_NULL) );
            
            viCheckErr ( viPrintf (io, "TRIG:A:LOGI:CLA %s;", strTriggerType) ); 
            checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_STATE_CLOCK_SOURCE, 0, TKDPO4K_VAL_SOUR_CH1));
            break;
        }
        case TKDPO4K_VAL_SETHOLD_TRIGGER:
        {
            viCheckErr ( Ivi_GetViInt32EntryFromValue ( TKDPO4K_VAL_SETHOLD_TRIGGER, &attrLogicTriggerClassRangeTable, 
                                                      VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strTriggerType, VI_NULL) );
            
            viCheckErr ( viPrintf (io, "TRIG:A:LOGI:CLA %s;", strTriggerType) ); 
            break;
        }
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PULSE_TRIGGER_CLASS -*/
static IviRangeTableEntry attrPulseTriggerClassRangeTableEntries[] =
{
    {TKDPO4K_VAL_GLITCH_TRIGGER,        0, 0, "WIDTH",      0},
    {TKDPO4K_VAL_RUNT_TRIGGER,          0, 0, "RUNT",       0},
    {TKDPO4K_VAL_TRANSITION_TRIGGER,    0, 0, "TRANSITION", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrPulseTriggerClassRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:PUL:CLA",
    attrPulseTriggerClassRangeTableEntries,
};

    /*- TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS -*/
static IviRangeTableEntry attrSerialTriggerClassRangeTableEntries[] =
    {
        {TKDPO4K_VAL_I2C_TRIGGER, 0, 0, "I2C", 0},
        {TKDPO4K_VAL_SPI_TRIGGER, 0, 0, "SPI", 0},
        {TKDPO4K_VAL_CAN_TRIGGER, 0, 0, "CAN", 0},
        {TKDPO4K_VAL_RS232_TRIGGER, 0, 0, "RS232C", 0},
        {TKDPO4K_VAL_PARALLEL_TRIGGER, 0, 0, "PARALLEL", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrSerialTriggerClassRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrSerialTriggerClassRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerClass_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     bus, busNumber;
    ViChar      buf[BUFFER_SIZE];
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT, 0, &bus) );   
    busNumber = bus - TKDPO4K_VAL_BUS1 + 1;
    
    viCheckErr ( viQueryf (io, "BUS:B%d:TYPE?", "%s", busNumber, buf) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (buf, &attrSerialTriggerClassRangeTable, value,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL ) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerClass_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     bus, busNumber;
    ViString    strTriggerType;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_SELECT, 0, &bus) );   
    busNumber = bus - TKDPO4K_VAL_BUS1 + 1;

    viCheckErr ( Ivi_GetViInt32EntryFromValue ( value, &attrSerialTriggerClassRangeTable, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL, &strTriggerType, VI_NULL) );    
    
    viCheckErr ( viPrintf (io, "BUS:B%d:TYPE %s;", busNumber, strTriggerType) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_TYPE -*/
static IviRangeTableEntry attrDPO4KTriggerTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_EDGE_TRIGGER, 0, 0, "EDGE", 0},
        {TKDPO4K_VAL_RUNT_TRIGGER, 0, 0, "RUNT", 0},
        {TKDPO4K_VAL_GLITCH_TRIGGER, 0, 0, "GLITCH", 0},
        {TKDPO4K_VAL_TRANSITION_TRIGGER, 0, 0, "TRANSITION", 0},
        {TKDPO4K_VAL_STATE_TRIGGER, 0, 0, "STATE", 0},
        {TKDPO4K_VAL_PATTERN_TRIGGER, 0, 0, "PATTERN", 0},
        {TKDPO4K_VAL_SETHOLD_TRIGGER, 0, 0, "SETHOLD", 0},
        {TKDPO4K_VAL_TV_TRIGGER, 0, 0, "VIDEO", 0},
        {TKDPO4K_VAL_AC_LINE_TRIGGER, 0, 0, "AC", 0},
        {TKDPO4K_VAL_I2C_TRIGGER, 0, 0, "I2C", 0},
        {TKDPO4K_VAL_SPI_TRIGGER, 0, 0, "SPI", 0},
        {TKDPO4K_VAL_CAN_TRIGGER, 0, 0, "CAN", 0},
        {TKDPO4K_VAL_RS232_TRIGGER, 0, 0, "RS232", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };
   
static IviRangeTable attrDPO4KTriggerTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        VI_NULL,
        attrDPO4KTriggerTypeRangeTableEntries,
    };

static IviRangeTableEntry attrMSO4KTriggerTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_EDGE_TRIGGER, 0, 0, "EDGE", 0},
        {TKDPO4K_VAL_RUNT_TRIGGER, 0, 0, "RUNT", 0},
        {TKDPO4K_VAL_GLITCH_TRIGGER, 0, 0, "GLITCH", 0},
        {TKDPO4K_VAL_TRANSITION_TRIGGER, 0, 0, "TRANSITION", 0},
        {TKDPO4K_VAL_STATE_TRIGGER, 0, 0, "STATE", 0},
        {TKDPO4K_VAL_PATTERN_TRIGGER, 0, 0, "PATTERN", 0},
        {TKDPO4K_VAL_SETHOLD_TRIGGER, 0, 0, "SETHOLD", 0},
        {TKDPO4K_VAL_TV_TRIGGER, 0, 0, "VIDEO", 0},
        {TKDPO4K_VAL_AC_LINE_TRIGGER, 0, 0, "AC", 0},
        {TKDPO4K_VAL_I2C_TRIGGER, 0, 0, "I2C", 0},
        {TKDPO4K_VAL_SPI_TRIGGER, 0, 0, "SPI", 0},
        {TKDPO4K_VAL_CAN_TRIGGER, 0, 0, "CAN", 0},
        {TKDPO4K_VAL_RS232_TRIGGER, 0, 0, "RS232", 0},
        {TKDPO4K_VAL_PARALLEL_TRIGGER, 0, 0, "PAR", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };
   
static IviRangeTable attrMSO4KTriggerTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        VI_NULL,
        attrMSO4KTriggerTypeRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_ReadCallback (ViSession vi, 
                                                               ViSession io, 
                                                               ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViInt32 *value)
{
    ViInt32    triggerType;
    ViStatus   error = VI_SUCCESS;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE, 
                                       0, &triggerType));

    switch (triggerType)
    {
        case TKDPO4K_VAL_EDGE_TRIGGER:
        {
            checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_EDGE_TRIGGER_CLASS,
                                                0, &triggerType));
            break;                                              
        
        }
        case TKDPO4K_VAL_LOGIC_TRIGGER:
        {
            checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS, 
                                               0, &triggerType));
            break;
        }
        case TKDPO4K_VAL_PULSE_TRIGGER:
        {    
            checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_PULSE_TRIGGER_CLASS, 
                                               0, &triggerType));
            break;
        }
        case TKDPO4K_VAL_SERIAL_TRIGGER:
        {
            checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS,
                                               0, &triggerType));
            break;        
        }
    }
        
Error:
    *value = triggerType;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_WriteCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 value)

{
    ViStatus          error = VI_SUCCESS;

    switch (value)
    {
            /* Edge Triggers */
        case TKDPO4K_VAL_EDGE_TRIGGER:
        case TKDPO4K_VAL_AC_LINE_TRIGGER: 
        {
            checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE,
                                                0, TKDPO4K_VAL_EDGE_TRIGGER));
            
            checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_EDGE_TRIGGER_CLASS,
                                                0, value));
            break;
        }
            /* Pulse Triggers */
        case TKDPO4K_VAL_RUNT_TRIGGER:   
        case TKDPO4K_VAL_GLITCH_TRIGGER:
        case TKDPO4K_VAL_TRANSITION_TRIGGER:
        {
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE, 
                                               0, TKDPO4K_VAL_PULSE_TRIGGER));
                           
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_PULSE_TRIGGER_CLASS, 
                                               0, value));
            break;
        }
            /* Logic Triggers */
        case TKDPO4K_VAL_STATE_TRIGGER:    
        case TKDPO4K_VAL_PATTERN_TRIGGER: 
        case TKDPO4K_VAL_SETHOLD_TRIGGER:
        {
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE, 
                                               0, TKDPO4K_VAL_LOGIC_TRIGGER));
            
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS, 
                                               0, value));
            break;
        }
            /* Serial Triggers */
        case TKDPO4K_VAL_CAN_TRIGGER:           
        case TKDPO4K_VAL_I2C_TRIGGER:
        case TKDPO4K_VAL_SPI_TRIGGER:
        case TKDPO4K_VAL_RS232_TRIGGER:
        case TKDPO4K_VAL_PARALLEL_TRIGGER:
        {
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE,
                                                0, TKDPO4K_VAL_SERIAL_TRIGGER));
                        
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS,
                                                0, value));
            break;
        }
            /* Video Triggers */
        default: 
        {    
            checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE, 
                                               0, value));
            break;
        }
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_CheckCallback (ViSession vi, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_DefaultCheckCallbackViInt32 (vi, "", TKDPO4K_ATTR_TRIGGER_TYPE, value));
    
    /* Advanced Option check is needed! */
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerType_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_MSO4K (instrModelNo))
    {
        tblPtr = &attrMSO4KTriggerTypeRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KTriggerTypeRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_SOURCE -*/
static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_CheckCallback (ViSession vi, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     triggerType;

    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 
                                      0, &triggerType));
    
    if ((triggerType == TKDPO4K_VAL_PATTERN_TRIGGER)
            || (triggerType == TKDPO4K_VAL_STATE_TRIGGER)
                || (triggerType == TKDPO4K_VAL_SETHOLD_TRIGGER)
                    || (triggerType == TKDPO4K_VAL_CAN_TRIGGER)
                        || (triggerType == TKDPO4K_VAL_I2C_TRIGGER)
                            || (triggerType == TKDPO4K_VAL_SPI_TRIGGER))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }

    error = tkdpo4k_GetStr2BufFromStr1 (triggerSourceStringTable, value, VI_NULL);
    /* If SOUR1 ~ SOUR4 is specified */
    if (error < VI_SUCCESS)
    {
        ViString coercedChanStr;
        
        error = Ivi_CoerceChannelName (vi, value, &coercedChanStr);
        if (error >= VI_SUCCESS)   /* value is a valid channel name  */
        {
        
            if ((strcmp( coercedChanStr, "") == 0 ) || (strcmp( coercedChanStr, "MATH") == 0)
                || (strcmp( coercedChanStr, "REF1" ) == 0) || (strcmp( coercedChanStr, "REF2" ) == 0)
                  || (strcmp( coercedChanStr, "REF3" ) == 0) || (strcmp( coercedChanStr, "REF4" ) == 0)
                    ||(strncmp(coercedChanStr,"RF_",3) == 0))
            {
                viCheckErr( IVI_ERROR_INVALID_VALUE);
            }
        }
        else
        {
            error = IVI_ERROR_INVALID_VALUE;
        }
    }
    viCheckErr( error);    
     
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 const ViConstString cacheValue)
{
    ViStatus       error = VI_SUCCESS;
    ViChar         rdBuffer[BUFFER_SIZE];
    size_t         bufSize = sizeof(rdBuffer);
    ViInt32        triggerType;
    ViString       commandStr = "";
    ViConstString  sourceName;
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 
                                      0, &triggerType));

    switch (triggerType)
    {
        case TKDPO4K_VAL_RUNT_TRIGGER:
        {
            commandStr = ":TRIG:A:PUL:RUNT:SOU?";
            break;
        }
        case TKDPO4K_VAL_GLITCH_TRIGGER:
        {
            commandStr = "TRIG:A:PUL:WID:SOU?";
            break;
        }
        case TKDPO4K_VAL_TRANSITION_TRIGGER:
        {
            commandStr = "TRIG:A:PUL:TRAN:SOU?";
            break;
        }
        case TKDPO4K_VAL_TV_TRIGGER:
        {
            commandStr = ":TRIG:A:VID:SOU?";
            break;
        }
        case TKDPO4K_VAL_EDGE_TRIGGER:
        case TKDPO4K_VAL_AC_LINE_TRIGGER:   
        default:
        {
            commandStr = ":TRIG:A:EDGE:SOU?"; 
            break;
        }
    }
    viCheckErr( viPrintf (io, "%s", commandStr));
    viCheckErr( viScanf (io, "%#s", &bufSize, rdBuffer));

    error = tkdpo4k_GetStr1PtrFromStr2 (triggerSourceStringTable, &sourceName, rdBuffer);
    if (error < VI_SUCCESS)
    {
            /* Assume the buf contains an instrument channel string. */
        checkErr( Ivi_GetUserChannelName (vi, rdBuffer, &sourceName));
    }

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, sourceName));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerSource_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViConstString value)

{
    ViStatus        error = VI_SUCCESS;
    ViInt32         triggerType;
    ViChar          sourceNameBuf[BUFFER_SIZE];
    ViString        cmdStringHeader = "";
    
    if (value[0] != '\0')
    {
        checkErr(Ivi_GetAttributeViInt32(vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0, &triggerType));

        switch (triggerType)
        {
            case TKDPO4K_VAL_RUNT_TRIGGER:
            {
                if(strncmp(value,"D",1) == 0)
                {
                    viCheckErr(IVI_ERROR_INVALID_VALUE);
                }
                cmdStringHeader = ":TRIG:A:PUL:RUNT:SOU";
                break;
            }
            case TKDPO4K_VAL_GLITCH_TRIGGER:
            {
                cmdStringHeader = "TRIG:A:PUL:WID:SOU";
                break;
            }
            case TKDPO4K_VAL_TRANSITION_TRIGGER:
            {
                cmdStringHeader = "TRIG:A:PUL:TRAN:SOU";
                break;
            }
            case TKDPO4K_VAL_TV_TRIGGER:
            {
                cmdStringHeader = ":TRIG:A:VID:SOU";
                break;
            }
            case TKDPO4K_VAL_EDGE_TRIGGER:
            case TKDPO4K_VAL_AC_LINE_TRIGGER:
            default:            
            {
                cmdStringHeader = ":TRIG:A:EDGE:SOU";
                break;
            }
        }

        error = tkdpo4k_GetStr2BufFromStr1 (triggerSourceStringTable, value, sourceNameBuf);
        if (error >= VI_SUCCESS)
        {
            if ((triggerType == TKDPO4K_VAL_AC_LINE_TRIGGER)
                    || (triggerType == TKDPO4K_VAL_RUNT_TRIGGER)
                        || (triggerType == TKDPO4K_VAL_TRANSITION_TRIGGER))
                    
            {
                error = IVI_ERROR_INVALID_CONFIGURATION;
                viCheckErr (error);
            }
        }
        else 
        {
            ViConstString chanStr;

            error = Ivi_CoerceChannelName (vi, value, &chanStr);
            if (error >= VI_SUCCESS)
            {
                sprintf (sourceNameBuf, "%s", chanStr);
            }
        }
        viCheckErr( error);

        viCheckErr( viPrintf (io, "%s %s", cmdStringHeader, sourceNameBuf));
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_LEVEL -*/
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_ReadCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf (io, ":TRIG:A:LEV?", "%le", value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_WriteCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":TRIG:A:LEV %le", value));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevel_CheckCallback (ViSession vi, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      tSource[BUFFER_SIZE];
    ViInt32     triggerType;
    ViReal64    ext = 0.0;
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    
    if (!(triggerType == TKDPO4K_VAL_EDGE_TRIGGER 
            || triggerType == TKDPO4K_VAL_AC_LINE_TRIGGER
                || triggerType == TKDPO4K_VAL_GLITCH_TRIGGER)) 
    {
         viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Cannot set trigger level when "
                         "trigger type is not Edge or Glitch Trigger.");
    }

    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 0, BUFFER_SIZE, tSource));
    
    if (!strcmp (tSource, TKDPO4K_VAL_EXTERNAL))
        ext = 1.0;
    
    if (ext != 0.0)
    {   
        /*- Trigger source is External -*/
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, -8.0 * ext, 8.0 * ext));
    }
    else if (strcmp(tSource, TKDPO4K_VAL_AC_LINE) == 0)
    {   
        /*- Trigger source is AC Line -*/
        if(value != 0.0)
        {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Cannot set trigger level when "
                                                             "trigger source is AC line.");
        }                                                             
    } 
    else if (strstr (tSource, "CH"))
    {   
        /*- Trigger source is input channel -*/
        ViReal64      rangeLimit, limit;
        ViString      channel;
        
        checkErr( Ivi_CoerceChannelName (vi, tSource, &channel));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit));
                                            
        limit = rangeLimit*0.8;
        /******************************************************************** 
         * In old firmware version, trigger level limitation of 40 exists.
         * But it is removed in new firmware version.
         * So remove the limitation of 40 from the check callback function.
        
        if(limit > 40)
        {
            limit = 40;
        }
        
        *********************************************************************/  
        
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH -*/
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, ":TRIG:A:LEV:%s?", "%le", channelName, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":TRIG:A:LEV:%s %le", channelName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLevelByCh_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      tSource[BUFFER_SIZE];
    ViInt32     triggerType;
    ViReal64    ext = 0.0;
    
    checkErr( Ivi_CoerceChannelName (vi, channelName, VI_NULL) );
    
    if( !strstr(channelName, "CH") && !strstr(channelName, "D") )
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);         
    }
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    
    if (!(triggerType == TKDPO4K_VAL_EDGE_TRIGGER || 
          triggerType == TKDPO4K_VAL_GLITCH_TRIGGER)) 
    {
         viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Cannot set trigger level when "
                         "trigger type is not Edge or Glitch Trigger.");
    }

    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
              0, BUFFER_SIZE, tSource));
    
    if (!strcmp (tSource, TKDPO4K_VAL_EXTERNAL))
        ext = 1.0;
    
    if (ext != 0.0)
    {   /*- Trigger source is External -*/
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, -8.0 * ext, 8.0 * ext));
    }
    else if (strcmp(tSource, TKDPO4K_VAL_AC_LINE) == 0)
    {   /*- Trigger source is AC Line -*/
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Cannot set trigger level when "
                                                             "trigger source is AC line.");
    } 
    else if (strstr (channelName, "CH"))
    {   /*- Trigger source is input channel -*/
        ViReal64      rangeLimit, limit;
        
        checkErr( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit));

        limit = rangeLimit*0.8;                                            
        /******************************************************************** 
         * In old firmware version, trigger level limitation of 40 exists.
         * But it is removed in new firmware version.
         * So remove the limitation of 40 from the check callback function.

        if(limit > 40)
        {
            limit = 40;
        }

        *********************************************************************/  
        
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH -*/
static ViStatus _VI_FUNC tkdpo4kAttrTriggerUpperthresByCh_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr ( viQueryf (io, ":TRIGger:A:UPPerthreshold:%s?", "%le", channelName, value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerUpperthresByCh_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr ( viPrintf (io, ":TRIGger:A:UPPerthreshold:%s %le", channelName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerThresholdByCh_CheckCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    
    if( !((strcmp (channelName, "CH1") == 0)
            || (strcmp (channelName, "CH2") == 0)
                || (strcmp (channelName, "CH3") == 0)
                    || (strcmp (channelName, "CH4") == 0)
                        || (strcmp(channelName, "RF") ==0)) )
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    } 
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    if (!((triggerType == TKDPO4K_VAL_RUNT_TRIGGER)
            || (triggerType == TKDPO4K_VAL_TRANSITION_TRIGGER)))
    {               
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );

    limit = rangeLimit*0.8;
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, -limit, limit)); 
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH -*/
static ViStatus _VI_FUNC tkdpo4kAttrTriggerLowerthresByCh_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr ( viQueryf (io, ":TRIGger:A:LOWerthreshold:%s?", "%le", channelName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerLowerthresByCh_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr ( viPrintf (io, ":TRIGger:A:LOWerthreshold:%s %le", channelName, value) );

Error:
    return error;
}


    /*- TKDPO4K_ATTR_TRIGGER_HOLDOFF -*/
static IviRangeTableEntry attrTriggerHoldoffRangeTableEntries[] =
{
    {0.0,       20.0e-9,    0,  "",     0},
    {20.0e-9,   8.0,        0,  "",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrTriggerHoldoffRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    "",
    attrTriggerHoldoffRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr ( viQueryf (io, ":TRIG:A:HOLD:TIM?", "%lf", value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr ( viPrintf (io, ":TRIG:A:HOLD:TIM %le", value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTriggerHoldoff_CoerceCallback (ViSession vi, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 value, 
                                                                    ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;
    ViInt32  comparePrecision;
    
    checkErr( Ivi_GetAttrComparePrecision (vi, attributeId, &comparePrecision));

    if ((value >= 0) && (value <= 20.0e-9))
    {
        newValue = 20.0e-9;
    }
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 2.0e-9, comparePrecision, &newValue));
    }
   
Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_MODIFIER -*/
static IviRangeTableEntry attrTriggerModifierRangeTableEntries[] =
{
    {TKDPO4K_VAL_NO_TRIGGER_MOD,    0,  0,  "NORMAL",  0}, 
    {TKDPO4K_VAL_AUTO,              0,  0,  "AUTO",    0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   

static IviRangeTable  attrTriggerModifierRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:A:MOD",
    attrTriggerModifierRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_TRIGGER_COUPLING -*/
static IviRangeTableEntry attrDPO4KTriggerCouplingRangeTableEntries[] =
{ 
    {TKDPO4K_VAL_DC,            0,  0,  "DC",       0},
    {TKDPO4K_VAL_LF_REJECT,     0,  0,  "LFREJ",    0}, 
    {TKDPO4K_VAL_HF_REJECT,     0,  0,  "HFREJ",    0}, 
    {TKDPO4K_VAL_NOISE_REJECT,  0,  0,  "NOISEREJ", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   

static IviRangeTable  attrDPO4KTriggerCouplingRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:A:EDGE:COUP", 
    attrDPO4KTriggerCouplingRangeTableEntries, 
};

static IviRangeTableEntry attrDPO3KTriggerCouplingRangeTableEntries[] =
{ 
    {TKDPO4K_VAL_DC,            0,  0,  "DC",       0},
    {TKDPO4K_VAL_AC,            0,  0,  "AC",       0},
    {TKDPO4K_VAL_LF_REJECT,     0,  0,  "LFREJ",    0}, 
    {TKDPO4K_VAL_HF_REJECT,     0,  0,  "HFREJ",    0}, 
    {TKDPO4K_VAL_NOISE_REJECT,  0,  0,  "NOISEREJ", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   

static IviRangeTable  attrDPO3KTriggerCouplingRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:A:EDGE:COUP", 
    attrDPO3KTriggerCouplingRangeTableEntries, 
};

static ViStatus _VI_FUNC tkdpo4kAttrTriggerCoupling_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KTriggerCouplingRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KTriggerCouplingRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TRIGGER_SLOPE -*/
static IviRangeTableEntry attrTriggerSlopeRangeTableEntries[] =
{ 
    {TKDPO4K_VAL_POSITIVE,     0,   0,  "RISE", 0}, 
    {TKDPO4K_VAL_NEGATIVE,     0,   0,  "FALL", 0}, 
    {TKDPO4K_VAL_EITHER,       0,   0,  "EITHER", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   

static IviRangeTable  attrTriggerSlopeRangeTable =
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:A:EDGE:SLO", 
    attrTriggerSlopeRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE -*/
static IviRangeTableEntry attrDPO4KSerialTriggerSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_BUS1, 0, 0, "B1", 0},
    {TKDPO4K_VAL_BUS2, 0, 0, "B2", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KSerialTriggerSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    "TRIGGER:A:BUS:SOURCE",
    attrDPO4KSerialTriggerSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KSerialTriggerSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_BUS1, 0, 0, "B1", 0},
    {TKDPO4K_VAL_BUS2, 0, 0, "B2", 0},
    {TKDPO4K_VAL_BUS3, 0, 0, "B3", 0},
    {TKDPO4K_VAL_BUS4, 0, 0, "B4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KSerialTriggerSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    "TRIGGER:A:BUS:SOURCE",
    attrMSO4KSerialTriggerSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSerialTriggerSource_RangeTableCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_MSO4K (instrModelNo))
    {
        tblPtr = &attrMSO4KSerialTriggerSourceRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KSerialTriggerSourceRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_POLARITY -*/
static IviRangeTableEntry attrTvTriggerPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_TV_POSITIVE,   0, 0, "POSITIVE", 0},
    {TKDPO4K_VAL_TV_NEGATIVE,   0, 0, "NEGATIVE", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrTvTriggerPolarityRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:VID:POL",
    attrTvTriggerPolarityRangeTableEntries,
};

    /*- TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT -*/
static IviRangeTableEntry attrDPO4KTvTriggerSignalFormatRangeTableEntries[] =
{
    {TKDPO4K_VAL_NTSC,          0, 0, "NTSC",           0},
    {TKDPO4K_VAL_PAL,           0, 0, "PAL",            0},
    {TKDPO4K_VAL_SECAM,         0, 0, "SECAM",          0},
    {TKDPO4K_VAL_BILEVELCUSTOM, 0, 0, "BILEVELCUSTOM",  0},
    {TKDPO4K_VAL_TRILEVELCUSTOM,0, 0, "TRILEVELCUSTOM", 0},
    {TKDPO4K_VAL_HD480P60,      0, 0, "HD480P60",       0},  
    {TKDPO4K_VAL_HD576P50,      0, 0, "HD576P50",       0},  
    {TKDPO4K_VAL_HD720P30,      0, 0, "HD720P30",       0},  
    {TKDPO4K_VAL_HD720P50,      0, 0, "HD720P50",       0},
    {TKDPO4K_VAL_HD720P60,      0, 0, "HD720P60",       0},
    {TKDPO4K_VAL_HD875I60,      0, 0, "HD875I60",       0},
    {TKDPO4K_VAL_HD1080P24,     0, 0, "HD1080P24",      0},
    {TKDPO4K_VAL_HD1080SF24,    0, 0, "HD1080SF24",     0},
    {TKDPO4K_VAL_HD1080I50,     0, 0, "HD1080I50",      0},
    {TKDPO4K_VAL_HD1080I60,     0, 0, "HD1080I60",      0},
    {TKDPO4K_VAL_HD1080P25,     0, 0, "HD1080P25",      0},
    {TKDPO4K_VAL_HD1080P30,     0, 0, "HD1080P30",      0},
    {TKDPO4K_VAL_HD1080P50,     0, 0, "HD1080P50",      0},
    {TKDPO4K_VAL_HD1080P60,     0, 0, "HD1080P60",      0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};         /*HDTV and CUSTOM type is not suported any more in new firmware in 4k model*/

static IviRangeTable attrDPO4KTvTriggerSignalFormatRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    VI_NULL,
    attrDPO4KTvTriggerSignalFormatRangeTableEntries,
};

static IviRangeTableEntry attrDPO3KTvTriggerSignalFormatRangeTableEntries[] =   
    {
        {TKDPO4K_VAL_NTSC, 0, 0, "NTSC", 0},
        {TKDPO4K_VAL_PAL, 0, 0, "PAL", 0},
        {TKDPO4K_VAL_SECAM, 0, 0, "SECAM", 0},
        {TKDPO4K_VAL_HDTV, 0, 0, "HDTV", 0},
        {TKDPO4K_VAL_BILEVELCUSTOM, 0, 0, "BILEVELCUSTOM", 0},
        {TKDPO4K_VAL_TRILEVELCUSTOM, 0, 0, "TRILEVELCUSTOM", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDPO3KTvTriggerSignalFormatRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        VI_NULL,
        attrDPO3KTvTriggerSignalFormatRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_ReadCallback (ViSession vi, 
                                                                       ViSession io, 
                                                                       ViConstString channelName, 
                                                                       ViAttr attributeId, 
                                                                       ViInt32 *value)
{
    ViChar      buf[BUFFER_SIZE];
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr rangeTable;
    
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));
    
    viCheckErr( viQueryf(io, ":TRIG:A:VID:STAN?", "%s", buf));
    
    if (Ivi_GetViInt32EntryFromString (buf, rangeTable, value, 
                                       VI_NULL, VI_NULL, VI_NULL, VI_NULL) < VI_SUCCESS)                                   
        viCheckErr( VI_ERROR_INV_RESPONSE);
        
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_WriteCallback (ViSession vi, 
                                                                        ViSession io, 
                                                                        ViConstString channelName, 
                                                                        ViAttr attributeId, 
                                                                        ViInt32 value)
{
    ViStatus    error    = VI_SUCCESS;
    ViString    tvTriggerSignalTypeStr;
    ViAttr      videoSignalType = value;
    IviRangeTablePtr rangeTable;
    
    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &rangeTable));
    
        /* Set the base type */
    checkErr( Ivi_GetViInt32EntryFromValue (videoSignalType, rangeTable, 
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, 
                                            &tvTriggerSignalTypeStr, VI_NULL));

    viCheckErr( viPrintf (io, ":TRIG:A:VID:STAN %s;", tvTriggerSignalTypeStr));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerSignalFormat_RangeTableCallback (ViSession vi,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KTvTriggerSignalFormatRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KTvTriggerSignalFormatRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_EVENT -*/
static IviRangeTableEntry attrTvTriggerEventRangeTableEntries[] =
{
    {TKDPO4K_VAL_TV_EVENT_FIELD1,       0,  0,  "ODD",          0},  /* ODD  */
    {TKDPO4K_VAL_TV_EVENT_FIELD2,       0,  0,  "EVEN",         0},  /* EVEN */
    {TKDPO4K_VAL_TV_EVENT_ANY_FIELD,    0,  0,  "ALLFIELDS",    0},
    {TKDPO4K_VAL_TV_EVENT_ANY_LINE,     0,  0,  "ALLLINES",     0},
    {TKDPO4K_VAL_TV_EVENT_LINE_NUMBER,  0,  0,  "NUMERIC",      0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrTvTriggerEventRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    "TRIGger:A:VIDeo:FIELD",
    attrTvTriggerEventRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerEvent_WriteCallback (ViSession vi, 
                                                                   ViSession io, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViInt32 value)
{
    ViStatus error = VI_SUCCESS;
    
    checkErr( tkdpo4kStdViInt32_WriteCallback (vi, io, "", attributeId, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerEvent_ReadCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViInt32 *value)
{
    ViStatus  error = VI_SUCCESS;
    
    checkErr( tkdpo4kStdViInt32_ReadCallback (vi, io, "", attributeId, value));

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER -*/
static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_ReadCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViInt32 *value)
{
    ViStatus error = VI_SUCCESS;
    
    viCheckErr( viQueryf(io, ":TRIG:A:VID:LINE?", "%ld", value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_WriteCallback (ViSession vi, 
                                                                  ViSession io, 
                                                                  ViConstString channelName, 
                                                                  ViAttr attributeId, 
                                                                  ViInt32 value)
{
    ViStatus error = VI_SUCCESS;

    viCheckErr( viPrintf (io, ":TRIG:A:VID:LINE %ld;", value));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerLineNumber_CheckCallback  (ViSession vi, 
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId, 
                                                                   ViInt32 value)
{
    ViStatus  error = VI_SUCCESS;
    ViInt32   tvTriggerType, typeRange = 1;
        
        /* Get Trigger Type */
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT, 0, 
                                        &tvTriggerType));
    switch (tvTriggerType)
    {
        case TKDPO4K_VAL_PAL:
        case TKDPO4K_VAL_SECAM:
        case TKDPO4K_VAL_HDTV:
        case TKDPO4K_VAL_CUSTOM:
        case TKDPO4K_VAL_BILEVELCUSTOM: 
        case TKDPO4K_VAL_TRILEVELCUSTOM:
        case TKDPO4K_VAL_HD576P50:
        {
            typeRange = 625;
            break;
        }           
        case TKDPO4K_VAL_NTSC:
        case TKDPO4K_VAL_HD480P60: 
        {
            typeRange = 525;
            break;
        }
        case TKDPO4K_VAL_HD720P30:
        case TKDPO4K_VAL_HD720P50:
        case TKDPO4K_VAL_HD720P60: 
        {
            typeRange = 750;
            break;
        }
        case TKDPO4K_VAL_HD875I60:
        {
            typeRange = 875;
            break;
        }
        case TKDPO4K_VAL_HD1080P24:
        case TKDPO4K_VAL_HD1080SF24:
        case TKDPO4K_VAL_HD1080I50:
        case TKDPO4K_VAL_HD1080I60:
        case TKDPO4K_VAL_HD1080P25: 
        case TKDPO4K_VAL_HD1080P30:
        case TKDPO4K_VAL_HD1080P50:
        case TKDPO4K_VAL_HD1080P60:
        {
            typeRange = 1125;
            break;
        }
    }
    
    error = (value >= 1 && value <= typeRange) ? VI_SUCCESS : IVI_ERROR_INVALID_VALUE;

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT -*/
static IviRangeTableEntry attrDPO4KTvTriggerHdtvFormatRangeTableEntries[] =
    {
        {TKDPO4K_VAL_HDTV_1080P24, 0, 0, "HD1080P24", 0},
        {TKDPO4K_VAL_HDTV_720P60, 0, 0, "HD720P60", 0},
        {TKDPO4K_VAL_HDTV_480P60, 0, 0, "HD480P60", 0},
        {TKDPO4K_VAL_HDTV_1080I50, 0, 0, "HD1080I50", 0},
        {TKDPO4K_VAL_HDTV_1080P25, 0, 0, "HD1080P25", 0},
        {TKDPO4K_VAL_HDTV_1080I60, 0, 0, "HD1080I60", 0},
        {TKDPO4K_VAL_HDTV_1080PSF24, 0, 0, "HD1080SF24", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDPO4KTvTriggerHdtvFormatRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        "TRIG:A:VID:HD:FORM",
        attrDPO4KTvTriggerHdtvFormatRangeTableEntries,
    };

static IviRangeTableEntry attrDPO3KTvTriggerHdtvFormatRangeTableEntries[] =
    {
        {TKDPO4K_VAL_HDTV_1080P24, 0, 0, "HD1080P24", 0},
        {TKDPO4K_VAL_HDTV_720P60, 0, 0, "HD720P60", 0},
        {TKDPO4K_VAL_HDTV_480P60, 0, 0, "HD480P60", 0},
        {TKDPO4K_VAL_HDTV_1080I50, 0, 0, "HD1080I50", 0},
        {TKDPO4K_VAL_HDTV_1080P25, 0, 0, "HD1080P25", 0},
        {TKDPO4K_VAL_HDTV_1080I60, 0, 0, "HD1080I60", 0},
        {TKDPO4K_VAL_HDTV_1080PSF24, 0, 0, "HD1080SF24", 0},
        {TKDPO4K_VAL_HDTV_576P50, 0, 0, "HD576P50", 0},
        {TKDPO4K_VAL_HDTV_720P30, 0, 0, "HD720P30", 0},
        {TKDPO4K_VAL_HDTV_720P50, 0, 0, "HD720P50", 0},
        {TKDPO4K_VAL_HDTV_875I60, 0, 0, "HD875I60", 0},
        {TKDPO4K_VAL_HDTV_1080P30, 0, 0, "HD1080P30", 0},
        {TKDPO4K_VAL_HDTV_1080P50, 0, 0, "HD1080P50", 0},
        {TKDPO4K_VAL_HDTV_1080P60, 0, 0, "HD1080P60", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrDPO3KTvTriggerHdtvFormatRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        "TRIG:A:VID:HD:FORM",
        attrDPO3KTvTriggerHdtvFormatRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
       
    checkErr( tkdpo4kStdViInt32_ReadCallback (vi, io, "", attributeId, value));   
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( tkdpo4kStdViInt32_WriteCallback (vi, io, "", attributeId, value));    
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerHdtvFormat_RangeTableCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KTvTriggerHdtvFormatRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KTvTriggerHdtvFormatRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_FIELD_HOLDOFF -*/
static IviRangeTableEntry attrTvTriggerFieldHoldoffRangeTableEntries[] =
    {
        {0, 8.5, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrTvTriggerFieldHoldoffRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrTvTriggerFieldHoldoffRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerFieldHoldoff_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf (io, "TRIG:A:VID:HOLD:FIELD?", "%Lf", value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerFieldHoldoff_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, "TRIG:A:VID:HOLD:FIELD %Lf", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_FORMAT -*/
static IviRangeTableEntry attrTvTriggerCustomFormatRangeTableEntries[] =
    {
        {TKDPO4K_VAL_TV_CUSTOM_INTERLACED,  0, 0, "INTERLA", 0},
        {TKDPO4K_VAL_TV_CUSTOM_PROGRESSIVE, 0, 0, "PROG", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrTvTriggerCustomFormatRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "TRIG:A:VID:CUST:FORM",
        attrTvTriggerCustomFormatRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomFormat_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( tkdpo4kStdViInt32_ReadCallback (vi, io, "", attributeId, value));     
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomFormat_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( tkdpo4kStdViInt32_WriteCallback (vi, io, "", attributeId, value));        
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SCAN_RATE -*/
static IviRangeTableEntry attrTvTriggerCustomScanRateRangeTableEntries[] =
    {
        {TKDPO4K_VAL_TV_RATE15K, 0, 0, "RATE15K", 0},
        {TKDPO4K_VAL_TV_RATE20K, 0, 0, "RATE20K", 0},
        {TKDPO4K_VAL_TV_RATE25K, 0, 0, "RATE25K", 0},
        {TKDPO4K_VAL_TV_RATE35K, 0, 0, "RATE35K", 0},
        {TKDPO4K_VAL_TV_RATE50K, 0, 0, "RATE50K", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrTvTriggerCustomScanRateRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "TRIG:A:VID:CUST:SCAN",
        attrTvTriggerCustomScanRateRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomScanRate_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( tkdpo4kStdViInt32_ReadCallback (vi, io, "", attributeId, value));     
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomScanRate_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( tkdpo4kStdViInt32_WriteCallback (vi, io, "", attributeId, value));    
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_LINE_PERIOD -*/
static IviRangeTableEntry attrTvTriggerCustomLinePeriodRangeTableEntries[] =
    {
        {0, 500E-6, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrTvTriggerCustomLinePeriodRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrTvTriggerCustomLinePeriodRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomLinePeriod_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf (io, ":TRIG:A:VID:CUST:LINEP?", "%Lf", value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomLinePeriod_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":TRIG:A:VID:CUST:LINEP %Lf", value) );          

Error:
    return error;
}

    /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SYNC_INTERVAL -*/ 
static IviRangeTableEntry attrTvTriggerCustomSyncIntervalRangeTableEntries[] =
    {
        {0, 200E-6, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrTvTriggerCustomSyncIntervalRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrTvTriggerCustomSyncIntervalRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomSyncInterval_ReadCallback (ViSession vi,
                                                                              ViSession io,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf (io, ":TRIG:A:VID:CUST:SYNCI?", "%Lf", value));    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTvTriggerCustomSyncInterval_WriteCallback (ViSession vi,
                                                                               ViSession io,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":TRIG:A:VID:CUST:SYNCI %Lf", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD -*/
static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    checkErr ( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                            0, value ) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_ReadCallback (ViSession vi, 
                                                                        ViSession io, 
                                                                        ViConstString channelName, 
                                                                        ViAttr attributeId, 
                                                                        ViReal64 *value)
{
    ViStatus  error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)
                        ||(strcmp(channel, "RF") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                            0, value ) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRuntHighThreshold_CheckCallback (ViSession vi, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    ViChar      triggerSource[BUFFER_SIZE]; 
    ViString    channel;    
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, triggerSource));
    checkErr( Ivi_CoerceChannelName(vi, triggerSource, &channel) ); 
    
    if( !((strcmp (channel, "CH1") == 0)
            || (strcmp (channel, "CH2") == 0)
                || (strcmp (channel, "CH3") == 0)
                    || (strcmp (channel, "CH4") == 0)
                        ||(strcmp (channel, "RF") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    } 
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    if (!(triggerType == TKDPO4K_VAL_RUNT_TRIGGER))
    {               
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }   
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );
                                            
    limit = rangeLimit*0.8;
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));

Error:
    return error;                                                    
}


    /*- TKDPO4K_ATTR_RUNT_LOW_THRESHOLD -*/
static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_WriteCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
  
    checkErr ( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                            0, value ) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_ReadCallback (ViSession vi, 
                                                                    ViSession io, 
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId, 
                                                                    ViReal64 *value)
{
    ViStatus  error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)
                        ||(strcmp(channel,"RF") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                            0, value ) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRuntLowThreshold_CheckCallback (ViSession vi, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    ViChar      triggerSource[BUFFER_SIZE]; 
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, triggerSource));
    checkErr( Ivi_CoerceChannelName(vi, triggerSource, &channel) );
                                                
    if( !((strcmp (channel, "CH1") == 0)
            || (strcmp (channel, "CH2") == 0)
                || (strcmp (channel, "CH3") == 0)
                    || (strcmp (channel, "CH4") == 0)
                        ||(strcmp (channel, "RF") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    } 
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    if (!(triggerType == TKDPO4K_VAL_RUNT_TRIGGER))
    {               
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }   
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );
    limit = rangeLimit*0.8;
    
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));

Error:
    return error; 
}
    

    /*- TKDPO4K_ATTR_RUNT_POLARITY -*/
static IviRangeTableEntry attrRuntPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_RUNT_POSITIVE, 0, 0, "POSITIVE", 0},
    {TKDPO4K_VAL_RUNT_NEGATIVE, 0, 0, "NEGATIVE", 0},
    {TKDPO4K_VAL_RUNT_EITHER,   0, 0, "EITHER",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
        
static IviRangeTable attrRuntPolarityRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:PUL:RUNT:POL",
    attrRuntPolarityRangeTableEntries,
};

    /*- TKDPO4K_ATTR_RUNT_WHEN -*/
static IviRangeTableEntry attrRuntWhenRangeTableEntries[] =
{
    {TKDPO4K_VAL_RUNT_WHEN_OCCURS,      0,  0, "OCCURS",    0},
    {TKDPO4K_VAL_RUNT_WHEN_WIDER_THAN,  0,  0, "MORETHAN",  0},
    {TKDPO4K_VAL_RUNT_WHEN_LESS_THAN,   0,  0, "LESSTHAN",  0},
    {TKDPO4K_VAL_RUNT_WHEN_EQUAL,       0,  0, "EQUAL",     0},
    {TKDPO4K_VAL_RUNT_WHEN_NOTEQUAL,    0,  0, "UNEQUAL",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
        
static IviRangeTable attrRuntWhenRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:PUL:RUNT:WHE",
    attrRuntWhenRangeTableEntries,
};

    /*- TKDPO4K_ATTR_RUNT_WIDTH -*/
static IviRangeTableEntry attrRuntWidthRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8.0,    0,  "",     0}, 
     *************************************/
     
    {4.0e-9,    8.0,    0,  "",     0},                                                                                                                                                                                                    
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrRuntWidthRangeTable =
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":TRIG:A:PUL:RUNT:WID", 
    attrRuntWidthRangeTableEntries, 
};

static ViStatus _VI_FUNC tkdpo4kAttrRuntWidth_CoerceCallback (ViSession vi, ViConstString channelName, 
                                                               ViAttr attributeId, 
                                                               ViReal64 value, 
                                                               ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;
    
    /**************************************************************************
     * The resolution in old firmware version is 0.5ns, but 0.8ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    
    ***************************************************************************/
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue) );
    
Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_GLITCH_POLARITY -*/
static IviRangeTableEntry attrGlitchPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_GLITCH_POSITIVE,  0,   0,  "POSITIVE", 0}, 
    {TKDPO4K_VAL_GLITCH_NEGATIVE,  0,   0,  "NEGATIVE", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable  attrGlitchPolarityRangeTable =
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    "TRIG:A:PUL:WID:POL", 
    attrGlitchPolarityRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_GLITCH_CONDITION -*/
static IviRangeTableEntry attrGlitchConditionRangeTableEntries[] =
{
    {TKDPO4K_VAL_GLITCH_GREATER_THAN,      0, 0, "MORETHAN",   0},
    {TKDPO4K_VAL_GLITCH_LESS_THAN,         0, 0, "LESSTHAN",   0},
    {TKDPO4K_VAL_GLITCH_WITHIN_5_PERCENT,  0, 0, "EQUAL",      0},
    {TKDPO4K_VAL_GLITCH_OUTSIDE_5_PERCENT, 0, 0, "UNEQUAL",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrGlitchConditionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:PUL:WID:WHE",
    attrGlitchConditionRangeTableEntries,
};

    /*- TKDPO4K_ATTR_GLITCH_WIDTH -*/
static IviRangeTableEntry attrGlitchWidthRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8.0,    0,      "",     0}, 
     *************************************/
    
    {4.0e-09,   8.0,    0,      "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable  attrGlitchWidthRangeTable =
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":TRIG:A:PUL:WID:WID", 
    attrGlitchWidthRangeTableEntries, 
};

static ViStatus _VI_FUNC tkdpo4kAttrGlitchWidth_CoerceCallback (ViSession vi,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 value,
                                                           ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;
    
    /**************************************************************************
     * The resolution in old firmware version is 0.5ns, but 0.8ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    
    ***************************************************************************/
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));
    
Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE -*/
static IviRangeTableEntry attrAcLineTriggerSlopeRangeTableEntries[] =
{
    {TKDPO4K_VAL_AC_LINE_POSITIVE, 0, 0, "", 0},
    {TKDPO4K_VAL_AC_LINE_NEGATIVE, 0, 0, "", 0},
    {TKDPO4K_VAL_AC_LINE_EITHER,   0, 0, "", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrAcLineTriggerSlopeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrAcLineTriggerSlopeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrAcLineTriggerSlope_ReadCallback (ViSession vi, 
                                                                     ViSession io,
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     val;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SLOPE, 0, &val));
    if (val == TKDPO4K_VAL_POSITIVE)
    {
        val = TKDPO4K_VAL_AC_LINE_POSITIVE;
    }
    else if (val == TKDPO4K_VAL_NEGATIVE)
    {
        val = TKDPO4K_VAL_AC_LINE_NEGATIVE;
    }
    else if (val == TKDPO4K_VAL_EITHER)
    {
        val = TKDPO4K_VAL_AC_LINE_EITHER;   
    }
    
    *value = val;

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAcLineTriggerSlope_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     newVal = TKDPO4K_VAL_NEGATIVE;
    ViInt32     modelNo;
    
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));
    
    if (value == TKDPO4K_VAL_AC_LINE_POSITIVE)
    {
        newVal = TKDPO4K_VAL_POSITIVE;
    }
    else if (value == TKDPO4K_VAL_AC_LINE_EITHER)    /*Only available for MOD3K*/
    {
        if(IS_MDO3K (modelNo))
        {
            newVal = TKDPO4K_VAL_EITHER; 
        }
        else
        {
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);
        }
    }        
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SLOPE, 0, newVal));
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_ACQUISITION_TYPE -*/
static IviRangeTableEntry attrAcquisitionTypeRangeTableEntries[] =
{
    {TKDPO4K_VAL_NORMAL,        0, 0, "SAMPLE",     0},
    {TKDPO4K_VAL_HI_RES,        0, 0, "HIRES",      0},
    {TKDPO4K_VAL_PEAK_DETECT,   0, 0, "PEAKDETECT", 0},
    {TKDPO4K_VAL_ENVELOPE,      0, 0, "ENVELOPE",   0},
    {TKDPO4K_VAL_AVERAGE,       0, 0, "AVERAGE",    0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
    
static IviRangeTable attrAcquisitionTypeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":ACQ:MOD",
    attrAcquisitionTypeRangeTableEntries,
};

    /*- TKDPO4K_ATTR_ACQUISITION_START_TIME -*/
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_WriteCallback (ViSession vi, 
                                                              ViSession io, 
                                                              ViConstString channelName, 
                                                              ViAttr attributeId, 
                                                              ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    horzTime, sendTime;
    
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                        0, &horzTime));
    sendTime = value + horzTime*(50)/100.0;
    viCheckErr( viPrintf (io, ":HOR:DEL:TIM %le", sendTime));
    
Error:
    return error;
}
 
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_ReadCallback (ViSession vi, 
                                                             ViSession io, 
                                                             ViConstString channelName, 
                                                             ViAttr attributeId, 
                                                             ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    delay, horzTime;
    
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                        0, &horzTime));
    viCheckErr( viQueryf (io, ":HOR:DEL:TIM?", "%le", &delay));
    *value = delay - horzTime*(50)/100.0;

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_CheckCallback (ViSession vi, 
                                                                         ViConstString channelName, 
                                                                         ViAttr attributeId, 
                                                                         ViReal64 value)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 horzTime;
    ViInt32 recordLength;
    ViReal64 bottomValue = 200.0e-9;
    
    checkErr( Ivi_GetAttributeViReal64 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                        0, &horzTime));
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 0, &recordLength) );
    if(recordLength >= 10000000)
    {
        bottomValue = 2.0e-3;                   /* 2ms */
    }
    else if(recordLength >= 1000000)
    {
        bottomValue = 200.0e-6;                 /* 200us */ 
    }
    else if(recordLength >= 100000)
    {
        bottomValue = 20.0e-6;                  /* 20us */ 
    }
    else if(recordLength >= 10000)
    {
        bottomValue = 2.0e-6;                   /* 2us */ 
    }
    else if(recordLength >= 1000)
    {
        bottomValue = 200.0e-9;                 /* 200ns */ 
    }
    
    /* Range: -horzTime ~ 50.0 when the horizontal time is greater than bottomValue */
    if(horzTime > bottomValue)
    {
        if ((value < -horzTime) || (value > 50.0))
        {
            viCheckErr( IVI_ERROR_INVALID_VALUE);             
        }       
    }
    /* Range: -2us ~ 50.0 when the horizontal time is equal to or lesser than bottomValue */
    else
    {
        if ((value < -bottomValue) || (value > 50.0))
        {
            viCheckErr( IVI_ERROR_INVALID_VALUE);       
        }
    }
        
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionStartTime_CoerceCallback (ViSession vi, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value, 
                                                                      ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;
    ViInt32  comparePrecision;
    
    checkErr( Ivi_GetAttrComparePrecision (vi, attributeId, &comparePrecision));

    /**************************************************************************************
     * The resolution in old firmware version is 4ns, but 400ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 4.0e-9, comparePrecision, &newValue));
    ***************************************************************************************/
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 400.0e-9, comparePrecision, &newValue));

Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_INITIATE_CONTINUOUS -*/
static ViStatus _VI_FUNC tkdpo4kAttrInitiateContinuous_ReadCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      rdBuf[256];

    viCheckErr( viQueryf (io, ":ACQ:STOPA?", "%s", rdBuf));
    *value = (rdBuf[0] == 'R');

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrInitiateContinuous_WriteCallback (ViSession vi, 
                                                                       ViSession io, 
                                                                       ViConstString channelName, 
                                                                       ViAttr attributeId, 
                                                                       ViBoolean value)

{
    ViStatus    error = VI_SUCCESS;

    if(value == VI_TRUE)
    {
        viCheckErr( viPrintf (io, ":ACQ:STOPA %s", "RUNST") );  
    }
    else
    {
        viCheckErr( viPrintf (io, ":ACQ:STOPA %s", "SEQ") );    
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_NUM_AVERAGES -*/
static IviRangeTableEntry attrNumAveragesRangeTableEntries[] =
    {
        {0, 2, 2, "2", 0},
        {2, 4, 4, "4", 0},
        {4, 8, 8, "8", 0},
        {8, 16, 16, "16", 0},
        {16, 32, 32, "32", 0},
        {32, 64, 64, "64", 0},
        {64, 128, 128, "128", 0},
        {128, 256, 256, "256", 0},
        {256, 512, 512, "512", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };
   
static IviRangeTable attrNumAveragesRangeTable =
    {
        IVI_VAL_COERCED,
        VI_FALSE,
        VI_TRUE,
        ":ACQ:NUMAV",
        attrNumAveragesRangeTableEntries,
    };

    /*- TKDPO4K_ATTR_NUM_ENVELOPES -*/
static IviRangeTableEntry attrNumEnvelopesRangeTableEntries[] =
{
    {TKDPO4K_VAL_INFINITE, TKDPO4K_VAL_INFINITE, 0, "0", 0},
    {1, 2000, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrNumEnvelopesRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    "",  
    attrNumEnvelopesRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrNumEnvelopes_ReadCallback (ViSession vi, 
                                                                ViSession io,
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViInt32 *value)
{
    ViStatus error = VI_SUCCESS; 
    ViChar buf[BUFFER_SIZE];

    if (!Ivi_Simulating (vi))
    {
        viCheckErr( viQueryf (io, ":ACQ:NUME?", "%s", buf) );
        if( strstr(buf, "INFINITE") )
        {
            *value = TKDPO4K_VAL_INFINITE;
        }
        else
        {
            sscanf(buf,"%d",value);  
        }
    }
Error:
    return error;
}
                                                                
static ViStatus _VI_FUNC tkdpo4kAttrNumEnvelopes_WriteCallback (ViSession vi, 
                                                                 ViSession io, 
                                                                 ViConstString channelName, 
                                                                 ViAttr attributeId, 
                                                                 ViInt32 value)

{
    ViStatus error = VI_SUCCESS;
    
    if (!Ivi_Simulating (vi))
    {
        if (value == TKDPO4K_VAL_INFINITE)
        {
            viCheckErr( viPrintf (io, ":ACQ:NUME INFI;"));
        }
        else
        {
            viCheckErr( viPrintf (io, ":ACQ:NUME %ld;", value));  
        }
    }
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_MODE  -*/
static IviRangeTableEntry attrDelayTriggerModeRangeTableEntries[] =
{
    {TKDPO4K_VAL_TRIG_AFTER_TIME,   0, 0, "TIME",   0},
    {TKDPO4K_VAL_TRIG_AFTER_EVENTS, 0, 0, "EVENTS", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrDelayTriggerModeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:B:BY",
    attrDelayTriggerModeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerMode_CheckCallback (ViSession vi, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViInt32 value)
{
    ViStatus error = VI_SUCCESS;
    ViInt32  triggerType;   

    
    checkErr( Ivi_DefaultCheckCallbackViInt32 (vi, "", TKDPO4K_ATTR_DELAY_TRIGGER_MODE, 
                                               value));
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE,  
                                      0, &triggerType));

    if ((triggerType != TKDPO4K_VAL_EDGE_TRIGGER) && 
                (triggerType != TKDPO4K_VAL_TV_TRIGGER))
    {
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                            "The trigger type must be set to TKDPO4K_VAL_EDGE_TRIGGER "
                            "or TKDPO4K_VAL_TV_TRIGGER for the Delay Trigger Mode you "
                            "selected.");
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_EVENTS -*/
static IviRangeTableEntry attrDelayTriggerEventsRangeTableEntries[] =
{ 
    {1,     9999999,    0,      "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable  attrDelayTriggerEventsRangeTable =       
{
    IVI_VAL_RANGED, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:B:EVENTS:COUN", 
    attrDelayTriggerEventsRangeTableEntries, 
};
    
    /*- TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING -*/
static IviRangeTableEntry attrDPO4KDelayTriggerCouplingRangeTableEntries[] =
{
    {TKDPO4K_VAL_DC,            0,      0,          "DC",       0},
    {TKDPO4K_VAL_HF_REJECT,     0,      0,          "HFREJ",    0},
    {TKDPO4K_VAL_LF_REJECT,     0,      0,          "LFREJ",    0},
    {TKDPO4K_VAL_NOISE_REJECT,  0,      0,          "NOISEREJ", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrDPO4KDelayTriggerCouplingRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:B:EDGE:COUP",
    attrDPO4KDelayTriggerCouplingRangeTableEntries,
};

static IviRangeTableEntry attrDPO3KDelayTriggerCouplingRangeTableEntries[] =
{
    {TKDPO4K_VAL_DC,            0,      0,          "DC",       0},
    {TKDPO4K_VAL_AC,            0,      0,          "AC",       0},
    {TKDPO4K_VAL_HF_REJECT,     0,      0,          "HFREJ",    0},
    {TKDPO4K_VAL_LF_REJECT,     0,      0,          "LFREJ",    0},
    {TKDPO4K_VAL_NOISE_REJECT,  0,      0,          "NOISEREJ", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
   
static IviRangeTable attrDPO3KDelayTriggerCouplingRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:B:EDGE:COUP",
    attrDPO3KDelayTriggerCouplingRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerCoupling_RangeTableCallback (ViSession vi,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_DPO3K (instrModelNo))
    {
        tblPtr = &attrDPO3KDelayTriggerCouplingRangeTable; 
    }
    else
    {
        tblPtr = &attrDPO4KDelayTriggerCouplingRangeTable;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_SLOPE -*/
static IviRangeTableEntry attrDelayTriggerSlopeRangeTableEntries[] =
{ 
    {TKDPO4K_VAL_POSITIVE,  0,  0,  "RISE", 0}, 
    {TKDPO4K_VAL_NEGATIVE,  0,  0,  "FALL", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   
static IviRangeTable  attrDelayTriggerSlopeRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":TRIG:B:EDGE:SLO", 
    attrDelayTriggerSlopeRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL -*/
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_ReadCallback (ViSession vi, 
                                                                     ViSession io, 
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId, 
                                                                     ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf(io, ":TRIG:B:LEV?", "%le", value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_WriteCallback (ViSession vi, 
                                                                      ViSession io, 
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value)

{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":TRIG:B:LEV %le;", value));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerLevel_CheckCallback  (ViSession vi, 
                                                                       ViConstString channelName, 
                                                                       ViAttr attributeId, 
                                                                       ViReal64 value)
{
    ViChar      tSource[BUFFER_SIZE];
    ViStatus    error = VI_SUCCESS;
    ViInt32     triggerType;
    ViReal64    ext = 0.0;
    
    checkErr(Ivi_GetAttributeViInt32(vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0, &triggerType));
    
    if (triggerType != TKDPO4K_VAL_EDGE_TRIGGER)
    {
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Delay Trigger Level can"
                        " only be set when the Trigger Type is Edge.");
    }
    
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                            0, BUFFER_SIZE, tSource));
    
    if (!strcmp (tSource, TKDPO4K_VAL_EXTERNAL))
    {
        ext = 1.0;
    }
    
    if (ext != 0.0)
    {   
        /*- Trigger source is External -*/
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, -8.0 * ext, 8.0 * ext));
    }
    else if (strcmp(tSource, TKDPO4K_VAL_AC_LINE) == 0)
    {   
        /*- Trigger source is AC Line -*/
        viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, "Cannot set trigger level when "
                                                             "trigger source is AC line.");
    } 
    else
    {   
        /*- Trigger source is input channel -*/
        ViReal64      rangeLimit, limit;
        ViString      channel;
        
        checkErr( Ivi_CoerceChannelName (vi, tSource, &channel));
        checkErr( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit));
        limit = rangeLimit*0.8;    
                                            
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
        checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));
    }                                                    

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_TIME -*/
static IviRangeTableEntry attrDelayTriggerTimeRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8,  0,  "", 0}, 
     *************************************/
    
    {4.0e-9,    8,  0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDelayTriggerTimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:B:TIM",
    attrDelayTriggerTimeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerTime_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViReal64 value,
                                                                     ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;

    /**************************************************************************
     * The resolution in old firmware version is 0.5ns, but 0.8ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    
    ***************************************************************************/
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));

Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE -*/  
static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_CheckCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    coercedChanStr;

    error = tkdpo4k_GetStr2BufFromStr1 (triggerSourceStringTable, value, VI_NULL);
    if(error < VI_SUCCESS)
    {
        checkErr( Ivi_CoerceChannelName (vi, value, &coercedChanStr) );
        if( (strcmp(coercedChanStr, "RF") != 0) && (strncmp( coercedChanStr, "CH",2) != 0))
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar         rdBuffer[BUFFER_SIZE];  
    size_t        bufSize = sizeof(rdBuffer); 
    ViConstString  sourceName;
    
    viCheckErr( viQueryf (io, ":TRIG:B:EDGE:SOU?", "%#s", &bufSize, rdBuffer) );
    
    error = tkdpo4k_GetStr1PtrFromStr2 (triggerSourceStringTable, &sourceName, rdBuffer);
    if (error < VI_SUCCESS)
    {
            /* Assume the buf contains an instrument channel string. */
        checkErr( Ivi_GetUserChannelName (vi, rdBuffer, &sourceName));
    }

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, sourceName));    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDelayTriggerSource_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      sourceNameBuf[BUFFER_SIZE] = {0}; 
    
    error = tkdpo4k_GetStr2BufFromStr1 (triggerSourceStringTable, value, sourceNameBuf); 
    if(error <  VI_SUCCESS)
    {
        ViConstString chanStr; 
        
        checkErr( Ivi_CoerceChannelName (vi, value, &chanStr));
        sprintf (sourceNameBuf, "%s", chanStr);
    }

    viCheckErr( viPrintf (io, ":TRIG:B:EDGE:SOU %s", sourceNameBuf));   
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_TRANSITION_WHEN -*/
static IviRangeTableEntry attrTransitionWhenRangeTableEntries[] =
{
    {TKDPO4K_VAL_TRANSITION_FASTER_THAN,    0,  0,  "FASTER",   0},
    {TKDPO4K_VAL_TRANSITION_SLOWER_THAN,    0,  0,  "SLOWER",   0},
    {TKDPO4K_VAL_TRANSITION_EQUAL,          0,  0,  "EQUAL",    0},
    {TKDPO4K_VAL_TRANSITION_UNEQUAL,        0,  0,  "UNEQUAL",  0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable attrTransitionWhenRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:PUL:TRAN:WHE",
    attrTransitionWhenRangeTableEntries,
};

    /*- TKDPO4K_ATTR_TRANSITION_POLARITY -*/
static IviRangeTableEntry attrTransitionPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_TRANSITION_POSITIVE,   0, 0, "POSITIVE",   0},
    {TKDPO4K_VAL_TRANSITION_NEGATIVE,   0, 0, "NEGATIVE",   0},
    {TKDPO4K_VAL_TRANSITION_EITHER,     0, 0, "EITHER",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable attrTransitionPolarityRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    ":TRIG:A:TRAN:POL",
    attrTransitionPolarityRangeTableEntries,
};
    
    /*- TKDPO4K_ATTR_TRANSITION_DELTA_TIME -*/
static IviRangeTableEntry attrTransitionDeltaTimeRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8,  0,  "", 0}, 
     *************************************/
    
    {4.0e-9,    8,  0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};
static IviRangeTable attrTransitionDeltaTimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:TRAN:DELT",
    attrTransitionDeltaTimeRangeTableEntries,
};
 
static ViStatus _VI_FUNC tkdpo4kAttrTransitionDeltaTime_CoerceCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViReal64 value,
                                                                         ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;

    /**************************************************************************
     * The resolution in old firmware version is 0.5ns, but 0.8ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.25e-9, 12, &newValue));
    
    ***************************************************************************/

    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));

Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD -*/
static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_ReadCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 *value)
{
    ViStatus  error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                            0, value ) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_WriteCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
  
    checkErr ( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                            0, value ) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTransitionHighThreshold_CheckCallback (ViSession vi,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    ViChar      triggerSource[BUFFER_SIZE]; 
    ViString    channel;        
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, triggerSource));
    checkErr( Ivi_CoerceChannelName (vi, triggerSource, &channel) );
                                        
    if( !((strcmp (channel, "CH1") == 0)
            || (strcmp (channel, "CH2") == 0)
                || (strcmp (channel, "CH3") == 0)
                    || (strcmp (channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    } 
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    if (!(triggerType == TKDPO4K_VAL_TRANSITION_TRIGGER))
    {               
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }   
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );
    limit = rangeLimit*0.8;                                     
    
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));

Error:
    return error;                                 
}
                                    

    /*- TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD -*/
static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViReal64 *value)
{
    ViStatus  error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                            0, value ) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE];
    ViString    channel;
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL,  TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, buf));
    checkErr( Ivi_CoerceChannelName (vi, buf, &channel));
    
    if( !((strcmp(channel, "CH1") == 0)
            || (strcmp(channel, "CH2") == 0)
                || (strcmp(channel, "CH3") == 0)
                    || (strcmp(channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
  
    checkErr ( Ivi_SetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                            0, value ) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrTransitionLowThreshold_CheckCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    ViChar      triggerSource[BUFFER_SIZE]; 
    ViString    channel;    
        
    checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                        0, BUFFER_SIZE, triggerSource));
    checkErr( Ivi_CoerceChannelName (vi, triggerSource, &channel));  
    
    if( !((strcmp (channel, "CH1") == 0)
            || (strcmp (channel, "CH2") == 0)
                || (strcmp (channel, "CH3") == 0)
                    || (strcmp (channel, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    } 
    
    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));
    if (!(triggerType == TKDPO4K_VAL_TRANSITION_TRIGGER))
    {               
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }   
    
    checkErr ( Ivi_GetAttributeViReal64 (vi, channel, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );
                                            
    limit = rangeLimit*0.8; 
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));

Error:
    return error;
}
                                    

    /*- Checks validity of logical inputs -*/
    
    /*- TKDPO4K_ATTR_LOGIC_FUNCTION -*/
static IviRangeTableEntry attrLogicFunctionRangeTableEntries[] =
{
    {TKDPO4K_VAL_LOGIC_AND,     0, 0, "AND",    0},
    {TKDPO4K_VAL_LOGIC_NAND,    0, 0, "NAND",   0},
    {TKDPO4K_VAL_LOGIC_NOR,     0, 0, "NOR",    0},
    {TKDPO4K_VAL_LOGIC_OR,      0, 0, "OR",     0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrLogicFunctionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:FUNC",
    attrLogicFunctionRangeTableEntries,
};

    /*- TKDPO4K_ATTR_LOGIC_WHEN -*/
static IviRangeTableEntry attrLogicWhenRangeTableEntries[] =
{
    {TKDPO4K_VAL_LOGIC_TRUE,        0, 0, "TRUE",       0},
    {TKDPO4K_VAL_LOGIC_FALSE,       0, 0, "FALSE",      0},
    {TKDPO4K_VAL_LOGIC_LESSTHAN,    0, 0, "LESSTHAN",   0},
    {TKDPO4K_VAL_LOGIC_MORETHAN,    0, 0, "MORETHAN",   0},
    {TKDPO4K_VAL_LOGIC_EQUAL,       0, 0, "EQUAL",      0},
    {TKDPO4K_VAL_LOGIC_UNEQUAL,     0, 0, "UNEQUAL",    0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrLogicWhenRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:PAT:WHE",
    attrLogicWhenRangeTableEntries,
};

    /*- TKDPO4K_ATTR_LOGIC_INPUT_BY_CH -*/
static IviRangeTableEntry attrLogicInputByChanRangeTableEntries[] =
{
    {TKDPO4K_VAL_LOGIC_HIGH,    0, 0, "HIGH",   0},
    {TKDPO4K_VAL_LOGIC_LOW,     0, 0, "LOW",    0},
    {TKDPO4K_VAL_LOGIC_X,       0, 0, "X",      0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrLogicInputByChanRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrLogicInputByChanRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrLogicInputByCh_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      input[BUFFER_SIZE];
    
    memset(input, 0, sizeof(ViChar)*BUFFER_SIZE);
    
    viCheckErr( viQueryf(io, ":TRIG:A:LOGI:INPut:%s?", "%s", channelName, input) );

    viCheckErr( Ivi_GetViInt32EntryFromString( input, &attrLogicInputByChanRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLogicInputByCh_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    input;

    viCheckErr( Ivi_GetViInt32EntryFromValue( value, &attrLogicInputByChanRangeTable,
                                            VI_NULL, VI_NULL, VI_NULL,
                                            VI_NULL, &input, VI_NULL    ) );

    viCheckErr( viPrintf(io, ":TRIG:A:LOGI:INPut:%s %s;", channelName, input) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_LOGIC_THRES_BY_CH -*/
static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, "TRIG:A:LOGI:THR:%s?", "%le", channelName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viPrintf (io, "TRIG:A:LOGI:THR:%s %le", channelName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLogicThresByCh_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    rangeLimit, limit;
    ViInt32     triggerType;
    
    if( !((strcmp (channelName, "CH1") == 0)
            || (strcmp (channelName, "CH2") == 0)
                || (strcmp (channelName, "CH3") == 0)
                    || (strcmp (channelName, "CH4") == 0)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }

    checkErr(Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_TRIGGER_TYPE, 0,
                                      &triggerType));

    if(!((triggerType == TKDPO4K_VAL_PATTERN_TRIGGER)
            || (triggerType == TKDPO4K_VAL_STATE_TRIGGER)
                || (triggerType == TKDPO4K_VAL_SETHOLD_TRIGGER)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);         
    }

    checkErr ( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &rangeLimit) );
    limit = rangeLimit*0.8;
    
    /******************************************************************** 
     * In old firmware version, trigger level limitation of 40 exists.
     * But it is removed in new firmware version.
     * So remove the limitation of 40 from the check callback function.
    
        if(limit > 40)
        {
            limit = 40;
        }

    *********************************************************************/
    
    checkErr( tkdpo4k_CheckRangeWithPrecision (vi, attributeId, value, 
                                                    -limit, limit));    
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_PATTERN_FUNCTION -*/
static ViStatus _VI_FUNC tkdpo4kAttrPatternFunction_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_FUNCTION,
                                            0, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrPatternFunction_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_FUNCTION,
                                            0, value) );

Error:
    return error;
}    

    /*- TKDPO4K_ATTR_PATTERN_WHEN -*/
static ViStatus _VI_FUNC tkdpo4kAttrPatternWhen_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_WHEN,
                                        0, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrPatternWhen_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

	checkErr ( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_WHEN,
                                            0, value) );

Error:
    return error;
}    

    /*- TKDPO4K_ATTR_PATTERN_INPUT -*/
static ViStatus _VI_FUNC tkdpo4kAttrPatternInput_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr ( Ivi_GetAttributeViInt32 (vi, channelName, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH,
                                            0, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrPatternInput_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr ( Ivi_SetAttributeViInt32 (vi, channelName, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH,
                                            0, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PATTERN_DELTATIME -*/
static IviRangeTableEntry attrPatternDeltatimeRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8,  0,  "", 0}, 
     *************************************/
    
    {4.0e-9,    8.0,    0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrPatternDeltatimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:PAT:WHE:LESSL",
    attrPatternDeltatimeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrPatternDeltatime_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViReal64 value,
                                                                      ViReal64 *coercedValue)
{
    ViStatus error = VI_SUCCESS;
    ViReal64 newValue = value;

    /**************************************************************************
     * The resolution in old firmware version is 0.5ns, but 0.8ns in new 
     * firmware. So remove the old resolution from the driver source code.
     
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    
    ***************************************************************************/

    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));

Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_STATE_FUNCTION -*/
static ViStatus _VI_FUNC tkdpo4kAttrStateFunction_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_FUNCTION,
                                        0, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrStateFunction_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_FUNCTION,
                                        0, value) );

Error:
    return error;
}    

    /*- TKDPO4K_ATTR_STATE_WHEN -*/
static ViStatus _VI_FUNC tkdpo4kAttrStateWhen_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    checkErr( Ivi_SetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_WHEN,
                                        0, value) );
                                        
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrStateWhen_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_LOGIC_WHEN, 
                                        0, value) );
                                        
Error:
    return error;
}

    /*- TKDPO4K_ATTR_STATE_INPUT -*/
static ViStatus _VI_FUNC tkdpo4kAttrStateInput_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_GetAttributeViInt32 (vi, channelName, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH,
                                        0, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrStateInput_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    checkErr( Ivi_SetAttributeViInt32 (vi, channelName, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH,
                                        0, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_STATE_CLOCK_EDGE -*/
static IviRangeTableEntry attrStateClockEdgeRangeTableEntries[] =
{
    {TKDPO4K_VAL_CLOCK_RISE, 0, 0, "RISE", 0},
    {TKDPO4K_VAL_CLOCK_FALL, 0, 0, "FALL", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrStateClockEdgeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:INP:CLOC:EDGE",
    attrStateClockEdgeRangeTableEntries,
};

    /*- TKDPO4K_ATTR_STATE_CLOCK_SOURCE -*/
static IviRangeTableEntry attrDPO4KStateClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1,  0, 0, "CH1",    0},
    {TKDPO4K_VAL_SOUR_CH2,  0, 0, "CH2",    0},
    {TKDPO4K_VAL_SOUR_CH3,  0, 0, "CH3",    0},
    {TKDPO4K_VAL_SOUR_CH4,  0, 0, "CH4",    0},
    {TKDPO4K_VAL_SOUR_NONE, 0, 0, "NONE",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KStateClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KStateClockSourceRangeTableEntries,
};
    
static IviRangeTableEntry attrMSO4KStateClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1,  0, 0, "CH1",    0},
    {TKDPO4K_VAL_SOUR_CH2,  0, 0, "CH2",    0},
    {TKDPO4K_VAL_SOUR_CH3,  0, 0, "CH3",    0},
    {TKDPO4K_VAL_SOUR_CH4,  0, 0, "CH4",    0},
    {TKDPO4K_VAL_SOUR_D0,   0, 0, "D0",     0},
    {TKDPO4K_VAL_SOUR_D1,   0, 0, "D1",     0},
    {TKDPO4K_VAL_SOUR_D2,   0, 0, "D2",     0},
    {TKDPO4K_VAL_SOUR_D3,   0, 0, "D3",     0},
    {TKDPO4K_VAL_SOUR_D4,   0, 0, "D4",     0},
    {TKDPO4K_VAL_SOUR_D5,   0, 0, "D5",     0},
    {TKDPO4K_VAL_SOUR_D6,   0, 0, "D6",     0},
    {TKDPO4K_VAL_SOUR_D7,   0, 0, "D7",     0},
    {TKDPO4K_VAL_SOUR_D8,   0, 0, "D8",     0},
    {TKDPO4K_VAL_SOUR_D9,   0, 0, "D9",     0},
    {TKDPO4K_VAL_SOUR_D10,  0, 0, "D10",    0},
    {TKDPO4K_VAL_SOUR_D11,  0, 0, "D11",    0},
    {TKDPO4K_VAL_SOUR_D12,  0, 0, "D12",    0},
    {TKDPO4K_VAL_SOUR_D13,  0, 0, "D13",    0},
    {TKDPO4K_VAL_SOUR_D14,  0, 0, "D14",    0},
    {TKDPO4K_VAL_SOUR_D15,  0, 0, "D15",    0},     
    {TKDPO4K_VAL_SOUR_NONE, 0, 0, "NONE",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KStateClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KStateClockSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KStateClockSourceRangeTable;
    else
        tblPtr = &attrMSO4KStateClockSourceRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      source[BUFFER_SIZE];
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    viCheckErr ( viQueryf (io, "TRIG:A:LOGI:INP:CLOC:SOU?", "%s", source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrStateClockSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    source;     
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:LOGI:INP:CLOC:SOU %s", source) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_SETHOLD_CLOCK_EDGE -*/
static IviRangeTableEntry attrSetholdClockEdgeRangeTableEntries[] =
{
    {TKDPO4K_VAL_CLOCK_RISE, 0, 0, "RISE", 0},
    {TKDPO4K_VAL_CLOCK_FALL, 0, 0, "FALL", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrSetholdClockEdgeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:SETH:CLOC:EDGE",
    attrSetholdClockEdgeRangeTableEntries,
};

    /*- TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE -*/
static IviRangeTableEntry attrDPO4KSetholdClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_EXT, 0, 0, "AUX", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KSetholdClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:SETH:CLOC:SOU",
    attrDPO4KSetholdClockSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KSetholdClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,   0, 0, "D0", 0},
    {TKDPO4K_VAL_SOUR_D1,   0, 0, "D1", 0},
    {TKDPO4K_VAL_SOUR_D2,   0, 0, "D2", 0},
    {TKDPO4K_VAL_SOUR_D3,   0, 0, "D3", 0},
    {TKDPO4K_VAL_SOUR_D4,   0, 0, "D4", 0},
    {TKDPO4K_VAL_SOUR_D5,   0, 0, "D5", 0},
    {TKDPO4K_VAL_SOUR_D6,   0, 0, "D6", 0},
    {TKDPO4K_VAL_SOUR_D7,   0, 0, "D7", 0},
    {TKDPO4K_VAL_SOUR_D8,   0, 0, "D8", 0},
    {TKDPO4K_VAL_SOUR_D9,   0, 0, "D9", 0},
    {TKDPO4K_VAL_SOUR_D10,  0, 0, "D10",0},
    {TKDPO4K_VAL_SOUR_D11,  0, 0, "D11",0},
    {TKDPO4K_VAL_SOUR_D12,  0, 0, "D12",0},
    {TKDPO4K_VAL_SOUR_D13,  0, 0, "D13",0},
    {TKDPO4K_VAL_SOUR_D14,  0, 0, "D14",0},
    {TKDPO4K_VAL_SOUR_D15,  0, 0, "D15",0}, 
    {TKDPO4K_VAL_SOUR_EXT, 0, 0,  "AUX",0},    
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KSetholdClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:SETH:CLOC:SOU",
    attrMSO4KSetholdClockSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_RangeTableCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KSetholdClockSourceRangeTable;
    else
        tblPtr = &attrMSO4KSetholdClockSourceRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_CheckCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     dataSource;
    
    checkErr (Ivi_DefaultCheckCallbackViInt32 (vi, channelName, attributeId, value));
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                        0, &dataSource));
    if (dataSource == value)
    {
        viCheckErrElab (IVI_ERROR_INVALID_CONFIGURATION,
                        "Invalid Channel Name."
                        "Setup and Hold Trigger.");
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      source[BUFFER_SIZE]; 
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    viCheckErr ( viQueryf (io, ":TRIG:A:SETH:CLOC:SOU?", "%s", source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdClockSource_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:SETH:CLOC:SOU %s", source) );                                               

Error:
    return error;
}

    /*- TKDPO4K_ATTR_SETHOLD_DATA_SOURCE -*/
static IviRangeTableEntry attrDPO4KSetholdDataSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_EXT, 0, 0, "AUX", 0},    
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KSetholdDataSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:SETH:DAT:SOU",
    attrDPO4KSetholdDataSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KSetholdDataSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KSetholdDataSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:SETH:DAT:SOU",
    attrMSO4KSetholdDataSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KSetholdDataSourceRangeTable;
    else
        tblPtr = &attrMSO4KSetholdDataSourceRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     clockSource;
    
    checkErr (Ivi_DefaultCheckCallbackViInt32 (vi, channelName, attributeId, value));
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                        0, &clockSource));
    if (clockSource == value)
    {
        viCheckErrElab (IVI_ERROR_INVALID_CONFIGURATION,
                        "Invalid Channel Name."
                        "Setup and Hold Trigger.");
    }

Error:
    return error;
}
    
static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      buf[BUFFER_SIZE]; 
    IviRangeTablePtr    tblPtr = VI_NULL;    
    
    viCheckErr ( viQueryf (io, ":TRIG:A:SETH:DAT:SOU?", "%s", buf) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr ( Ivi_GetViInt32EntryFromString ( buf, tblPtr, value,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL ) ); 
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdDataSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    strClockSource;  
    IviRangeTablePtr    tblPtr = VI_NULL;
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue (value, tblPtr, VI_NULL,
                                            VI_NULL, VI_NULL, VI_NULL, &strClockSource, VI_NULL ) );    

    viCheckErr ( viPrintf (io, ":TRIG:A:SETH:DAT:SOU %s", strClockSource) );

Error:
    return error;
}    

    /*- TKDPO4K_ATTR_SETHOLD_HOLDTIME -*/
static IviRangeTableEntry attrDPO4KSetholdHoldtimeRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8,  0,  "", 0}, 
     *************************************/
    
    {4.0e-9,    8,  0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KSetholdHoldtimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:SETH:HOLDT",
    attrDPO4KSetholdHoldtimeRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KSetholdHoldtimeRangeTableEntries[] =
{
    {1.0e-9,    1.0e-3,     0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KSetholdHoldtimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:SETH:HOLDT",
    attrMSO4KSetholdHoldtimeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSetholdHoldtime_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KSetholdHoldtimeRangeTable;
    else
        tblPtr = &attrMSO4KSetholdHoldtimeRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSetholdHoldtime_CoerceCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViReal64 value,
                                                                    ViReal64 *coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    
    if (IS_MSO4K(model))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    }
    
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));  
    }
    
Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_SETHOLD_SETTIME -*/
static IviRangeTableEntry attrDPO4KSetholdSettimeRangeTableEntries[] =
{
    /*************************************
     * Minimum Runt Width in old firmware
     * version is 2.5e-9. Bus is 4.0e-9
     * in new firmware. Remove the old 
     * value from the range table.
     
    {2.5e-9,    8,  0,  "", 0}, 
     *************************************/
     
    {0.0e-9,    8,  0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KSetholdSettimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:SETH:SETT",
    attrDPO4KSetholdSettimeRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KSetholdSettimeRangeTableEntries[] =
{
    {-0.5e-9,   1.0e-3,     0,  "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KSetholdSettimeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":TRIG:A:LOGI:SETH:SETT",
    attrMSO4KSetholdSettimeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSetholdSettime_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KSetholdSettimeRangeTable;
    else
        tblPtr = &attrMSO4KSetholdSettimeRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}
    
static ViStatus _VI_FUNC tkdpo4kAttrSetholdSettime_CoerceCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value,
                                                                   ViReal64 *coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    
    if (IS_MSO4K(model))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.5e-9, 12, &newValue));
    }
    
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.8e-9, 12, &newValue));  
    }

Error:
    *coercedValue = newValue;
    return error;
}

    /*- TKDPO4K_ATTR_RS232_CONDITION -*/
static IviRangeTableEntry attrRs232ConditionRangeTableEntries[] =
    {
        {TKDPO4K_VAL_RS232_RX_START,        0, 0, "RXSTART",    0},
        {TKDPO4K_VAL_RS232_RX_DATA,         0, 0, "RXDATA",     0},
        {TKDPO4K_VAL_RS232_RX_END_PACKET,   0, 0, "RXENDPACKET",0},
        {TKDPO4K_VAL_RS232_TX_START,        0, 0, "TXSTART",    0},
        {TKDPO4K_VAL_RS232_TX_DATA,         0, 0, "TXDATA",     0},
        {TKDPO4K_VAL_RS232_TX_END_PACKET,   0, 0, "TXENDPACKET",0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRs232ConditionRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        "",
        attrRs232ConditionRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrRs232Condition_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      RS232Condition[BUFFER_SIZE];
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:RS232C:COND?", "%s", busName, RS232Condition) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (RS232Condition, &attrRs232ConditionRangeTable, value, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232Condition_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, RS232Condition;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
                                                            
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrRs232ConditionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &RS232Condition, VI_NULL) );
                                                    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:RS232C:COND %s", busName, RS232Condition) );                                             
        
Error:
    return error;
}

    /*- TKDPO4K_ATTR_RS232_RX_DATA_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    size_t      dataLen;
    ViInt32     i;
    
    charValue = (char*) value;
    dataLen = strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_RX_DATA_SIZE,
                                            0, &dataSize) );
    if(dataLen != (dataSize*8) )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
            && (charValue[i] != 'x')
                &&(charValue[i] != '0')
                    &&(charValue[i] != '1'))
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_RX_DATA_SIZE,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen); 
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }

    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viQueryf(io, "TRIG:A:BUS:%s:RS232C:RX:DAT:VAL?", "%s", busName, returnValue) ); 
    
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataValue_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:BUS:%s:RS232C:RX:DAT:VAL \"%s\"", busName, value) );     
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_RS232_RX_DATA_SIZE -*/
static IviRangeTableEntry attrRs232RxDataSizeRangeTableEntries[] =
    {
        {1, 128, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRs232RxDataSizeRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRs232RxDataSizeRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataSize_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, "TRIG:A:BUS:%s:RS232C:RX:DAT:SIZ?", "%d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232RxDataSize_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:BUS:%s:RS232C:RX:DAT:SIZ %d", busName, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_RS232_TX_DATA_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    charValue = (char*) value;
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_TX_DATA_SIZE,
                                            0, &dataSize) );
    if(dataLen != (dataSize*8) )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
            && (charValue[i] != 'x')
                &&(charValue[i] != '0')
                    &&(charValue[i] != '1'))
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_CoerceCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RS232_TX_DATA_SIZE,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen); 
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }

    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viQueryf(io, "TRIG:A:BUS:%s:RS232C:TX:DAT:VAL?", "%s", busName, returnValue) ); 
    
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataValue_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:BUS:%s:RS232C:TX:DAT:VAL \"%s\"", busName, value) );     
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_RS232_TX_DATA_SIZE -*/
static IviRangeTableEntry attrRs232TxDataSizeRangeTableEntries[] =
    {
        {1, 128, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrRs232TxDataSizeRangeTable =
    {
        IVI_VAL_RANGED,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrRs232TxDataSizeRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataSize_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, "TRIG:A:BUS:%s:RS232C:TX:DAT:SIZ?", "%d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRs232TxDataSize_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:BUS:%s:RS232C:TX:DAT:SIZ %d", busName, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_PARALLEL_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_CheckCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    charValue = (char*) value;
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_WIDTH,
                                            0, &dataSize) );
    if(dataLen != dataSize )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
            && (charValue[i] != 'x')
                &&(charValue[i] != '0')
                    &&(charValue[i] != '1'))
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_BUS_PARALLEL_WIDTH,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen); 
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }

    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viQueryf(io, "TRIG:A:BUS:%s:PAR:VAL?", "%s", busName, returnValue) ); 
    
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrParallelValue_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, "TRIG:A:BUS:%s:PAR:VAL \"%s\"", busName, value) );   
    
Error:
    return error;
}


    /*- TKDPO4K_ATTR_CAN_CONDITION -*/
static IviRangeTableEntry attrCanConditionRangeTableEntries[] =
{
    {TKDPO4K_VAL_CAN_COND_SOF,          0, 0, "SOF",        0},
    {TKDPO4K_VAL_CAN_COND_FRAMETYPE,    0, 0, "FRAMETYPE",  0},
    {TKDPO4K_VAL_CAN_COND_IDENTIFIER,   0, 0, "IDENTIFIER", 0},
    {TKDPO4K_VAL_CAN_COND_DATA,         0, 0, "DATA",       0},
    {TKDPO4K_VAL_CAN_COND_IDANDDATA,    0, 0, "IDANDDATA",  0},
    {TKDPO4K_VAL_CAN_COND_EOF,          0, 0, "EOF",        0},
    {TKDPO4K_VAL_CAN_COND_ACKMISS,      0, 0, "ACKMISS",    0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrCanConditionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrCanConditionRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrCanCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      CANCondition[BUFFER_SIZE];
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:CAN:COND?", "%s", busName, CANCondition) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (CANCondition, &attrCanConditionRangeTable, value, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, CANCondition;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
                                                            
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrCanConditionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &CANCondition, VI_NULL) );
                                                    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:COND %s", busName, CANCondition) );                                              
        
Error:
    return error;
}

    /*- TKDPO4K_ATTR_CAN_DATA_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    charValue = (char*) value;
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_DATA_SIZE,
                                            0, &dataSize) );
    if(dataLen != (dataSize*8) )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
            && (charValue[i] != 'x')
                &&(charValue[i] != '0')
                    &&(charValue[i] != '1'))
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_DATA_SIZE,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen); 
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }

    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viQueryf(io, ":TRIG:A:BUS:%s:CAN:DAT:VAL?", "%s", busName, returnValue) );
    
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanDataValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:DAT:VAL \"%s\"", busName, value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_CAN_DATA_SIZE -*/
static IviRangeTableEntry attrCanDataSizeRangeTableEntries[] =
{
    {1, 8, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrCanDataSizeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrCanDataSizeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrCanDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:CAN:DAT:SIZ?", "%d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:DAT:SIZ %d", busName, value) );

Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_CAN_ID_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_CheckCallback (ViSession vi,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     IDMode;
    ViInt32     IDLen;
    ViInt32     i;
    
    charValue = (char*) value;
    IDLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_ID_MODE,
                                            0, &IDMode) );
    /* Standard Identifier has 11 address bits */
    if(IDMode == TKDPO4K_VAL_CAN_ID_STANDARD)
    {
        if(IDLen != TKDPO4K_VAL_CAN_ID_STANDARD_LEN)
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);             
        }
    }
    /* Extended Identifier has 29 address bits */
    else
    {
        if(IDLen != TKDPO4K_VAL_CAN_ID_EXTENDED_LEN)
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    
    for(i=0; i<IDLen; i++)
    {
        if( (charValue[i] != 'X')
                && (charValue[i] != 'x')
                    && (charValue[i] != '0')
                        && (charValue[i] != '1') )
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_CoerceCallback (ViSession vi,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     IDMode;
    ViInt32     IDLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_CAN_ID_MODE,
                                            0, &IDMode) );  
    
    if(IDMode == TKDPO4K_VAL_CAN_ID_STANDARD)
    {
        IDLen = TKDPO4K_VAL_CAN_ID_STANDARD_LEN;
    }
    else
    {
        IDLen = TKDPO4K_VAL_CAN_ID_EXTENDED_LEN;
    }   
    strncpy (newValue, value, IDLen);
    
    for(i=0; i<IDLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }
    }
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     IDLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 

    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:CAN:ID:VAL?", "%s", busName, returnValue) );
    IDLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[IDLen] = '\0';
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanIdValue_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:ID:VAL \"%s\"", busName, value ) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_CAN_ID_MODE -*/
static IviRangeTableEntry attrCanIdModeRangeTableEntries[] =
{
    {TKDPO4K_VAL_CAN_ID_STANDARD, 0, 0, "STANDARD", 0},
    {TKDPO4K_VAL_CAN_ID_EXTENDED, 0, 0, "EXTENDED", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrCanIdModeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrCanIdModeRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrCanIdMode_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      IDMode[BUFFER_SIZE];
    memset(IDMode, 0, sizeof(ViChar)*BUFFER_SIZE);
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:CAN:ID:MOD?", "%s", busName, IDMode) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (IDMode, &attrCanIdModeRangeTable, value, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanIdMode_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, IDMode;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrCanIdModeRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &IDMode, VI_NULL) );

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:ID:MOD %s", busName, IDMode) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_CAN_FRAMETYPE -*/
static IviRangeTableEntry attrCanFrametypeRangeTableEntries[] =
{
    {TKDPO4K_VAL_CAN_FRAME_DATA,        0, 0, "DATA",       0},
    {TKDPO4K_VAL_CAN_FRAME_REMOTE,      0, 0, "REMOTE",     0},
    {TKDPO4K_VAL_CAN_FRAME_ERROR,       0, 0, "ERROR",      0},
    {TKDPO4K_VAL_CAN_FRAME_OVERLOAD,    0, 0, "OVERLOAD",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrCanFrametypeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrCanFrametypeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrCanFrametype_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      frameType[BUFFER_SIZE] = {0};

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:CAN:FRAME?", "%s", busName, frameType) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (frameType, &attrCanFrametypeRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrCanFrametype_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, frameType; 

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrCanFrametypeRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &frameType, VI_NULL) );
                                                    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:CAN:FRAME %s", busName, frameType) );                                                        
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_I2C_CONDITION -*/
static IviRangeTableEntry attrI2cConditionRangeTableEntries[] =
{
    {TKDPO4K_VAL_I2C_COND_START,        0, 0, "START",          0},
    {TKDPO4K_VAL_I2C_COND_STOP,         0, 0, "STOP",           0},
    {TKDPO4K_VAL_I2C_COND_REPEATSTART,  0, 0, "REPEATSTART",    0},
    {TKDPO4K_VAL_I2C_COND_ACKMISS,      0, 0, "ACKMISS",        0},
    {TKDPO4K_VAL_I2C_COND_ADDRESS,      0, 0, "ADDRESS",        0},
    {TKDPO4K_VAL_I2C_COND_DATA,         0, 0, "DATA",           0},
    {TKDPO4K_VAL_I2C_COND_ADDRANDDATA,  0, 0, "ADDRANDDATA",    0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrI2cConditionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrI2cConditionRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrI2cCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    ViChar      condition[BUFFER_SIZE] = {0};

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:COND?", "%s", busName, condition) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (condition, &attrI2cConditionRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViString    condition;

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrI2cConditionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &condition, VI_NULL) );
    
    viCheckErr ( viPrintf (io,  ":TRIG:A:BUS:%s:I2C:COND %s", busName, condition) );
                                                    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_I2C_ADDR_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     addressMode;
    ViInt32     addressLen;
    ViInt32     i;  

    charValue = (char*) value; 
    addressLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_ADDR_MODE,
                                            0, &addressMode) );

    /* Addressing Mode of 7 bit */
    if(addressMode == TKDPO4K_VAL_I2C_ADDR7)
    {
        if(addressLen != 7)
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    /* Addressing Mode of 10 bit */
    else
    {
        if(addressLen != 10)
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    
    for(i=0; i<addressLen; i++)
    {
        if( (charValue[i] != 'X')
                && (charValue[i] != 'x')
                    && (charValue[i] != '0')
                        && (charValue[i] != '1') )
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }   
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     addressMode;
    ViInt32     addressLen;
    ViInt32     i;      
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_ADDR_MODE,
                                            0, &addressMode) );
                                
    if(addressMode == TKDPO4K_VAL_I2C_ADDR7)
    {
        addressLen = 7;
    }
    else
    {
        addressLen = 10;
    }                           
    strncpy(newValue, value, addressLen);
    
    for(i=0; i<addressLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );    
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     addressLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:ADDR:VAL?", "%s", busName, returnValue) );
    addressLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[addressLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:I2C:ADDR:VAL \"%s\"", busName, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_I2C_ADDR_MODE -*/
static IviRangeTableEntry attrI2cAddrModeRangeTableEntries[] =
{
    {TKDPO4K_VAL_I2C_ADDR7,     0, 0, "ADDR7",  0},
    {TKDPO4K_VAL_I2C_ADDR10,    0, 0, "ADDR10", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrI2cAddrModeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrI2cAddrModeRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrMode_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViChar      addressMode[BUFFER_SIZE] = {0};

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:ADDR:MOD?", "%s", busName, addressMode) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (addressMode, &attrI2cAddrModeRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cAddrMode_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViString    addressMode;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrI2cAddrModeRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &addressMode, VI_NULL) );
    
    viCheckErr ( viPrintf (io,  ":TRIG:A:BUS:%s:I2C:ADDR:MOD %s", busName, addressMode) );

Error:
    return error;
}   

    /*- TKDPO4K_ATTR_I2C_DATA_VALUE -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;  
    
    charValue = (char*) value; 
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_DATA_SIZE,
                                            0, &dataSize) );
    if(dataLen != dataSize*8 )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);     
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
                && (charValue[i] != 'x')
                    && (charValue[i] != '0')
                        && (charValue[i] != '1') )
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }       
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_I2C_DATA_SIZE,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen);
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }   
                                                
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:DAT:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:I2C:DAT:VAL \"%s\"", busName, value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_I2C_DATA_SIZE -*/
static IviRangeTableEntry attrI2cDataSizeRangeTableEntries[] =
{
    {1, 12, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrI2cDataSizeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrI2cDataSizeRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:DAT:SIZ?", "%d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:I2C:DAT:SIZ %d", busName, value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_I2C_DATA_DIRECTION -*/
static IviRangeTableEntry attrI2cDataDirectionRangeTableEntries[] =
{
    {TKDPO4K_VAL_I2C_READ,      0, 0, "READ",   0},
    {TKDPO4K_VAL_I2C_WRITE,     0, 0, "WRITE",  0},
    {TKDPO4K_VAL_I2C_NOCARE,    0, 0, "NOCARE", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrI2cDataDirectionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrI2cDataDirectionRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataDirection_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViChar      direction[BUFFER_SIZE] = {0};
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:I2C:DAT:DIR?", "%s", busName, direction) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (direction, &attrI2cDataDirectionRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrI2cDataDirection_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViString    direction;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrI2cDataDirectionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &direction, VI_NULL) ); 
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:I2C:DAT:DIR %s", busName, direction) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_SPI_CONDITION -*/
static IviRangeTableEntry attrSpiConditionRangeTableEntries[] =
{
    {TKDPO4K_VAL_SPI_SS,        0, 0, "SS",         0},
    {TKDPO4K_VAL_SPI_MOSI,      0, 0, "MOSI",       0},
    {TKDPO4K_VAL_SPI_MISO,      0, 0, "MISO",       0},
    {TKDPO4K_VAL_SPI_MISOMOSI,  0, 0, "MISOMOSI",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrSpiConditionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrSpiConditionRangeTableEntries,
};
    
static ViStatus _VI_FUNC tkdpo4kAttrSpiCondition_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViChar      condition[BUFFER_SIZE] = {0};
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:SPI:COND?", "%s", busName, condition) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (condition, &attrSpiConditionRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiCondition_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  
    ViString    condition;
    
    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (value, &attrSpiConditionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &condition, VI_NULL) );
                                                    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:SPI:COND %s", busName, condition) );                                                     

Error:
    return error;
}

    /*- TKDPO4K_ATTR_SPI_DATA_SIZE -*/
static IviRangeTableEntry attrSpiDataSizeRangeTableEntries[] =
{
    {1, 16, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrSpiDataSizeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrSpiDataSizeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrSpiDataSize_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:SPI:DAT:SIZ?", "%d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiDataSize_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;  

    checkErr ( tkdpo4k_GetSelectedBusName(vi, &busName) );

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:SPI:DAT:SIZ %d", busName, value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_SPI_MOSI_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    charValue = (char*) value; 
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            0, &dataSize) );
                                            
    if(dataLen != dataSize*8 )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);     
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
                && (charValue[i] != 'x')
                    && (charValue[i] != '0')
                        && (charValue[i] != '1') )
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }       
    }   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            0, &dataSize) );    
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen);
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }   
                                                
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );  

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:SPI:DAT:MOSI:VAL?", "%s", busName, returnValue) ); 
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiMosiValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:SPI:DAT:MOSI:VAL \"%s\"", busName, value) );     

Error:
    return error;
}

    /*- TKDPO4K_ATTR_SPI_MISO_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_CheckCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    char*       charValue;
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    charValue = (char*) value; 
    dataLen = (ViInt32)strlen(charValue);
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            0, &dataSize) );
                                            
    if(dataLen != dataSize*8 )
    {
        error = IVI_ERROR_INVALID_VALUE;
        viCheckErr (error);     
    }
    
    for(i=0; i<dataLen; i++)
    {
        if( (charValue[i] != 'X')
                && (charValue[i] != 'x')
                    && (charValue[i] != '0')
                        && (charValue[i] != '1') )
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }       
    }   

Error:
    return error;
}


static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      newValue[BUFFER_SIZE] = {0};
    ViInt32     dataSize;
    ViInt32     dataLen;
    ViInt32     i;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            0, &dataSize) );
    dataLen = dataSize*8;
    strncpy (newValue, value, dataLen);
    
    for(i=0; i<dataLen; i++)
    {
        if( islower(newValue[i]) )
        {
            newValue[i] = (ViChar) toupper( newValue[i] );
        }       
    }
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, newValue) );    

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:SPI:DAT:MISO:VAL?", "%s", busName, returnValue) ); 
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrSpiMisoValue_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) ); 
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:SPI:DAT:MISO:VAL \"%s\"", busName, value) ); 
    
Error:
    return error;
}
   
    /*- TKDPO4K_ATTR_INPUT_DATA_SOURCE -*/
static IviRangeTableEntry attrInputDataSourceRangeTableEntries[] =
{
    {0,   0,      0,        TKDPO4K_VAL_CH_1,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_CH_2,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_CH_3,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_CH_4,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_MATH,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_REF_1,    0}, 
    {0,   0,      0,        TKDPO4K_VAL_REF_2,    0}, 
    {0,   0,      0,        TKDPO4K_VAL_REF_3,    0}, 
    {0,   0,      0,        TKDPO4K_VAL_REF_4,    0},
    {0,   0,      0,        TKDPO4K_VAL_D_0,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_1,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_2,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_3,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_4,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_5,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_6,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_7,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_8,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_9,      0},
    {0,   0,      0,        TKDPO4K_VAL_D_10,     0},
    {0,   0,      0,        TKDPO4K_VAL_D_11,     0},
    {0,   0,      0,        TKDPO4K_VAL_D_12,     0},
    {0,   0,      0,        TKDPO4K_VAL_D_13,     0},
    {0,   0,      0,        TKDPO4K_VAL_D_14,     0}, 
    {0,   0,      0,        TKDPO4K_VAL_D_15,     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}  
};   

static IviRangeTable  attrInputDataSourceRangeTable =
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":DAT:SOU", 
    attrInputDataSourceRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_REF_CALC_METH -*/
static IviRangeTableEntry attrMeasRefCalcMethRangeTableEntries[] =
{
    {TKDPO4K_VAL_MEAS_HISTOGRAM,    0, 0, "HISTOGRAM",  0},
    {TKDPO4K_VAL_MEAS_MIN_MAX,      0, 0, "MINMAX",     0},
    {TKDPO4K_VAL_MEAS_AUTO,         0, 0, "AUTO",       0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMeasRefCalcMethRangeTable =
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    ":MEASU:METH", 
    attrMeasRefCalcMethRangeTableEntries, 
};
    
    /*- TKDPO4K_ATTR_MEAS_SOURCE -*/  
static IviRangeTableEntry attrMeasSourceRangeTableEntries[] =
{
    {0,   0,      0,   TKDPO4K_VAL_CH_1,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_2,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_3,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_4,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_1,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_2,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_3,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_4,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_MATH,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_0,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_1,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_2,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_3,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_4,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_5,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_6,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_7,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_8,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_9,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_10,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_11,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_12,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_13,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_14,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_15,      0},
    {0,   0,      0,   TKDPO4K_VAL_HISTOGRAM,     0},
    {0,   0,      0,   TKDPO4K_VAL_RF_AMPLITUDE,  0},
    {0,   0,      0,   TKDPO4K_VAL_RF_FREQUENCY,  0},
    {0,   0,      0,   TKDPO4K_VAL_RF_PHASE,      0},
    {IVI_RANGE_TABLE_LAST_ENTRY}  
};   

static IviRangeTable  attrMeasSourceRangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    "MEASU:IMM:SOURCE1", 
    attrMeasSourceRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_SOURCE2 -*/  
static IviRangeTableEntry attrMeasSource2RangeTableEntries[] =
{
    {0,   0,      0,   TKDPO4K_VAL_CH_1,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_2,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_3,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_CH_4,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_1,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_2,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_3,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_REF_4,     0}, 
    {0,   0,      0,   TKDPO4K_VAL_MATH,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_0,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_1,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_2,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_3,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_4,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_5,       0},
    {0,   0,      0,   TKDPO4K_VAL_D_6,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_7,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_8,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_9,       0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_10,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_11,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_12,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_13,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_14,      0}, 
    {0,   0,      0,   TKDPO4K_VAL_D_15,      0},
    {0,   0,      0,   TKDPO4K_VAL_RF_AMPLITUDE,  0},
    {0,   0,      0,   TKDPO4K_VAL_RF_FREQUENCY,  0},
    {0,   0,      0,   TKDPO4K_VAL_RF_PHASE,      0},
    {IVI_RANGE_TABLE_LAST_ENTRY}  
};   

static IviRangeTable  attrMeasSource2RangeTable =       
{
    IVI_VAL_DISCRETE, 
    VI_FALSE, 
    VI_FALSE, 
    "MEASU:IMM:SOURCE2", 
    attrMeasSource2RangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_DEL_DIRECTION -*/
static IviRangeTableEntry attrMeasDelDirectionRangeTableEntries[] =
{
    {TKDPO4K_VAL_DEL_DIR_BACKWARD, 0, 0, "BACKWARDS", 0},
    {TKDPO4K_VAL_DEL_DIR_FORWARD,  0, 0, "FORWARDS",  0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMeasDelDirectionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    "MEASU:IMM:DEL:DIR",
    attrMeasDelDirectionRangeTableEntries,
};

    /*- TKDPO4K_ATTR_MEAS_DEL_EDGE -*/
static IviRangeTableEntry attrMeasDelEdgeRangeTableEntries[] =
{
    {TKDPO4K_VAL_DEL_EDGE_RISE, 0, 0, "RISE", 0},
    {TKDPO4K_VAL_DEL_EDGE_FALL, 0, 0, "FALL", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMeasDelEdgeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_FALSE,
    VI_FALSE,
    "MEASU:IMM:DEL:EDGE1",
    attrMeasDelEdgeRangeTableEntries,
};

    /*- TKDPO4K_ATTR_MEAS_DEL_EDGE2 -*/
static IviRangeTableEntry attrMeasDelEdge2RangeTableEntries[] =
    {
        {TKDPO4K_VAL_DEL_EDGE_RISE, 0, 0, "RISE", 0},
        {TKDPO4K_VAL_DEL_EDGE_FALL, 0, 0, "FALL", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrMeasDelEdge2RangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_FALSE,
        VI_FALSE,
        "MEASU:IMM:DEL:EDGE2",
        attrMeasDelEdge2RangeTableEntries,
    };

    /*- TKDPO4K_ATTR_MEAS_GATING -*/
static IviRangeTableEntry attrMeasGatingRangeTableEntries[] =
{
    {TKDPO4K_VAL_MEAS_GATING_OFF,       0, 0, "OFF",    0},
    {TKDPO4K_VAL_MEAS_GATING_SCREEN,    0, 0, "SCREEN", 0},
    {TKDPO4K_VAL_MEAS_GATING_CURSOR,    0, 0, "CURSOR", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMeasGatingRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":MEASU:GAT",
    attrMeasGatingRangeTableEntries,
};

    /*- TKDPO4K_ATTR_MEAS_HIGH_REF -*/
static IviRangeTableEntry attrMeasHighRefRangeTableEntries[] =
{
    {0.0,   100.0,  0,  "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   
static IviRangeTable  attrMeasHighRefRangeTable =       
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":MEASU:REFL:PERC:HIGH", 
    attrMeasHighRefRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_LOW_REF -*/
static IviRangeTableEntry attrMeasLowRefRangeTableEntries[] =
{ 
    {0.0,   100.0,  0,  "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   
static IviRangeTable  attrMeasLowRefRangeTable =       
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":MEASU:REFL:PERC:LOW", 
    attrMeasLowRefRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_MID_REF -*/
static IviRangeTableEntry attrMeasMidRefRangeTableEntries[] =
{ 
    {0.0,   100.0,  0,  "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   
static IviRangeTable  attrMeasMidRefRangeTable =       
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":MEASU:REFL:PERC:MID", 
    attrMeasMidRefRangeTableEntries, 
};
    
    /*- TKDPO4K_ATTR_MEAS_MID2_REF -*/
static IviRangeTableEntry attrMeasMid2RefRangeTableEntries[] =
{ 
    {0.0,   100.0,  0,  "",     0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};   
static IviRangeTable  attrMeasMid2RefRangeTable =       
{
    IVI_VAL_RANGED, 
    VI_TRUE, 
    VI_TRUE, 
    ":MEASU:REFL:PERC:MID2", 
    attrMeasMid2RefRangeTableEntries, 
};

    /*- TKDPO4K_ATTR_MEAS_VALUE -*/
static ViStatus _VI_FUNC tkdpo4kAttrMeasureValue_ReadCallback (ViSession vi, 
                                                                ViSession io, 
                                                                ViConstString channelName, 
                                                                ViAttr attributeId, 
                                                                ViReal64 *value)
{
    ViStatus  error = VI_SUCCESS;
    ViInt32   timeout;
    if (!Ivi_Simulating(vi))
    {
        viCheckErr(viGetAttribute(io,VI_ATTR_TMO_VALUE,&timeout));
        viCheckErr(viSetAttribute(io,VI_ATTR_TMO_VALUE,50000));
        viCheckErr( viQueryf(io, ":MEASU:IMM:VAL?", "%le", value));
        viCheckErr(viSetAttribute(io,VI_ATTR_TMO_VALUE,timeout));
    }
    else
    {
        ViInt32 function;
        ViReal64 range;
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MEAS_FUNCTION, 
                                           0, &function));
        checkErr( Ivi_GetAttributeViReal64 (vi, channelName, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            0, &range));
        switch (function) 
        {
            case TKDPO4K_VAL_RISE_TIME:
            case TKDPO4K_VAL_FALL_TIME:
            {
                *value = 2e-6;
                break;
            }
            case TKDPO4K_VAL_FREQUENCY:
            {
                *value = rand ()/10.0 + 10000.0;
                break;
            }                
            case TKDPO4K_VAL_PERIOD:
            {
                *value = 1.0/(rand ()/10.0 + 10000.0);
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_RMS:
            {
                *value = range * 0.3535;
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_PEAK_TO_PEAK:
            {
                *value = range;
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_MAX:
            case TKDPO4K_VAL_VOLTAGE_HIGH:
            {
                *value = (1 - rand ()/120000.0) * range/2;
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_LOW:
            case TKDPO4K_VAL_VOLTAGE_MIN:
            {
                *value = (rand ()/120000.0 - 1) * range/2;
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_AVERAGE:
            {
                *value = 0;
                break;
            }                
            case TKDPO4K_VAL_WIDTH_NEG:
            case TKDPO4K_VAL_WIDTH_POS:
            {
                *value = 1e-4 * rand () / 30000.0;
                break;
            }                
            case TKDPO4K_VAL_DUTY_CYCLE_NEG:
            {
                *value = 30.0;
                break;
            }                
            case TKDPO4K_VAL_DUTY_CYCLE_POS:
            {
                *value = 70.0;
                break;
            }                
            case TKDPO4K_VAL_VOLTAGE_CYCLE_RMS:
            case TKDPO4K_VAL_VOLTAGE_CYCLE_AVERAGE:
            {
                *value = range * 0.353;
                break;
            }                
            case TKDPO4K_VAL_AMPLITUDE:
            {
                *value = range * 0.49;
                break;
            }                
            case TKDPO4K_VAL_POSITIVE_OVERSHOOT:
            case TKDPO4K_VAL_NEGATIVE_OVERSHOOT:
            {
                *value = 5.0;
                break;
            }
            case TKDPO4K_VAL_PHASE:
            {
                *value = rand() * 180;
                break;
            }
            default:
            {
                *value = rand() * 100;
                break;
            }
        }
    }
        
Error:
    return error;
}

    /*- TKDPO4K_ATTR_MATH_TYPE -*/
static IviRangeTableEntry attrMathTypeRangeTableEntries[] =
    {
        {TKDPO4K_VAL_MATH_TYPE_DUAL, 0, 0, "DUAL", 0},
        {TKDPO4K_VAL_MATH_TYPE_FFT, 0, 0, "FFT", 0},
        {TKDPO4K_VAL_MATH_TYPE_ADVANCED, 0, 0, "ADVANCED", 0},
        {TKDPO4K_VAL_MATH_TYPE_SPECTRUM, 0, 0, "SPECTRUM", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrMathTypeRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        ":MATH:TYP",
        attrMathTypeRangeTableEntries,
    };

    /*- TKDPO4K_ATTR_MATH_SOURCE_1ST -*/
    /*- TKDPO4K_ATTR_MATH_SOURCE_2ND -*/
static IviRangeTableEntry attrMathSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1,      0, 0, "CH1",    0},
    {TKDPO4K_VAL_SOUR_CH2,      0, 0, "CH2",    0},
    {TKDPO4K_VAL_SOUR_CH3,      0, 0, "CH3",    0},
    {TKDPO4K_VAL_SOUR_CH4,      0, 0, "CH4",    0},
    {TKDPO4K_VAL_SOUR_REF1,     0, 0, "REF1",   0},
    {TKDPO4K_VAL_SOUR_REF2,     0, 0, "REF2",   0},
    {TKDPO4K_VAL_SOUR_REF3,     0, 0, "REF3",   0},
    {TKDPO4K_VAL_SOUR_REF4,     0, 0, "REF4",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMathSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMathSourceRangeTableEntries,
};

    /*- TKDPO4K_ATTR_MATH_FUNCTION -*/
static IviRangeTableEntry attrMathFunctionRangeTableEntries[] =
{
    {TKDPO4K_VAL_MATH_ADD,          0, 0, "+",      0},
    {TKDPO4K_VAL_MATH_SUBTRACT,     0, 0, "-",      0},
    {TKDPO4K_VAL_MATH_MULTIPLY,     0, 0, "*",      0},
    {TKDPO4K_VAL_MATH_DIVIDE,       0, 0, "/",      0},
    {TKDPO4K_VAL_MATH_FFT,          0, 0, "FFT",    0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMathFunctionRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMathFunctionRangeTableEntries,
};
static ViStatus _VI_FUNC tkdpo4kAttrMathFunction_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      funcString[BUFFER_SIZE] = {0};
    ViInt32     mathType;
    ViString    addString, subString, multiString, divString, fftString;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, &mathType) ); 
    
    if(mathType == TKDPO4K_VAL_MATH_TYPE_DUAL||mathType == TKDPO4K_VAL_MATH_TYPE_SPECTRUM)
    {
        viCheckErr ( viQueryf (io, "MATH:DEFINE?", "%s", funcString) );             
        
        viCheckErr ( Ivi_GetViInt32EntryFromValue (TKDPO4K_VAL_MATH_ADD, &attrMathFunctionRangeTable,   
                                                    VI_NULL, VI_NULL, VI_NULL, VI_NULL, &addString, VI_NULL) );
        viCheckErr ( Ivi_GetViInt32EntryFromValue (TKDPO4K_VAL_MATH_SUBTRACT, &attrMathFunctionRangeTable,  
                                                    VI_NULL, VI_NULL, VI_NULL, VI_NULL, &subString, VI_NULL) ); 
        viCheckErr ( Ivi_GetViInt32EntryFromValue (TKDPO4K_VAL_MATH_MULTIPLY, &attrMathFunctionRangeTable,  
                                                    VI_NULL, VI_NULL, VI_NULL, VI_NULL, &multiString, VI_NULL) );
        viCheckErr ( Ivi_GetViInt32EntryFromValue (TKDPO4K_VAL_MATH_DIVIDE, &attrMathFunctionRangeTable,    
                                                    VI_NULL, VI_NULL, VI_NULL, VI_NULL, &divString, VI_NULL) ); 
                                                    
        if( strstr (funcString, addString) )                                                        
        {
            *value = TKDPO4K_VAL_MATH_ADD;
        }
        else if( strstr (funcString, subString) )
        {
            *value = TKDPO4K_VAL_MATH_SUBTRACT;
        }
        else if( strstr (funcString, multiString) )
        {
            *value = TKDPO4K_VAL_MATH_MULTIPLY;
        }
        else if( strstr (funcString, divString) )
        {
            *value = TKDPO4K_VAL_MATH_DIVIDE;       
        }
        else
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    else if(mathType == TKDPO4K_VAL_MATH_TYPE_FFT)
    {
        viCheckErr ( viQueryf (io, "MATH:DEFINE?", "%s", funcString) );     

        viCheckErr ( Ivi_GetViInt32EntryFromValue (TKDPO4K_VAL_MATH_FFT, &attrMathFunctionRangeTable,   
                                                    VI_NULL, VI_NULL, VI_NULL, VI_NULL, &fftString, VI_NULL) ); 
                                                    
        if( strstr (funcString, fftString) )
        {
            *value = TKDPO4K_VAL_MATH_FFT;
        }
        else
        {
            error = IVI_ERROR_INVALID_VALUE;
            viCheckErr (error);
        }
    }
    else
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error); 
    }
        
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrMathFunction_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     mathType;
    ViInt32     source1, source2;
    ViString    source1Name, source2Name, operator;
    ViInt32     refsource1,refsource2;
    ViString    refsource1Name,refsource2Name;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, &mathType) );
                                            
    if(!((mathType == TKDPO4K_VAL_MATH_TYPE_DUAL)                                           
            || (mathType == TKDPO4K_VAL_MATH_TYPE_FFT)|| (mathType == TKDPO4K_VAL_MATH_TYPE_SPECTRUM)))
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_SOURCE_1ST,
                                            0, &source1) );
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_SOURCE_2ND,
                                            0, &source2) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromValue (source1, &attrMathSourceRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &source1Name, VI_NULL) );
    viCheckErr ( Ivi_GetViInt32EntryFromValue (source2, &attrMathSourceRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &source2Name, VI_NULL) );
    viCheckErr ( Ivi_GetViInt32EntryFromValue   (value, &attrMathFunctionRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &operator, VI_NULL) );
    

    /* SPECTRUM Operation*/
    if(mathType == TKDPO4K_VAL_MATH_TYPE_SPECTRUM)
    {   
        checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_RF_SOURCE_1ST,
                                            0, &refsource1) );
        checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_RF_SOURCE_2ND,
                                            0, &refsource2) );
        viCheckErr ( Ivi_GetViInt32EntryFromValue (refsource1, &attrMathRefSourceRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &refsource1Name, VI_NULL) );
        viCheckErr ( Ivi_GetViInt32EntryFromValue (refsource2, &attrMathRefSourceRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                    &refsource2Name, VI_NULL) );
        viCheckErr ( viPrintf (io, "MATH:DEFINE \"%s%s%s\"", refsource1Name, operator, refsource2Name) );
    }
    /* FFT Operation */
    else if(value == TKDPO4K_VAL_MATH_FFT)
    {
        viCheckErr ( viPrintf (io, "MATH:DEFINE \"%s(%s)\"", operator, source1Name) );                                                                 
    }
    /* Basic Math Operation */
    else
    {
        viCheckErr ( viPrintf (io, "MATH:DEFINE \"%s%s%s\"", source1Name, operator, source2Name) );         
    }
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_FFT_VERT_SCALE -*/
static IviRangeTableEntry attrFFTVertScaleRangeTableEntries[] =
{
    {TKDPO4K_VAL_MATH_DBV_RMS,      0, 0, "DB",     0},
    {TKDPO4K_VAL_MATH_LINEAR_RMS,   0, 0, "LINEAR", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrFFTVertScaleRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    ":MATH:SPECT:MAG",
    attrFFTVertScaleRangeTableEntries,
};

    /*- TKDPO4K_ATTR_FFT_WINDOW -*/
static IviRangeTableEntry attrFFTWindowRangeTableEntries[] =
{
    {TKDPO4K_VAL_MATH_HANNING,      0, 0, "HANNING",        0},
    {TKDPO4K_VAL_MATH_RECTANGULAR,  0, 0, "RECTANGULAR",    0},
    {TKDPO4K_VAL_MATH_HAMMING,      0, 0, "HAMMING",        0},
    {TKDPO4K_VAL_MATH_BLACK_HARRIS, 0, 0, "BLACKMANHARRIS", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrFFTWindowRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    "MATH:SPECT:WIN",
    attrFFTWindowRangeTableEntries,
};

    /*- TKDPO4K_ATTR_ADV_VAR1 -*/
static IviRangeTableEntry attrAdvVar1RangeTableEntries[] =
{
    {-9.9E15, 9.9E15, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrAdvVar1RangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    "MATHVAR:VAR1",
    attrAdvVar1RangeTableEntries,
};

    /*- TKDPO4K_ATTR_ADV_VAR2 -*/   
static IviRangeTableEntry attrAdvVar2RangeTableEntries[] =
{
    {-9.9E15, 9.9E15, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrAdvVar2RangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    ":MATHVAR:VAR2",
    attrAdvVar2RangeTableEntries,
};
    
    /*- TKDPO4K_ATTR_ADV_DEFINE -*/
static ViStatus _VI_FUNC tkdpo4kAttrAdvDefine_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      value[BUFFER_SIZE] = {0};
    ViInt32     mathType;  
    ViInt32     length;
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, &mathType) );
    if(mathType != TKDPO4K_VAL_MATH_TYPE_ADVANCED)
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }
    
    viCheckErr ( viQueryf (io, ":MATH:DEFINE?", "%s", value) );
    length = (ViInt32)strlen (value);
    
    value[length-1] = '\0';
        
    checkErr ( Ivi_SetValInStringCallback(vi, attributeId, value+1) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAdvDefine_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     mathType;  
    
    checkErr ( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MATH_TYPE,
                                            0, &mathType) );
    if(mathType != TKDPO4K_VAL_MATH_TYPE_ADVANCED)
    {
        error = IVI_ERROR_INVALID_CONFIGURATION;
        viCheckErr (error);
    }

    viCheckErr ( viPrintf (io, ":MATH:DEFINE \"%s\"", value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SELECT -*/
static IviRangeTableEntry attrDPO4KBusSelectRangeTableEntries[] =
{
    {TKDPO4K_VAL_BUS1, 0, 0, "B1", 0},
    {TKDPO4K_VAL_BUS2, 0, 0, "B2", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusSelectRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusSelectRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusSelectRangeTableEntries[] =
{
    {TKDPO4K_VAL_BUS1, 0, 0, "B1", 0},
    {TKDPO4K_VAL_BUS2, 0, 0, "B2", 0},
    {TKDPO4K_VAL_BUS3, 0, 0, "B3", 0},
    {TKDPO4K_VAL_BUS4, 0, 0, "B4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusSelectRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusSelectRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusSelect_RangeTableCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     instrModelNo;
    
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    
    if (IS_MSO4K (instrModelNo))
    {
        tblPtr = &attrMSO4KBusSelectRangeTable; 
    }
    else{
		if(IS_MDO4KC (instrModelNo))
    	{
        	tblPtr = &attrMDO4KCBusSelectRangeTable;
    	}
		else{
			tblPtr = &attrDPO4KBusSelectRangeTable;
		}
	}

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

    /*- TKDPO4K_ATTR_BUS_TYPE -*/
static IviRangeTableEntry attrDPO4KBusTypeRangeTableEntries[] =
{
    {TKDPO4K_VAL_BUS_I2C,   0, 0, "I2C",    0},
    {TKDPO4K_VAL_BUS_SPI,   0, 0, "SPI",    0},
    {TKDPO4K_VAL_BUS_CAN,   0, 0, "CAN",    0},
    {TKDPO4K_VAL_BUS_RS232, 0, 0, "RS232C", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusTypeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusTypeRangeTableEntries,
};
    
static IviRangeTableEntry attrMSO4KBusTypeRangeTableEntries[] = 
{
    {TKDPO4K_VAL_BUS_I2C,       0, 0, "I2C",    0},
    {TKDPO4K_VAL_BUS_SPI,       0, 0, "SPI",    0},
    {TKDPO4K_VAL_BUS_CAN,       0, 0, "CAN",    0},
    {TKDPO4K_VAL_BUS_RS232,     0, 0, "RS232C", 0},
    {TKDPO4K_VAL_BUS_PARALLEL,  0, 0, "PARALLEL",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}    
};

static IviRangeTable attrMSO4KBusTypeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusTypeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusType_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusTypeRangeTable;
    else
        tblPtr = &attrMSO4KBusTypeRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusType_ReadCallback (ViSession vi,
                                                          ViSession io,
                                                          ViConstString channelName,
                                                          ViAttr attributeId,
                                                          ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      busType[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
                                                
    viCheckErr ( viQueryf (io, ":BUS:%s:TYPE?", "%s", busName, busType) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString (busType, tblPtr,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                            
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusType_WriteCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    busType;
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr( Ivi_GetViInt32EntryFromValue (value, tblPtr, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL,
                                                &busType, VI_NULL) );

    viCheckErr ( viPrintf (io, ":BUS:%s:TYPE %s", busName, busType) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_STATE -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusState_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViInt32     result;

    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    
    viCheckErr ( viQueryf (io, ":BUS:%s:STATE?", "%d", busName, &result) );
    if(result == 0)
    {
        *value = VI_FALSE;
    }
    else
    {
        *value = VI_TRUE;
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusState_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViBoolean value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViInt32     result;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    if(value == VI_FALSE)
    {
        result = 0;
    }
    else
    {
        result = 1;
    }   
    
    viCheckErr ( viPrintf (io, ":BUS:%s:STATE %d", busName, result) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_CAN_BITRATE -*/
static IviRangeTableEntry attrBusCanBitrateRangeTableEntries[] =
    {
        {TKDPO4K_VAL_CAN_RATE10K, 0, 0, "RATE10K", 0},
        {TKDPO4K_VAL_CAN_RATE20K, 0, 0, "RATE20K", 0},
        {TKDPO4K_VAL_CAN_RATE33K, 0, 0, "RATE33K", 0},
        {TKDPO4K_VAL_CAN_RATE37K, 0, 0, "RATE37K", 0},
        {TKDPO4K_VAL_CAN_RATE50K, 0, 0, "RATE50K", 0},
        {TKDPO4K_VAL_CAN_RATE62K, 0, 0, "RATE62K", 0},
        {TKDPO4K_VAL_CAN_RATE83K, 0, 0, "RATE83K", 0},
        {TKDPO4K_VAL_CAN_RATE92K, 0, 0, "RATE92K", 0},
        {TKDPO4K_VAL_CAN_RATE100K, 0, 0, "RATE100K", 0},
        {TKDPO4K_VAL_CAN_RATE125K, 0, 0, "RATE125K", 0},
        {TKDPO4K_VAL_CAN_RATE250K, 0, 0, "RATE250K", 0},
        {TKDPO4K_VAL_CAN_RATE500K, 0, 0, "RATE500K", 0},
        {TKDPO4K_VAL_CAN_RATE800K, 0, 0, "RATE800K", 0},
        {TKDPO4K_VAL_CAN_RATE1M, 0, 0, "RATE1M", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusCanBitrateRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusCanBitrateRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrBusCanBitrate_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      bitRate[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, ":BUS:%s:CAN:BITR?", "%s", busName, bitRate) );
    
    error = Ivi_GetViInt32EntryFromString (bitRate, &attrBusCanBitrateRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL);
    if(error <  VI_SUCCESS)
    {
        sscanf (bitRate, "%d", value);
        
        error = VI_SUCCESS;
    }

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusCanBitrate_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    bitRate;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( Ivi_GetViInt32EntryFromValue (value, &attrBusCanBitrateRangeTable, 
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL, &bitRate, VI_NULL) );

    viCheckErr( viPrintf (io, ":BUS:%s:CAN:BITR %s", busName, bitRate) ); 

Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_BUS_CAN_PROBE -*/
static IviRangeTableEntry attrBusCanProbeRangeTableEntries[] =
{
    {TKDPO4K_VAL_CAN_CANH,  0, 0, "CANH",           0},
    {TKDPO4K_VAL_CAN_CANL,  0, 0, "CANL",           0},
    {TKDPO4K_VAL_CAN_RX,    0, 0, "RX",             0},
    {TKDPO4K_VAL_CAN_TX,    0, 0, "TX",             0},
    {TKDPO4K_VAL_CAN_DIFF,  0, 0, "DIFFERENTIAL",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusCanProbeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusCanProbeRangeTableEntries,
};  

static ViStatus _VI_FUNC tkdpo4kAttrBusCanProbe_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      probe[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:CAN:PRO?", "%s", busName, probe) );
    
    viCheckErr ( Ivi_GetViInt32EntryFromString (probe, &attrBusCanProbeRangeTable,
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusCanProbe_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    probe;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( Ivi_GetViInt32EntryFromValue (value, &attrBusCanProbeRangeTable,
                                                VI_NULL, VI_NULL, VI_NULL, VI_NULL, &probe, VI_NULL) ); 
                                                
    viCheckErr ( viPrintf (io, ":BUS:%s:CAN:PRO %s", busName, probe) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_CAN_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusCanSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusCanSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusCanSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusCanSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusCanSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusCanSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;

    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusCanSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusCanSourceRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:CAN:SOU?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}


static ViStatus _VI_FUNC tkdpo4kAttrBusCanSource_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:CAN:SOU %s", busName, source) );

Error:
    return error;
}   

    /*- TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusI2cClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusI2cClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusI2cClockSourceRangeTableEntries,
};  

static IviRangeTableEntry attrMSO4KBusI2cClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusI2cClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusI2cClockSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusI2cClockSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusI2cClockSourceRangeTable;     

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:I2C:CLOCK:SOU?", "%s", busName, source) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cClockSource_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
                                            
    viCheckErr( viPrintf (io, ":BUS:%s:I2C:CLOCK:SOU %s", busName, source) );                                           

Error:
    return error;
}   

    /*- TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusI2cDataSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusI2cDataSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusI2cDataSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusI2cDataSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusI2cDataSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusI2cDataSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusI2cDataSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusI2cDataSourceRangeTable;      

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:I2C:DATA:SOU?", "%s", busName, source) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );          
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusI2cDataSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );      
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
                                            
    viCheckErr( viPrintf (io, ":BUS:%s:I2C:DATA:SOU %s", busName, source) );    

Error:
    return error;
}   

    /*- TKDPO4K_ATTR_BUS_SPI_MISO_POLARITY -*/
static IviRangeTableEntry attrBusSpiPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_SPI_POLARITY_LOW,  0, 0, "LOW",    0},
    {TKDPO4K_VAL_SPI_POLARITY_HIGH, 0, 0, "HIGH",   0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusSpiPolarityRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusSpiPolarityRangeTableEntries,
};  

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      polarity[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:DATA:MISO:POLAR?", "%s", busName, polarity) );  
    
    viCheckErr ( Ivi_GetViInt32EntryFromString(polarity, &attrBusSpiPolarityRangeTable, 
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    polarity;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, &attrBusSpiPolarityRangeTable,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &polarity, VI_NULL) );  

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:DATA:MISO:POLAR %s", busName, polarity) );

Error:
    return error;
}   

    /*- TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusSpiMisoSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusSpiMisoSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusSpiMisoSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusSpiMisoSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusSpiMisoSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusSpiMisoSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusSpiMisoSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusSpiMisoSourceRangeTable;  

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:DATA:MISO:SOU?", "%s", busName, source) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMisoSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:DATA:MISO:SOU %s", busName, source) );   

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SPI_MOSI_POLARITY -*/      
static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      polarity[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:DATA:MOSI:POLAR?", "%s", busName, polarity) );  
    
    viCheckErr ( Ivi_GetViInt32EntryFromString(polarity, &attrBusSpiPolarityRangeTable, 
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    polarity;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, &attrBusSpiPolarityRangeTable,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &polarity, VI_NULL) );  

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:DATA:MOSI:POLAR %s", busName, polarity) );   

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusSpiMosiSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusSpiMosiSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusSpiMosiSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusSpiMosiSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0}, 
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusSpiMosiSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusSpiMosiSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusSpiMosiSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusSpiMosiSourceRangeTable;  

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:DATA:MOSI:SOU?", "%s", busName, source) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );      
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiMosiSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:DATA:MOSI:SOU %s", busName, source) ); 
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SPI_SCLK_POLARITY -*/
static IviRangeTableEntry attrBusSpiSclkPolarityRangeTableEntries[] =
{
    {TKDPO4K_VAL_SPI_SCLK_RISE, 0, 0, "RISE", 0},
    {TKDPO4K_VAL_SPI_SCLK_FALL, 0, 0, "FALL", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusSpiSclkPolarityRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusSpiSclkPolarityRangeTableEntries,
};  
    
static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkPolarity_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      polarity[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:SCLK:POLAR?", "%s", busName, polarity) );  
    
    viCheckErr ( Ivi_GetViInt32EntryFromString(polarity, &attrBusSpiSclkPolarityRangeTable, 
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkPolarity_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    polarity;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, &attrBusSpiSclkPolarityRangeTable,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &polarity, VI_NULL) );  

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:SCLK:POLAR %s", busName, polarity) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusSpiSclkSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusSpiSclkSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusSpiSclkSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusSpiSclkSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusSpiSclkSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusSpiSclkSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_RangeTableCallback (ViSession vi,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusSpiSclkSourceRangeTable;
    else
        tblPtr = &attrMSO4KBusSpiSclkSourceRangeTable;

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:SCLK:SOU?", "%s", busName, source) );

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSclkSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:SCLK:SOU %s", busName, source) ); 
    
Error:
    return error;
}

    /*- `TKDPO4K_ATTR_BUS_SPI_SS_POLARITY -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsPolarity_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      polarity[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:SS:POLAR?", "%s", busName, polarity) );  
    
    viCheckErr ( Ivi_GetViInt32EntryFromString(polarity, &attrBusSpiPolarityRangeTable, 
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsPolarity_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    polarity;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, &attrBusSpiPolarityRangeTable,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &polarity, VI_NULL) );  

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:SS:POLAR %s", busName, polarity) );  

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_SPI_SS_SOURCE -*/
static IviRangeTableEntry attrDPO4KBusSpiSsSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrDPO4KBusSpiSsSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrDPO4KBusSpiSsSourceRangeTableEntries,
};

static IviRangeTableEntry attrMSO4KBusSpiSsSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrMSO4KBusSpiSsSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrMSO4KBusSpiSsSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );
    if(IS_DPO4K(model) || IS_DPO3K(model))
        tblPtr = &attrDPO4KBusSpiSsSourceRangeTable;    
    else
        tblPtr = &attrMSO4KBusSpiSsSourceRangeTable;        
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, ":BUS:%s:SPI:SS:SOU?", "%s", busName, source) );
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusSpiSsSource_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );      
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );

    viCheckErr( viPrintf (io, ":BUS:%s:SPI:SS:SOU %s", busName, source) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_PARALLEL_BITS_SOURCE -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusParallelBitsSource_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      bitsSource[BUFFER_SIZE] = {0};
    ViString    bitValue;
    ViString    activeBit;
    ViInt32     source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    ViInt32     index=0, j;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    for(j=0; j<16; j++)
    {
        checkErr ( Ivi_GetNthRepCapName ( vi, BITSOURCE_REP_CAP_NAME, j+1, &activeBit) );   
        
        checkErr ( Ivi_GetAttributeViInt32 (vi, activeBit, TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE, 0, &source) );
        checkErr ( Ivi_GetAttrRangeTable ( vi, activeBit, TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE, &tblPtr) ); 
        viCheckErr ( Ivi_GetViInt32EntryFromValue ( source, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &bitValue, VI_NULL) );
        
        index += sprintf(bitsSource+index, "%s,", bitValue);
    }
    bitsSource[strlen ( bitsSource) - 1] = 0;
    
    checkErr( Ivi_SetValInStringCallback ( vi, attributeId, bitsSource) );
                                                
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelBitsSource_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      bitValue[BUFFER_SIZE] = {0};
    ViString    activeBit;
    ViInt32     source;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     index=0, j;
    ViConstString       channelString;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    for(j=0; j<16; j++)
    {
        sscanf(value+index, "%[^,],", bitValue);
        index += (ViInt32)strlen ( bitValue) + 1;
        checkErr ( Ivi_GetNthRepCapName ( vi, BITSOURCE_REP_CAP_NAME, j+1, &activeBit) );
        
        checkErr ( Ivi_CoerceChannelName ( vi, bitValue, &channelString));
        
        checkErr ( Ivi_GetAttrRangeTable ( vi, activeBit, TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE, &tblPtr) );       
        viCheckErr ( Ivi_GetViInt32EntryFromString ( channelString, tblPtr, 
                                                    &source, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
        
        checkErr ( Ivi_SetAttributeViInt32 ( vi, activeBit, TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE, 0, source) );
    }

Error:
    return error;
}

    /*- TKDPO4K_ATTR_INSTR_BIT_SOURCE -*/
static IviRangeTableEntry attrInstrParallelBitSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrInstrParallelBitSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrInstrParallelBitSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrInstrParallelBitSource_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
    ViStatus        error = VI_SUCCESS;
    ViString    busName; 
    ViChar      source[BUFFER_SIZE] = {0}; 
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    viCheckErr( viQueryf(io, "BUS:%s:PAR:%s:SOU?","%s", busName, channelName, source));
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
    
Error:
    return error;   
}

static ViStatus _VI_FUNC tkdpo4kAttrInstrParallelBitSource_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
    ViStatus        error = VI_SUCCESS;
    ViString    busName; 
    ViString    source; 
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    viCheckErr( viPrintf(io, "BUS:%s:PAR:%s:SOU %s", busName, channelName, source));
    
Error:
    return error;   
}

    /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_EDGE -*/
static IviRangeTableEntry attrBusParallelClockEdgeRangeTableEntries[] =
{
    {TKDPO4K_VAL_PARALLEL_CLOCK_RISE,   0, 0, "RISING", 0},
    {TKDPO4K_VAL_PARALLEL_CLOCK_FALL,   0, 0, "FALLING", 0},
    {TKDPO4K_VAL_PARALLEL_CLOCK_EITHER, 0, 0, "EITHER", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusParallelClockEdgeRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusParallelClockEdgeRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockEdge_ReadCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViChar      polarity[BUFFER_SIZE] = {0};    
    IviRangeTablePtr    tblPtr = VI_NULL;      
     
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, "BUS:%s:PAR:CLOCK:EDGE?", "%s", busName, polarity) );
    
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr ( Ivi_GetViInt32EntryFromString(polarity, tblPtr,    
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockEdge_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    polarity;   
    IviRangeTablePtr    tblPtr = VI_NULL;      
     
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &polarity, VI_NULL) );
    viCheckErr( viPrintf(io, "BUS:%s:PAR:CLOCK:EDGE %s", busName, polarity));   
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_LOCKED -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockLocked_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      result[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );
    
    viCheckErr( viQueryf (io, "BUS:%s:PAR:CLOCK:ISCLOCK?", "%s", busName, result) );
    if(strcmp(result, "YES") == 0)
        *value = VI_TRUE;
    else
        *value = VI_FALSE;
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockLocked_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViBoolean value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viPrintf(io, "BUS:%s:PAR:CLOCK:ISCLOCK %s", busName, value?"YES":"NO") );
    
Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_SOURCE -*/
static IviRangeTableEntry attrBusParallelClockSourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusParallelClockSourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusParallelClockSourceRangeTableEntries,
};

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockSource_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL;  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, "BUS:%s:PAR:CLOCK:SOU?", "%s", busName, source) );
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelClockSource_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );      
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr( viPrintf (io, "BUS:%s:PAR:CLOCK:SOU %s", busName, source) );    
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_PARALLEL_WIDTH -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_CheckCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, channelName, TKDPO4K_ATTR_MODEL, 0, &model) );
    switch(model)
    {
        case TKDPO4K_VAL_MSO_4104:
        case TKDPO4K_VAL_MSO_4054:
        case TKDPO4K_VAL_MSO_4034:
        {
            if((value<=0) || (value>20))
                viCheckErr(IVI_ERROR_INVALID_VALUE);
            break;
        }
        case TKDPO4K_VAL_MSO_4032:
        {
            if((value<=0) || (value>18))
                viCheckErr(IVI_ERROR_INVALID_VALUE);
            break;
        }
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    viCheckErr( viQueryf (io, "BUS:%s:PAR:WID?", "%d", busName, value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusParallelWidth_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    viCheckErr( viPrintf (io, "BUS:%s:PAR:WID %d", busName, value) );   
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_RS232_BITRATE -*/ 
static IviRangeTableEntry attrBusRs232BitrateRangeTableEntries[] =
    {
        {50, 0, 0, "", 0},
        {75, 0, 0, "", 0},
        {110, 0, 0, "", 0},
        {134, 0, 0, "", 0},
        {150, 0, 0, "", 0},
        {300, 0, 0, "", 0},
        {600, 0, 0, "", 0},
        {1200, 0, 0, "", 0},
        {1800, 0, 0, "", 0},
        {2000, 0, 0, "", 0},
        {2400, 0, 0, "", 0},
        {3600, 0, 0, "", 0},
        {4800, 0, 0, "", 0},
        {7200, 0, 0, "", 0},
        {9600, 0, 0, "", 0},
        {14400, 0, 0, "", 0},
        {15200, 0, 0, "", 0},
        {19200, 0, 0, "", 0},
        {28800, 0, 0, "", 0},
        {38400, 0, 0, "", 0},
        {56000, 0, 0, "", 0},
        {57600, 0, 0, "", 0},
        {115200, 0, 0, "", 0},
        {128000, 0, 0, "", 0},
        {230400, 0, 0, "", 0},
        {460800, 0, 0, "", 0},
        {921600, 0, 0, "", 0},
        {1382400, 0, 0, "", 0},
        {1843200, 0, 0, "", 0},
        {2764800, 0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusRs232BitrateRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusRs232BitrateRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Bitrate_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    viCheckErr( viQueryf (io, "BUS:%s:RS232C:BITR?", "%d", busName, value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Bitrate_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:BITR %d", busName, value) );    

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_RS232_DATABITS -*/
static IviRangeTableEntry attrBusRs232DatabitsRangeTableEntries[] =
    {
        {7, 0, 0, "", 0},
        {8, 0, 0, "", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusRs232DatabitsRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusRs232DatabitsRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Databits_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    viCheckErr( viQueryf (io, "BUS:%s:RS232C:DATAB?", "%d", busName, value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Databits_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:DATAB %d", busName, value) );   

Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_RS232_DELIMITER -*/
static IviRangeTableEntry attrBusRs232DelimiterRangeTableEntries[] =
    {
        {TKDPO4K_VAL_RS232_DELIMITER_NULL, 0, 0, "NULL", 0},
        {TKDPO4K_VAL_RS232_DELIMITER_LF, 0, 0, "LF", 0},
        {TKDPO4K_VAL_RS232_DELIMITER_CR, 0, 0, "CR", 0},
        {TKDPO4K_VAL_RS232_DELIMITER_SPACE, 0, 0, "SPACE", 0},
        {TKDPO4K_VAL_RS232_DELIMITER_XFF, 0, 0, "XFF", 0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusRs232DelimiterRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusRs232DelimiterRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Delimiter_ReadCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    ViChar      delimiter[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    viCheckErr( viQueryf(io, "BUS:%s:RS232C:DELIM?", "%s", busName, delimiter) );
    
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(delimiter, tblPtr,   
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Delimiter_WriteCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, delimiter;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &delimiter, VI_NULL) ); 
    
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:DELIM %s", busName, delimiter) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_RS232_PARITY -*/
static IviRangeTableEntry attrBusRs232ParityRangeTableEntries[] =
    {
        {TKDPO4K_VAL_RS232_PARITY_NONE,     0, 0, "NONE",   0},
        {TKDPO4K_VAL_RS232_PARITY_EVEN,     0, 0, "EVEN",   0},
        {TKDPO4K_VAL_RS232_PARITY_ODD,      0, 0, "ODD",    0},
        {IVI_RANGE_TABLE_LAST_ENTRY}
    };

static IviRangeTable attrBusRs232ParityRangeTable =
    {
        IVI_VAL_DISCRETE,
        VI_TRUE,
        VI_TRUE,
        VI_NULL,
        attrBusRs232ParityRangeTableEntries,
    };

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Parity_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    ViChar      parity[BUFFER_SIZE] = {0};
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );  
    viCheckErr( viQueryf(io, "BUS:%s:RS232C:PAR?", "%s", busName, parity) );
    
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(parity, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );  
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232Parity_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName, parity;
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &parity, VI_NULL) );    
    
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:PAR %s", busName, parity) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_BUS_RS232_RX_SOURCE -*/
static IviRangeTableEntry attrBusRS232SourceRangeTableEntries[] =
{
    {TKDPO4K_VAL_SOUR_CH1, 0, 0, "CH1", 0},
    {TKDPO4K_VAL_SOUR_CH2, 0, 0, "CH2", 0},
    {TKDPO4K_VAL_SOUR_CH3, 0, 0, "CH3", 0},
    {TKDPO4K_VAL_SOUR_CH4, 0, 0, "CH4", 0},
    {TKDPO4K_VAL_SOUR_D0,  0, 0, "D0",  0},
    {TKDPO4K_VAL_SOUR_D1,  0, 0, "D1",  0},
    {TKDPO4K_VAL_SOUR_D2,  0, 0, "D2",  0},
    {TKDPO4K_VAL_SOUR_D3,  0, 0, "D3",  0},
    {TKDPO4K_VAL_SOUR_D4,  0, 0, "D4",  0},
    {TKDPO4K_VAL_SOUR_D5,  0, 0, "D5",  0},
    {TKDPO4K_VAL_SOUR_D6,  0, 0, "D6",  0},
    {TKDPO4K_VAL_SOUR_D7,  0, 0, "D7",  0},
    {TKDPO4K_VAL_SOUR_D8,  0, 0, "D8",  0},
    {TKDPO4K_VAL_SOUR_D9,  0, 0, "D9",  0},
    {TKDPO4K_VAL_SOUR_D10, 0, 0, "D10", 0},
    {TKDPO4K_VAL_SOUR_D11, 0, 0, "D11", 0},
    {TKDPO4K_VAL_SOUR_D12, 0, 0, "D12", 0},
    {TKDPO4K_VAL_SOUR_D13, 0, 0, "D13", 0},
    {TKDPO4K_VAL_SOUR_D14, 0, 0, "D14", 0},
    {TKDPO4K_VAL_SOUR_D15, 0, 0, "D15", 0},     
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrBusRS232SourceRangeTable =
{
    IVI_VAL_DISCRETE,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrBusRS232SourceRangeTableEntries,
};
static ViStatus _VI_FUNC tkdpo4kAttrBusRs232RxSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    ViChar      source[BUFFER_SIZE] = {0};  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    viCheckErr( viQueryf(io, "BUS:%s:RS232C:RX:SOU?", "%s", busName, source) ); 
    
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232RxSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    ViString    source; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );     
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );   
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );    
    
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:RX:SOU %s", busName, source) ); 
    
Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_BUS_RS232_TX_SOURCE -*/
static ViStatus _VI_FUNC tkdpo4kAttrBusRs232TxSource_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    ViChar      source[BUFFER_SIZE] = {0};  
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    viCheckErr( viQueryf(io, "BUS:%s:RS232C:TX:SOU?", "%s", busName, source) ); 
    
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) ); 
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );   
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusRs232TxSource_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    ViString    source; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );     
    checkErr( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );   
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );    
    
    viCheckErr( viPrintf(io, "BUS:%s:RS232C:TX:SOU %s", busName, source) ); 
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_INSTRUMENT_FIRMWARE_REVISION -*/
static ViStatus _VI_FUNC tkdpo4kAttrInstrumentFirmwareRevision_ReadCallback (ViSession vi, 
                                                                    ViSession io,
                                                                    ViConstString channelName, 
                                                                    ViAttr attributeId,
                                                                    const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      idQ[BUFFER_SIZE], rdBuffer[BUFFER_SIZE];
    
    checkErr( Ivi_GetAttributeViString (vi, "", TKDPO4K_ATTR_ID_QUERY_RESPONSE,
                                        0, BUFFER_SIZE, idQ));

    sscanf (idQ, "%*[^,],%*[^,],%*[^,],%256[^\n]", rdBuffer);

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));
    
Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_INSTRUMENT_MANUFACTURER -*/
static ViStatus _VI_FUNC tkdpo4kAttrInstrumentManufacturer_ReadCallback (ViSession vi, 
                                                                          ViSession io,
                                                                          ViConstString channelName, 
                                                                          ViAttr attributeId,
                                                                          const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      idQ[BUFFER_SIZE], rdBuffer[BUFFER_SIZE];
    
    checkErr( Ivi_GetAttributeViString (vi, "", TKDPO4K_ATTR_ID_QUERY_RESPONSE,
                                        0, BUFFER_SIZE, idQ));

    sscanf (idQ, "%256[^,]", rdBuffer);

    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));
    
Error:
    return error;
}
    
    /*- TKDPO4K_ATTR_INSTRUMENT_MODEL -*/
static ViStatus _VI_FUNC tkdpo4kAttrInstrumentModel_ReadCallback (ViSession vi, 
                                                                   ViSession io,
                                                                   ViConstString channelName, 
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViChar      idQ[BUFFER_SIZE], rdBuffer[BUFFER_SIZE] = {0};
    ViInt32     model;
    
    if (!Ivi_Simulating(vi))
    {
    
        checkErr( Ivi_GetAttributeViString (vi, VI_NULL, TKDPO4K_ATTR_ID_QUERY_RESPONSE,
                                            0, BUFFER_SIZE, idQ));

        sscanf (idQ, "%*[^,],%256[^,]", rdBuffer);
    }
    else 
    {
        checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model));
      
        switch (model)
        {
            case TKDPO4K_VAL_DPO_4104:
            {
                strcpy(rdBuffer, "DPO 4104");
                break;
            }
            case TKDPO4K_VAL_DPO_4054:
            {
                strcpy(rdBuffer, "DPO 4054");
                break;
            }
            case TKDPO4K_VAL_DPO_4034:
            {
                strcpy(rdBuffer, "DPO 4034");   
                break;
            }
            case TKDPO4K_VAL_DPO_4032:
            {
                strcpy(rdBuffer, "DPO 4032");
                break;
            }
            case TKDPO4K_VAL_DPO_4104B:
            {
                strcpy(rdBuffer, "DPO 4104B");
                break;
            }
            case TKDPO4K_VAL_DPO_4054B:
            {
                strcpy(rdBuffer, "DPO 4054B");
                break;
            }
            case TKDPO4K_VAL_DPO_4034B:
            {
                strcpy(rdBuffer, "DPO 4034B");      
                break;
            }
            case TKDPO4K_VAL_MSO_4104: 
            {
                strcpy(rdBuffer, "MSO 4104");
                break;
            }       
            case TKDPO4K_VAL_MSO_4054:
            {
                strcpy(rdBuffer, "MSO 4054");
                break;
            }
            case TKDPO4K_VAL_MSO_4034:
            {
                strcpy(rdBuffer, "MSO 4034");
                break;
            }
            case TKDPO4K_VAL_MSO_4032:
            {
                strcpy(rdBuffer, "MSO 4032");
                break;
            }
            case TKDPO4K_VAL_MSO_4104B: 
            {
                strcpy(rdBuffer, "MSO 4104B");
                break;
            }       
            case TKDPO4K_VAL_MSO_4054B:
            {
                strcpy(rdBuffer, "MSO 4054B");
                break;
            }
            case TKDPO4K_VAL_MSO_4034B:
            {
                strcpy(rdBuffer, "MSO 4034B");
                break;
            }
            case TKDPO4K_VAL_MDO_41046:
            {
                strcpy(rdBuffer, "MDO 4104-6"); 
                break;
            }
            case TKDPO4K_VAL_MDO_41043:
            {
                strcpy(rdBuffer, "MDO 4104-3");  
                break;
            }
            case TKDPO4K_VAL_MDO_40546:
            {
                strcpy(rdBuffer, "MDO 4054-6");  
                break;
            }
            case TKDPO4K_VAL_MDO_40543:
            {
                strcpy(rdBuffer, "MDO 4054-3");
                break;
            }
            case TKDPO4K_VAL_DPO_4102B:
            {
                strcpy(rdBuffer, "DPO 4102B");
                break;
            }
            case TKDPO4K_VAL_DPO_4102B_L:
            {
                strcpy(rdBuffer, "DPO 4102B-L");
                break;
            }
            case TKDPO4K_VAL_DPO_4104B_L:
            {
                strcpy(rdBuffer, "DPO 4104B-L");
                break;
            }
            case TKDPO4K_VAL_MSO_4102B:
            {
                strcpy(rdBuffer, "MSO 4102B");
                break;
            }
            case TKDPO4K_VAL_MSO_4102B_L:
            {
                strcpy(rdBuffer, "MSO 4102B-L");
                break;
            }
            case TKDPO4K_VAL_MSO_4104B_L:
            {
                strcpy(rdBuffer, "MSO 4104B-L");
                break;
            }
            case TKDPO4K_VAL_DPO_4014B:
            {
                strcpy(rdBuffer, "DPO 4014B");
                break;
            }
            case TKDPO4K_VAL_MSO_4014B:
            {
                strcpy(rdBuffer, "MSO 4014B");
                break;
            }
            case TKDPO4K_VAL_MDO_4014_3:
            {
                strcpy(rdBuffer, "MDO 4014-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4034_3:
            {
                strcpy(rdBuffer, "MDO 4034-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4014B_3:
            {
                strcpy(rdBuffer, "MDO 4014B-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4034B_3:
            {
                strcpy(rdBuffer, "MDO 4034B-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4054B_3:
            {
                strcpy(rdBuffer, "MDO 4054B-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4054B_6:
            {
                strcpy(rdBuffer, "MDO 4054B-6");
                break;
            }
            case TKDPO4K_VAL_MDO_4104B_3:
            {
                strcpy(rdBuffer, "MDO 4014B-3");
                break;
            }
            case TKDPO4K_VAL_MDO_4104B_6:
            {
                strcpy(rdBuffer, "MDO 4014B-6");
                break;
            }
            case TKDPO4K_VAL_MDO_3012:
            {
                strcpy(rdBuffer, "MDO 3012");
                break;
            }
            case TKDPO4K_VAL_MDO_3014:
            {
                strcpy(rdBuffer, "MDO 3014");
                break;
            }
            case TKDPO4K_VAL_MDO_3022:
            {
                strcpy(rdBuffer, "MDO 3022");
                break;
            }
            case TKDPO4K_VAL_MDO_3024:
            {
                strcpy(rdBuffer, "MDO 3024");
                break;
            }
            case TKDPO4K_VAL_MDO_3032:
            {
                strcpy(rdBuffer, "MDO 3032");
                break;
            }
            case TKDPO4K_VAL_MDO_3034:
            {
                strcpy(rdBuffer, "MDO 3034");
                break;
            }
            case TKDPO4K_VAL_MDO_3052:
            {
                strcpy(rdBuffer, "MDO 3052");
                break;
            }
            case TKDPO4K_VAL_MDO_3054:
            {
                strcpy(rdBuffer, "MDO 3054");
                break;
            }
            case TKDPO4K_VAL_MDO_3102:
            {
                strcpy(rdBuffer, "MDO 3102");
                break;
            }
            case TKDPO4K_VAL_MDO_3104:
            {
                strcpy(rdBuffer, "MDO 3104");
                break;
            }
			case TKDPO4K_VAL_MDO_4024C:
            {
                strcpy(rdBuffer, "MDO 4024C");
                break;
            }
			case TKDPO4K_VAL_MDO_4034C:
            {
                strcpy(rdBuffer, "MDO 4034C");
                break;
            }
			case TKDPO4K_VAL_MDO_4054C:
            {
                strcpy(rdBuffer, "MDO 4054C");
                break;
            }
			case TKDPO4K_VAL_MDO_4104C:
            {
                strcpy(rdBuffer, "MDO 4104C");
                break;
            }
        }
    }
    
    checkErr( Ivi_SetValInStringCallback (vi, attributeId, rdBuffer));
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_FETCH_BUFFER_SIZE -*/
static IviRangeTableEntry attrFetchBufferSizeRangeTableEntries[] =
{
    {MIN_FETCH_BUFFER_SIZE, MAX_FETCH_BUFFER_SIZE, 0, "", 0},
    {IVI_RANGE_TABLE_LAST_ENTRY}
};

static IviRangeTable attrFetchBufferSizeRangeTable =
{
    IVI_VAL_RANGED,
    VI_TRUE,
    VI_TRUE,
    VI_NULL,
    attrFetchBufferSizeRangeTableEntries,
};
    
    /*- TKDPO4K_ATTR_DATA_WIDTH -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataWidth_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":DAT:WID?", "%ld", value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDataWidth_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf(io, ":DAT:WID %ld", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_START_POS -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataStartPos_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":DAT:STAR?", "%ld", value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDataStartPos_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf(io, ":DAT:STAR %ld", value) ); 

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_STOP_POS -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataStopPos_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":DAT:STOP?", "%ld", value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrDataStopPos_WriteCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viPrintf(io, ":DAT:STOP %ld", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_YZERO -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataYZero_ReadCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":WFMPRE:YZE?", "%le", value) );
    
Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_YOFF -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataYoff_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viQueryf(io, ":WFMPRE:YOFF?", "%le", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_YMULT -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataYmult_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf(io, ":WFMPRE:YMULT?", "%le", value) );  

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_XINCR -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataXincr_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, "WFMPRE:XINCR?", "%le", value) );

Error:
    return error;
}

    /*- TKDPO4K_ATTR_DATA_XZERO -*/
static ViStatus _VI_FUNC tkdpo4kAttrDataXzero_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;

    viCheckErr( viQueryf (io, "WFMPRE:XZERO?", "%le", value) );

Error:
    return error;
}

static ViStatus tkdpo4k_buildRangeTable(ViSession vi)    
{
    ViStatus error = VI_SUCCESS;       
    ViInt32 tableSize = MAX_TABLE_SIZE; /* Max tablesize of the table, depend on how many items in it */
       
    checkErr(Ivi_RangeTableNew (vi, tableSize + 1, IVI_VAL_DISCRETE, VI_FALSE, VI_FALSE, &attrMeasFunctionRangeTable));
       
    attrMeasFunctionRangeTable->customInfo = "MEASU:IMM:TYP";

    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 0,  TKDPO4K_VAL_RISE_TIME,           0.0, 0.0, "RISE",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 1,  TKDPO4K_VAL_FALL_TIME,           0.0, 0.0, "FALL",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 2,  TKDPO4K_VAL_FREQUENCY,           0.0, 0.0, "FREQUENCY",  0)); 
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 3,  TKDPO4K_VAL_PERIOD,              0.0, 0.0, "PERIOD",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 4,  TKDPO4K_VAL_VOLTAGE_RMS,             0.0, 0.0, "RMS",        0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 5,  TKDPO4K_VAL_VOLTAGE_PEAK_TO_PEAK,    0.0, 0.0, "PK2PK",      0));  
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 6,  TKDPO4K_VAL_VOLTAGE_MAX,             0.0, 0.0, "MAXIMUM",    0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 7,  TKDPO4K_VAL_VOLTAGE_MIN,             0.0, 0.0, "MINIMUM",    0));        
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 8,  TKDPO4K_VAL_VOLTAGE_HIGH,            0.0, 0.0, "HIGH",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 9,  TKDPO4K_VAL_VOLTAGE_LOW,             0.0, 0.0, "LOW",        0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 10, TKDPO4K_VAL_VOLTAGE_AVERAGE,         0.0, 0.0, "MEAN",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 11, TKDPO4K_VAL_WIDTH_NEG,           0.0, 0.0, "NWIDTH",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 12, TKDPO4K_VAL_WIDTH_POS,           0.0, 0.0, "PWIDTH",     0));        
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 13, TKDPO4K_VAL_DUTY_CYCLE_NEG,      0.0, 0.0, "NDUTY",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 14, TKDPO4K_VAL_DUTY_CYCLE_POS,      0.0, 0.0, "PDUTY",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 15, TKDPO4K_VAL_AMPLITUDE,           0.0, 0.0, "AMPLITUDE",  0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 16, TKDPO4K_VAL_VOLTAGE_CYCLE_RMS,   0.0, 0.0, "CRMS",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 17, TKDPO4K_VAL_VOLTAGE_CYCLE_AVERAGE, 0.0, 0.0, "CMEAN",        0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 18, TKDPO4K_VAL_POSITIVE_OVERSHOOT,  0.0, 0.0, "POVERSHOOT", 0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 19, TKDPO4K_VAL_NEGATIVE_OVERSHOOT,  0.0, 0.0, "NOVERSHOOT", 0)); 
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 20, TKDPO4K_VAL_TIMING_BURST_WIDTH,  0.0, 0.0, "BURST",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 21, TKDPO4K_VAL_PHASE,               0.0, 0.0, "PHASE",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 22, TKDPO4K_VAL_DELAY,               0.0, 0.0, "DELAY",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 23, TKDPO4K_VAL_AREA,                    0.0, 0.0, "AREA",       0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 24, TKDPO4K_VAL_CYCLE_AREA,          0.0, 0.0, "CAREA",      0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 25, TKDPO4K_VAL_CROSS_NEG,               0.0, 0.0, "NCROSS",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 26, TKDPO4K_VAL_CROSS_POS,               0.0, 0.0, "PCROSS",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 27, TKDPO4K_VAL_EDGE_POS,                0.0, 0.0, "PEDGECOUNT", 0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 28, TKDPO4K_VAL_EDGE_NEG,                0.0, 0.0, "NEDGECOUNT", 0));     
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 29, TKDPO4K_VAL_PULSE_POS,               0.0, 0.0, "PPULSECOUNT",0));  
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 30, TKDPO4K_VAL_PULSE_NEG,               0.0, 0.0, "NPULSECOUNT",0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 31, TKDPO4K_VAL_HISTOGRAM_HITS,          0.0, 0.0, "HIT",        0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 32, TKDPO4K_VAL_MEDIAN,                  0.0, 0.0, "MED",        0));    
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 33, TKDPO4K_VAL_SIGMA1,                  0.0, 0.0, "SIGMA1",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 34, TKDPO4K_VAL_SIGMA2,                  0.0, 0.0, "SIGMA2",     0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 35, TKDPO4K_VAL_SIGMA3,                  0.0, 0.0, "SIGMA3",     0));    
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 36, TKDPO4K_VAL_STDDEV,                  0.0, 0.0, "STD",        0));    
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 37, TKDPO4K_VAL_WAVEFORMS,               0.0, 0.0, "WAVEFORMS",  0));
    viCheckErr(Ivi_SetRangeTableEntry (attrMeasFunctionRangeTable, 38, TKDPO4K_VAL_TOVERSHOOT,              0.0, 0.0, "TOV",        0));
    
Error:              
    return error;   
}

    /*- TKDPO4K_ATTR_LOWER_THRESHOLD -*/
static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value){
    ViStatus    error = VI_SUCCESS;
   
    viCheckErr( viQueryf (io, ":BUS:LOW:%s?","%le", (ViString)channelName,value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value){
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":BUS:LOW:%s %le", channelName, value));
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrLowerThreshold_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    
    checkErr (Ivi_DefaultCheckCallbackViReal64 (vi, channelName, attributeId, value));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );

    switch(model)
    {
        case TKDPO4K_VAL_DPO_4104B:
        case TKDPO4K_VAL_DPO_4054B:
        case TKDPO4K_VAL_DPO_4034B:
        case TKDPO4K_VAL_MSO_4104B:
        case TKDPO4K_VAL_MSO_4054B:
        case TKDPO4K_VAL_MSO_4034B:
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_41043:
        case TKDPO4K_VAL_MDO_40546:
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_DPO_4014B:
        case TKDPO4K_VAL_MSO_4014B:
        case TKDPO4K_VAL_MDO_4014_3:
        case TKDPO4K_VAL_MDO_4034_3:
        case TKDPO4K_VAL_MDO_4014B_3:
        case TKDPO4K_VAL_MDO_4034B_3:
        case TKDPO4K_VAL_MDO_4054B_3:
        case TKDPO4K_VAL_MDO_4054B_6:
        case TKDPO4K_VAL_MDO_4104B_3:
        case TKDPO4K_VAL_MDO_4104B_6:
		case TKDPO4K_VAL_MDO_4024C:
		case TKDPO4K_VAL_MDO_4034C:
		case TKDPO4K_VAL_MDO_4054C:
		case TKDPO4K_VAL_MDO_4104C:	
            break;
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);     
    }

    
Error:
    return error;
}

/*- TKDPO4K_ATTR_UPPER_THRESHOLD -*/   
static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64 *value){
    ViStatus    error = VI_SUCCESS;
   
    viCheckErr( viQueryf (io, ":BUS:UPP:%s?", "%le", (ViString)channelName,value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value){
    ViStatus    error = VI_SUCCESS;
    
    viCheckErr( viPrintf (io, ":BUS:UPP:%s %le", channelName, value));
    
Error:
    return error;
}



static ViStatus _VI_FUNC tkdpo4kAttrUpperThreshold_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    
    checkErr (Ivi_DefaultCheckCallbackViReal64 (vi, channelName, attributeId, value));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );

    switch(model)
    {
        case TKDPO4K_VAL_DPO_4104B:
        case TKDPO4K_VAL_DPO_4054B:
        case TKDPO4K_VAL_DPO_4034B:
        case TKDPO4K_VAL_MSO_4104B:
        case TKDPO4K_VAL_MSO_4054B:
        case TKDPO4K_VAL_MSO_4034B:
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_41043:
        case TKDPO4K_VAL_MDO_40546:
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_DPO_4014B:
        case TKDPO4K_VAL_MSO_4014B:
        case TKDPO4K_VAL_MDO_4014_3:
        case TKDPO4K_VAL_MDO_4034_3:
        case TKDPO4K_VAL_MDO_4014B_3:
        case TKDPO4K_VAL_MDO_4034B_3:
        case TKDPO4K_VAL_MDO_4054B_3:
        case TKDPO4K_VAL_MDO_4054B_6:
        case TKDPO4K_VAL_MDO_4104B_3:
        case TKDPO4K_VAL_MDO_4104B_6:
		case TKDPO4K_VAL_MDO_4024C:
		case TKDPO4K_VAL_MDO_4034C:
		case TKDPO4K_VAL_MDO_4054C:
		case TKDPO4K_VAL_MDO_4104C:	
            break;
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);     
    }

    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kBModelViInt32_CheckCallback (ViSession vi,
                                                      ViConstString channelName,
                                                      ViAttr attributeId,
                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    
    checkErr(Ivi_DefaultCheckCallbackViInt32 (vi, channelName, attributeId, value));
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );

    switch(model)
    {
        case TKDPO4K_VAL_DPO_4104B:
        case TKDPO4K_VAL_DPO_4054B:
        case TKDPO4K_VAL_DPO_4034B:
        case TKDPO4K_VAL_MSO_4104B:
        case TKDPO4K_VAL_MSO_4054B:
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_41043:
        case TKDPO4K_VAL_MDO_40546:
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_DPO_4014B:
        case TKDPO4K_VAL_MSO_4014B:
        case TKDPO4K_VAL_MDO_4014B_3:
        case TKDPO4K_VAL_MDO_4034B_3:
        case TKDPO4K_VAL_MDO_4054B_3:
        case TKDPO4K_VAL_MDO_4054B_6:
        case TKDPO4K_VAL_MDO_4104B_3:
        case TKDPO4K_VAL_MDO_4104B_6:
		case TKDPO4K_VAL_MDO_4024C:
		case TKDPO4K_VAL_MDO_4034C:
		case TKDPO4K_VAL_MDO_4054C:
		case TKDPO4K_VAL_MDO_4104C:		
            break;
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);     
    }

    
Error:
    return error;
}



/*- TKDPO4K_ATTR_BUS_ETHERNET_TYPE -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetType_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:TYP?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetType_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:TYP %s", busName, source) );

Error:
    return error;
}


/*- TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE -*/    
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProbeType_ReadCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:PRO?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProbeType_WriteCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:PRO %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC -*/  
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetDiffInputDataSrc_ReadCallback (ViSession vi,
                                                                              ViSession io,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:SOU:DIFF?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetDiffInputDataSrc_WriteCallback (ViSession vi,
                                                                               ViSession io,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:SOU:DIFF %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC -*/    
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetPlusDataSrc_ReadCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:SOU:DPLU?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetPlusDataSrc_WriteCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:SOU:DPLU %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC-*/   
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetMinusDataSrc_ReadCallback (ViSession vi,
                                                                          ViSession io,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:SOU:DMIN?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetMinusDataSrc_WriteCallback (ViSession vi,
                                                                           ViSession io,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:SOU:DMIN %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL -*/   
static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProtocol_ReadCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":BUS:%s:ETHER:PROTO?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBusEthernetProtocol_WriteCallback (ViSession vi,
                                                                       ViSession io,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":BUS:%s:ETHER:PROTO %s", busName, source) );

Error:
    return error;
}


/*- TKDPO4K_ATTR_USB_TRAN_FIELD -*/   
static ViStatus _VI_FUNC tkdpo4kAttrUsbTranField_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:USB:SPL:SC:VAL?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranField_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:USB:SPL:SC:VAL %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_USB_TRAN_END_POINT -*/   
static ViStatus _VI_FUNC tkdpo4kAttrUsbTranEndPoint_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:USB:SPL:ET:VAL?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranEndPoint_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:USB:SPL:ET:VAL %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_USB_TRAN_START_END -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrUsbTranStartEnd_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 *value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:USB:SPL:SE:VAL?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUsbTranStartEnd_WriteCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViInt32 value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:USB:SPL:SE:VAL %s", busName, source) );

Error:
    return error;
}

 
static ViStatus _VI_FUNC tkdpo4kBModelViString_CheckCallback (ViSession vi,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     model;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &model) );

    switch(model)
    {
        case TKDPO4K_VAL_DPO_4104B:
        case TKDPO4K_VAL_DPO_4054B:
        case TKDPO4K_VAL_DPO_4034B:
        case TKDPO4K_VAL_MSO_4104B:
        case TKDPO4K_VAL_MSO_4054B:
        case TKDPO4K_VAL_MSO_4034B:
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_41043: 
        case TKDPO4K_VAL_MDO_40546:
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_DPO_4014B:
        case TKDPO4K_VAL_MSO_4014B:
        case TKDPO4K_VAL_MDO_4014B_3:
        case TKDPO4K_VAL_MDO_4034B_3:
        case TKDPO4K_VAL_MDO_4054B_3:
        case TKDPO4K_VAL_MDO_4054B_6:
        case TKDPO4K_VAL_MDO_4104B_3:
        case TKDPO4K_VAL_MDO_4104B_6:
		case TKDPO4K_VAL_MDO_4024C:
		case TKDPO4K_VAL_MDO_4034C:
		case TKDPO4K_VAL_MDO_4054C:
		case TKDPO4K_VAL_MDO_4104C:			
            break;
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION);     
    }

    
Error:
    return error;
}

/*- TKDPO4K_ATTR_USB_HUB_ADDRESS -*/    
static ViStatus _VI_FUNC tkdpo4kAttrUsbHubAdd_ReadCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:USB:SPL:HUB:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUsbHubAdd_WriteCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:USB:SPL:HUB:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_USB_PORT_ADDRESS -*/    
static ViStatus _VI_FUNC tkdpo4kAttrUsbPortAdd_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:USB:SPL:PORT:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrUsbPortAdd_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:USB:SPL:PORT:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE -*/    
static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicFrameType_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:FRAMETYP?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicFrameType_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:FRAMETYP %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_BASIC_CONDITION -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicCondition_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:COND?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicCondition_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:COND %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_BASIC_QUALIFIER -*/  
static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicQualifier_ReadCallback (ViSession vi,
                                                                     ViSession io,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 *value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      source[BUFFER_SIZE] = {0};
    IviRangeTablePtr    tblPtr = VI_NULL; 
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:QUAL?", "%s", busName, source) );
    
    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );
    viCheckErr ( Ivi_GetViInt32EntryFromString(source, tblPtr,  
                                                value, VI_NULL, VI_NULL, VI_NULL, VI_NULL) );


Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetBasicQualifier_WriteCallback (ViSession vi,
                                                                      ViSession io,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,
                                                                      ViInt32 value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    ViString    source;
    IviRangeTablePtr    tblPtr = VI_NULL;   
    
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    checkErr ( Ivi_GetAttrRangeTable(vi, channelName, attributeId, &tblPtr) );  
    viCheckErr( Ivi_GetViInt32EntryFromValue(value, tblPtr,
                                            VI_NULL, VI_NULL, VI_NULL, VI_NULL, &source, VI_NULL) );
    
    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:QUAL %s", busName, source) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_DATA_SIZE -*/  
static ViStatus _VI_FUNC tkdpo4kAttrEnetDataSize_ReadCallback (ViSession vi,
                                                               ViSession io,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 *value)
{
                                                                    
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:DAT:SIZ?", "%d", busName, value) );
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataSize_WriteCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:DAT:SIZ %d", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_DATA_OFFSET -*/   
static ViStatus _VI_FUNC tkdpo4kAttrEnetDataOffse_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName; 
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) );   

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:DAT:OFFS %d", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataOffset_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    checkErr( tkdpo4k_GetSelectedBusName(vi, &busName) ); 
    
    viCheckErr( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:DAT:OFFS?", "%d", busName, value) );
    
Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT -*/   
static ViStatus _VI_FUNC tkdpo4kAttrEnetDataUppLimit_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:DATA:HIVAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetDataUppLimit_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:DATA:HIVAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_DATA -*/     
static ViStatus _VI_FUNC tkdpo4kAttrEnetData_ReadCallback (ViSession vi,
                                                           ViSession io,
                                                           ViConstString channelName,
                                                           ViAttr attributeId,
                                                           const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:DATA:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetData_WriteCallback (ViSession vi,
                                                            ViSession io,
                                                            ViConstString channelName,
                                                            ViAttr attributeId,
                                                            ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:DATA:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS -*/     
static ViStatus _VI_FUNC tkdpo4kAttrEnetIPSrcAddr_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:IPH:SOU:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPSrcAddr_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:IPH:SOU:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_IP_DST_ADDRESS -*/    
static ViStatus _VI_FUNC tkdpo4kAttrEnetIPDstAddr_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:IPH:DEST:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_IP_DST_ADDRESS -*/   
static ViStatus _VI_FUNC tkdpo4kAttrEnetIPDstAddr_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:IPH:DEST:VAL \"%s\"", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACDstAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:MAC:ADDR:DEST:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_MAC_DST_ADDRESS -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetMACDstAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:MAC:ADDR:DEST:VAL \"%s\"", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACSrcAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:MAC:ADDR:SOU:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_MAC_SRC_ADDRESS -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetMACSrcAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:MAC:ADDR:SOU:VAL \"%s\"", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACLength_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:MAC:LEN:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_MAC_DST_LENGTH -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetMACLength_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:MAC:LEN:VAL \"%s\"", busName, value) );

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetMACUppLength_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:MAC:LEN:HIVAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetMACUppLength_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:MAC:LEN:HIVAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_MAC_QTAG -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetQtagValue_ReadCallback (ViSession vi,
                                                                ViSession io,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:QTAG:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetQtagValue_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:QTAG:VAL  \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS -*/      
static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpDstAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:DEST:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpDstAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:DEST:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS -*/   
static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSrcAddr_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:SOU:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSrcAddr_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:SOU:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER -*/  
static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpAcqNumber_ReadCallback (ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:ACK:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpAcqNumber_WriteCallback (ViSession vi,
                                                                    ViSession io,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:ACK:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER -*/   
static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSequenceNumber_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        const ViConstString cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:SEQ:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetTcpSequenceNumber_WriteCallback (ViSession vi,
                                                                         ViSession io,
                                                                         ViConstString channelName,
                                                                         ViAttr attributeId,
                                                                         ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:TCPH:SEQ:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_ENET_IP_PROTOCOL -*/  
static ViStatus _VI_FUNC tkdpo4kAttrEnetIPProtocol_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 const ViConstString cacheValue){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;
    ViChar      returnValue[BUFFER_SIZE]={0};
    ViInt32     dataLen;
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );  
    
    viCheckErr ( viQueryf (io, ":TRIG:A:BUS:%s:ETHER:IPH:PROTO:VAL?", "%s", busName, returnValue) );
    dataLen = (ViInt32)strlen(returnValue) - 1;
    returnValue[dataLen] = '\0';
    
    checkErr ( Ivi_SetValInStringCallback (vi, attributeId, returnValue+1) );   

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrEnetIPProtocol_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViConstString value){
    ViStatus    error = VI_SUCCESS;
    ViString    busName;    
    
    checkErr ( tkdpo4k_GetSelectedBusName (vi, &busName) );     

    viCheckErr ( viPrintf (io, ":TRIG:A:BUS:%s:ETHER:IPH:PROTO:VAL \"%s\"", busName, value) );

Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_SQUELCH_STATE */ 
/*- TKDPO4K_ATTR_RF_NUM_AVERAGES */
/*- TKDPO4K_ATTR_RF_AVERAGE_TRACE_COUNT */

/*- TKDPO4K_ATTR_RF_RBW -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfRbw_CheckCallback (ViSession vi,
                                                         ViConstString channelName,
                                                         ViAttr attributeId,
                                                         ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     RBWMode;  
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    viCheckErr(Ivi_GetAttributeViInt32(vi,channelName,TKDPO4K_ATTR_RF_RBW_MODE,0,&RBWMode));
    if(RBWMode != TKDPO4K_VAL_RF_RBW_MODE_MANUAL)
    {
        viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION,"To configure this attribute, RBW mode should be manual");
    }
    
    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value)); 
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_DETECTION_METHOD -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMethod_CheckCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     detectionMode;   
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_DETECTION_MODE,0,&detectionMode));
    if(detectionMode!=TKDPO4K_VAL_RF_DETECT_MODE_MANUAL)
    {
        viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION,"To configure this attribute, RBW mode should be manual");  
    }
    
    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value));       
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_SPAN_RBM_RATIO -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfSpanRbwRatio_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value)
{                                  
    ViStatus    error = VI_SUCCESS;  
    ViInt32     RBWMode;  
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckErr(Ivi_GetAttributeViInt32(vi,channelName,TKDPO4K_ATTR_RF_RBW_MODE,0,&RBWMode));
    if(RBWMode != TKDPO4K_VAL_RF_RBW_MODE_AUTO)
    {
        viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION,"To configure this attribute, RBW mode should be auto");
    }

    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value)); 
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_FREQ_START -*/
/*- TKDPO4K_ATTR_RF_FREQ_STOP -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrRfFreqStartStop_CheckCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     InstrModel;
    ViReal64    stopVal,startVal;
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );  
    viCheckErr(Ivi_GetAttributeViInt32(vi,channelName,TKDPO4K_ATTR_MODEL,0,&InstrModel));
    /* MDO-41043 and MDO-40543 have different range: 30KHz-3GHz */
    if((InstrModel == TKDPO4K_VAL_MDO_41043) || (InstrModel == TKDPO4K_VAL_MDO_40543) || (InstrModel == TKDPO4K_VAL_MDO_4014_3) 
        || (InstrModel == TKDPO4K_VAL_MDO_4034_3) || (InstrModel == TKDPO4K_VAL_MDO_4014B_3) || (InstrModel == TKDPO4K_VAL_MDO_4034B_3)
        || (InstrModel == TKDPO4K_VAL_MDO_4054B_3) || (InstrModel == TKDPO4K_VAL_MDO_4104B_3)
		)
    {
		if(attributeId == TKDPO4K_ATTR_RF_FREQ_STOP)
    	{
			if(value>3000000000)
			{
				checkErr(IVI_ERROR_INVALID_VALUE);
			}
		}else{
			if(value>(ViReal64)9000000000)
			{
				checkErr(IVI_ERROR_INVALID_VALUE);
			}
		}
    }
    if(attributeId == TKDPO4K_ATTR_RF_FREQ_STOP)
    {
        viCheckErr(Ivi_GetAttributeViReal64(vi,channelName,TKDPO4K_ATTR_RF_FREQ_START,0,&startVal));
        /* (stop-start)>1KHz */
        if((value-startVal)<1000)
        {
            checkErr(IVI_ERROR_INVALID_VALUE);
        }
    }
    else if(attributeId = TKDPO4K_ATTR_RF_FREQ_START)
    {
        viCheckErr(Ivi_GetAttributeViReal64(vi,channelName,TKDPO4K_ATTR_RF_FREQ_STOP,0,&stopVal));
        /* (stop-start)>1KHz */
        if((stopVal-value)<1000)
        {
            checkErr(IVI_ERROR_INVALID_VALUE);    
        }
    }
	if( IS_MDO4K(InstrModel) && (!IS_MDO4KC(InstrModel)) ) 
	{
		if(attributeId == TKDPO4K_ATTR_RF_FREQ_STOP && value >6000000000.0)
        {
            checkErr(IVI_ERROR_INVALID_VALUE);    
        }
	}
    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value)); 
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_FREQ_CENTER -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfFreqCenter_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName,
                                                                     ViAttr attributeId,
                                                                     IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     InstrModel;  
    viCheckErr(Ivi_GetAttributeViInt32(vi,channelName,TKDPO4K_ATTR_MODEL,0,&InstrModel));     
    
    if(InstrModel == TKDPO4K_VAL_MDO_41043 || InstrModel == TKDPO4K_VAL_MDO_40543 || InstrModel == TKDPO4K_VAL_MDO_4014_3 || InstrModel == TKDPO4K_VAL_MDO_4034_3\
       || InstrModel == TKDPO4K_VAL_MDO_4014B_3 || InstrModel == TKDPO4K_VAL_MDO_4034B_3 || InstrModel == TKDPO4K_VAL_MDO_4054B_3 || InstrModel == TKDPO4K_VAL_MDO_4104B_3
	   
		)
    {
        tblPtr = &attrRfFreqCenter3GRangeTable;
    }
    else if(InstrModel == TKDPO4K_VAL_MDO_41046 || InstrModel == TKDPO4K_VAL_MDO_40546 
			|| InstrModel == TKDPO4K_VAL_MDO_4054B_6 || InstrModel == TKDPO4K_VAL_MDO_4104B_6
			|| (InstrModel == TKDPO4K_VAL_MDO_4024C) || (InstrModel == TKDPO4K_VAL_MDO_4034C)
	   		|| (InstrModel == TKDPO4K_VAL_MDO_4054C) || (InstrModel == TKDPO4K_VAL_MDO_4104C)
			 )
    {
        tblPtr = &attrRfFreqCenter6GRangeTable; 
    }
    else
    {
        tblPtr = VI_NULL;
    }
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

/*- TKDPO4K_ATTR_RF_FREQ_SPAN -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfFreqSpan_RangeTableCallback (ViSession vi,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32     InstrModel;  
    viCheckErr(Ivi_GetAttributeViInt32(vi,channelName,TKDPO4K_ATTR_MODEL,0,&InstrModel));     
    
    if(InstrModel == TKDPO4K_VAL_MDO_41043 || InstrModel == TKDPO4K_VAL_MDO_40543 || InstrModel == TKDPO4K_VAL_MDO_4014_3 || InstrModel == TKDPO4K_VAL_MDO_4034_3\
       || InstrModel == TKDPO4K_VAL_MDO_4014B_3 || InstrModel == TKDPO4K_VAL_MDO_4034B_3 || InstrModel == TKDPO4K_VAL_MDO_4054B_3 || InstrModel == TKDPO4K_VAL_MDO_4104B_3
	   
	   )
    {
        tblPtr = &attrRfFreqSpan3GRangeTable;
    }
    else if((InstrModel == TKDPO4K_VAL_MDO_41046) || (InstrModel == TKDPO4K_VAL_MDO_40546) 
			 || (InstrModel == TKDPO4K_VAL_MDO_4054B_6) || (InstrModel == TKDPO4K_VAL_MDO_4104B_6) 
		|| (InstrModel == TKDPO4K_VAL_MDO_4024C) || (InstrModel == TKDPO4K_VAL_MDO_4034C)
	   || (InstrModel == TKDPO4K_VAL_MDO_4054C) || (InstrModel == TKDPO4K_VAL_MDO_4104C)   
	   )
    {
        tblPtr = &attrRfFreqSpan6GRangeTable; 
    }
    else
    {
        tblPtr = VI_NULL;
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}
/*- TKDPO4K_ATTR_RF_REF_LEVEL -*/ 
static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_CoerceCallback (ViSession vi,
                                                               ViConstString channelName,
                                                               ViAttr attributeId,
                                                               ViInt32 value,
                                                               ViInt32 *coercedValue)
{
    /* The value of RF_REF_LEVEL is in steps of 5 dBm */
    ViStatus    error = VI_SUCCESS;
    ViInt32     quotient;
    ViInt32     remainder;
    
    quotient = value/5;
    remainder = value%5;
    if(remainder>=2.5)
    {
        *coercedValue = (quotient+1)*5;
    }
    else
    {
        *coercedValue = quotient*5;
    }

    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_ReadCallback (ViSession vi,
                                                             ViSession io,
                                                             ViConstString channelName,
                                                             ViAttr attributeId,
                                                             ViInt32 *value){
    ViStatus  error = VI_SUCCESS;
    ViChar    buf[BUFFER_SIZE] = {0};
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    viCheckErr(viPrintf (io, ":RF:REFL?"));
    viCheckErr( viRead (io, buf, BUFFER_SIZE, VI_NULL));
    if (Scan (buf, "%s>%i", value) != 1)
    {
        if(strcmp(buf,"AUTO"))
        {
            *value = TKDPO4K_VAL_RF_REF_LEVEL_AUTO;
        }
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfRefLevel_WriteCallback (ViSession vi,
                                                              ViSession io,
                                                              ViConstString channelName,
                                                              ViAttr attributeId,
                                                              ViInt32 value){
    ViStatus         error = VI_SUCCESS;
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    if(value!=TKDPO4K_VAL_RF_REF_LEVEL_AUTO)
    {
        viCheckErr(tkdpo4kStdViInt32_WriteCallback(vi,io,channelName,attributeId,value));
    }
    else
    {
        viCheckErr(viPrintf(io,":RF:REFL AUTO"));
    }

Error:
    return error;
}




/*- TKDPO4K_ATTR_RF_MEASURE_ADJACENT_PAIRS -*/                           
static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureAcprAdjacentpairs_CheckCallback (ViSession vi,
                                                                              ViConstString channelName,
                                                                              ViAttr attributeId,
                                                                              ViInt32 value)
{
    ViStatus    error = VI_SUCCESS; 
    viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value)); 
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_CHANNEL_BANDWIDTH -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_RangeTableCallback (ViSession vi,
                                                                                  ViConstString channelName,
                                                                                  ViAttr attributeId,
                                                                                  IviRangeTablePtr *rangeTablePtr)
{
    ViStatus    error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32 instrModelNo;
    
    viCheckErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_MODEL, 0, &instrModelNo) );
    switch (instrModelNo)
    {
        case TKDPO4K_VAL_MDO_41043:
        case TKDPO4K_VAL_MDO_40543:
        case TKDPO4K_VAL_MDO_4014_3:
        case TKDPO4K_VAL_MDO_4034_3:  
        case TKDPO4K_VAL_MDO_4014B_3:  
        case TKDPO4K_VAL_MDO_4034B_3:  
        case TKDPO4K_VAL_MDO_4054B_3:  
        case TKDPO4K_VAL_MDO_4104B_3:
		case TKDPO4K_VAL_MDO_4024C:
		case TKDPO4K_VAL_MDO_4034C:
		case TKDPO4K_VAL_MDO_4054C:	
		case TKDPO4K_VAL_MDO_4104C:			
            tblPtr = &attrRfChannelBandwidth3GRangeTable;
            break;
        case TKDPO4K_VAL_MDO_41046:
        case TKDPO4K_VAL_MDO_40546:
        case TKDPO4K_VAL_MDO_4054B_6:
        case TKDPO4K_VAL_MDO_4104B_6:
            tblPtr = &attrRfChannelBandwidth6GRangeTable;
            break;
        default:
            tblPtr = VI_NULL;   
    }

Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_ReadCallback (ViSession vi,
                                                                            ViSession io,
                                                                            ViConstString channelName,
                                                                            ViAttr attributeId,
                                                                            ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     measureType;
    ViChar      chBWHead[BUFFER_SIZE] = {0}; 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_MEASURE_TYPE, 0, &measureType) ); 
    
    switch (measureType)
    {
        case TKDPO4K_VAL_RF_MEASURE_TYPE_CP:
            sprintf(chBWHead,"%s","CP"); 
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR:
            sprintf(chBWHead,"%s","ACPR");
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_OBW:
            sprintf(chBWHead,"%s","OBW");
            break;
        default:
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Invalid RF measure type");
            break;
    }
    
    if (!Ivi_Simulating (vi))
    {
        viCheckErr( viQueryf (io, ":RF:MEASU:%s:CHANBW?", "%Le",chBWHead, value));
    }
    
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelBandwidth_WriteCallback (ViSession vi,
                                                                             ViSession io,
                                                                             ViConstString channelName,
                                                                             ViAttr attributeId,
                                                                             ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     measureType;
    ViChar      chBWHead[BUFFER_SIZE] = {0}; 
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    checkErr (Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_RF_MEASURE_TYPE, 0, &measureType) ); 
    
    switch (measureType)
    {
        case TKDPO4K_VAL_RF_MEASURE_TYPE_CP:
            sprintf(chBWHead,"%s","CP"); 
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR:
            sprintf(chBWHead,"%s","ACPR");
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_OBW:
            sprintf(chBWHead,"%s","OBW");
            break;
        default:
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Invalid RF measure type");
            break;
    }
    
    if (!Ivi_Simulating (vi))
    {
        if(abs(value) < 1.0)
        {
            viCheckErr( viPrintf (io, ":RF:MEASU:%s:CHANBW %le", chBWHead, value));
        }
        else
        {
            viCheckErr( viPrintf (io, ":RF:MEASU:%s:CHANBW %lf", chBWHead, value));
        }
    }
    
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_CHANNEL_POWER -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureChannelPower_ReadCallback (ViSession vi,
                                                                        ViSession io,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        ViReal64 *value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     measureType;
    ViChar      chBWHead[BUFFER_SIZE] = {0};
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    viCheckErr (Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_TYPE,0,&measureType));
    switch(measureType)
    {
        case TKDPO4K_VAL_RF_MEASURE_TYPE_CP:
            sprintf(chBWHead,"%s","CP"); 
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR:
            sprintf(chBWHead,"%s","ACPR");
            break;
        case TKDPO4K_VAL_RF_MEASURE_TYPE_OBW:
            sprintf(chBWHead,"%s","OBW");
            break;
        default:
            viCheckErrElab( IVI_ERROR_INVALID_CONFIGURATION, 
                        "Invalid RF measure type");
            break;
    }
    if (!Ivi_Simulating (vi))
    {
        viCheckErr( viQueryf (io, ":RF:MEASU:%s:POW?", "%Le",chBWHead, value));
    }
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_CHANNEL_SPACING -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureAcprChannelSpacing_CheckCallback (ViSession vi,
                                                                               ViConstString channelName,
                                                                               ViAttr attributeId,
                                                                               ViReal64 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     instrModel;
    viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&instrModel));
    if(instrModel == TKDPO4K_VAL_MDO_41043||(instrModel == TKDPO4K_VAL_MDO_40543)||(instrModel == TKDPO4K_VAL_MDO_4014_3)||(instrModel == TKDPO4K_VAL_MDO_4034_3)\
      ||(instrModel == TKDPO4K_VAL_MDO_4014B_3)||(instrModel == TKDPO4K_VAL_MDO_4034B_3)||(instrModel == TKDPO4K_VAL_MDO_4054B_3)||(instrModel == TKDPO4K_VAL_MDO_4104B_3)
	  )
    {
        if(value >3000000000.0)
        {
            viCheckErr(IVI_ERROR_INVALID_VALUE);    
        }
    }															   
	if(value < 0)
    {
        viCheckErr(IVI_ERROR_INVALID_VALUE);    
    }
Error:
    return error;
}


/*- TKDPO4K_ATTR_RF_MEASURE_POWER_PERCENTAGE -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfMeasureObwPercentDown_CheckCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId,
                                                                           ViReal64 value)
{
    ViStatus    error = VI_SUCCESS; 
    viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_OBW));
    viCheckErr(tkdpo4k_TestifyMDOModel(vi) );
    checkErr(Ivi_DefaultCheckCallbackViReal64(vi,channelName,attributeId,value)); 
Error:
    return error;
}

/*- TKDPO4K_ATTR_RF_SPECTRUM_MODE -*/
static ViStatus _VI_FUNC tkdpo4kAttrRfSpectrumMode_CheckCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     it = 0;
    ViChar*     channelstr[20]={TKDPO4K_VAL_CH_1,TKDPO4K_VAL_CH_2,TKDPO4K_VAL_CH_3,TKDPO4K_VAL_CH_4,TKDPO4K_VAL_D_0,TKDPO4K_VAL_D_1,TKDPO4K_VAL_D_2,TKDPO4K_VAL_D_3,TKDPO4K_VAL_D_4,TKDPO4K_VAL_D_5,
    TKDPO4K_VAL_D_6,TKDPO4K_VAL_D_7,TKDPO4K_VAL_D_8,TKDPO4K_VAL_D_9,TKDPO4K_VAL_D_10,TKDPO4K_VAL_D_11,TKDPO4K_VAL_D_12,TKDPO4K_VAL_D_13,TKDPO4K_VAL_D_14,TKDPO4K_VAL_D_15};
    ViBoolean   channelEnabled;
    if(value == TKDPO4K_VAL_RF_SPECTRUM_FREERUN)
    {
        for(it;it<20;it++)
        {
            viCheckErr(Ivi_GetAttributeViBoolean(vi,channelstr[it],TKDPO4K_ATTR_CHANNEL_ENABLED,0,&channelEnabled));
            if(channelEnabled)
            {
                viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION,"The Free Run spectrum mode is only possible when all analog and digital channels are turned off. ") ;
            }
        }
    }
Error:
    return error;
}

/*- Callbacks for attributes which has command map entry*/
static ViStatus _VI_FUNC tkdpo4kAttrReal64HasEntry_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViReal64* value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    if(attributeId == TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ || attributeId == TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ)
    {
        viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_OBW));    
    }
    if(attributeId ==TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO)
    {
        viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR));  
    }
    if((attributeId >= TKDPO4K_RF_ATTR_START) || (attributeId <= TKDPO4K_RF_ATTR_END)) /*RF channel attributes*/
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    }   
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViReal64_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViReal64_commands, attributeId, &repCommand));


    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%hd", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrReal64HasEntry_WriteCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViReal64 value){
    ViStatus        error = VI_SUCCESS;
    ViString        command;
    ViString        repCommand;
    if(attributeId == TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ || attributeId == TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ)
    {
        viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_OBW));    
    }
    if(attributeId ==TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO)
    {
        viCheckErr(tkdpo4k_TestifyRFMeasureType(vi,TKDPO4K_VAL_RF_MEASURE_TYPE_ACPR));  
    }
    if((attributeId >= TKDPO4K_RF_ATTR_START) || (attributeId <= TKDPO4K_RF_ATTR_END)) /*RF channel attributes*/
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    }   
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViReal64_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViReal64_commands, attributeId, &repCommand));
    
    
    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %le", command, VALID_CHANNELNAME (channelName), repCommand, value ));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrBooleanHasEntry_WriteCallback(ViSession vi,
                                                                   ViSession io,
                                                                   ViConstString channelName,
                                                                   ViAttr attributeId,
                                                                   ViBoolean value)
{
    ViStatus        error = VI_SUCCESS;
    ViString        command;
    ViString        repCommand;

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViBoolean_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViBoolean_commands, attributeId, &repCommand));
    
    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %s", command, VALID_CHANNELNAME (channelName), repCommand, value ? "ON" : "OFF"));

Error:
    return error;
}


static ViStatus _VI_FUNC tkdpo4kAttrBooleanHasEntry_ReadCallback (ViSession vi,
                                                                  ViSession io,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  ViBoolean *value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    if((attributeId >= TKDPO4K_RF_ATTR_START) || (attributeId <= TKDPO4K_RF_ATTR_END)) /*RF channel attributes*/
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    }
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViBoolean_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViBoolean_commands, attributeId, &repCommand));

    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%hd", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrInt32HasEntry_ReadCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32* value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    if((attributeId >= TKDPO4K_RF_ATTR_START) || (attributeId <= TKDPO4K_RF_ATTR_END)) /*RF channel attributes*/
    {
        viCheckErr(tkdpo4k_TestifyMDOModel(vi) ); 
    }   
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViInt32_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViInt32_commands, attributeId, &repCommand));    

    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%ld", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}
static ViStatus _VI_FUNC tkdpo4kAttrInt32HasEntry_WriteCallback (ViSession vi,
                                                                 ViSession io,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId,
                                                                 ViInt32 value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand;     

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViInt32_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViInt32_commands, attributeId, &repCommand));    

    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %ld", command, VALID_CHANNELNAME (channelName), repCommand, value));
Error:
    return error;   
}

/* TKDPO4K_ATTR_FUNC_AMPLITUDE */
static ViStatus _VI_FUNC tkdpo4kAttrFuncAmplitude_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId,        
                                                                      IviRangeTablePtr *rangeTablePtr)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;                    
    ViInt32             function, impedance;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM, 0, &function) );
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) ); 
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionAmplitudeSineHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionAmplitudeSincHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionAmplitudeLorentzHighzRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionAmplitudeGaussianHighzRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }
    
    }
    else
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionAmplitudeSineFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionAmplitudeSincFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionAmplitudeLorentzFiftyRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionAmplitudeGaussianFiftyRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }        
    }        
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

                  
static ViStatus _VI_FUNC tkdpo4kAttrFuncAmplitude_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId, 
                                                                  ViReal64 value, 
                                                                  ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;                    
    ViInt32     impedance;
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) );
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1e-3, 12, &newValue));
    }
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 5e-4, 12, &newValue)); 
    }
    
Error:
    *coercedValue = newValue;
    return error;
}

        
/* TKDPO4K_ATTR_FUNC_FREQUENCY */
static ViStatus _VI_FUNC tkdpo4kAttrFuncFrequency_RangeTableCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId,     
                                                                      IviRangeTablePtr *rangeTablePtr)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;                    
    ViInt32             function;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM, 0, &function) );
    
    switch(function)
    {
        case TKDPO4K_VAL_WFM_SINE:
            {
                tblPtr = &attrFunctionFrequencySineRangeTable;
                break;
            }
        case TKDPO4K_VAL_WFM_SQUARE:
        case TKDPO4K_VAL_WFM_PULSE:
        case TKDPO4K_VAL_WFM_ARBITRARY:
            {
                tblPtr = &attrFunctionFrequencySquareRangeTable;
                break;
            } 
        case TKDPO4K_VAL_WFM_LORENTZ:
        case TKDPO4K_VAL_WFM_GAUSSIAN:
        case TKDPO4K_VAL_WFM_ERISE: 
        case TKDPO4K_VAL_WFM_EDECAY:     
        case TKDPO4K_VAL_WFM_NOISE:
        case TKDPO4K_VAL_WFM_DC:
        case TKDPO4K_VAL_WFM_HAVERSINE:    
            {
                tblPtr = &attrFunctionFrequencyLorentzRangeTable;
                break;
            } 
        case TKDPO4K_VAL_WFM_SINC:
            {
                tblPtr = &attrFunctionFrequencySincRangeTable; 
                break; 
            }
        case TKDPO4K_VAL_WFM_RAMP: 
        case TKDPO4K_VAL_WFM_CARDIAC:
            {
                tblPtr = &attrFunctionFrequencyCardiacRangeTable;
                break;
            }
        default:
            viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

                  
static ViStatus _VI_FUNC tkdpo4kAttrFuncFrequency_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId, 
                                                                  ViReal64 value, 
                                                                  ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.1, 12, &newValue)); 
    
Error:
    *coercedValue = newValue;
    return error;
}
        
/* TKDPO4K_ATTR_FUNC_HIGH_LEVEL */
static ViStatus _VI_FUNC tkdpo4kAttrFuncHighLevel_RangeTableCallback (ViSession vi,   
                                                                      ViConstString channelName, 
                                                                      ViAttr attributeId,    
                                                                      IviRangeTablePtr *rangeTablePtr)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;                    
    ViInt32             function, impedance;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM, 0, &function) );
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) ); 
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionHighLevelSineHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionHighLevelSincHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionHighLevelLorentzHighzRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionHighLevelGaussianHighzRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }
    
    }
    else
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionHighLevelSineFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionHighLevelSincFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionHighLevelLorentzFiftyRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionHighLevelGaussianFiftyRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }        
    }        
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

                  
static ViStatus _VI_FUNC tkdpo4kAttrFuncHighLevel_CoerceCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId, 
                                                                  ViReal64 value, 
                                                                  ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;                    
    ViInt32     impedance;
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) );
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 2e-3, 12, &newValue));
    }
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1e-3, 12, &newValue)); 
    }
    
Error:
    *coercedValue = newValue;
    return error;
}

/* TKDPO4K_ATTR_FUNC_LOW_LEVEL */
static ViStatus _VI_FUNC tkdpo4kAttrFuncLowLevel_RangeTableCallback (ViSession vi,  
                                                                     ViConstString channelName,   
                                                                     ViAttr attributeId,          
                                                                     IviRangeTablePtr *rangeTablePtr)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;                    
    ViInt32             function, impedance;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_FUNC_WAVEFORM, 0, &function) );
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) ); 
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionLowLevelSineHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionLowLevelSincHighzRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionLowLevelLorentzHighzRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionLowLevelGaussianHighzRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }
    
    }
    else
    {
        switch(function)
        {
            case TKDPO4K_VAL_WFM_SINE:
            case TKDPO4K_VAL_WFM_SQUARE: 
            case TKDPO4K_VAL_WFM_PULSE: 
            case TKDPO4K_VAL_WFM_RAMP: 
            case TKDPO4K_VAL_WFM_NOISE: 
            case TKDPO4K_VAL_WFM_DC:
            case TKDPO4K_VAL_WFM_HAVERSINE:
            case TKDPO4K_VAL_WFM_CARDIAC:
            case TKDPO4K_VAL_WFM_ARBITRARY:
                {
                    tblPtr = &attrFunctionLowLevelSineFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_SINC:
                {
                    tblPtr = &attrFunctionLowLevelSincFiftyRangeTable;
                    break;
                }
            case TKDPO4K_VAL_WFM_LORENTZ: 
                {
                    tblPtr = &attrFunctionLowLevelLorentzFiftyRangeTable;
                    break;
                } 
            case TKDPO4K_VAL_WFM_GAUSSIAN:
            case TKDPO4K_VAL_WFM_ERISE: 
            case TKDPO4K_VAL_WFM_EDECAY:                
                {
                    tblPtr = &attrFunctionLowLevelGaussianFiftyRangeTable;
                    break;
                }
            default:
                viCheckErr(IVI_ERROR_INVALID_CONFIGURATION); 
        }        
    }        
    
Error:
    *rangeTablePtr = tblPtr;
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrFuncLowLevel_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value, 
                                                                 ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;                    
    ViInt32     impedance;
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) );
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 2e-3, 12, &newValue));
    }
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1e-3, 12, &newValue)); 
    }
    
Error:
    *coercedValue = newValue;
    return error;
}

/* TKDPO4K_ATTR_FUNC_DC_OFFSET */
static ViStatus _VI_FUNC tkdpo4kAttrFuncDcOffset_RangeTableCallback (ViSession vi,
                                                                     ViConstString channelName, 
                                                                     ViAttr attributeId,       
                                                                     IviRangeTablePtr *rangeTablePtr)
{
    ViStatus            error = VI_SUCCESS;
    IviRangeTablePtr    tblPtr = VI_NULL;
    ViInt32             impedance;
    
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) );                         

    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        tblPtr = &attrFunctionDCOffsetHighzRangeTable;
    }
    else
    {
        tblPtr = &attrFunctionDCOffsetFiftyRangeTable;
    }    
    
Error:
    *rangeTablePtr = tblPtr;  
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrFuncDcOffset_CoerceCallback (ViSession vi,
                                                                 ViConstString channelName,
                                                                 ViAttr attributeId, 
                                                                 ViReal64 value, 
                                                                 ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;                    
    ViInt32     impedance;
    checkErr( Ivi_GetAttributeViInt32 (vi, VI_NULL, TKDPO4K_ATTR_OUTPUT_IMPEDANCE, 0, &impedance) );
    
    if(impedance == TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ)
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1e-3, 12, &newValue));
    }
    else
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 5e-4, 12, &newValue)); 
    }
    
Error:
    *coercedValue = newValue;
    return error;
}

/* TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH */
static ViStatus _VI_FUNC tkdpo4kAttrFuncDutyCycleHigh_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId, 
                                                                      ViReal64 value, 
                                                                      ViReal64* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;   
    
    checkErr( tkdpo4k_CoerceToResolution (vi, value, 0.1, 12, &newValue));
    
Error:
    *coercedValue = newValue;
    return error;
}

/* TKDPO4K_ATTR_ARB_WAVEFORM_LABEL */     
static ViStatus _VI_FUNC tkdpo4kAttrARBWaveformLabel_WriteCallback (ViSession vi,
                                                                    ViSession io, 
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId, 
                                                                    ViConstString value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand;
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViString_commands, attributeId, &command));
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViString_commands, attributeId, &repCommand));
     
    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s \"%s\"", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

/* TKDPO4K_ATTR_ACQUISITION_NUMBER */                 
static ViStatus _VI_FUNC tkdpo4kAttrAcquisitionNumber_CoerceCallback (ViSession vi,
                                                                      ViConstString channelName,
                                                                      ViAttr attributeId, 
                                                                      ViInt32 value, ViInt32* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    newValue = value;   
    
    if((value>=1)&&(value<=100))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1, 12, &newValue));
    }
    else if((value>=100)&&(value<=1000))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 10, 12, &newValue));
    }    
    else if((value>=1000)&&(value<=10000))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 100, 12, &newValue));
    }     
    else if((value>=10000)&&(value<=1000000))
    {
        checkErr( tkdpo4k_CoerceToResolution (vi, value, 1000, 12, &newValue));
    } 
    
Error:
    *coercedValue = newValue;
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kEnum_WriteCallback                                               
 * Purpose:  This function sets the enum value of the ViInt32 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kEnum_WriteCallback (ViSession       vi,
                                                    ViSession       io,
                                                    ViConstString   channelName,
                                                    ViAttr          attributeId,
                                                    ViInt32         value)
{
    ViStatus            error = VI_SUCCESS;
    ViString            command,
                        commandValue;
    ViString            repCommand;                     
    IviRangeTablePtr    table;

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kEnum_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kEnum_commands, attributeId, &repCommand));

    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &table));
    viCheckErr( tkdpo4k_GetCmdFromIntValue(value, table, &commandValue));
    
    if (!Ivi_Simulating (vi))
    {
        viCheckErr( viPrintf (io, "%s%s%s %s", command, VALID_CHANNELNAME (channelName), repCommand, commandValue));
    }
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kEnum_ReadCallback                                               
 * Purpose:  This function reads the enum value of the ViInt32 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kEnum_ReadCallback (ViSession        vi,
                                                   ViSession        io,
                                                   ViConstString    channelName,
                                                   ViAttr           attributeId,
                                                   ViInt32*     value)
{
    ViStatus            error = VI_SUCCESS;
    ViString            command;
    ViString            repCommand; 
    IviRangeTablePtr    table;

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kEnum_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kEnum_commands, attributeId, &repCommand));

    checkErr( Ivi_GetAttrRangeTable (vi, channelName, attributeId, &table));

    if (!Ivi_Simulating (vi))
    {
        ViChar  rdBuffer[BUFFER_SIZE] = {0};
        ViInt32 rdBufferSize = (ViInt32)sizeof(rdBuffer);

        viCheckErr( viPrintf (io, "%s%s%s?", command, VALID_CHANNELNAME (channelName), repCommand));
        viCheckErr( viScanf(io, "%#s", &rdBufferSize, rdBuffer));
        viCheckErr( tkdpo4k_GetValueFromCmd(rdBuffer, table, value));
    }
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViBoolean_WriteCallback                                               
 * Purpose:  This function sets the bool value of the ViBoolean attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViBoolean_WriteCallback (ViSession      vi,
                                                         ViSession      io,
                                                         ViConstString  channelName,
                                                         ViAttr         attributeId,
                                                         ViBoolean      value)
{
    ViStatus        error = VI_SUCCESS;
    ViString        command;
    ViString        repCommand;

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViBoolean_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViBoolean_commands, attributeId, &repCommand));
    
    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %s", command, VALID_CHANNELNAME (channelName), repCommand, value ? "ON" : "OFF"));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViBoolean_ReadCallback                                               
 * Purpose:  This function reads the bool value of the ViBoolean attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViBoolean_ReadCallback (ViSession       vi,
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViBoolean*      value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViBoolean_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViBoolean_commands, attributeId, &repCommand));

    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%hd", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViString_WriteCallback                                               
 * Purpose:  This function sets the string value of the ViString attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViString_WriteCallback (ViSession       vi, 
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViConstString   value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand;
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViString_commands, attributeId, &command));
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViString_commands, attributeId, &repCommand));
     
    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %s", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViString_ReadCallback                                               
 * Purpose:  This function reads the string value of the ViString attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViString_ReadCallback (ViSession            vi, 
                                                       ViSession            io,
                                                       ViConstString        channelName,
                                                       ViAttr               attributeId,
                                                       const ViConstString  cacheValue)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    ViChar*     pdata = VI_NULL;
    ViChar*     pend  = VI_NULL;
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViString_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViString_commands, attributeId, &repCommand));

    if (!Ivi_Simulating (vi))
    {
        ViChar      buffer[BUFFER_SIZE];
        ViChar*     pbuffer = VI_NULL;
        ViUInt32    allocated_count = 0;
        ViUInt32    count = 0;
        ViUInt32    readed_count;

        viCheckErr( viPrintf (io, "%s%s%s?", command, VALID_CHANNELNAME (channelName), repCommand));
        
        while ((error = viRead (io, buffer, BUFFER_SIZE, &readed_count)) == VI_SUCCESS_MAX_CNT)
        {
            if (allocated_count)
            {
                if (allocated_count <= count + readed_count)
                {
                    allocated_count += (allocated_count - count) + BUFFER_SIZE; 
                    pdata = realloc (pdata, allocated_count);
                }

                pend = pdata + count;
            }
            else
            {
                allocated_count = 2 * BUFFER_SIZE;
                pdata = malloc(allocated_count);
                pend  = pdata;
            }
            
            memcpy(pend, buffer, readed_count);
            count += readed_count;
        }
        
        if (readed_count > 0)
        {
            /*
             * Check if the last character is alnum.
             * if this character is not alnum we know that it's '\n'.
             * Remove it.
             */
            if (!isalnum(buffer[readed_count-1]))
                readed_count--;
            buffer[readed_count] = '\0';
        }
        
        /*
         * If function is read more data as BUFFER_SIZE, we must
         * copy last data from static buffer to dynamic buffer
         */
        if (pdata)
        {
            /*
             * For sure, check if the  buffer has enought element.
             * This condition should be FALSE every time.
             */
            if (allocated_count <= count + readed_count)
            {
                allocated_count += (allocated_count - count) + BUFFER_SIZE; 
                pdata = realloc (pdata, allocated_count);
            }
            pend = pdata + count;
            memcpy(pend, buffer, readed_count+1);           
            pbuffer = pdata;
        }
        else
            pbuffer = buffer;
        
        viCheckErr( error);

        checkErr( Ivi_SetValInStringCallback(vi, attributeId, pbuffer));
    }

Error:
    if (pdata)
        free( pdata);
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViReal64_WriteCallback                                               
 * Purpose:  This function sets the bool value of the ViReal64 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViReal64_WriteCallback (ViSession       vi,
                                                        ViSession       io,
                                                        ViConstString   channelName,
                                                        ViAttr          attributeId,
                                                        ViReal64        value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand;     

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViReal64_commands, attributeId, &command));
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViReal64_commands, attributeId, &repCommand));   
     
    if (!Ivi_Simulating (vi))
    {
        if(abs(value) < 1.0)
        {
            viCheckErr( viPrintf (io, "%s%s%s %Le", command, VALID_CHANNELNAME (channelName), repCommand, value));
        }
        else
        {
            viCheckErr( viPrintf (io, "%s%s%s %Lf", command, VALID_CHANNELNAME (channelName), repCommand, value));
        }
    }
Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViReal64_ReadCallback                                               
 * Purpose:  This function reads the bool value of the ViReal64 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViReal64_ReadCallback (ViSession        vi,
                                                       ViSession        io,
                                                       ViConstString    channelName,
                                                       ViAttr           attributeId,
                                                       ViReal64*        value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViReal64_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViReal64_commands, attributeId, &repCommand));   

    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%Le", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViInt32_WriteCallback                                               
 * Purpose:  This function sets the bool value of the ViInt32 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViInt32_WriteCallback (ViSession        vi,
                                                       ViSession        io,
                                                       ViConstString    channelName,
                                                       ViAttr           attributeId,
                                                       ViInt32          value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand;     

    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViInt32_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViInt32_commands, attributeId, &repCommand));    

    if (!Ivi_Simulating (vi))
        viCheckErr( viPrintf (io, "%s%s%s %ld", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}

/*****************************************************************************
 * Function: tkdpo4kViInt32_ReadCallback                                               
 * Purpose:  This function reads the bool value of the ViInt32 attribute.
 *****************************************************************************/
static ViStatus _VI_FUNC tkdpo4kViInt32_ReadCallback (ViSession     vi,
                                                      ViSession     io,
                                                      ViConstString channelName,
                                                      ViAttr        attributeId,
                                                      ViInt32*      value)
{
    ViStatus    error = VI_SUCCESS;
    ViString    command;
    ViString    repCommand; 
    
    viCheckErr( tkdpo4k_GetStringFromTable (tkdpo4kViInt32_commands, attributeId, &command)); 
    viCheckErr (tkdpo4k_GetRepCommandFromTable (tkdpo4kViInt32_commands, attributeId, &repCommand));    

    if (!Ivi_Simulating (vi))
        viCheckErr( viQueryf (io, "%s%s%s?", "%ld", command, VALID_CHANNELNAME (channelName), repCommand, value));

Error:
    return error;
}



static ViStatus _VI_FUNC tkdpo4kAttrRfPhaseTraceDegreesNum_CoerceCallback (ViSession vi,
                                                                           ViConstString channelName,
                                                                           ViAttr attributeId, 
                                                                           ViInt32 value, ViInt32* coercedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViReal64    absValue;
    ViReal64    newValue = value;
    ViReal64    resMultiplier;

    absValue = fabs (value);

    modf (absValue/180, &resMultiplier);
    
    if ((absValue/180-resMultiplier)>=0.5)
        resMultiplier = ceil (absValue/180);

    newValue = 180 * resMultiplier;

    if (value < 0.0)
        newValue *= -1.0;

    *coercedValue = newValue;
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetStringFromTable
 *  Purpose:  Read the string command from rangetable    
 *****************************************************************************/
static ViStatus tkdpo4k_GetStringFromTable(
        tkdpo4kStringValueTable table,
    ViInt32               value,
    ViConstString*        string
)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   found = VI_FALSE;
    ViInt32     i;
    
    for( i = 0; table[i].string; i++)
    {
        if ( table[i].value == value )
        {
            *string = table[i].string;
            found = VI_TRUE;
            break;
        }
    }
    
    if ( !found )
        error = IVI_ERROR_INVALID_VALUE;

    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetRepCommandFromTable
 *  Purpose:  Read the repeated command from range table to concat with the 
 *            string command.
 *****************************************************************************/
static ViStatus tkdpo4k_GetRepCommandFromTable(
    tkdpo4kStringValueTable table,
    ViInt32               value,
    ViConstString*        repCommand
)
{
    ViStatus    error = VI_SUCCESS;
    ViBoolean   found = VI_FALSE;
    ViInt32     i;

    for( i = 0; table[i].repCommand; i++)
    {
        if ( table[i].value == value )
        {
            *repCommand = table[i].repCommand;
            found = VI_TRUE;
            break;
        }
    }

    if ( !found )
        error = IVI_ERROR_INVALID_VALUE;

    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_TestifyRFMeasureType
 *  Purpose:  Testify if the value of TKDPO4K_ATTR_RF_MEASURE_TYPE is expectedValue.
 *****************************************************************************/
static ViStatus tkdpo4k_TestifyRFMeasureType (ViSession vi, ViInt32 expectedValue)
{
    ViStatus    error = VI_SUCCESS;
    ViInt32     measureType;
    checkErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_RF_MEASURE_TYPE,0,&measureType));
    if(measureType!=expectedValue)
    {
        viCheckErrElab(IVI_ERROR_INVALID_CONFIGURATION,"Invalid measure type");
    }
    Error:
        return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_TestifyMDOModel
 *  Purpose:  Testify if the current instrument is MDO 4K Series.
 *****************************************************************************/
static ViStatus tkdpo4k_TestifyMDOModel (ViSession vi)
{
    ViStatus error= VI_SUCCESS;
    ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));
    if(!(IS_MDO4K(modelNo) || IS_MDO3K(modelNo)))
    {
        checkErr(IVI_ERROR_ATTRIBUTE_NOT_SUPPORTED);
    }
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_TestifyMDO4KModel
 *  Purpose:  Testify if the current instrument is MDO 4K Series.
 *****************************************************************************/
static ViStatus tkdpo4k_TestifyMDO4KModel (ViSession vi)
{
    ViStatus error= VI_SUCCESS;
    ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));
    if(!IS_MDO4K(modelNo))
    {
        checkErr(IVI_ERROR_ATTRIBUTE_NOT_SUPPORTED);
    }
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_TestifyMDO4KModel
 *  Purpose:  Testify if the current instrument is MDO 4K Series.
 *****************************************************************************/
static ViStatus tkdpo4k_TestifyMDO3KModel (ViSession vi)
{
    ViStatus error= VI_SUCCESS;
    ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));
    if(!IS_MDO3K(modelNo))
    {
        checkErr(IVI_ERROR_ATTRIBUTE_NOT_SUPPORTED);
    }
Error:
    return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfFftWindow_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;
	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo)){
		tblPtr = &attrRfFftWindowRangeTable;
	}
	else{
		tblPtr = &attrMDO4KCRfFftWindowRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}





static ViStatus _VI_FUNC tkdpo4kAttrI2cDataSize_RangeTableCallback (ViSession vi,
                                                                    ViConstString channelName,
                                                                    ViAttr attributeId,
                                                                    IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;
	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo)){
		tblPtr = &attrI2cDataSizeRangeTable;
	}
	else{
		tblPtr = &attrMDO4kCI2cDataSizeRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAdvVar1_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;
	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo)){
		tblPtr = &attrAdvVar1RangeTable;
	}
	else{
		tblPtr = &attrMDO4KCAdvVarRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrAdvVar2_RangeTableCallback (ViSession vi,
                                                                ViConstString channelName,
                                                                ViAttr attributeId,
                                                                IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;
	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo)){
		tblPtr = &attrAdvVar2RangeTable;
	}
	else{
		tblPtr = &attrMDO4KCAdvVarRangeTable;
	}


Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMethod_RangeTableCallback (ViSession vi,
                                                                          ViConstString channelName,
                                                                          ViAttr attributeId,
                                                                          IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;

	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo) && !IS_MDO4KB(modelNo)){
		tblPtr = &attrRfDetectionMethodRangeTable;
	}
	else{
		tblPtr = &attrRfDetectionMethodNotAbbrRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfRbwMode_RangeTableCallback (ViSession vi,
                                                                  ViConstString channelName,
                                                                  ViAttr attributeId,
                                                                  IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;

	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo) && !IS_MDO4KB(modelNo)){
		tblPtr = &attrRfRbwModeRangeTable;
	}
	else{
		tblPtr = &attrRfRbwModeNotAbbrRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfSpectrumMode_RangeTableCallback (ViSession vi,
                                                                       ViConstString channelName,
                                                                       ViAttr attributeId,
                                                                       IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;

	ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo) && !IS_MDO4KB(modelNo)){
		tblPtr = &attrRfSpectrumModeRangeTable;
	}
	else{
		tblPtr = &attrRfSpectrumModeNotAbbrRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

static ViStatus _VI_FUNC tkdpo4kAttrRfDetectionMode_RangeTableCallback (ViSession vi,
                                                                        ViConstString channelName,
                                                                        ViAttr attributeId,
                                                                        IviRangeTablePtr *rangeTablePtr)
{
	ViStatus	error = VI_SUCCESS;
	IviRangeTablePtr	tblPtr = VI_NULL;

		ViInt32  modelNo;
    viCheckErr(Ivi_GetAttributeViInt32(vi,VI_NULL,TKDPO4K_ATTR_MODEL,0,&modelNo));

	if(!IS_MDO4KC(modelNo) && !IS_MDO4KB(modelNo)){
		tblPtr = &attrRfDetectionModeRangeTable;
	}
	else{
		tblPtr = &attrRfDetectionModeNotAbbrRangeTable;
	}

Error:
	*rangeTablePtr = tblPtr;
	return error;
}

/*****************************************************************************
 * Function: tkdpo4k_InitAttributes
 * Purpose:  This function adds attributes to the IVI session, initializes   
 *           instrument attributes, and sets attribute invalidation          
 *           dependencies.                                                   
 *****************************************************************************/
static ViStatus tkdpo4k_InitAttributes (ViSession vi, ViString idnString, ViInt32 instrModelNo)
{
    ViStatus    error = VI_SUCCESS;
    
        /*- Initialize instrument attributes --------------------------------*/            

    checkErr( tkdpo4k_buildRangeTable(vi));
    
    checkErr( Ivi_SetAttributeViInt32 (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_MAJOR_VERSION,
                                       0, TKDPO4K_MAJOR_VERSION));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_MINOR_VERSION,
                                       0, TKDPO4K_MINOR_VERSION));
    checkErr( Ivi_SetAttrReadCallbackViString (vi, TKDPO4K_ATTR_SPECIFIC_DRIVER_REVISION,
                                               tkdpo4kAttrDriverRevision_ReadCallback));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_CLASS_SPEC_MAJOR_VERSION,
                                       0, TKDPO4K_CLASS_SPEC_MAJOR_VERSION));
    checkErr( Ivi_SetAttributeViInt32 (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_CLASS_SPEC_MINOR_VERSION,
                                       0, TKDPO4K_CLASS_SPEC_MINOR_VERSION));
    checkErr( Ivi_SetAttributeViString (vi, "", TKDPO4K_ATTR_IO_SESSION_TYPE,
                                        0, TKDPO4K_IO_SESSION_TYPE));
    checkErr( Ivi_SetAttributeViString (vi, "", TKDPO4K_ATTR_SUPPORTED_INSTRUMENT_MODELS,
                                        0, TKDPO4K_SUPPORTED_INSTRUMENT_MODELS));
    checkErr( Ivi_SetAttrReadCallbackViString (vi, TKDPO4K_ATTR_INSTRUMENT_FIRMWARE_REVISION,
                                               tkdpo4kAttrInstrumentFirmwareRevision_ReadCallback));
    checkErr( Ivi_SetAttrReadCallbackViString (vi, TKDPO4K_ATTR_INSTRUMENT_MANUFACTURER,
                                               tkdpo4kAttrInstrumentManufacturer_ReadCallback));
    checkErr( Ivi_SetAttrReadCallbackViString (vi, TKDPO4K_ATTR_INSTRUMENT_MODEL,
                                               tkdpo4kAttrInstrumentModel_ReadCallback));
    checkErr( Ivi_SetAttributeViString (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_VENDOR,
                                        0, TKDPO4K_DRIVER_VENDOR));
    checkErr( Ivi_SetAttributeViString (vi, "", TKDPO4K_ATTR_SPECIFIC_DRIVER_DESCRIPTION,
                                        0, TKDPO4K_DRIVER_DESCRIPTION));
    checkErr( Ivi_SetAttributeViAddr (vi, VI_NULL, IVI_ATTR_OPC_CALLBACK, 0, 
                                      tkdpo4k_WaitForOPCCallback));
    checkErr( Ivi_SetAttributeViAddr (vi, VI_NULL, IVI_ATTR_CHECK_STATUS_CALLBACK, 0, 
                                      tkdpo4k_CheckStatusCallback));
    checkErr( Ivi_SetAttributeViBoolean (vi, VI_NULL, IVI_ATTR_SUPPORTS_WR_BUF_OPER_MODE, 
                                         0, VI_TRUE));
    checkErr( Ivi_SetAttributeFlags (vi, TKDPO4K_ATTR_INSTRUMENT_FIRMWARE_REVISION,
                                     IVI_VAL_USE_CALLBACKS_FOR_SIMULATION));
    checkErr( Ivi_SetAttributeFlags (vi, TKDPO4K_ATTR_INSTRUMENT_MANUFACTURER,
                                     IVI_VAL_USE_CALLBACKS_FOR_SIMULATION));
    checkErr( Ivi_SetAttributeFlags (vi, TKDPO4K_ATTR_INSTRUMENT_MODEL,
                                     IVI_VAL_USE_CALLBACKS_FOR_SIMULATION));
                                 
    checkErr( Ivi_SetAttributeViString (vi, "", TKDPO4K_ATTR_GROUP_CAPABILITIES, 0,
                                        "IviScopeBase,"
                                        "IviScopeTVTrigger,"
                                        "IviScopeRuntTrigger,"
                                        "IviScopeGlitchTrigger,"
                                        "IviScopeAcLineTrigger,"
                                        "IviScopeWaveformMeas,"
                                        "IviScopeMinMaxWaveform,"
                                        "IviScopeProbeAutoSense,"
                                        "IviScopeContinuousAcquisition,"
                                        "IviScopeAverageAcquisition,"
                                        "IviScopeSampleMode,"
                                        "IviScopeTriggerModifier,"
                                        "IviScopeAutoSetup"));

    /*- Acquisition Sub-system ----------------------------------------------------------*/
        /*- TKDPO4K_ATTR_ACQUISITION_TYPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ACQUISITION_TYPE,
                                       "TKDPO4K_ATTR_ACQUISITION_TYPE",
                                       TKDPO4K_VAL_NORMAL, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrAcquisitionTypeRangeTable));
                                        
        /*- TKDPO4K_ATTR_ACQUISITION_START_TIME -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_ACQUISITION_START_TIME,
                                        "TKDPO4K_ATTR_ACQUISITION_START_TIME", 0.0,
                                        0,
                                        tkdpo4kAttrAcquisitionStartTime_ReadCallback,
                                        tkdpo4kAttrAcquisitionStartTime_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_ACQUISITION_START_TIME, 
                                                 tkdpo4kAttrAcquisitionStartTime_CoerceCallback));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_ACQUISITION_START_TIME, 
                                                 tkdpo4kAttrAcquisitionStartTime_CheckCallback));
                                                 
        /*- TKDPO4K_ATTR_HORZ_MIN_NUM_PTS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS,
                                       "TKDPO4K_ATTR_HORZ_MIN_NUM_PTS", 10000,
                                       IVI_VAL_USE_CALLBACKS_FOR_SIMULATION, VI_NULL,
                                       tkdpo4kAttrHorzMinNumPts_WriteCallback,
                                       &attrDPO4KHorzMinNumPtsRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS,
                                             tkdpo4kAttrHorzMinNumPts_RangeTableCallback));

        /*- TKDPO4K_ATTR_HORZ_RECORD_LENGTH -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_HORZ_RECORD_LENGTH,
                                       "TKDPO4K_ATTR_HORZ_RECORD_LENGTH", 10000,
                                       IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION | IVI_VAL_DONT_CHECK_STATUS,
                                       tkdpo4kAttrHorzRecordLength_ReadCallback,
                                       VI_NULL, VI_NULL));
                                       
        /*- TKDPO4K_ATTR_HORZ_SAMPLE_RATE -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_HORZ_SAMPLE_RATE,
                                        "TKDPO4K_ATTR_HORZ_SAMPLE_RATE", 250.0e6,
                                        IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrHorzSampleRate_ReadCallback,
                                        VI_NULL, VI_NULL, 0));

        /*- TKDPO4K_ATTR_HORZ_TIME_PER_RECORD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                        "TKDPO4K_ATTR_HORZ_TIME_PER_RECORD", 4.0e-5,
                                        0, tkdpo4kAttrHorzTimePerRecord_ReadCallback,
                                        tkdpo4kAttrHorzTimePerRecord_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                             tkdpo4kAttrHorzTimePerRecord_RangeTableCallback));        

        /*- TKDPO4K_ATTR_NUM_ENVELOPES -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_NUM_ENVELOPES,
                                       "TKDPO4K_ATTR_NUM_ENVELOPES",
                                       TKDPO4K_VAL_INFINITE, 0,
                                       tkdpo4kAttrNumEnvelopes_ReadCallback,
                                       tkdpo4kAttrNumEnvelopes_WriteCallback,
                                       &attrNumEnvelopesRangeTable));
    
        /*- TKDPO4K_ATTR_INITIATE_CONTINUOUS -*/
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_INITIATE_CONTINUOUS,
                                         "TKDPO4K_ATTR_INITIATE_CONTINUOUS",
                                         VI_FALSE, 0,
                                         tkdpo4kAttrInitiateContinuous_ReadCallback,
                                         tkdpo4kAttrInitiateContinuous_WriteCallback));
        
        /*- TKDPO4K_ATTR_NUM_AVERAGES -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_NUM_AVERAGES,
                                       "TKDPO4K_ATTR_NUM_AVERAGES", 16, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrNumAveragesRangeTable));

        /*- TKDPO4K_ATTR_SAMPLE_MODE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SAMPLE_MODE,
                                       "TKDPO4K_ATTR_SAMPLE_MODE",
                                       TKDPO4K_VAL_REAL_TIME,
                                       IVI_VAL_NOT_USER_WRITABLE, VI_NULL, VI_NULL,
                                       VI_NULL));
    
    if(IS_MSO4K(instrModelNo) || IS_MDO4K(instrModelNo))
    {
            /*- TKDPO4K_ATTR_MAGNIVU_ENABLED -*/                                                    
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_MAGNIVU_ENABLED,
                                         "TKDPO4K_ATTR_MAGNIVU_ENABLED", VI_TRUE, 0,
                                         tkdpo4kAttrMagnivuEnabled_ReadCallback,
                                         tkdpo4kAttrMagnivuEnabled_WriteCallback));
    }
    
    /*- Channel Sub-system --------------------------------------------------------------*/
        /*- TKDPO4K_ATTR_CHANNEL_ENABLED -*/
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_CHANNEL_ENABLED,
                                         "TKDPO4K_ATTR_CHANNEL_ENABLED", VI_FALSE,
                                         IVI_VAL_MULTI_CHANNEL,
                                         tkdpo4kAttrChannelEnabled_ReadCallback,
                                         tkdpo4kAttrChannelEnabled_WriteCallback));

        /*- TKDPO4K_ATTR_PROBE_ATTENUATION -*/ 
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_PROBE_ATTENUATION,
                                        "TKDPO4K_ATTR_PROBE_ATTENUATION",
                                        TKDPO4K_VAL_PROBE_SENSE_ON,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrProbeAttenuation_ReadCallback,
                                        tkdpo4kAttrProbeAttenuation_WriteCallback,
                                        &attrProbeAttenuationRangeTable, 0));

        /*- TKDPO4K_ATTR_PROBE_SENSE_VALUE -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_PROBE_SENSE_VALUE,
                                        "TKDPO4K_ATTR_PROBE_SENSE_VALUE", 1.0,
                                        IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrProbeSenseValue_ReadCallback,
                                        VI_NULL, VI_NULL, 0));

        /*- TKDPO4K_ATTR_PROBE_SENSE -*/
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_PROBE_SENSE,
                                         "TKDPO4K_ATTR_PROBE_SENSE", VI_FALSE,
                                         IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE 
                                         | IVI_VAL_HIDDEN,
                                         VI_NULL, VI_NULL));

        /*- TKDPO4K_ATTR_PROBE_GAIN -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_PROBE_GAIN,
                                        "TKDPO4K_ATTR_PROBE_GAIN", 1.0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                        tkdpo4kAttrProbeGain_ReadCallback,
                                        tkdpo4kAttrProbeGain_WriteCallback, VI_NULL,
                                        0));

        /*- TKDPO4K_ATTR_VERTICAL_RANGE -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_VERTICAL_RANGE,
                                        "TKDPO4K_ATTR_VERTICAL_RANGE", 1,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrVerticalRange_ReadCallback,
                                        tkdpo4kAttrVerticalRange_WriteCallback,
                                        &attrVerticalRangeRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_VERTICAL_RANGE,
                                                 tkdpo4kAttrVerticalRange_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_VERTICAL_RANGE,
                                                tkdpo4kAttrVerticalRange_CheckCallback));
    
        /*- TKDPO4K_ATTR_VERTICAL_OFFSET -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_VERTICAL_OFFSET,
                                        "TKDPO4K_ATTR_VERTICAL_OFFSET", 0,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrVerticalOffset_ReadCallback,
                                        tkdpo4kAttrVerticalOffset_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_VERTICAL_OFFSET, 
                                                tkdpo4kAttrVerticalOffset_CheckCallback));
                                  
        /*- TKDPO4K_ATTR_VERTICAL_COUPLING -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_VERTICAL_COUPLING,
                                       "TKDPO4K_ATTR_VERTICAL_COUPLING",
                                       TKDPO4K_VAL_DC, IVI_VAL_MULTI_CHANNEL,
                                       tkdpo4kAttrVerticalCoupling_ReadCallback,
                                       tkdpo4kAttrVerticalCoupling_WriteCallback,
                                       &attrVerticalCouplingRangeTable));

        /*- TKDPO4K_ATTR_MAX_INPUT_FREQUENCY -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY,
                                        "TKDPO4K_ATTR_MAX_INPUT_FREQUENCY", 300.0e6,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrMaxInputFrequency_ReadCallback,
                                        tkdpo4kAttrMaxInputFrequency_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY,
                                             tkdpo4kAttrMaxInputFrequency_RangeTableCallback));

        /*- TKDPO4K_ATTR_INPUT_IMPEDANCE -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_INPUT_IMPEDANCE,
                                        "TKDPO4K_ATTR_INPUT_IMPEDANCE", 1.0e+06,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrChannelImpedance_ReadCallback,
                                        tkdpo4kAttrChannelImpedance_WriteCallback,
                                        &attrDPO4KChannelImpedanceRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_INPUT_IMPEDANCE,
                                             tkdpo4kAttrInputImpedance_RangeTableCallback));
    
        /*- TKDPO4K_ATTR_DIGITAL_THRESHOLD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DIGITAL_THRESHOLD,
                                        "TKDPO4K_ATTR_DIGITAL_THRESHOLD", 1.4,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrDigitalThreshold_ReadCallback,
                                        tkdpo4kAttrDigitalThreshold_WriteCallback,
                                        &attrDigitalThresholdRangeTable, 0));
    
        /*- TKDPO4K_ATTR_TOTAL_POINTS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TOTAL_POINTS,
                                       "TKDPO4K_ATTR_TOTAL_POINTS", 10000,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kAttrTotalPoints_ReadCallback,
                                       tkdpo4kAttrTotalPoints_WriteCallback,
                                       &attrDPO4KTotalPointsRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_TOTAL_POINTS,
                                             tkdpo4kAttrTotalPoints_RangeTableCallback));

        /*- TKDPO4K_ATTR_TRIGGER_TYPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRIGGER_TYPE,
                                       "TKDPO4K_ATTR_TRIGGER_TYPE",
                                       TKDPO4K_VAL_EDGE_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION | IVI_VAL_DONT_CHECK_STATUS,
                                       tkdpo4kAttrTriggerType_ReadCallback,
                                       tkdpo4kAttrTriggerType_WriteCallback,
                                       &attrDPO4KTriggerTypeRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_TRIGGER_TYPE,
                                             tkdpo4kAttrTriggerType_RangeTableCallback));
    checkErr( Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_TRIGGER_TYPE, 
                                               tkdpo4kAttrTriggerType_CheckCallback));

        /*- TKDPO4K_ATTR_TRIGGER_SOURCE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_TRIGGER_SOURCE,
                                        "TKDPO4K_ATTR_TRIGGER_SOURCE",
                                        TKDPO4K_VAL_CH_1, 0,
                                        tkdpo4kAttrTriggerSource_ReadCallback,
                                        tkdpo4kAttrTriggerSource_WriteCallback));
    checkErr( Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_TRIGGER_SOURCE, 
                                                tkdpo4kAttrTriggerSource_CheckCallback));

        /*- TKDPO4K_ATTR_TRIGGER_LEVEL -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LEVEL,
                                        "TKDPO4K_ATTR_TRIGGER_LEVEL", 0.0,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTriggerLevel_ReadCallback,
                                        tkdpo4kAttrTriggerLevel_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LEVEL, 
                                                tkdpo4kAttrTriggerLevel_CheckCallback));
                                                
        /*- TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH -*/                                       
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH,
                                        "TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH", 0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTriggerLevelByCh_ReadCallback,
                                        tkdpo4kAttrTriggerLevelByCh_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH,
                                                tkdpo4kAttrTriggerLevelByCh_CheckCallback));
                                            
        /*- TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH -*/                                            
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                        "TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH", 0.8,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTriggerUpperthresByCh_ReadCallback,
                                        tkdpo4kAttrTriggerUpperthresByCh_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi,
                                                TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH,
                                                tkdpo4kAttrTriggerThresholdByCh_CheckCallback));
                                                
        /*- TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH -*/                                               
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                        "TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH", 0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTriggerLowerthresByCh_ReadCallback,
                                        tkdpo4kAttrTriggerLowerthresByCh_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH,
                                                tkdpo4kAttrTriggerThresholdByCh_CheckCallback));
                                                
        /*- TKDPO4K_ATTR_TRIGGER_HOLDOFF -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_HOLDOFF,
                                        "TKDPO4K_ATTR_TRIGGER_HOLDOFF", 20.0e-9, 0,
                                        tkdpo4kAttrTriggerHoldoff_ReadCallback,
                                        tkdpo4kAttrTriggerHoldoff_WriteCallback,
                                        &attrTriggerHoldoffRangeTable, 9));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_TRIGGER_HOLDOFF, 
                                                 tkdpo4kAttrTriggerHoldoff_CoerceCallback));
                                        

        /*- TKDPO4K_ATTR_TRIGGER_MODIFIER -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRIGGER_MODIFIER,
                                       "TKDPO4K_ATTR_TRIGGER_MODIFIER",
                                       TKDPO4K_VAL_NO_TRIGGER_MOD, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrTriggerModifierRangeTable));

        /*- TKDPO4K_ATTR_TRIGGER_COUPLING -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRIGGER_COUPLING,
                                       "TKDPO4K_ATTR_TRIGGER_COUPLING",
                                       TKDPO4K_VAL_DC, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrDPO4KTriggerCouplingRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_TRIGGER_COUPLING,
                                             tkdpo4kAttrTriggerCoupling_RangeTableCallback));
    
        /*- TKDPO4K_ATTR_TRIGGER_SLOPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRIGGER_SLOPE,
                                       "TKDPO4K_ATTR_TRIGGER_SLOPE",
                                       TKDPO4K_VAL_POSITIVE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrTriggerSlopeRangeTable));
                                        
        /*- TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE -*/                                  
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE,
                                       "TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE",
                                       TKDPO4K_VAL_BUS1, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrDPO4KSerialTriggerSourceRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_SERIAL_TRIGGER_SOURCE,
                                             tkdpo4kAttrSerialTriggerSource_RangeTableCallback));
    
        /*- TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE,
                                       "TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE",
                                       TKDPO4K_VAL_AC_LINE_POSITIVE,
                                       IVI_VAL_USE_CALLBACKS_FOR_SIMULATION | IVI_VAL_DONT_CHECK_STATUS,
                                       tkdpo4kAttrAcLineTriggerSlope_ReadCallback,
                                       tkdpo4kAttrAcLineTriggerSlope_WriteCallback,
                                       &attrAcLineTriggerSlopeRangeTable));

        /*- TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT,
                                       "TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT",
                                       TKDPO4K_VAL_NTSC, 0,
                                       tkdpo4kAttrTvTriggerSignalFormat_ReadCallback,
                                       tkdpo4kAttrTvTriggerSignalFormat_WriteCallback,
                                       &attrDPO4KTvTriggerSignalFormatRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi,
                                             TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT,
                                             tkdpo4kAttrTvTriggerSignalFormat_RangeTableCallback));

        /*- TKDPO4K_ATTR_TV_TRIGGER_POLARITY -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_POLARITY,
                                       "TKDPO4K_ATTR_TV_TRIGGER_POLARITY",
                                       TKDPO4K_VAL_POSITIVE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrTvTriggerPolarityRangeTable));

        /*- TKDPO4K_ATTR_TV_TRIGGER_EVENT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_EVENT,
                                       "TKDPO4K_ATTR_TV_TRIGGER_EVENT",
                                       TKDPO4K_VAL_TV_EVENT_ANY_LINE, 0,
                                       tkdpo4kAttrTvTriggerEvent_ReadCallback,
                                       tkdpo4kAttrTvTriggerEvent_WriteCallback,
                                       &attrTvTriggerEventRangeTable));

        /*- TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER,
                                       "TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER", 1, 0,
                                       tkdpo4kAttrTvTriggerLineNumber_ReadCallback,
                                       tkdpo4kAttrTvTriggerLineNumber_WriteCallback,
                                       VI_NULL));
    checkErr( Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER, 
                                               tkdpo4kAttrTvTriggerLineNumber_CheckCallback));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT,
                                       "TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT",
                                       TKDPO4K_VAL_HDTV_1080P24, 0,
                                       tkdpo4kAttrTvTriggerHdtvFormat_ReadCallback,
                                       tkdpo4kAttrTvTriggerHdtvFormat_WriteCallback,
                                       &attrDPO4KTvTriggerHdtvFormatRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_TV_TRIGGER_HDTV_FORMAT,
                                             tkdpo4kAttrTvTriggerHdtvFormat_RangeTableCallback));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_FIELD_HOLDOFF -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TV_TRIGGER_FIELD_HOLDOFF,
                                        "TKDPO4K_ATTR_TV_TRIGGER_FIELD_HOLDOFF", 0,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTvTriggerFieldHoldoff_ReadCallback,
                                        tkdpo4kAttrTvTriggerFieldHoldoff_WriteCallback,
                                        &attrTvTriggerFieldHoldoffRangeTable, 0));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_FORMAT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_FORMAT,
                                       "TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_FORMAT",
                                       TKDPO4K_VAL_TV_CUSTOM_INTERLACED, 0,
                                       tkdpo4kAttrTvTriggerCustomFormat_ReadCallback,
                                       tkdpo4kAttrTvTriggerCustomFormat_WriteCallback,
                                       &attrTvTriggerCustomFormatRangeTable));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SCAN_RATE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SCAN_RATE,
                                       "TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SCAN_RATE",
                                       TKDPO4K_VAL_TV_RATE15K, 0,
                                       tkdpo4kAttrTvTriggerCustomScanRate_ReadCallback,
                                       tkdpo4kAttrTvTriggerCustomScanRate_WriteCallback,
                                       &attrTvTriggerCustomScanRateRangeTable));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_LINE_PERIOD -*/ 
    checkErr (Ivi_AddAttributeViReal64 (vi,
                                        TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_LINE_PERIOD,
                                        "TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_LINE_PERIOD",
                                        0, 0,
                                        tkdpo4kAttrTvTriggerCustomLinePeriod_ReadCallback,
                                        tkdpo4kAttrTvTriggerCustomLinePeriod_WriteCallback,
                                        &attrTvTriggerCustomLinePeriodRangeTable, 0));
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SYNC_INTERVAL -*/ 
    checkErr (Ivi_AddAttributeViReal64 (vi,
                                        TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SYNC_INTERVAL,
                                        "TKDPO4K_ATTR_TV_TRIGGER_CUSTOM_SYNC_INTERVAL",
                                        0, 0,
                                        tkdpo4kAttrTvTriggerCustomSyncInterval_ReadCallback,
                                        tkdpo4kAttrTvTriggerCustomSyncInterval_WriteCallback,
                                        &attrTvTriggerCustomSyncIntervalRangeTable,
                                        0));
    
        /*- TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD,
                                        "TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD", 0.8,
                                        IVI_VAL_NEVER_CACHE | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION,
                                        tkdpo4kAttrRuntHighThreshold_ReadCallback,
                                        tkdpo4kAttrRuntHighThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RUNT_HIGH_THRESHOLD, 
                                                tkdpo4kAttrRuntHighThreshold_CheckCallback));
    
        /*- TKDPO4K_ATTR_RUNT_LOW_THRESHOLD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RUNT_LOW_THRESHOLD,
                                        "TKDPO4K_ATTR_RUNT_LOW_THRESHOLD", 0,
                                        IVI_VAL_NEVER_CACHE | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION,
                                        tkdpo4kAttrRuntLowThreshold_ReadCallback,
                                        tkdpo4kAttrRuntLowThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RUNT_LOW_THRESHOLD, 
                                                tkdpo4kAttrRuntLowThreshold_CheckCallback));
    
        /*- TKDPO4K_ATTR_RUNT_POLARITY -*/
    checkErr( Ivi_AddAttributeViInt32  (vi, TKDPO4K_ATTR_RUNT_POLARITY, 
                                        "TKDPO4K_ATTR_RUNT_POLARITY", 
                                        TKDPO4K_VAL_RUNT_POSITIVE, 0, 
                                        tkdpo4kStdViInt32_ReadCallback, 
                                        tkdpo4kStdViInt32_WriteCallback, 
                                        &attrRuntPolarityRangeTable));
    
        /*- TKDPO4K_ATTR_RUNT_WHEN -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RUNT_WHEN,
                                       "TKDPO4K_ATTR_RUNT_WHEN",
                                       TKDPO4K_VAL_RUNT_WHEN_OCCURS, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrRuntWhenRangeTable));
    
        /*- TKDPO4K_ATTR_RUNT_WIDTH -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RUNT_WIDTH,
                                        "TKDPO4K_ATTR_RUNT_WIDTH", 4.0e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRuntWidthRangeTable, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_RUNT_WIDTH, 
                                                 tkdpo4kAttrRuntWidth_CoerceCallback));

        /*- TKDPO4K_ATTR_GLITCH_WIDTH -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_GLITCH_WIDTH,
                                        "TKDPO4K_ATTR_GLITCH_WIDTH", 4.0e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrGlitchWidthRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_GLITCH_WIDTH,
                                                 tkdpo4kAttrGlitchWidth_CoerceCallback));

        /*- TKDPO4K_ATTR_GLITCH_POLARITY -*/
    checkErr( Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_GLITCH_POLARITY, 
                                       "TKDPO4K_ATTR_GLITCH_POLARITY", 
                                       TKDPO4K_VAL_GLITCH_POSITIVE, 0, 
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback, 
                                       &attrGlitchPolarityRangeTable));
                                       
        /*- TKDPO4K_ATTR_GLITCH_CONDITION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_GLITCH_CONDITION,
                                       "TKDPO4K_ATTR_GLITCH_CONDITION",
                                       TKDPO4K_VAL_GLITCH_LESS_THAN, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrGlitchConditionRangeTable));
    
        /*- TKDPO4K_ATTR_OPC_TIMEOUT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_OPC_TIMEOUT,
                                       "TKDPO4K_ATTR_OPC_TIMEOUT", 50000,
                                       IVI_VAL_DONT_CHECK_STATUS | IVI_VAL_HIDDEN,
                                       VI_NULL, VI_NULL, VI_NULL));

       /*- TKDPO4K_ATTR_ID_QUERY_RESPONSE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ID_QUERY_RESPONSE,
                "TKDPO4K_ATTR_ID_QUERY_RESPONSE",
                idnString, IVI_VAL_NOT_USER_WRITABLE,
                tkdpo4kAttrIdQueryResponse_ReadCallback, VI_NULL));

        /*- TKDPO4K_ATTR_DELAY_TRIGGER_MODE -*/
    checkErr( Ivi_AddAttributeViInt32  (vi, TKDPO4K_ATTR_DELAY_TRIGGER_MODE, 
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_MODE", 
                                        TKDPO4K_VAL_TRIG_AFTER_TIME, 0, 
                                        tkdpo4kStdViInt32_ReadCallback, 
                                        tkdpo4kStdViInt32_WriteCallback, 
                                        &attrDelayTriggerModeRangeTable));
    checkErr( Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_MODE, 
                                               tkdpo4kAttrDelayTriggerMode_CheckCallback));
                                        
        /*- TKDPO4K_ATTR_DELAY_TRIGGER_EVENTS -*/
    checkErr( Ivi_AddAttributeViInt32  (vi, TKDPO4K_ATTR_DELAY_TRIGGER_EVENTS, 
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_EVENTS", 
                                        2, 0, 
                                        tkdpo4kStdViInt32_ReadCallback, 
                                        tkdpo4kStdViInt32_WriteCallback, 
                                        &attrDelayTriggerEventsRangeTable));
    
        /*- TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE,
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE",
                                        TKDPO4K_VAL_CH_1, 0,
                                        tkdpo4kAttrDelayTriggerSource_ReadCallback,
                                        tkdpo4kAttrDelayTriggerSource_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_DELAY_TRIGGER_SOURCE,
                                                tkdpo4kAttrDelayTriggerSource_CheckCallback));

        /*- TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING,
                                       "TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING",
                                       TKDPO4K_VAL_DC, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrDPO4KDelayTriggerCouplingRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_DELAY_TRIGGER_COUPLING,
                                             tkdpo4kAttrDelayTriggerCoupling_RangeTableCallback));
    
        /*- TKDPO4K_ATTR_DELAY_TRIGGER_SLOPE -*/
    checkErr( Ivi_AddAttributeViInt32  (vi, TKDPO4K_ATTR_DELAY_TRIGGER_SLOPE, 
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_SLOPE", 
                                        TKDPO4K_VAL_POSITIVE, 0, 
                                        tkdpo4kStdViInt32_ReadCallback, 
                                        tkdpo4kStdViInt32_WriteCallback, 
                                        &attrDelayTriggerSlopeRangeTable));
    
        /*- TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL,
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL", 0.0,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrDelayTriggerLevel_ReadCallback,
                                        tkdpo4kAttrDelayTriggerLevel_WriteCallback,
                                        VI_NULL, 0));
    checkErr( Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_LEVEL, 
                                                tkdpo4kAttrDelayTriggerLevel_CheckCallback));
    
        /*- TKDPO4K_ATTR_DELAY_TRIGGER_TIME -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_TIME,
                                        "TKDPO4K_ATTR_DELAY_TRIGGER_TIME", 4e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrDelayTriggerTimeRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_DELAY_TRIGGER_TIME,
                                                 tkdpo4kAttrDelayTriggerTime_CoerceCallback));
        
        /*- TKDPO4K_ATTR_TRANSITION_WHEN -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRANSITION_WHEN,
                                       "TKDPO4K_ATTR_TRANSITION_WHEN",
                                       TKDPO4K_VAL_TRANSITION_SLOWER_THAN, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrTransitionWhenRangeTable));

        /*- TKDPO4K_ATTR_TRANSITION_POLARITY -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_TRANSITION_POLARITY,
                                       "TKDPO4K_ATTR_TRANSITION_POLARITY",
                                       TKDPO4K_VAL_TRANSITION_POSITIVE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrTransitionPolarityRangeTable));
    
        /*- TKDPO4K_ATTR_TRANSITION_DELTA_TIME -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRANSITION_DELTA_TIME,
                                        "TKDPO4K_ATTR_TRANSITION_DELTA_TIME", 4.0e-9,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrTransitionDeltaTimeRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_TRANSITION_DELTA_TIME,
                                                 tkdpo4kAttrTransitionDeltaTime_CoerceCallback));

        /*- TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD,
                                        "TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD",
                                        0.8, IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTransitionHighThreshold_ReadCallback,
                                        tkdpo4kAttrTransitionHighThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_TRANSITION_HIGH_THRESHOLD,
                                                tkdpo4kAttrTransitionHighThreshold_CheckCallback));
    
        /*- TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD,
                                        "TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD", 0,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrTransitionLowThreshold_ReadCallback,
                                        tkdpo4kAttrTransitionLowThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_TRANSITION_LOW_THRESHOLD,
                                                tkdpo4kAttrTransitionLowThreshold_CheckCallback));

        /*- TKDPO4K_ATTR_LOGIC_FUNCTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_LOGIC_FUNCTION,
                                       "TKDPO4K_ATTR_LOGIC_FUNCTION",
                                       TKDPO4K_VAL_LOGIC_AND, IVI_VAL_HIDDEN,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrLogicFunctionRangeTable));
                                       
        /*- TKDPO4K_ATTR_LOGIC_WHEN -*/                                        
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_LOGIC_WHEN,
                                       "TKDPO4K_ATTR_LOGIC_WHEN",
                                       TKDPO4K_VAL_LOGIC_TRUE, IVI_VAL_HIDDEN,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrLogicWhenRangeTable));
                                       
        /*- TKDPO4K_ATTR_LOGIC_INPUT_BY_CH -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH,
                                       "TKDPO4K_ATTR_LOGIC_INPUT_BY_CH",
                                       TKDPO4K_VAL_LOGIC_X,
                                       IVI_VAL_MULTI_CHANNEL | IVI_VAL_HIDDEN,
                                       tkdpo4kAttrLogicInputByCh_ReadCallback,
                                       tkdpo4kAttrLogicInputByCh_WriteCallback,
                                       &attrLogicInputByChanRangeTable));
 
        /*- TKDPO4K_ATTR_LOGIC_THRES_BY_CH -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_LOGIC_THRES_BY_CH,
                                        "TKDPO4K_ATTR_LOGIC_THRES_BY_CH", 0,
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrLogicThresByCh_ReadCallback,
                                        tkdpo4kAttrLogicThresByCh_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_LOGIC_THRES_BY_CH,
                                                tkdpo4kAttrLogicThresByCh_CheckCallback));
        
        /*- TKDPO4K_ATTR_PATTERN_FUNCTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_PATTERN_FUNCTION,
                                       "TKDPO4K_ATTR_PATTERN_FUNCTION",
                                       TKDPO4K_VAL_LOGIC_AND, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrPatternFunction_ReadCallback,
                                       tkdpo4kAttrPatternFunction_WriteCallback,
                                       VI_NULL));
    
        /*- TKDPO4K_ATTR_PATTERN_WHEN -*/
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_PATTERN_WHEN,
	                                   "TKDPO4K_ATTR_PATTERN_WHEN",
	                                   TKDPO4K_VAL_LOGIC_TRUE, IVI_VAL_NEVER_CACHE,
	                                   tkdpo4kAttrPatternWhen_ReadCallback,
	                                   tkdpo4kAttrPatternWhen_WriteCallback,
	                                   &attrLogicWhenRangeTable));
                                       
        /*- TKDPO4K_ATTR_PATTERN_INPUT -*/    
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_PATTERN_INPUT,
                                       "TKDPO4K_ATTR_PATTERN_INPUT",
                                       TKDPO4K_VAL_LOGIC_X,
                                       IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrPatternInput_ReadCallback,
                                       tkdpo4kAttrPatternInput_WriteCallback,
                                       VI_NULL));

        /*- TKDPO4K_ATTR_PATTERN_DELTATIME -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_PATTERN_DELTATIME,
                                        "TKDPO4K_ATTR_PATTERN_DELTATIME", 4.0e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrPatternDeltatimeRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_PATTERN_DELTATIME,
                                                 tkdpo4kAttrPatternDeltatime_CoerceCallback));

        /*- TKDPO4K_ATTR_STATE_FUNCTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_STATE_FUNCTION,
                                       "TKDPO4K_ATTR_STATE_FUNCTION",
                                       TKDPO4K_VAL_LOGIC_AND, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrStateFunction_ReadCallback,
                                       tkdpo4kAttrStateFunction_WriteCallback,
                                       VI_NULL));
        
        /*- TKDPO4K_ATTR_STATE_WHEN -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_STATE_WHEN,
                                       "TKDPO4K_ATTR_STATE_WHEN",
                                       TKDPO4K_VAL_LOGIC_TRUE, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrStateWhen_ReadCallback,
                                       tkdpo4kAttrStateWhen_WriteCallback, VI_NULL));

        /*- TKDPO4K_ATTR_STATE_INPUT -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_STATE_INPUT,
                                       "TKDPO4K_ATTR_STATE_INPUT",
                                       TKDPO4K_VAL_LOGIC_X,
                                       IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrStateInput_ReadCallback,
                                       tkdpo4kAttrStateInput_WriteCallback, VI_NULL));
                                       
        /*- TKDPO4K_ATTR_STATE_CLOCK_EDGE -*/                                      
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_STATE_CLOCK_EDGE,
                                       "TKDPO4K_ATTR_STATE_CLOCK_EDGE", 
                                       TKDPO4K_VAL_CLOCK_RISE, 0,
                                       tkdpo4kStdViInt32_ReadCallback, 
                                       tkdpo4kStdViInt32_WriteCallback, 
                                       &attrStateClockEdgeRangeTable));

        /*- TKDPO4K_ATTR_STATE_CLOCK_SOURCE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_STATE_CLOCK_SOURCE,
                                       "TKDPO4K_ATTR_STATE_CLOCK_SOURCE",
                                       TKDPO4K_VAL_SOUR_NONE, 0,
                                       tkdpo4kAttrStateClockSource_ReadCallback,
                                       tkdpo4kAttrStateClockSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_STATE_CLOCK_SOURCE,
                                             tkdpo4kAttrStateClockSource_RangeTableCallback));

        /*- TKDPO4K_ATTR_SETHOLD_CLOCK_EDGE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SETHOLD_CLOCK_EDGE,
                                       "TKDPO4K_ATTR_SETHOLD_CLOCK_EDGE",
                                       TKDPO4K_VAL_CLOCK_RISE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrSetholdClockEdgeRangeTable));

        /*- TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE -*/                                      
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                       "TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, 0,
                                       tkdpo4kAttrSetholdClockSource_ReadCallback,
                                       tkdpo4kAttrSetholdClockSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                               tkdpo4kAttrSetholdClockSource_CheckCallback));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_SETHOLD_CLOCK_SOURCE,
                                             tkdpo4kAttrSetholdClockSource_RangeTableCallback));
                                       
        /*- TKDPO4K_ATTR_SETHOLD_DATA_SOURCE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                       "TKDPO4K_ATTR_SETHOLD_DATA_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH2, 0,
                                       tkdpo4kAttrSetholdDataSource_ReadCallback,
                                       tkdpo4kAttrSetholdDataSource_WriteCallback,
                                       &attrDPO4KSetholdDataSourceRangeTable));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                               tkdpo4kAttrSetholdDataSource_CheckCallback));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_SETHOLD_DATA_SOURCE,
                                             tkdpo4kAttrSetholdDataSource_RangeTableCallback));
                                       
        /*- TKDPO4K_ATTR_SETHOLD_HOLDTIME -*/                                      
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_SETHOLD_HOLDTIME,
                                        "TKDPO4K_ATTR_SETHOLD_HOLDTIME", 4.0e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrDPO4KSetholdHoldtimeRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_SETHOLD_HOLDTIME,
                                             tkdpo4kAttrSetholdHoldtime_RangeTableCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_SETHOLD_HOLDTIME,
                                                 tkdpo4kAttrSetholdHoldtime_CoerceCallback));                                       
                                        
        /*- TKDPO4K_ATTR_SETHOLD_SETTIME -*/                                        
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_SETHOLD_SETTIME,
                                        "TKDPO4K_ATTR_SETHOLD_SETTIME", 4.0e-9, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrDPO4KSetholdSettimeRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_SETHOLD_SETTIME,
                                             tkdpo4kAttrSetholdSettime_RangeTableCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_SETHOLD_SETTIME,
                                                 tkdpo4kAttrSetholdSettime_CoerceCallback));

        /*- TKDPO4K_ATTR_RS232_CONDITION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RS232_CONDITION,
                                       "TKDPO4K_ATTR_RS232_CONDITION",
                                       TKDPO4K_VAL_RS232_RX_START,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrRs232Condition_ReadCallback,
                                       tkdpo4kAttrRs232Condition_WriteCallback,
                                       &attrRs232ConditionRangeTable));
    
        /*- TKDPO4K_ATTR_RS232_RX_DATA_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_RS232_RX_DATA_VALUE,
                                        "TKDPO4K_ATTR_RS232_RX_DATA_VALUE",
                                        TKDPO4K_VAL_RS232_RX_DATA_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrRs232RxDataValue_ReadCallback,
                                        tkdpo4kAttrRs232RxDataValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi,
                                                 TKDPO4K_ATTR_RS232_RX_DATA_VALUE,
                                                 tkdpo4kAttrRs232RxDataValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_RS232_RX_DATA_VALUE,
                                                tkdpo4kAttrRs232RxDataValue_CheckCallback));
    
        /*- TKDPO4K_ATTR_RS232_RX_DATA_SIZE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RS232_RX_DATA_SIZE,
                                       "TKDPO4K_ATTR_RS232_RX_DATA_SIZE", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrRs232RxDataSize_ReadCallback,
                                       tkdpo4kAttrRs232RxDataSize_WriteCallback,
                                       &attrRs232RxDataSizeRangeTable));
    
        /*- TKDPO4K_ATTR_RS232_TX_DATA_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_RS232_TX_DATA_VALUE,
                                        "TKDPO4K_ATTR_RS232_TX_DATA_VALUE",
                                        TKDPO4K_VAL_RS232_RX_DATA_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrRs232TxDataValue_ReadCallback,
                                        tkdpo4kAttrRs232TxDataValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi,
                                                 TKDPO4K_ATTR_RS232_TX_DATA_VALUE,
                                                 tkdpo4kAttrRs232TxDataValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_RS232_TX_DATA_VALUE,
                                                tkdpo4kAttrRs232TxDataValue_CheckCallback));
    
        /*- TKDPO4K_ATTR_RS232_TX_DATA_SIZE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RS232_TX_DATA_SIZE,
                                       "TKDPO4K_ATTR_RS232_TX_DATA_SIZE", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrRs232TxDataSize_ReadCallback,
                                       tkdpo4kAttrRs232TxDataSize_WriteCallback,
                                       &attrRs232TxDataSizeRangeTable));
    
    if(IS_MSO4K(instrModelNo) || IS_MDO4K(instrModelNo))    
    {
        /*- TKDPO4K_ATTR_PARALLEL_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_PARALLEL_VALUE,
                                        "TKDPO4K_ATTR_PARALLEL_VALUE",
                                        TKDPO4K_VAL_PARALLEL_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrParallelValue_ReadCallback,
                                        tkdpo4kAttrParallelValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_PARALLEL_VALUE,
                                                 tkdpo4kAttrParallelValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_PARALLEL_VALUE,
                                                tkdpo4kAttrParallelValue_CheckCallback));
    }
    
        /*- TKDPO4K_ATTR_CAN_CONDITION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_CAN_CONDITION,
                                       "TKDPO4K_ATTR_CAN_CONDITION",
                                       TKDPO4K_VAL_CAN_COND_SOF, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrCanCondition_ReadCallback,
                                       tkdpo4kAttrCanCondition_WriteCallback,
                                       &attrCanConditionRangeTable));
                                       
        /*- TKDPO4K_ATTR_CAN_DATA_VALUE -*/                                    
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_CAN_DATA_VALUE,
                                        "TKDPO4K_ATTR_CAN_DATA_VALUE",
                                        TKDPO4K_VAL_CAN_DATA_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrCanDataValue_ReadCallback,
                                        tkdpo4kAttrCanDataValue_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_CAN_DATA_VALUE,
                                                tkdpo4kAttrCanDataValue_CheckCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_CAN_DATA_VALUE,
                                                 tkdpo4kAttrCanDataValue_CoerceCallback));

        /*- TKDPO4K_ATTR_CAN_DATA_SIZE -*/                                      
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_CAN_DATA_SIZE,
                                       "TKDPO4K_ATTR_CAN_DATA_SIZE", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrCanDataSize_ReadCallback,
                                       tkdpo4kAttrCanDataSize_WriteCallback,
                                       &attrCanDataSizeRangeTable));

        /*- TKDPO4K_ATTR_CAN_ID_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_CAN_ID_VALUE,
                                        "TKDPO4K_ATTR_CAN_ID_VALUE",
                                        TKDPO4K_VAL_CAN_ID_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrCanIdValue_ReadCallback,
                                        tkdpo4kAttrCanIdValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_CAN_ID_VALUE,
                                                 tkdpo4kAttrCanIdValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_CAN_ID_VALUE,
                                                tkdpo4kAttrCanIdValue_CheckCallback));                                     
                                       
        /*- TKDPO4K_ATTR_CAN_ID_MODE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_CAN_ID_MODE,
                                       "TKDPO4K_ATTR_CAN_ID_MODE",
                                       TKDPO4K_VAL_CAN_ID_STANDARD,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrCanIdMode_ReadCallback,
                                       tkdpo4kAttrCanIdMode_WriteCallback,
                                       &attrCanIdModeRangeTable));
                                       
        /*- TKDPO4K_ATTR_CAN_FRAMETYPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_CAN_FRAMETYPE,
                                       "TKDPO4K_ATTR_CAN_FRAMETYPE",
                                       TKDPO4K_VAL_CAN_FRAME_DATA,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrCanFrametype_ReadCallback,
                                       tkdpo4kAttrCanFrametype_WriteCallback,
                                       &attrCanFrametypeRangeTable));

        /*- TKDPO4K_ATTR_I2C_CONDITION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_I2C_CONDITION,
                                       "TKDPO4K_ATTR_I2C_CONDITION",
                                       TKDPO4K_VAL_I2C_COND_START,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrI2cCondition_ReadCallback,
                                       tkdpo4kAttrI2cCondition_WriteCallback,
                                       &attrI2cConditionRangeTable));
                                       
        /*- TKDPO4K_ATTR_I2C_ADDR_VALUE -*/                                    
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_I2C_ADDR_VALUE,
                                        "TKDPO4K_ATTR_I2C_ADDR_VALUE",
                                        TKDPO4K_VAL_I2C_ADDR_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrI2cAddrValue_ReadCallback,
                                        tkdpo4kAttrI2cAddrValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_I2C_ADDR_VALUE,
                                                 tkdpo4kAttrI2cAddrValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_I2C_ADDR_VALUE,
                                                tkdpo4kAttrI2cAddrValue_CheckCallback));
        
        /*- TKDPO4K_ATTR_I2C_ADDR_MODE -*/                                     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_I2C_ADDR_MODE,
                                       "TKDPO4K_ATTR_I2C_ADDR_MODE",
                                       TKDPO4K_VAL_I2C_ADDR7, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrI2cAddrMode_ReadCallback,
                                       tkdpo4kAttrI2cAddrMode_WriteCallback,
                                       &attrI2cAddrModeRangeTable));
                                       
        /*- TKDPO4K_ATTR_I2C_DATA_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_I2C_DATA_VALUE,
                                        "TKDPO4K_ATTR_I2C_DATA_VALUE",
                                        TKDPO4K_VAL_I2C_DATA_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrI2cDataValue_ReadCallback,
                                        tkdpo4kAttrI2cDataValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_I2C_DATA_VALUE,
                                                 tkdpo4kAttrI2cDataValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_I2C_DATA_VALUE,
                                                tkdpo4kAttrI2cDataValue_CheckCallback));
                                                
        /*- TKDPO4K_ATTR_I2C_DATA_SIZE -*/                                     
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_I2C_DATA_SIZE,
	                                   "TKDPO4K_ATTR_I2C_DATA_SIZE", 1,
	                                   IVI_VAL_NEVER_CACHE,
	                                   tkdpo4kAttrI2cDataSize_ReadCallback,
	                                   tkdpo4kAttrI2cDataSize_WriteCallback,
	                                   &attrI2cDataSizeRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_I2C_DATA_SIZE,
	                                         tkdpo4kAttrI2cDataSize_RangeTableCallback));

        /*- TKDPO4K_ATTR_I2C_DATA_DIRECTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_I2C_DATA_DIRECTION,
                                       "TKDPO4K_ATTR_I2C_DATA_DIRECTION",
                                       TKDPO4K_VAL_I2C_NOCARE, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrI2cDataDirection_ReadCallback,
                                       tkdpo4kAttrI2cDataDirection_WriteCallback,
                                       &attrI2cDataDirectionRangeTable));

        /*- TKDPO4K_ATTR_SPI_CONDITION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SPI_CONDITION,
                                       "TKDPO4K_ATTR_SPI_CONDITION",
                                       TKDPO4K_VAL_SPI_MOSI, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrSpiCondition_ReadCallback,
                                       tkdpo4kAttrSpiCondition_WriteCallback,
                                       &attrSpiConditionRangeTable));
                                       
        /*- TKDPO4K_ATTR_SPI_DATA_SIZE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                       "TKDPO4K_ATTR_SPI_DATA_SIZE", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrSpiDataSize_ReadCallback,
                                       tkdpo4kAttrSpiDataSize_WriteCallback,
                                       &attrSpiDataSizeRangeTable));
                                       
        /*- TKDPO4K_ATTR_SPI_MOSI_VALUE -*/                                    
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_SPI_MOSI_VALUE,
                                        "TKDPO4K_ATTR_SPI_MOSI_VALUE",
                                        TKDPO4K_VAL_SPI_MOSI_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrSpiMosiValue_ReadCallback,
                                        tkdpo4kAttrSpiMosiValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_SPI_MOSI_VALUE,
                                                 tkdpo4kAttrSpiMosiValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_SPI_MOSI_VALUE,
                                                tkdpo4kAttrSpiMosiValue_CheckCallback));                                       

        /*- TKDPO4K_ATTR_SPI_MISO_VALUE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_SPI_MISO_VALUE,
                                        "TKDPO4K_ATTR_SPI_MISO_VALUE",
                                        TKDPO4K_VAL_SPI_MISO_VALUE,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrSpiMisoValue_ReadCallback,
                                        tkdpo4kAttrSpiMisoValue_WriteCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViString (vi, TKDPO4K_ATTR_SPI_MISO_VALUE,
                                                 tkdpo4kAttrSpiMisoValue_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_SPI_MISO_VALUE,
                                                tkdpo4kAttrSpiMisoValue_CheckCallback));        
        
        /*- TKDPO4K_ATTR_MEAS_SOURCE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_MEAS_SOURCE,
                                        "TKDPO4K_ATTR_MEAS_SOURCE", TKDPO4K_VAL_CH_1,
                                        0, tkdpo4kStdViStringSource_ReadCallback,
                                        tkdpo4kStdViStringSource_WriteCallback));
    checkErr( Ivi_SetStoredRangeTablePtr (vi, TKDPO4K_ATTR_MEAS_SOURCE, 
                                          &attrMeasSourceRangeTable));
    checkErr( Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_MEAS_SOURCE, 
                                                tkdpo4kStdViStringSource_CheckCallback));
    
        /*- TKDPO4K_ATTR_MEAS_SOURCE2 -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_MEAS_SOURCE2,
                                        "TKDPO4K_ATTR_MEAS_SOURCE2",
                                        TKDPO4K_VAL_CH_1, 0,
                                        tkdpo4kStdViStringSource_ReadCallback,
                                        tkdpo4kStdViStringSource_WriteCallback));
    checkErr( Ivi_SetStoredRangeTablePtr (vi, TKDPO4K_ATTR_MEAS_SOURCE2, 
                                          &attrMeasSource2RangeTable));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_MEAS_SOURCE2,
                                                tkdpo4kStdViStringSource_CheckCallback));

        /*- TKDPO4K_ATTR_MEAS_FUNCTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_FUNCTION,
                                       "TKDPO4K_ATTR_MEAS_FUNCTION",
                                       TKDPO4K_VAL_PERIOD, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       attrMeasFunctionRangeTable));
    
        /*- TKDPO4K_ATTR_MEAS_DEL_DIRECTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_DEL_DIRECTION,
                                       "TKDPO4K_ATTR_MEAS_DEL_DIRECTION",
                                       TKDPO4K_VAL_DEL_DIR_BACKWARD, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMeasDelDirectionRangeTable));
    
        /*- TKDPO4K_ATTR_MEAS_DEL_EDGE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_DEL_EDGE,
                                       "TKDPO4K_ATTR_MEAS_DEL_EDGE",
                                       TKDPO4K_VAL_DEL_EDGE_RISE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMeasDelEdgeRangeTable));
    
        /*- TKDPO4K_ATTR_MEAS_DEL_EDGE2 -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_DEL_EDGE2,
                                       "TKDPO4K_ATTR_MEAS_DEL_EDGE2",
                                       TKDPO4K_VAL_DEL_EDGE_RISE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMeasDelEdge2RangeTable));

        /*- TKDPO4K_ATTR_MEAS_REF_CALC_METH -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_REF_CALC_METH, 
                                       "TKDPO4K_ATTR_MEAS_REF_CALC_METH", 
                                       TKDPO4K_VAL_MEAS_AUTO, 0, 
                                       tkdpo4kStdViInt32_ReadCallback, 
                                       tkdpo4kStdViInt32_WriteCallback, 
                                       &attrMeasRefCalcMethRangeTable));
    
        /*- TKDPO4K_ATTR_MEAS_HIGH_REF -*/
    checkErr( Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MEAS_HIGH_REF, 
                                        "TKDPO4K_ATTR_MEAS_HIGH_REF", 
                                        90.0, 0, 
                                        tkdpo4kStdViReal64_ReadCallback, 
                                        tkdpo4kStdViReal64_WriteCallback, 
                                        &attrMeasHighRefRangeTable, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_MEAS_HIGH_REF, 
                                                 tkdpo4kResolutionOne_CoerceCallback));

        /*- TKDPO4K_ATTR_MEAS_LOW_REF -*/
    checkErr( Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MEAS_LOW_REF, 
                                        "TKDPO4K_ATTR_MEAS_LOW_REF", 
                                        10.0, 0, 
                                        tkdpo4kStdViReal64_ReadCallback, 
                                        tkdpo4kStdViReal64_WriteCallback, 
                                        &attrMeasLowRefRangeTable, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_MEAS_LOW_REF, 
                                                 tkdpo4kResolutionOne_CoerceCallback));

        /*- TKDPO4K_ATTR_MEAS_MID_REF -*/
    checkErr( Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MEAS_MID_REF, 
                                        "TKDPO4K_ATTR_MEAS_MID_REF", 
                                        50.0, 0, 
                                        tkdpo4kStdViReal64_ReadCallback, 
                                        tkdpo4kStdViReal64_WriteCallback, 
                                        &attrMeasMidRefRangeTable, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_MEAS_MID_REF, 
                                                 tkdpo4kResolutionOne_CoerceCallback));

        /*- TKDPO4K_ATTR_MEAS_MID2_REF -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MEAS_MID2_REF,
                                        "TKDPO4K_ATTR_MEAS_MID2_REF", 50.0, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrMeasMid2RefRangeTable, 0));
    checkErr( Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_MEAS_MID2_REF, 
                                                 tkdpo4kResolutionOne_CoerceCallback));
   
        /*- TKDPO4K_ATTR_MEAS_VALUE -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_MEAS_VALUE,
                                        "TKDPO4K_ATTR_MEAS_VALUE", 0.0,
                                        IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN | 
                                        IVI_VAL_USE_CALLBACKS_FOR_SIMULATION | 
                                        IVI_VAL_MULTI_CHANNEL,
                                        tkdpo4kAttrMeasureValue_ReadCallback,
                                        VI_NULL, VI_NULL, 0));

        /*- TKDPO4K_ATTR_MEAS_GATING -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MEAS_GATING,
                                       "TKDPO4K_ATTR_MEAS_GATING", 
                                       TKDPO4K_VAL_MEAS_GATING_SCREEN, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMeasGatingRangeTable));

        /*- TKDPO4K_ATTR_INPUT_DATA_SOURCE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_INPUT_DATA_SOURCE,
                                        "TKDPO4K_ATTR_INPUT_DATA_SOURCE",
                                        TKDPO4K_VAL_CH_1, IVI_VAL_HIDDEN,
                                        tkdpo4kStdViStringSource_ReadCallback,
                                        tkdpo4kStdViStringSource_WriteCallback));
    checkErr( Ivi_SetStoredRangeTablePtr (vi, TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                          &attrInputDataSourceRangeTable));
    checkErr( Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_INPUT_DATA_SOURCE, 
                                                tkdpo4kStdViStringSource_CheckCallback));
    
        /*- TKDPO4K_ATTR_MAIN_TRIGGER_TYPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MAIN_TRIGGER_TYPE,
                                       "TKDPO4K_ATTR_MAIN_TRIGGER_TYPE",
                                       TKDPO4K_VAL_EDGE_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMainTriggerTypeRangeTable));
                                       
        /*- TKDPO4K_ATTR_EDGE_TRIGGER_CLASS -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_EDGE_TRIGGER_CLASS,
                                       "TKDPO4K_ATTR_EDGE_TRIGGER_CLASS",
                                       TKDPO4K_VAL_EDGE_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kAttrEdgeTriggerClass_ReadCallback,
                                       tkdpo4kAttrEdgeTriggerClass_WriteCallback,
                                       &attrEdgeTriggerClassRangeTable));

        /*- TKDPO4K_ATTR_PULSE_TRIGGER_CLASS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_PULSE_TRIGGER_CLASS,
                                       "TKDPO4K_ATTR_PULSE_TRIGGER_CLASS",
                                       TKDPO4K_VAL_RUNT_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrPulseTriggerClassRangeTable));
                                       
        /*- TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS,
                                       "TKDPO4K_ATTR_LOGIC_TRIGGER_CLASS",
                                       TKDPO4K_VAL_PATTERN_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kAttrLogicTriggerClass_ReadCallback,
                                       tkdpo4kAttrLogicTriggerClass_WriteCallback,
                                       &attrLogicTriggerClassRangeTable));

        /*- TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS,
                                       "TKDPO4K_ATTR_SERIAL_TRIGGER_CLASS",
                                       TKDPO4K_VAL_I2C_TRIGGER,
                                       IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                       tkdpo4kAttrSerialTriggerClass_ReadCallback,
                                       tkdpo4kAttrSerialTriggerClass_WriteCallback,
                                       &attrSerialTriggerClassRangeTable));

        /*- TKDPO4K_ATTR_MATH_TYPE -*/  
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_TYPE,
                                       "TKDPO4K_ATTR_MATH_TYPE",
                                       TKDPO4K_VAL_MATH_TYPE_DUAL, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrMathTypeRangeTable));
                                       
        /*- TKDPO4K_ATTR_MATH_FUNCTION -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_FUNCTION,
                                       "TKDPO4K_ATTR_MATH_FUNCTION",
                                       TKDPO4K_VAL_MATH_ADD, 0,
                                       tkdpo4kAttrMathFunction_ReadCallback,
                                       tkdpo4kAttrMathFunction_WriteCallback,
                                       &attrMathFunctionRangeTable));
                                       
        /*- TKDPO4K_ATTR_MATH_SOURCE_1ST -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_SOURCE_1ST,
                                       "TKDPO4K_ATTR_MATH_SOURCE_1ST",
                                       TKDPO4K_VAL_SOUR_CH1,
                                       IVI_VAL_NOT_USER_READABLE, VI_NULL, VI_NULL,
                                       &attrMathSourceRangeTable));
        
        /*- TKDPO4K_ATTR_MATH_SOURCE_2ND -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_SOURCE_2ND,
                                       "TKDPO4K_ATTR_MATH_SOURCE_2ND",
                                       TKDPO4K_VAL_SOUR_CH2,
                                       IVI_VAL_NOT_USER_READABLE, VI_NULL, VI_NULL,
                                       &attrMathSourceRangeTable));
 
        /*- TKDPO4K_ATTR_FFT_VERT_SCALE -*/     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FFT_VERT_SCALE,
                                       "TKDPO4K_ATTR_FFT_VERT_SCALE",
                                       TKDPO4K_VAL_MATH_DBV_RMS, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrFFTVertScaleRangeTable));
                                       
        /*- TKDPO4K_ATTR_FFT_WINDOW -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FFT_WINDOW,
                                       "TKDPO4K_ATTR_FFT_WINDOW",
                                       TKDPO4K_VAL_MATH_HANNING, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrFFTWindowRangeTable));

        /*- TKDPO4K_ATTR_ADV_DEFINE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ADV_DEFINE,
                                        "TKDPO4K_ATTR_ADV_DEFINE",
                                        TKDPO4K_VAL_ADV_DEFINE, 0,
                                        tkdpo4kAttrAdvDefine_ReadCallback,
                                        tkdpo4kAttrAdvDefine_WriteCallback));

        /*- TKDPO4K_ATTR_ADV_VAR1 -*/
	checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_ADV_VAR1,
	                                    "TKDPO4K_ATTR_ADV_VAR1", 0, 0,
	                                    tkdpo4kStdViReal64_ReadCallback,
	                                    tkdpo4kStdViReal64_WriteCallback,
	                                    &attrAdvVar1RangeTable, 0));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_ADV_VAR1,
	                                         tkdpo4kAttrAdvVar1_RangeTableCallback));

        /*- TKDPO4K_ATTR_ADV_VAR2 -*/                                           
	checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_ADV_VAR2,
	                                    "TKDPO4K_ATTR_ADV_VAR2", 0, 0,
	                                    tkdpo4kStdViReal64_ReadCallback,
	                                    tkdpo4kStdViReal64_WriteCallback,
	                                    &attrAdvVar2RangeTable, 0));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_ADV_VAR2,
	                                         tkdpo4kAttrAdvVar2_RangeTableCallback));
        
        /*- TKDPO4K_ATTR_BUS_SELECT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SELECT,
                                       "TKDPO4K_ATTR_BUS_SELECT", TKDPO4K_VAL_BUS1,
                                       0, VI_NULL, VI_NULL, &attrDPO4KBusSelectRangeTable));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_SELECT,
                                             tkdpo4kAttrBusSelect_RangeTableCallback));
        
        /*- TKDPO4K_ATTR_BUS_TYPE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_TYPE,
                                       "TKDPO4K_ATTR_BUS_TYPE", TKDPO4K_VAL_BUS_I2C,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusType_ReadCallback,
                                       tkdpo4kAttrBusType_WriteCallback, VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_TYPE,
                                             tkdpo4kAttrBusType_RangeTableCallback));

        /*- TKDPO4K_ATTR_BUS_STATE -*/
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_BUS_STATE,
                                         "TKDPO4K_ATTR_BUS_STATE", VI_FALSE,
                                         IVI_VAL_NEVER_CACHE,
                                         tkdpo4kAttrBusState_ReadCallback,
                                         tkdpo4kAttrBusState_WriteCallback));
        
        /*- TKDPO4K_ATTR_BUS_CAN_BITRATE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_CAN_BITRATE,
                                       "TKDPO4K_ATTR_BUS_CAN_BITRATE",
                                       TKDPO4K_VAL_CAN_RATE500K, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusCanBitrate_ReadCallback,
                                       tkdpo4kAttrBusCanBitrate_WriteCallback,
                                       &attrBusCanBitrateRangeTable));
        
        /*- TKDPO4K_ATTR_BUS_CAN_PROBE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_CAN_PROBE,
                                       "TKDPO4K_ATTR_BUS_CAN_PROBE",
                                       TKDPO4K_VAL_CAN_CANH, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusCanProbe_ReadCallback,
                                       tkdpo4kAttrBusCanProbe_WriteCallback,
                                       &attrBusCanProbeRangeTable));
        
        /*- TKDPO4K_ATTR_BUS_CAN_SOURCE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_CAN_SOURCE,
                                       "TKDPO4K_ATTR_BUS_CAN_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusCanSource_ReadCallback,
                                       tkdpo4kAttrBusCanSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_CAN_SOURCE,
                                             tkdpo4kAttrBusCanSource_RangeTableCallback));
                                       
        /*- TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE -*/                                      
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE,
                                       "TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusI2cClockSource_ReadCallback,
                                       tkdpo4kAttrBusI2cClockSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_I2C_CLOCK_SOURCE,
                                             tkdpo4kAttrBusI2cClockSource_RangeTableCallback));

        /*- TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE -*/        
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE,
                                       "TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH2, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusI2cDataSource_ReadCallback,
                                       tkdpo4kAttrBusI2cDataSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_I2C_DATA_SOURCE,
                                             tkdpo4kAttrBusI2cDataSource_RangeTableCallback));
                                       
        /*- TKDPO4K_ATTR_BUS_SPI_MISO_POLARITY -*/                                     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_MISO_POLARITY,
                                       "TKDPO4K_ATTR_BUS_SPI_MISO_POLARITY",
                                       TKDPO4K_VAL_SPI_POLARITY_HIGH,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiMisoPolarity_ReadCallback,
                                       tkdpo4kAttrBusSpiMisoPolarity_WriteCallback,
                                       &attrBusSpiPolarityRangeTable));
                                       
        /*- TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE,
                                       "TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH4, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiMisoSource_ReadCallback,
                                       tkdpo4kAttrBusSpiMisoSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_SPI_MISO_SOURCE,
                                             tkdpo4kAttrBusSpiMisoSource_RangeTableCallback));
        
        /*- TKDPO4K_ATTR_BUS_SPI_MOSI_POLARITY -*/                                     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_MOSI_POLARITY,
                                       "TKDPO4K_ATTR_BUS_SPI_MOSI_POLARITY",
                                       TKDPO4K_VAL_SPI_POLARITY_HIGH,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiMosiPolarity_ReadCallback,
                                       tkdpo4kAttrBusSpiMosiPolarity_WriteCallback,
                                       &attrBusSpiPolarityRangeTable));
        
        /*- TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE,
                                       "TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH3, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiMosiSource_ReadCallback,
                                       tkdpo4kAttrBusSpiMosiSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_SPI_MOSI_SOURCE,
                                             tkdpo4kAttrBusSpiMosiSource_RangeTableCallback));
        
        /*- TKDPO4K_ATTR_BUS_SPI_SCLK_POLARITY -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_SCLK_POLARITY,
                                       "TKDPO4K_ATTR_BUS_SPI_SCLK_POLARITY",
                                       TKDPO4K_VAL_SPI_SCLK_RISE,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiSclkPolarity_ReadCallback,
                                       tkdpo4kAttrBusSpiSclkPolarity_WriteCallback,
                                       &attrBusSpiSclkPolarityRangeTable));
                                       
        /*- TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE,
                                       "TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiSclkSource_ReadCallback,
                                       tkdpo4kAttrBusSpiSclkSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_SPI_SCLK_SOURCE,
                                             tkdpo4kAttrBusSpiSclkSource_RangeTableCallback));
        
        /*- TKDPO4K_ATTR_BUS_SPI_SS_POLARITY -*/                                       
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_SS_POLARITY,
                                       "TKDPO4K_ATTR_BUS_SPI_SS_POLARITY",
                                       TKDPO4K_VAL_SPI_POLARITY_LOW,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiSsPolarity_ReadCallback,
                                       tkdpo4kAttrBusSpiSsPolarity_WriteCallback,
                                       &attrBusSpiPolarityRangeTable));
    
        /*- TKDPO4K_ATTR_BUS_SPI_SS_SOURCE -*/                     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_SPI_SS_SOURCE,
                                       "TKDPO4K_ATTR_BUS_SPI_SS_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH2, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusSpiSsSource_ReadCallback,
                                       tkdpo4kAttrBusSpiSsSource_WriteCallback,
                                       VI_NULL));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_BUS_SPI_SS_SOURCE,
                                             tkdpo4kAttrBusSpiSsSource_RangeTableCallback));
    
    if(IS_MSO4K(instrModelNo) || IS_MDO4K(instrModelNo))
    {
        /*- Parallel trigger is only available with MSO series models -*/
        
            /*- TKDPO4K_ATTR_BUS_PARALLEL_BITS_SOURCE -*/
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_BUS_PARALLEL_BITS_SOURCE,
                                        "TKDPO4K_ATTR_BUS_PARALLEL_BITS_SOURCE", "",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrBusParallelBitsSource_ReadCallback,
                                        tkdpo4kAttrBusParallelBitsSource_WriteCallback));
    
            /*- TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE -*/
    checkErr (Ivi_AddRepeatedAttributeViInt32 (vi, BITSOURCE_REP_CAP_NAME,
                                               TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE,
                                               "TKDPO4K_ATTR_INSTR_PARALLEL_BIT_SOURCE",
                                               TKDPO4K_VAL_SOUR_CH1,
                                               IVI_VAL_NEVER_CACHE | IVI_VAL_HIDDEN,
                                               tkdpo4kAttrInstrParallelBitSource_ReadCallback,
                                               tkdpo4kAttrInstrParallelBitSource_WriteCallback,
                                               &attrInstrParallelBitSourceRangeTable));
    
            /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_EDGE -*/    
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_EDGE,
                                       "TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_EDGE",
                                       TKDPO4K_VAL_PARALLEL_CLOCK_RISE,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusParallelClockEdge_ReadCallback,
                                       tkdpo4kAttrBusParallelClockEdge_WriteCallback,
                                       &attrBusParallelClockEdgeRangeTable));
    
            /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_LOCKED -*/
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_LOCKED,
                                         "TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_LOCKED",
                                         VI_TRUE, IVI_VAL_NEVER_CACHE,
                                         tkdpo4kAttrBusParallelClockLocked_ReadCallback,
                                         tkdpo4kAttrBusParallelClockLocked_WriteCallback));
    
            /*- TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_SOURCE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_SOURCE,
                                       "TKDPO4K_ATTR_BUS_PARALLEL_CLOCK_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusParallelClockSource_ReadCallback,
                                       tkdpo4kAttrBusParallelClockSource_WriteCallback,
                                       &attrBusParallelClockSourceRangeTable));
    
            /*- TKDPO4K_ATTR_BUS_PARALLEL_WIDTH -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_PARALLEL_WIDTH,
                                       "TKDPO4K_ATTR_BUS_PARALLEL_WIDTH", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusParallelWidth_ReadCallback,
                                       tkdpo4kAttrBusParallelWidth_WriteCallback,
                                       VI_NULL));
        checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_BUS_PARALLEL_WIDTH,
                                                   tkdpo4kAttrBusParallelWidth_CheckCallback));
    }
    
        /*- TKDPO4K_ATTR_BUS_RS232_BITRATE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_BITRATE,
                                       "TKDPO4K_ATTR_BUS_RS232_BITRATE", 9600,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232Bitrate_ReadCallback,
                                       tkdpo4kAttrBusRs232Bitrate_WriteCallback,
                                       &attrBusRs232BitrateRangeTable));
    
        /*- TKDPO4K_ATTR_BUS_RS232_DATABITS -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_DATABITS,
                                       "TKDPO4K_ATTR_BUS_RS232_DATABITS", 7,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232Databits_ReadCallback,
                                       tkdpo4kAttrBusRs232Databits_WriteCallback,
                                       &attrBusRs232DatabitsRangeTable));
    
        /*- TKDPO4K_ATTR_BUS_RS232_DELIMITER -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_DELIMITER,
                                       "TKDPO4K_ATTR_BUS_RS232_DELIMITER",
                                       TKDPO4K_VAL_RS232_DELIMITER_NULL,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232Delimiter_ReadCallback,
                                       tkdpo4kAttrBusRs232Delimiter_WriteCallback,
                                       &attrBusRs232DelimiterRangeTable));
    
        /*- TKDPO4K_ATTR_BUS_RS232_PARITY -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_PARITY,
                                       "TKDPO4K_ATTR_BUS_RS232_PARITY",
                                       TKDPO4K_VAL_RS232_PARITY_NONE,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232Parity_ReadCallback,
                                       tkdpo4kAttrBusRs232Parity_WriteCallback,
                                       &attrBusRs232ParityRangeTable));
        
        /*- TKDPO4K_ATTR_BUS_RS232_RX_SOURCE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_RX_SOURCE,
                                       "TKDPO4K_ATTR_BUS_RS232_RX_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH1, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232RxSource_ReadCallback,
                                       tkdpo4kAttrBusRs232RxSource_WriteCallback,
                                       &attrBusRS232SourceRangeTable));
    
        /*- TKDPO4K_ATTR_BUS_RS232_TX_SOURCE -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_RS232_TX_SOURCE,
                                       "TKDPO4K_ATTR_BUS_RS232_TX_SOURCE",
                                       TKDPO4K_VAL_SOUR_CH2, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusRs232TxSource_ReadCallback,
                                       tkdpo4kAttrBusRs232TxSource_WriteCallback,
                                       &attrBusRS232SourceRangeTable));
    
        /*- TKDPO4K_ATTR_MODEL -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MODEL, "TKDPO4K_ATTR_MODEL",
                                       instrModelNo,
                                       IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_DONT_CHECK_STATUS,
                                       VI_NULL, VI_NULL, &attrModelRangeTable));
                
        /*- TKDPO4K_ATTR_DATA_WIDTH -*/                
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DATA_WIDTH,
                                       "TKDPO4K_ATTR_DATA_WIDTH", 1, IVI_VAL_HIDDEN,
                                       tkdpo4kAttrDataWidth_ReadCallback,
                                       tkdpo4kAttrDataWidth_WriteCallback, VI_NULL));
                                       
        /*- TKDPO4K_ATTR_DATA_START_POS -*/                                    
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DATA_START_POS,
                                       "TKDPO4K_ATTR_DATA_START_POS", 0,
                                       IVI_VAL_HIDDEN,
                                       tkdpo4kAttrDataStartPos_ReadCallback,
                                       tkdpo4kAttrDataStartPos_WriteCallback,
                                       VI_NULL));
                                       
        /*- TKDPO4K_ATTR_DATA_STOP_POS -*/  
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DATA_STOP_POS,
                                       "TKDPO4K_ATTR_DATA_STOP_POS", 10000,
                                       IVI_VAL_HIDDEN,
                                       tkdpo4kAttrDataStopPos_ReadCallback,
                                       tkdpo4kAttrDataStopPos_WriteCallback, VI_NULL));
                                       
        /*- TKDPO4K_ATTR_FETCH_BUFFER_SIZE -*/                                     
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FETCH_BUFFER_SIZE,
                                       "TKDPO4K_ATTR_FETCH_BUFFER_SIZE", 10000, 0,
                                       VI_NULL, VI_NULL,
                                       &attrFetchBufferSizeRangeTable));
                                       
        /*- TKDPO4K_ATTR_DATA_YZERO -*/                                    
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DATA_YZERO,
                                        "TKDPO4K_ATTR_DATA_YZERO", 0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_HIDDEN,
                                        tkdpo4kAttrDataYZero_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
                                        
        /*- TKDPO4K_ATTR_DATA_YOFF -*/                                     
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DATA_YOFF,
                                        "TKDPO4K_ATTR_DATA_YOFF", 0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_HIDDEN,
                                        tkdpo4kAttrDataYoff_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
                                        
        /*- TKDPO4K_ATTR_DATA_YMULT -*/                                    
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DATA_YMULT,
                                        "TKDPO4K_ATTR_DATA_YMULT", 1.0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_HIDDEN,
                                        tkdpo4kAttrDataYmult_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
                                        
        /*- TKDPO4K_ATTR_DATA_XINCR -*/                                     
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DATA_XINCR,
                                        "TKDPO4K_ATTR_DATA_XINCR", 0, IVI_VAL_HIDDEN,
                                        tkdpo4kAttrDataXincr_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
                                        
        /*- TKDPO4K_ATTR_DATA_XZERO -*/                                     
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DATA_XZERO,
                                        "TKDPO4K_ATTR_DATA_XZERO", 0,
                                        IVI_VAL_HIDDEN,
                                        tkdpo4kAttrDataXzero_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
                                        
        /*- TKDPO4K_ATTR_WAVEFORM_SIZE -*/                                      
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_WAVEFORM_SIZE,
                                       "TKDPO4K_ATTR_WAVEFORM_SIZE", 0,
                                       IVI_VAL_NOT_USER_WRITABLE, VI_NULL, VI_NULL,
                                       VI_NULL));
        /*- TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN,
                                        "TKDPO4K_ATTR_TRIGGER_LEVEL_ON_AUXIN", 0, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback, VI_NULL, 0));
    
       /*- TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING,
                                       "TKDPO4K_ATTR_FASTACQ_WAVEFORM_GRADING",
                                       TKDPO4K_VAL_WAVEFORM_GRADING_TEMPERATURE, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrWaveformGradingRangeTable));
    
       /*- TKDPO4K_ATTR_FASTACQ_STATE -*/ 
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_FASTACQ_STATE,
                                         "TKDPO4K_ATTR_FASTACQ_STATE", VI_FALSE, 0,
                                         tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));

      /*- TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY -*/   
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY,
                                         "TKDPO4K_ATTR_MATH_EXPRESSION_DISPLAY",
                                         VI_TRUE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    
      /*- TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE -*/   
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE,
                                        "TKDPO4K_ATTR_SNAPSHOT_MEAS_VALUE", 0,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    
      /*- TKDPO4K_ATTR_RF_PHASE_IN_DEGREES -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_PHASE_IN_DEGREES,
                                       "TKDPO4K_ATTR_RF_PHASE_IN_DEGREES", 0, 0,
                                       tkdpo4kViInt32_ReadCallback,
                                       tkdpo4kViInt32_WriteCallback,
                                       &attrRFPhaseDegreesRangTable));

      /*- TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM -*/  
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM,
                                       "TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM", 180,
                                       0, tkdpo4kViInt32_ReadCallback,
                                       tkdpo4kViInt32_WriteCallback,
                                       &attrRFPhaseWrapDegreesNumRangTable));
    checkErr (Ivi_SetAttrCoerceCallbackViInt32 (vi, TKDPO4K_ATTR_RF_PHASE_WRAP_DEGREES_NUM,
                                                tkdpo4kAttrRfPhaseTraceDegreesNum_CoerceCallback));
    
      /*- TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE -*/  
    checkErr (Ivi_AddAttributeViBoolean (vi,
                                         TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE,
                                         "TKDPO4K_ATTR_RF_PHASE_WRAP_CONTROL_STATE",
                                         VI_TRUE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    
      /*- TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH -*/
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH,
                                        "TKDPO4K_ATTR_RF_VERSUS_TIME_BANDWIDTH", 0,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    
      /*- TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP,
                                       "TKDPO4K_ATTR_RF_SPECTROGRAM_TIME_STAMP", 0,
                                       IVI_VAL_NOT_USER_WRITABLE,
                                       tkdpo4kViInt32_ReadCallback, VI_NULL, VI_NULL));
    
      /*- TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM,
                                       "TKDPO4K_ATTR_RF_SPECTROGRAM_SECONDS_NUM", 0,
                                       IVI_VAL_NOT_USER_WRITABLE,
                                       tkdpo4kViInt32_ReadCallback, VI_NULL, VI_NULL));
    
      /*- TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT -*/
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT,
                                       "TKDPO4K_ATTR_RF_IQ_DATA_FILE_FORMAT",
                                       TKDPO4K_VAL_FILE_FORMAT_TIQ, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrRFIQDataFileFormatRangTable));

    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FUNC_WAVEFORM,
                                       "TKDPO4K_ATTR_FUNC_WAVEFORM",
                                       TKDPO4K_VAL_WFM_SINE, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrFunctionWaveformRangeTable));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_AMPLITUDE,
                                        "TKDPO4K_ATTR_FUNC_AMPLITUDE", 0.5, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionAmplitudeSincHighzRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_AMPLITUDE,
                                                 tkdpo4kAttrFuncAmplitude_CoerceCallback));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_FUNC_AMPLITUDE,
                                             tkdpo4kAttrFuncAmplitude_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_FREQUENCY,
                                        "TKDPO4K_ATTR_FUNC_FREQUENCY", 1e5, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionFrequencySineRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_FREQUENCY,
                                                 tkdpo4kAttrFuncFrequency_CoerceCallback));
    checkErr (Ivi_SetAttrRangeTableCallback(vi, TKDPO4K_ATTR_FUNC_FREQUENCY,
                                            tkdpo4kAttrFuncFrequency_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_START_PHASE,
                                        "TKDPO4K_ATTR_FUNC_START_PHASE", 0, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionStartPhaseRangeTable, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_HIGH_LEVEL,
                                        "TKDPO4K_ATTR_FUNC_HIGH_LEVEL", 0.25, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionHighLevelSineHighzRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_HIGH_LEVEL,
                                                 tkdpo4kAttrFuncHighLevel_CoerceCallback));
    checkErr (Ivi_SetAttrRangeTableCallback(vi, TKDPO4K_ATTR_FUNC_HIGH_LEVEL,
                                            tkdpo4kAttrFuncHighLevel_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_LOW_LEVEL,
                                        "TKDPO4K_ATTR_FUNC_LOW_LEVEL", -0.25, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionLowLevelSineHighzRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_LOW_LEVEL,
                                                 tkdpo4kAttrFuncLowLevel_CoerceCallback));
    checkErr (Ivi_SetAttrRangeTableCallback(vi, TKDPO4K_ATTR_FUNC_LOW_LEVEL,
                                            tkdpo4kAttrFuncLowLevel_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_DC_OFFSET,
                                        "TKDPO4K_ATTR_FUNC_DC_OFFSET", 0, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionDCOffsetHighzRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_DC_OFFSET,
                                                 tkdpo4kAttrFuncDcOffset_CoerceCallback));
    checkErr (Ivi_SetAttrRangeTableCallback(vi, TKDPO4K_ATTR_FUNC_DC_OFFSET,
                                            tkdpo4kAttrFuncDcOffset_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH,
                                        "TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH", 50, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionDutyCycleHighRangeTable, 0));
    checkErr (Ivi_SetAttrCoerceCallbackViReal64 (vi, TKDPO4K_ATTR_FUNC_DUTY_CYCLE_HIGH,
                                                 tkdpo4kAttrFuncDutyCycleHigh_CoerceCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_PERIOD,
                                        "TKDPO4K_ATTR_FUNC_PERIOD", 1e-5,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback, VI_NULL, 0));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FUNC_PRESET_LEVEL,
                                       "TKDPO4K_ATTR_FUNC_PRESET_LEVEL",
                                       TKDPO4K_VAL_FUNC_LEVEL_USER, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrFunctionPresetLevelRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_FUNC_NOISE_LEVEL,
                                       "TKDPO4K_ATTR_FUNC_NOISE_LEVEL", 0, 0,
                                       tkdpo4kViInt32_ReadCallback,
                                       tkdpo4kViInt32_WriteCallback,
                                       &attrFunctionNoiseLevelRangeTable));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_FUNC_NOISE_ENABLED,
                                         "TKDPO4K_ATTR_FUNC_NOISE_ENABLED", VI_FALSE,
                                         0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_PULSE_WIDTH,
                                        "TKDPO4K_ATTR_FUNC_PULSE_WIDTH", 1e-6,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback, VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_FUNC_RAMP_SYMMETRY,
                                        "TKDPO4K_ATTR_FUNC_RAMP_SYMMETRY", 50, 0,
                                        tkdpo4kViReal64_ReadCallback,
                                        tkdpo4kViReal64_WriteCallback,
                                        &attrFunctionRampSymmetryRangeTable, 0));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_OUTPUT_ENABLED,
                                         "TKDPO4K_ATTR_OUTPUT_ENABLED", VI_FALSE, 0,
                                         tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_OUTPUT_IMPEDANCE,
                                       "TKDPO4K_ATTR_OUTPUT_IMPEDANCE",
                                       TKDPO4K_VAL_FUNC_OUTPUT_IMPEDANCE_HIGHZ, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrOutputImpedanceRangeTable));
    checkErr (Ivi_AddRepeatedAttributeViString(vi, WAVEFORMSLOT_REP_CAP_NAME, TKDPO4K_ATTR_ARB_WAVEFORM_DATE,
                                               "TKDPO4K_ATTR_ARB_WAVEFORM_DATE", VI_NULL, 
                                               IVI_VAL_NOT_USER_WRITABLE,
                                               tkdpo4kViString_ReadCallback,
                                               VI_NULL));
    checkErr (Ivi_AddRepeatedAttributeViString(vi, WAVEFORMSLOT_REP_CAP_NAME, TKDPO4K_ATTR_ARB_WAVEFORM_TIME,
                                               "TKDPO4K_ATTR_ARB_WAVEFORM_TIME", VI_NULL,
                                               IVI_VAL_NOT_USER_WRITABLE,
                                               tkdpo4kViString_ReadCallback,
                                               VI_NULL));
    checkErr (Ivi_AddRepeatedAttributeViString(vi, WAVEFORMSLOT_REP_CAP_NAME, TKDPO4K_ATTR_ARB_WAVEFORM_LABEL,
                                               "TKDPO4K_ATTR_ARB_WAVEFORM_LABEL", "",
                                               0 ,tkdpo4kViString_ReadCallback,
                                               tkdpo4kAttrARBWaveformLabel_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi,
                                        TKDPO4K_ATTR_ARB_WAVEFORM_PREDEFINED_FUNCTION,
                                        "TKDPO4K_ATTR_ARB_WAVEFORM_PREDEFINED_FUNCTION",
                                        VI_NULL, IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViString_ReadCallback, VI_NULL));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ARB_WAVEFORM_POINT_NUMBER,
                                       "TKDPO4K_ATTR_ARB_WAVEFORM_POINT_NUMBER",
                                       VI_NULL, IVI_VAL_NOT_USER_WRITABLE,
                                       tkdpo4kViInt32_ReadCallback, VI_NULL, VI_NULL));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ARB_WAVEFORM_POINTS,
                                        "TKDPO4K_ATTR_ARB_WAVEFORM_POINTS", "", 0,
                                        tkdpo4kViString_ReadCallback,
                                        tkdpo4kViString_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ARB_WAVEFORM_HANDLE,
                                       "TKDPO4K_ATTR_ARB_WAVEFORM_HANDLE", VI_NULL,
                                       IVI_VAL_NEVER_CACHE, VI_NULL, VI_NULL,
                                       VI_NULL));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_WAVEFORM_QUANTUM,
                                       "TKDPO4K_ATTR_WAVEFORM_QUANTUM",
                                       TKDPO4K_VAL_WAVEFORMS_QUANTUM,
                                       IVI_VAL_NOT_USER_WRITABLE, VI_NULL, VI_NULL,
                                       VI_NULL));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MIN_WAVEFORM_SIZE,
                                       "TKDPO4K_ATTR_MIN_WAVEFORM_SIZE",
                                       TKDPO4K_VAL_MIN_WAVEFORM_SIZE,
                                       IVI_VAL_NOT_USER_WRITABLE, VI_NULL, VI_NULL,
                                       VI_NULL));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MAX_WAVEFORM_SIZE,
                                       "TKDPO4K_ATTR_MAX_WAVEFORM_SIZE",
                                       TKDPO4K_VAL_MAX_WAVEFORM_SIZE,
                                       IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_USE_CALLBACKS_FOR_SIMULATION,
                                       VI_NULL, VI_NULL, VI_NULL));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MAX_NUM_WAVEFORMS,
                                       "TKDPO4K_ATTR_MAX_NUM_WAVEFORMS",
                                       TKDPO4K_VAL_MAX_WAVEFORMS,
                                       IVI_VAL_NOT_USER_WRITABLE, VI_NULL, VI_NULL,
                                       VI_NULL));
    checkErr (Ivi_AddAttributeViAddr (vi, TKDPO4K_ATTR_WFM_STRUCTURE,
                                      "TKDPO4K_ATTR_WFM_STRUCTURE", VI_NULL,
                                      IVI_VAL_HIDDEN, VI_NULL, VI_NULL));
    checkErr( tkdpo4k_CreateArbRecords(vi));  
    
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_DVM_RANGE_AUTO_ENABLED,
                                         "TKDPO4K_ATTR_DVM_RANGE_AUTO_ENABLED",
                                         VI_FALSE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DVM_TYPE,
                                       "TKDPO4K_ATTR_DVM_TYPE",
                                       TKDPO4K_VAL_DVM_TYPE_OFF, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrDVMTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_DVM_SOURCE,
                                       "TKDPO4K_ATTR_DVM_SOURCE",
                                       TKDPO4K_VAL_DVM_SOURCE_CH1, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrDVMSourceRangeTable));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_FREQUENCY,
                                        "TKDPO4K_ATTR_DVM_FREQUENCY", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_HISTORY_AVERAGE,
                                        "TKDPO4K_ATTR_DVM_HISTORY_AVERAGE", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_HISTORY_MAXIMUM,
                                        "TKDPO4K_ATTR_DVM_HISTORY_MAXIMUM", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_HISTORY_MINIMUM,
                                        "TKDPO4K_ATTR_DVM_HISTORY_MINIMUM", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_MAX_RESULE,
                                        "TKDPO4K_ATTR_DVM_MAX_RESULE", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_MIN_RESULT,
                                        "TKDPO4K_ATTR_DVM_MIN_RESULT", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_DVM_RESULT,
                                        "TKDPO4K_ATTR_DVM_RESULT", VI_NULL,
                                        IVI_VAL_NOT_USER_WRITABLE,
                                        tkdpo4kViReal64_ReadCallback, VI_NULL,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_AUX_OUT_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_AUX_OUT_EVENT_ENABLED",
                                         VI_FALSE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_PRINT_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_PRINT_EVENT_ENABLED",
                                         VI_FALSE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_SAVE_IMAGE_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_SAVE_IMAGE_EVENT_ENABLED",
                                         VI_FALSE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi,
                                         TKDPO4K_ATTR_SAVE_WAVEFORM_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_SAVE_WAVEFORM_EVENT_ENABLED",
                                         VI_FALSE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_SRQ_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_SRQ_EVENT_ENABLED", VI_FALSE,
                                         0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi,
                                         TKDPO4K_ATTR_STOP_ACQUISITION_EVENT_ENABLED,
                                         "TKDPO4K_ATTR_STOP_ACQUISITION_EVENT_ENABLED",
                                         VI_TRUE, 0, tkdpo4kViBoolean_ReadCallback,
                                         tkdpo4kViBoolean_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_EVENT_REPEAT_COUNT,
                                       "TKDPO4K_ATTR_EVENT_REPEAT_COUNT", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kViInt32_ReadCallback,
                                       tkdpo4kViInt32_WriteCallback,
                                       &attrEventRepeatCountRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_EVENT_TRIGGER_TYPE,
                                       "TKDPO4K_ATTR_EVENT_TRIGGER_TYPE",
                                       TKDPO4K_VAL_EVENT_TRIGGER_TYPE_NONE, 0,
                                       tkdpo4kEnum_ReadCallback,
                                       tkdpo4kEnum_WriteCallback,
                                       &attrEventTriggerTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ACQUISITION_NUMBER,
                                       "TKDPO4K_ATTR_ACQUISITION_NUMBER", 1, 0,
                                       tkdpo4kViInt32_ReadCallback,
                                       tkdpo4kViInt32_WriteCallback,
                                       &attrAcquisitionNumberRangeTable));
    checkErr (Ivi_SetAttrCoerceCallbackViInt32 (vi, TKDPO4K_ATTR_ACQUISITION_NUMBER,
                                                tkdpo4kAttrAcquisitionNumber_CoerceCallback)); 
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_AFG_ENABLED,
                                         "TKDPO4K_ATTR_AFG_ENABLED", VI_NULL,
                                         IVI_VAL_NOT_USER_WRITABLE,
                                         tkdpo4kViBoolean_ReadCallback, VI_NULL));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_ARB_ENABLED,
                                         "TKDPO4K_ATTR_ARB_ENABLED", VI_NULL,
                                         IVI_VAL_NOT_USER_WRITABLE,
                                         tkdpo4kViBoolean_ReadCallback, VI_NULL));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_DVM_ENABLED,
                                         "TKDPO4K_ATTR_DVM_ENABLED", VI_NULL,
                                         IVI_VAL_NOT_USER_WRITABLE,
                                         tkdpo4kViBoolean_ReadCallback, VI_NULL));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_CUSTOM_MASK_ENABLED,
                                         "TKDPO4K_ATTR_CUSTOM_MASK_ENABLED", VI_NULL,
                                         IVI_VAL_NOT_USER_WRITABLE,
                                         tkdpo4kViBoolean_ReadCallback, VI_NULL));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_STANDARD_MASK_ENABLED,
                                         "TKDPO4K_ATTR_STANDARD_MASK_ENABLED",
                                         VI_NULL, IVI_VAL_NOT_USER_WRITABLE,
                                         tkdpo4kViBoolean_ReadCallback, VI_NULL));
    
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_UPPER_THRESHOLD,
                                        "TKDPO4K_ATTR_UPPER_THRESHOLD", 0.0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrUpperThreshold_ReadCallback,
                                        tkdpo4kAttrUpperThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_UPPER_THRESHOLD,
                                                tkdpo4kAttrUpperThreshold_CheckCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_LOWER_THRESHOLD,
                                        "TKDPO4K_ATTR_LOWER_THRESHOLD", 0.0,
                                        IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrLowerThreshold_ReadCallback,
                                        tkdpo4kAttrLowerThreshold_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_LOWER_THRESHOLD,
                                                tkdpo4kAttrLowerThreshold_CheckCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_TYPE,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_TYPE",
                                       TKDPO4K_VAL_ENET_ENET10BASET,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetType_ReadCallback,
                                       tkdpo4kAttrBusEthernetType_WriteCallback,
                                       &attrBusEthernetTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE",
                                       TKDPO4K_VAL_ENET_PROBE_DIFF,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetProbeType_ReadCallback,
                                       tkdpo4kAttrBusEthernetProbeType_WriteCallback,
                                       &attrBusEthernetProbeTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC",
                                       TKDPO4K_VAL_ENET_PLUS_DATA_CH1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetPlusDataSrc_ReadCallback,
                                       tkdpo4kAttrBusEthernetPlusDataSrc_WriteCallback,
                                       &attrBusEthernetPlusDataSourceRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi,
                                       TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC",
                                       TKDPO4K_VAL_ENET_DIFF_INPUT_DATA_SRC_CH1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetDiffInputDataSrc_ReadCallback,
                                       tkdpo4kAttrBusEthernetDiffInputDataSrc_WriteCallback,
                                       &attrBusEthernetDiffInputDataSourceRangeTable));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_BUS_ETHERNET_DIFF_INPUT_DATA_SRC,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC",
                                       TKDPO4K_VAL_ENET_MINUS_DATA_SRC_CH1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetMinusDataSrc_ReadCallback,
                                       tkdpo4kAttrBusEthernetMinusDataSrc_WriteCallback,
                                       &attrBusEthernetMinusDataSourceRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL,
                                       "TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL",
                                       TKDPO4K_VAL_ENET_PROT_IPV4,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrBusEthernetProtocol_ReadCallback,
                                       tkdpo4kAttrBusEthernetProtocol_WriteCallback,
                                       &attrBusEthernetProtocolRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_FIELD,
                                       "TKDPO4K_ATTR_USB_TRAN_FIELD",
                                       TKDPO4K_VAL_USB_NOCARE, IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrUsbTranField_ReadCallback,
                                       tkdpo4kAttrUsbTranField_WriteCallback,
                                       &attrUSBSplitTranFieldRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_START_END,
                                       "TKDPO4K_ATTR_USB_TRAN_START_END",
                                       TKDPO4K_VAL_USB_START_END_NOCARE,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrUsbTranStartEnd_ReadCallback,
                                       tkdpo4kAttrUsbTranStartEnd_WriteCallback,
                                       &attrUSBSplitTranStartEndRangeTable));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_START_END,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_END_POINT,
                                       "TKDPO4K_ATTR_USB_TRAN_END_POINT",
                                       TKDPO4K_VAL_USB_END_NOCARE,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrUsbTranEndPoint_ReadCallback,
                                       tkdpo4kAttrUsbTranEndPoint_WriteCallback,
                                       &attrUSBSplitTranEndpointRangeTable));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_USB_HUB_ADDRESS,
                                        "TKDPO4K_ATTR_USB_HUB_ADDRESS", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrUsbHubAdd_ReadCallback,
                                        tkdpo4kAttrUsbHubAdd_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_USB_PORT_ADDRESS,
                                        "TKDPO4K_ATTR_USB_PORT_ADDRESS", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrUsbPortAdd_ReadCallback,
                                        tkdpo4kAttrUsbPortAdd_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE,
                                       "TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE",
                                       TKDPO4K_VAL_ENET_BASIC_FRAME_BAS,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrEnetBasicFrameType_ReadCallback,
                                       tkdpo4kAttrEnetBasicFrameType_WriteCallback,
                                       &attrEnetTriggerBasicFrameTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ENET_BASIC_CONDITION,
                                       "TKDPO4K_ATTR_ENET_BASIC_CONDITION",
                                       TKDPO4K_VAL_ENET_BASIC_CONDITION_SFD,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrEnetBasicCondition_ReadCallback,
                                       tkdpo4kAttrEnetBasicCondition_WriteCallback,
                                       &attrEnetTriggerBasicConditionRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ENET_BASIC_QUALIFIER,
                                       "TKDPO4K_ATTR_ENET_BASIC_QUALIFIER",
                                       TKDPO4K_VAL_ENET_BASIC_QUALIFIER_LESST,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrEnetBasicQualifier_ReadCallback,
                                       tkdpo4kAttrEnetBasicQualifier_WriteCallback,
                                       &attrEnetTriggerBasicQualifierRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ENET_DATA_SIZE,
                                       "TKDPO4K_ATTR_ENET_DATA_SIZE", 1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrEnetDataSize_ReadCallback,
                                       tkdpo4kAttrEnetDataSize_WriteCallback,
                                       &attrEnetTriggerDataSizeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_ENET_DATA_OFFSET,
                                       "TKDPO4K_ATTR_ENET_DATA_OFFSET", -1,
                                       IVI_VAL_NEVER_CACHE,
                                       tkdpo4kAttrEnetDataOffset_ReadCallback,
                                       tkdpo4kAttrEnetDataOffse_WriteCallback,
                                       &attrEnetTriggerDataOffsetRangeTable));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT,
                                        "TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetDataUppLimit_ReadCallback,
                                        tkdpo4kAttrEnetDataUppLimit_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_DATA,
                                        "TKDPO4K_ATTR_ENET_DATA", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetData_ReadCallback,
                                        tkdpo4kAttrEnetData_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetIPSrcAddr_ReadCallback,
                                        tkdpo4kAttrEnetIPSrcAddr_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_IP_DST_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_IP_DST_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetIPDstAddr_ReadCallback,
                                        tkdpo4kAttrEnetIPDstAddr_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_MAC_SRC_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_MAC_SRC_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetMACSrcAddr_ReadCallback,
                                        tkdpo4kAttrEnetMACSrcAddr_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_MAC_SRC_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_MAC_DST_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_MAC_DST_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetMACDstAddr_ReadCallback,
                                        tkdpo4kAttrEnetMACDstAddr_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH,
                                        "TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetMACUppLength_ReadCallback,
                                        tkdpo4kAttrEnetMACUppLength_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_MAC_UPPER_LENGTH,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_MAC_LENGTH,
                                        "TKDPO4K_ATTR_ENET_MAC_LENGTH", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetMACLength_ReadCallback,
                                        tkdpo4kAttrEnetMACLength_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_QTAG,
                                        "TKDPO4K_ATTR_ENET_QTAG", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetQtagValue_ReadCallback,
                                        tkdpo4kAttrEnetQtagValue_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER,
                                        "TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetTcpSequenceNumber_ReadCallback,
                                        tkdpo4kAttrEnetTcpSequenceNumber_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_TCP_SEQUENCE_NUMBER,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER,
                                        "TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetTcpAcqNumber_ReadCallback,
                                        tkdpo4kAttrEnetTcpAcqNumber_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_TCP_ACQ_NUMBER,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetTcpSrcAddr_ReadCallback,
                                        tkdpo4kAttrEnetTcpSrcAddr_WriteCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_TCP_SRC_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS,
                                        "TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS",
                                        "XXXXXXX", IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetTcpDstAddr_ReadCallback,
                                        tkdpo4kAttrEnetTcpDstAddr_WriteCallback));
    checkErr (Ivi_AddAttributeViString (vi, TKDPO4K_ATTR_ENET_IP_PROTOCOL,
                                        "TKDPO4K_ATTR_ENET_IP_PROTOCOL", "XXXXXXX",
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrEnetIPProtocol_ReadCallback,
                                        tkdpo4kAttrEnetIPProtocol_WriteCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_RF_SOURCE_1ST,
                                       "TKDPO4K_ATTR_MATH_RF_SOURCE_1ST",
                                       TKDPO4K_VAL_RFSOUR_NORMAL,
                                       IVI_VAL_NOT_USER_READABLE, VI_NULL, VI_NULL,
                                       &attrMathRefSourceRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_MATH_RF_SOURCE_2ND,
                                       "TKDPO4K_ATTR_MATH_RF_SOURCE_2ND",
                                       TKDPO4K_VAL_RFSOUR_AVERAGE,
                                       IVI_VAL_NOT_USER_READABLE, VI_NULL, VI_NULL,
                                       &attrMathRefSourceRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_NUM_AVERAGES,
                                       "TKDPO4K_ATTR_RF_NUM_AVERAGES", 16, 0,
                                       tkdpo4kAttrInt32HasEntry_ReadCallback,
                                       tkdpo4kAttrInt32HasEntry_WriteCallback,
                                       &attrNumAveragesRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_AVERAGE_TRACE_COUNT,
                                       "TKDPO4K_ATTR_RF_AVERAGE_TRACE_COUNT", 0,
                                       IVI_VAL_NOT_USER_WRITABLE,
                                       tkdpo4kAttrInt32HasEntry_ReadCallback,
                                       VI_NULL, VI_NULL));
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_DETECTION_METHOD,
	                                   "TKDPO4K_ATTR_RF_DETECTION_METHOD",
	                                   TKDPO4K_VAL_RF_DETECTION_POS_PEAK,
	                                   IVI_VAL_MULTI_CHANNEL | IVI_VAL_NEVER_CACHE,
	                                   tkdpo4kStdViInt32_ReadCallback,
	                                   tkdpo4kStdViInt32_WriteCallback,
	                                   &attrRfDetectionMethodRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_DETECTION_METHOD,
	                                         tkdpo4kAttrRfDetectionMethod_RangeTableCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_RF_DETECTION_METHOD,
                                               tkdpo4kAttrRfDetectionMethod_CheckCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_DETECTION_MODE,
	                                   "TKDPO4K_ATTR_RF_DETECTION_MODE", 0, 0,
	                                   tkdpo4kStdViInt32_ReadCallback,
	                                   tkdpo4kStdViInt32_WriteCallback,
	                                   &attrRfDetectionModeRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_DETECTION_MODE,
	                                         tkdpo4kAttrRfDetectionMode_RangeTableCallback));
    checkErr (Ivi_AddAttributeViBoolean (vi, TKDPO4K_ATTR_RF_SQUELCH_STATE,
                                         "TKDPO4K_ATTR_RF_SQUELCH_STATE", VI_FALSE,
                                         0, tkdpo4kAttrBooleanHasEntry_ReadCallback,
                                         tkdpo4kAttrBooleanHasEntry_WriteCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_SQUELCH_THRESHOLD,
                                        "TKDPO4K_ATTR_RF_SQUELCH_THRESHOLD", 0.22, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfSquelchThresholdRangeTable, 0));
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_SPECTRUM_MODE,
	                                   "TKDPO4K_ATTR_RF_SPECTRUM_MODE",
	                                   TKDPO4K_VAL_RF_SPECTRUM_FREERUN, 0,
	                                   tkdpo4kStdViInt32_ReadCallback,
	                                   tkdpo4kStdViInt32_WriteCallback,
	                                   &attrRfSpectrumModeRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_SPECTRUM_MODE,
	                                         tkdpo4kAttrRfSpectrumMode_RangeTableCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_RF_SPECTRUM_MODE,
                                               tkdpo4kAttrRfSpectrumMode_CheckCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_RBW,
                                        "TKDPO4K_ATTR_RF_RBW", 3000000, 0,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfRbwRangeTable, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RF_RBW,
                                                tkdpo4kAttrRfRbw_CheckCallback));
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_RBW_MODE,
	                                   "TKDPO4K_ATTR_RF_RBW_MODE",
	                                   TKDPO4K_VAL_RF_RBW_MODE_AUTO, 0,
	                                   tkdpo4kStdViInt32_ReadCallback,
	                                   tkdpo4kStdViInt32_WriteCallback,
	                                   &attrRfRbwModeRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_RBW_MODE,
	                                         tkdpo4kAttrRfRbwMode_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_SPAN_RBW_RATIO,
                                        "TKDPO4K_ATTR_RF_SPAN_RBW_RATIO", 1000, 0,
                                        tkdpo4kAttrReal64HasEntry_ReadCallback,
                                        tkdpo4kAttrReal64HasEntry_WriteCallback,
                                        VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_START,
                                        "TKDPO4K_ATTR_RF_FREQ_START", 0,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfFreqStartRangeTable, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_START,
                                                tkdpo4kAttrRfFreqStartStop_CheckCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_STOP,
                                        "TKDPO4K_ATTR_RF_FREQ_STOP", 3000000000,
                                        IVI_VAL_ALWAYS_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfFreqStopRangeTable, 0));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_REF_LEVEL,
                                       "TKDPO4K_ATTR_RF_REF_LEVEL", 0, 0,
                                       tkdpo4kAttrRfRefLevel_ReadCallback,
                                       tkdpo4kAttrRfRefLevel_WriteCallback,
                                       &attrRfRefLevelRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_UNITS,
                                       "TKDPO4K_ATTR_RF_UNITS",
                                       TKDPO4K_VAL_RF_UNITS_DBM, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrRfUnitsRangeTable));
	checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_FFT_WINDOW,
	                                   "TKDPO4K_ATTR_RF_FFT_WINDOW",
	                                   TKDPO4K_VAL_FFT_WINDOW_KAISER, 0,
	                                   tkdpo4kStdViInt32_ReadCallback,
	                                   tkdpo4kStdViInt32_WriteCallback,
	                                   &attrRfFftWindowRangeTable));
	checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_FFT_WINDOW,
	                                         tkdpo4kAttrRfFftWindow_RangeTableCallback));
    checkErr (Ivi_AddAttributeViInt32 (vi, TKDPO4K_ATTR_RF_MEASURE_TYPE,
                                       "TKDPO4K_ATTR_RF_MEASURE_TYPE",
                                       TKDPO4K_VAL_RF_MEASURE_TYPE_NONE, 0,
                                       tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrRfMeasureTypeRangeTable));
    checkErr (Ivi_AddAttributeViInt32 (vi,
                                       TKDPO4K_ATTR_RF_MEASURE_ACPR_ADJACENTPAIRS,
                                       "TKDPO4K_ATTR_RF_MEASURE_ACPR_ADJACENTPAIRS",
                                       1, 0, tkdpo4kStdViInt32_ReadCallback,
                                       tkdpo4kStdViInt32_WriteCallback,
                                       &attrRfMeasureAcprAdjacentpairsRangeTable));
    checkErr (Ivi_AddAttributeViReal64 (vi,
                                        TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING,
                                        "TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING",
                                        5000000, IVI_VAL_NEVER_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfACPRChannelSpacingRangeTable, 0));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi,
                                                TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING,
                                                tkdpo4kAttrRfMeasureAcprChannelSpacing_CheckCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi,
                                        TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,
                                        "TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH",
                                        1000000, IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrRfMeasureChannelBandwidth_ReadCallback,
                                        tkdpo4kAttrRfMeasureChannelBandwidth_WriteCallback,
                                        &attrRfChannelBandwidth3GRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi,
                                             TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,
                                             tkdpo4kAttrRfMeasureChannelBandwidth_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_MEASURE_CHANNEL_POWER,
                                        "TKDPO4K_ATTR_RF_MEASURE_CHANNEL_POWER", 0,
                                        IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrRfMeasureChannelPower_ReadCallback,
                                        VI_NULL, VI_NULL, 0));
    checkErr (Ivi_AddRepeatedAttributeViReal64 (vi, RF_ACPR_RATIO_REP_CAP_NAME,
                                                TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO,
                                                "TKDPO4K_ATTR_RF_MEASURE_ACPR_RATIO",
                                                1,
                                                IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE,
                                                tkdpo4kAttrReal64HasEntry_ReadCallback,
                                                VI_NULL, VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_MEASURE_OBW_PERCENT_DOWN,
                                        "TKDPO4K_ATTR_RF_MEASURE_OBW_PERCENT_DOWN",
                                        99, 0, tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfMeasurePowerPercentageRangeTable, 0.1));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ,
                                        "TKDPO4K_ATTR_RF_MEASURE_OBW_LOW_FREQ", 0,
                                        IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrReal64HasEntry_ReadCallback,
                                        VI_NULL, VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ,
                                        "TKDPO4K_ATTR_RF_MEASURE_OBW_HIGH_FREQ", 3e9,
                                        IVI_VAL_NOT_USER_WRITABLE | IVI_VAL_NEVER_CACHE,
                                        tkdpo4kAttrReal64HasEntry_ReadCallback,
                                        VI_NULL, VI_NULL, 0));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_CENTER,
                                        "TKDPO4K_ATTR_RF_FREQ_CENTER", 1500000000,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfFreqCenter6GRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_FREQ_CENTER,
                                             tkdpo4kAttrRfFreqCenter_RangeTableCallback));
    checkErr (Ivi_AddAttributeViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_SPAN,
                                        "TKDPO4K_ATTR_RF_FREQ_SPAN", 3000000000,
                                        IVI_VAL_NEVER_CACHE,
                                        tkdpo4kStdViReal64_ReadCallback,
                                        tkdpo4kStdViReal64_WriteCallback,
                                        &attrRfFreqSpan6GRangeTable, 0));
    checkErr (Ivi_SetAttrRangeTableCallback (vi, TKDPO4K_ATTR_RF_FREQ_SPAN,
                                             tkdpo4kAttrRfFreqSpan_RangeTableCallback));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi,
                                                TKDPO4K_ATTR_RF_MEASURE_OBW_PERCENT_DOWN,
                                                tkdpo4kAttrRfMeasureObwPercentDown_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_RF_MEASURE_ACPR_ADJACENTPAIRS,
                                               tkdpo4kAttrRfMeasureAcprAdjacentpairs_CheckCallback));
    checkErr (Ivi_SetAttrCoerceCallbackViInt32 (vi, TKDPO4K_ATTR_RF_REF_LEVEL,
                                                tkdpo4kAttrRfRefLevel_CoerceCallback));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RF_FREQ_STOP,
                                                tkdpo4kAttrRfFreqStartStop_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViReal64 (vi, TKDPO4K_ATTR_RF_SPAN_RBW_RATIO,
                                                tkdpo4kAttrRfSpanRbwRatio_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_IP_PROTOCOL,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_TCP_DST_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_QTAG,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_MAC_LENGTH,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_MAC_DST_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_IP_DST_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_IP_SRC_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_ENET_DATA,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi,
                                                TKDPO4K_ATTR_ENET_DATA_UPPER_LIMIT,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_ENET_DATA_OFFSET,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_ENET_DATA_SIZE,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_ENET_BASIC_QUALIFIER,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_ENET_BASIC_CONDITION,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_ENET_BASIC_FRAME_TYPE,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_USB_PORT_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViString (vi, TKDPO4K_ATTR_USB_HUB_ADDRESS,
                                                tkdpo4kBModelViString_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_END_POINT,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_USB_TRAN_FIELD,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_BUS_ETHERNET_PROTOCOL,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_BUS_ETHERNET_MINUS_DATA_SRC,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_BUS_ETHERNET_PLUS_DATA_SRC,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi,
                                               TKDPO4K_ATTR_BUS_ETHERNET_PROBE_TYPE,
                                               tkdpo4kBModelViInt32_CheckCallback));
    checkErr (Ivi_SetAttrCheckCallbackViInt32 (vi, TKDPO4K_ATTR_BUS_ETHERNET_TYPE,
                                               tkdpo4kBModelViInt32_CheckCallback));
    
        /*- Setup attribute invalidations -----------------------------------*/
        /*- Acquisition Sub-system ----------------------------------*/
        /*- TKDPO4K_ATTR_INITIATE_CONTINUOUS Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_INITIATE_CONTINUOUS,
                                            TKDPO4K_ATTR_TRIGGER_MODIFIER, VI_TRUE));        
        
        /*- TKDPO4K_ATTR_ACQUISITION_TYPE Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_ACQUISITION_TYPE, 
                                            TKDPO4K_ATTR_SAMPLE_MODE, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_ACQUISITION_TYPE,
                                            TKDPO4K_ATTR_DATA_XINCR, VI_TRUE));
                                            
        /*- TKDPO4K_ATTR_HORZ_MIN_NUM_PTS Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS,
                                            TKDPO4K_ATTR_ACQUISITION_TYPE, VI_TRUE));
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                            TKDPO4K_ATTR_HORZ_SAMPLE_RATE, VI_TRUE));
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS, 
                                            TKDPO4K_ATTR_HORZ_RECORD_LENGTH, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_MIN_NUM_PTS,
                                            TKDPO4K_ATTR_DATA_XINCR, VI_TRUE));
                                            
        /*- TKDPO4K_ATTR_HORZ_RECORD_LENGTH Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_RECORD_LENGTH, 
                                            TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            VI_TRUE));
    
        /*- TKDPO4K_ATTR_HORZ_TIME_PER_RECORD Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            TKDPO4K_ATTR_HORZ_SAMPLE_RATE, VI_TRUE));
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD, 
                                            TKDPO4K_ATTR_ACQUISITION_START_TIME, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_HORZ_TIME_PER_RECORD,
                                            TKDPO4K_ATTR_DATA_XINCR, VI_TRUE));

        /*- TKDPO4K_ATTR_SAMPLE_MODE Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_SAMPLE_MODE,
                                            TKDPO4K_ATTR_DATA_XINCR, VI_TRUE));                                         
                                            
        /*- Channel Sub-system --------------------------------------*/
        /*- TKDPO4K_ATTR_PROBE_ATTENUATION Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_PROBE_ATTENUATION, 
                                            TKDPO4K_ATTR_VERTICAL_RANGE, VI_FALSE));
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_PROBE_ATTENUATION, 
                                            TKDPO4K_ATTR_VERTICAL_OFFSET, VI_FALSE));
                                            
        /*- TKDPO4K_ATTR_VERTICAL_RANGE Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_VERTICAL_RANGE, 
                                            TKDPO4K_ATTR_VERTICAL_OFFSET, VI_FALSE));        
                                            
        /*- TKDPO4K_ATTR_TRIGGER_TYPE Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TRIGGER_TYPE, 
                                            TKDPO4K_ATTR_TRIGGER_SOURCE, VI_TRUE));
                                            
        /*- TKDPO4K_ATTR_TRIGGER_SLOPE Invalidations -*/
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TRIGGER_SLOPE, 
                                            TKDPO4K_ATTR_AC_LINE_TRIGGER_SLOPE, VI_TRUE));

        /*- TKDPO4K_ATTR_TRIGGER_LEVEL Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TRIGGER_LEVEL,
                                            TKDPO4K_ATTR_TRIGGER_LEVEL_BY_CH, VI_TRUE));    

        /*- TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TV_TRIGGER_SIGNAL_FORMAT,
                                            TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER, VI_TRUE));                                            
    
        /*- TKDPO4K_ATTR_TV_TRIGGER_EVENT Invalidations -*/                                            
    checkErr( Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TV_TRIGGER_EVENT, 
                                            TKDPO4K_ATTR_TV_TRIGGER_LINE_NUMBER, VI_TRUE));

        /*- TKDPO4K_ATTR_RUNT_WIDTH Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_RUNT_WIDTH,
                                            TKDPO4K_ATTR_GLITCH_WIDTH, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_RUNT_WIDTH,
                                            TKDPO4K_ATTR_TRANSITION_DELTA_TIME, VI_TRUE));   
   
        /*- TKDPO4K_ATTR_GLITCH_WIDTH Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_GLITCH_WIDTH,
                                            TKDPO4K_ATTR_RUNT_WIDTH, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_GLITCH_WIDTH,
                                            TKDPO4K_ATTR_TRANSITION_DELTA_TIME, VI_TRUE));
                                            
        /*- TKDPO4K_ATTR_TRANSITION_DELTA_TIME Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TRANSITION_DELTA_TIME,
                                            TKDPO4K_ATTR_RUNT_WIDTH, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_TRANSITION_DELTA_TIME, 
                                            TKDPO4K_ATTR_GLITCH_WIDTH, VI_TRUE));
        
        /*- TKDPO4K_ATTR_CAN_DATA_SIZE Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_CAN_DATA_SIZE,
                                            TKDPO4K_ATTR_CAN_DATA_VALUE, VI_TRUE));                                            
                                       
        /*- TKDPO4K_ATTR_CAN_ID_MODE Invalidations -*/                                          
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_CAN_ID_MODE,
                                            TKDPO4K_ATTR_CAN_ID_VALUE, VI_TRUE));                                           
                                            
        /*- TKDPO4K_ATTR_I2C_DATA_SIZE Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_I2C_DATA_SIZE,
                                            TKDPO4K_ATTR_I2C_DATA_VALUE, VI_TRUE));     
                                            
        /*- TKDPO4K_ATTR_I2C_ADDR_MODE Invalidations -*/                                            
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_I2C_ADDR_MODE,
                                            TKDPO4K_ATTR_I2C_ADDR_VALUE, VI_TRUE));                                         
                                            
        /*- TKDPO4K_ATTR_SPI_DATA_SIZE Invalidations -*/                                            
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            TKDPO4K_ATTR_SPI_MOSI_VALUE, VI_TRUE));                                         
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_SPI_DATA_SIZE,
                                            TKDPO4K_ATTR_SPI_MISO_VALUE, VI_TRUE));                                         
        
        /*- TKDPO4K_ATTR_MATH_TYPE Invalidations -*/
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_MATH_TYPE,
                                            TKDPO4K_ATTR_MATH_FUNCTION, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_RF_MEASURE_TYPE,
                                            TKDPO4K_ATTR_RF_DETECTION_METHOD,
                                            VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_RF_MEASURE_TYPE,
                                            TKDPO4K_ATTR_RF_FREQ_START, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi, TKDPO4K_ATTR_RF_MEASURE_TYPE,
                                            TKDPO4K_ATTR_RF_FREQ_STOP, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi,
                                            TKDPO4K_ATTR_RF_MEASURE_ACPR_CHANNEL_SPACING,
                                            TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,
                                            VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi,
                                            TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,
                                            TKDPO4K_ATTR_RF_FREQ_START, VI_TRUE));
    checkErr (Ivi_AddAttributeInvalidation (vi,
                                            TKDPO4K_ATTR_RF_MEASURE_CHANNEL_BANDWIDTH,
                                            TKDPO4K_ATTR_RF_FREQ_STOP, VI_TRUE));
        
        /*- MISCELLANEOUS Invalidations -*/


    /* Restrict for channels */
    {   /* Local scope */
    ViConstString inputChannelList = "CH1,CH2,CH3,CH4";
    ViConstString  inputChListNoRF = "CH1,CH2,CH3,CH4,MATH,REF1,REF2,REF3,REF4";
    ViChar        rfChannelListAll[BUFFER_SIZE] = {0};
    ViChar        digChList[BUFFER_SIZE] = {0};
    ViChar        rfChannelListRFOnly[BUFFER_SIZE] = {0}; 
    ViChar        digRFChList[BUFFER_SIZE] = {0};
    
    sprintf(digChList, "%s,%s", ANALOG_CHANNEL_LIST_4,DIGITAL_CHANNEL_LIST); 
    if( (instrModelNo == TKDPO4K_VAL_DPO_4032) 
            || (instrModelNo == TKDPO4K_VAL_MSO_4032)
                || (instrModelNo == TKDPO4K_VAL_DPO_3012)
                    || (instrModelNo == TKDPO4K_VAL_DPO_3032)
                        || (instrModelNo == TKDPO4K_VAL_DPO_3052) 
                            || (instrModelNo == TKDPO4K_VAL_MSO_3052)
                                || (instrModelNo == TKDPO4K_VAL_MSO_3032)
                                    || (instrModelNo == TKDPO4K_VAL_MSO_3012) 
                                        || (instrModelNo == TKDPO4K_VAL_DPO_4102B) 
                                            || (instrModelNo == TKDPO4K_VAL_DPO_4102B_L)
                                                || (instrModelNo == TKDPO4K_VAL_MSO_4102B) 
                                                    || (instrModelNo == TKDPO4K_VAL_MSO_4102B_L))
    {   /* 2 channels */
        inputChannelList = "CH1,CH2";
        inputChListNoRF = "CH1,CH2,MATH,REF1,REF2";
        sprintf(digChList, "%s,%s", ANALOG_CHANNEL_LIST_2,DIGITAL_CHANNEL_LIST);  
    }
    if ((instrModelNo == TKDPO4K_VAL_MDO_41046) ||(instrModelNo == TKDPO4K_VAL_MDO_41043) 
		||(instrModelNo == TKDPO4K_VAL_MDO_40546) ||(instrModelNo == TKDPO4K_VAL_MDO_40543)
		||(instrModelNo == TKDPO4K_VAL_MDO_4014_3)||(instrModelNo == TKDPO4K_VAL_MDO_4014B_3)
		||(instrModelNo == TKDPO4K_VAL_MDO_4034_3)||(instrModelNo == TKDPO4K_VAL_MDO_4034B_3)
		||(instrModelNo == TKDPO4K_VAL_MDO_4054B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4054B_6)
		||(instrModelNo == TKDPO4K_VAL_MDO_4104B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4104B_6)
		||(instrModelNo == TKDPO4K_VAL_MDO_4024C)||(instrModelNo == TKDPO4K_VAL_MDO_4034C)
		||(instrModelNo == TKDPO4K_VAL_MDO_4054C)||(instrModelNo == TKDPO4K_VAL_MDO_4104C)
		)
    {
        inputChannelList = "CH1,CH2,CH3,CH4,RF";    
        sprintf(digRFChList, "%s,%s", digChList,RF_CHANNEL_SOURCE_LIST); 
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH, digRFChList)); 
    }
    if ((instrModelNo == TKDPO4K_VAL_MDO_3014)
        ||(instrModelNo == TKDPO4K_VAL_MDO_3024)
            ||(instrModelNo == TKDPO4K_VAL_MDO_3034)
                ||(instrModelNo == TKDPO4K_VAL_MDO_3054)
                    ||(instrModelNo == TKDPO4K_VAL_MDO_3104))
    {
        inputChannelList = "CH1,CH2,CH3,CH4,RF";    
        sprintf(digRFChList, "%s,%s", digChList,RF_CHANNEL_SOURCE_LIST); 
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH, digRFChList)); 
    }
    if ((instrModelNo == TKDPO4K_VAL_MDO_3012)
        ||(instrModelNo == TKDPO4K_VAL_MDO_3022)
            ||(instrModelNo == TKDPO4K_VAL_MDO_3032)
                ||(instrModelNo == TKDPO4K_VAL_MDO_3052)
                    ||(instrModelNo == TKDPO4K_VAL_MDO_3102))
    {
        inputChannelList = "CH1,CH2,RF";    
        sprintf(digRFChList, "%s,%s", digChList,RF_CHANNEL_SOURCE_LIST); 
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOGIC_INPUT_BY_CH, digRFChList)); 
    }
    
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_PROBE_ATTENUATION, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_PROBE_SENSE_VALUE, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_VERTICAL_RANGE, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_VERTICAL_OFFSET, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_VERTICAL_COUPLING, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_MAX_INPUT_FREQUENCY, inputChannelList));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_INPUT_IMPEDANCE, inputChannelList));
    
    
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOWER_THRESHOLD, inputChListNoRF));
    checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_UPPER_THRESHOLD, inputChListNoRF));
    if((instrModelNo == TKDPO4K_VAL_MSO_4104) || (instrModelNo == TKDPO4K_VAL_MSO_4054) || (instrModelNo == TKDPO4K_VAL_MSO_4034) || (instrModelNo == TKDPO4K_VAL_MSO_3014)
        || (instrModelNo == TKDPO4K_VAL_MSO_3034) || (instrModelNo == TKDPO4K_VAL_MSO_3054) || (instrModelNo == TKDPO4K_VAL_MSO_4104B) || (instrModelNo == TKDPO4K_VAL_MSO_4054B)
        || (instrModelNo == TKDPO4K_VAL_MSO_4034B)|| (instrModelNo == TKDPO4K_VAL_MSO_4032) || (instrModelNo == TKDPO4K_VAL_MSO_3012)  || (instrModelNo == TKDPO4K_VAL_MSO_3032)
        || (instrModelNo == TKDPO4K_VAL_MSO_3052) || (instrModelNo == TKDPO4K_VAL_MDO_41046)|| (instrModelNo == TKDPO4K_VAL_MDO_41043) || (instrModelNo == TKDPO4K_VAL_MDO_40546)
        || (instrModelNo == TKDPO4K_VAL_MSO_4102B) || (instrModelNo == TKDPO4K_VAL_MSO_4102B_L)|| (instrModelNo == TKDPO4K_VAL_MSO_4104B_L) || (instrModelNo == TKDPO4K_VAL_MDO_40543) 
        || (instrModelNo == TKDPO4K_VAL_MDO_4014_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4034_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4014B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4034B_3)
        || (instrModelNo == TKDPO4K_VAL_MDO_4054B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4054B_6) ||(instrModelNo == TKDPO4K_VAL_MDO_4104B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4104B_6)
        || (instrModelNo == TKDPO4K_VAL_MSO_4014B) || (instrModelNo == TKDPO4K_VAL_MDO_3012) || (instrModelNo == TKDPO4K_VAL_MDO_3014) || (instrModelNo == TKDPO4K_VAL_MDO_3022) 
        || (instrModelNo == TKDPO4K_VAL_MDO_3024) ||(instrModelNo == TKDPO4K_VAL_MDO_3032) || (instrModelNo == TKDPO4K_VAL_MDO_3034) || (instrModelNo == TKDPO4K_VAL_MDO_3052) 
        || (instrModelNo == TKDPO4K_VAL_MDO_3054) || (instrModelNo == TKDPO4K_VAL_MDO_3102) || (instrModelNo == TKDPO4K_VAL_MDO_3104)
		|| (instrModelNo == TKDPO4K_VAL_MDO_4024C) || (instrModelNo == TKDPO4K_VAL_MDO_4034C) || (instrModelNo == TKDPO4K_VAL_MDO_4054C) || (instrModelNo == TKDPO4K_VAL_MDO_4104C))
    {
            checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_DIGITAL_THRESHOLD, digChList));
    }
    if ((instrModelNo == TKDPO4K_VAL_MDO_41046) ||(instrModelNo == TKDPO4K_VAL_MDO_41043)
      ||(instrModelNo == TKDPO4K_VAL_MDO_40546) ||(instrModelNo == TKDPO4K_VAL_MDO_40543)
      ||(instrModelNo == TKDPO4K_VAL_MDO_4014_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4034_3)
      ||(instrModelNo == TKDPO4K_VAL_MDO_4014B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4034B_3)
      ||(instrModelNo == TKDPO4K_VAL_MDO_4054B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4054B_6)
      ||(instrModelNo == TKDPO4K_VAL_MDO_4104B_3) ||(instrModelNo == TKDPO4K_VAL_MDO_4104B_6)
      ||(instrModelNo == TKDPO4K_VAL_MDO_3014)	  ||(instrModelNo == TKDPO4K_VAL_MDO_3024)
      ||(instrModelNo == TKDPO4K_VAL_MDO_3034) ||(instrModelNo == TKDPO4K_VAL_MDO_3054)
      ||(instrModelNo == TKDPO4K_VAL_MDO_3104)
	  ||(instrModelNo == TKDPO4K_VAL_MDO_4024C) || (instrModelNo == TKDPO4K_VAL_MDO_4034C) 
	  || (instrModelNo == TKDPO4K_VAL_MDO_4054C) || (instrModelNo == TKDPO4K_VAL_MDO_4104C)
	  )
    {
        sprintf(rfChannelListAll, "%s,%s,%s,%s", ANALOG_CHANNEL_LIST_4,DIGITAL_CHANNEL_LIST,VIRTUAL_CHANNEL_LIST_4,RF_CHANNEL_LIST);
        sprintf(rfChannelListRFOnly, "%s,%s,%s,%s", ANALOG_CHANNEL_LIST_4,DIGITAL_CHANNEL_LIST,VIRTUAL_CHANNEL_LIST_4,RF_CHANNEL_SOURCE_LIST);
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_CHANNEL_ENABLED, rfChannelListAll));  
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH, rfChannelListRFOnly));     
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH, rfChannelListRFOnly));
            
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOGIC_THRES_BY_CH, rfChannelListRFOnly));  
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_PATTERN_INPUT, rfChannelListRFOnly));  
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_STATE_INPUT, rfChannelListRFOnly));  
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_RF_DETECTION_METHOD, "RF_NORM,RF_MINH,RF_MAXH,RF_AVE"));                                 
    } 
    if ((instrModelNo == TKDPO4K_VAL_MDO_3012)
        ||(instrModelNo == TKDPO4K_VAL_MDO_3022)
            ||(instrModelNo == TKDPO4K_VAL_MDO_3032)
                ||(instrModelNo == TKDPO4K_VAL_MDO_3052)
                    ||(instrModelNo == TKDPO4K_VAL_MDO_3102))
    {
        sprintf(rfChannelListAll, "%s,%s,%s,%s", ANALOG_CHANNEL_LIST_2,DIGITAL_CHANNEL_LIST,VIRTUAL_CHANNEL_LIST_2,RF_CHANNEL_LIST);
        sprintf(rfChannelListRFOnly, "%s,%s,%s,%s", ANALOG_CHANNEL_LIST_2,DIGITAL_CHANNEL_LIST,VIRTUAL_CHANNEL_LIST_2,RF_CHANNEL_SOURCE_LIST);
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_CHANNEL_ENABLED, rfChannelListAll));  
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_TRIGGER_UPPERTHRES_BY_CH, rfChannelListRFOnly));     
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_TRIGGER_LOWERTHRES_BY_CH, rfChannelListRFOnly));
            
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_LOGIC_THRES_BY_CH, rfChannelListRFOnly));  
        
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_PATTERN_INPUT, rfChannelListRFOnly));  
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_STATE_INPUT, rfChannelListRFOnly));  
        checkErr( Ivi_RestrictAttrToChannels (vi, TKDPO4K_ATTR_RF_DETECTION_METHOD, "RF_NORM,RF_MINH,RF_MAXH,RF_AVE"));                                 
    }
    }
    
Error:
    return error;
}

/*****************************************************************************
 *  Function: tkdpo4k_GetDriverSetupOption
 *  Purpose:  Get the value of a DriverSetup option.  The driver setup string
 *            is part of the option string the user passes to the
 *            tkdpo4k_InitWithOptions function.  Specifically it is the part
 *            that follows "DriverSetup=".  This function assumes the 
 *            DriverSetup string has the following format:
 *              "OptionTag1 : OptionValue1; OptionTag2 : OptionValue2"
 *            Leading and trailing white space is removed from the option
 *            value and both the option tag and option value may contain
 *            white space.  The option tag is case sensitive.
 *
 *            Example:
 *
 *              "DriverSetup= Model : InstrX ; Special Option:Feature Y "
 *
 *              optionTag "Model"          returns optionValue "InstrX"
 *
 *              optionTag "Special Option" returns optionValue "Feature Y"
 *****************************************************************************/
static ViStatus tkdpo4k_GetDriverSetupOption (ViSession vi,
                                               ViConstString optionTag,
                                               ViInt32 optionValueSize,
                                               ViChar optionValue[])
{                   
    ViStatus error = VI_SUCCESS;
    ViChar   setup[BUFFER_SIZE];
    ViChar*  searchOrigin;
    ViChar*  start;
    ViChar*  end;
    size_t   n;

    checkErr( Ivi_LockSession (vi, VI_NULL));

    if ((optionValue != VI_NULL) && (optionValueSize > 0))
        optionValue[0] = 0;

    if ((optionTag != VI_NULL) && (optionValue != VI_NULL) && (optionValueSize > 1))
    {
        checkErr( Ivi_GetAttributeViString (vi, "", IVI_ATTR_DRIVER_SETUP,
                                            0, BUFFER_SIZE, setup));
        searchOrigin = setup;
        while (searchOrigin != VI_NULL)
        {
            searchOrigin = strstr(searchOrigin, optionTag);
            if (searchOrigin)
            {
                searchOrigin += strlen(optionTag);
                start = searchOrigin;
                while (isspace(*start)) start++;
                if (*start == ':')                          
                {
                    start++;
                    while (isspace(*start)) start++;
                    if (*start)
                    {
                        end = strchr (start, ';');
                        if (start != end)
                        {
                            end = (end) ? --end : &setup[strlen(setup)-1];
                            while (isspace(*end)) end--;
                            n = end - start + 1;
                            if (n > optionValueSize - 1)
                                n = optionValueSize - 1;
                            strncpy(optionValue, start, n);
                            optionValue[n] = 0;
                            break;
                        }
                    }
                }
            }
        }
    }
        
Error:
    Ivi_UnlockSession (vi, VI_NULL);
    return error;
}

/***************************************************************************** 
 *------------------- End Instrument Driver Source Code ---------------------* 
 *****************************************************************************/
